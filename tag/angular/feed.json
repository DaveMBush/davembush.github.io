{
    "version": "https://jsonfeed.org/version/1",
    "title": "Dave's Notebook • All posts by \"angular\" tag",
    "description": null,
    "home_page_url": "http://davembush.github.com",
    "items": [
        {
            "id": "http://davembush.github.com/what-i-learned-writing-smart-ngrx/",
            "url": "http://davembush.github.com/what-i-learned-writing-smart-ngrx/",
            "title": "what I learned writing smart-ngrx",
            "date_published": "2024-07-20T15:12:03.000Z",
            "content_html": "<p>Last week, I announced a project I had been working on for over 10 months. I call it <a href=\"/smart-ngrx/\">SmartNgRX</a> and it solves many common issues most of us have using SmartNgRX, including the boilerplate issue, over-fetching, and memory pressure caused by stale data.</p>\n<p>Today I want to talk about a few things I learned while creating SmartNgRX that can be applied globally to any project.</p>\n<h2 id=\"No-Boilerplate-Needed\"><a href=\"#No-Boilerplate-Needed\" class=\"headerlink\" title=\"No Boilerplate Needed\"></a>No Boilerplate Needed</h2><p>While SmartNgRX solves the boilerplate issue, you can apply this to your code simply by making all your NgRX slices behave the same. Once you’ve done that, you can create a single factory function for each of your Actions, Reducers, and Effects and use that to generate the Actions, Reducers, and Effects you need.</p>\n<p>You can see how I’ve done this by looking at the source code for SmartNgRX.</p>\n<h3 id=\"Generic-Actions\"><a href=\"#Generic-Actions\" class=\"headerlink\" title=\"Generic Actions\"></a>Generic Actions</h3><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> actionGroupCache = <span class=\"keyword\">new</span> <span class=\"title class_\">Map</span>&lt;<span class=\"built_in\">string</span>, <span class=\"built_in\">unknown</span>&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> actionFactory&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">SmartNgRXRowBase</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">entity</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">): <span class=\"title class_\">ActionGroup</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> source = <span class=\"string\">`<span class=\"subst\">$&#123;feature&#125;</span><span class=\"subst\">$&#123;psi&#125;</span><span class=\"subst\">$&#123;entity&#125;</span>`</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> cached = actionGroupCache.<span class=\"title function_\">get</span>(source) <span class=\"keyword\">as</span> <span class=\"title class_\">ActionGroup</span>&lt;T&gt; | <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (cached) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> cached;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">const</span> actionGroup = <span class=\"title function_\">createActionGroup</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">source</span>: source <span class=\"keyword\">as</span> <span class=\"built_in\">any</span>,</span><br><span class=\"line\">    <span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;Update Many&#x27;</span>: props&lt;<span class=\"title class_\">UpdateChanges</span>&lt;T&gt;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Remove</span>: props&lt;<span class=\"title class_\">IdsProp</span>&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Load By Ids&#x27;</span>: props&lt;<span class=\"title class_\">IdsProp</span>&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Load By Ids Preload&#x27;</span>: props&lt;<span class=\"title class_\">IdsProp</span>&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Store Rows&#x27;</span>: props&lt;<span class=\"title class_\">RowsProp</span>&lt;T&gt;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Update</span>: props&lt;&#123; <span class=\"attr\">old</span>: <span class=\"title class_\">RowProp</span>&lt;T&gt;; <span class=\"attr\">new</span>: <span class=\"title class_\">RowProp</span>&lt;T&gt; &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Add To Store&#x27;</span>: props&lt;<span class=\"title class_\">RowProp</span>&lt;T&gt;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Add</span>: props&lt;&#123;</span><br><span class=\"line\">        <span class=\"attr\">row</span>: T;</span><br><span class=\"line\">        <span class=\"attr\">parentId</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentFeature</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentEntityName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">      &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"string\">&#x27;Add Success&#x27;</span>: props&lt;&#123;</span><br><span class=\"line\">        <span class=\"attr\">newRow</span>: T;</span><br><span class=\"line\">        <span class=\"attr\">oldRow</span>: T;</span><br><span class=\"line\">        <span class=\"attr\">parentId</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentFeature</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentEntityName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">      &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Delete</span>: props&lt;&#123;</span><br><span class=\"line\">        <span class=\"attr\">id</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">        <span class=\"attr\">parentInfo</span>: &#123; <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>; <span class=\"attr\">entity</span>: <span class=\"built_in\">string</span>; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;[];</span><br><span class=\"line\">      &#125;&gt;(),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  actionGroupCache.<span class=\"title function_\">set</span>(source, actionGroup);</span><br><span class=\"line\">  <span class=\"keyword\">return</span> actionGroup;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>A casual glance will show you that all I’ve done is wrap the <code>createActionGroup</code> function from NgRX with a function that takes a feature and entity name and returns an ActionGroup. This is a simple example of reducing boilerplate in your code. We use the feature name and the entity name to generate the source name for the ActionGroup which makes it unique.</p>\n<p>You’ll notice that I’ve also cached the <code>ActionGroup</code> so that if you call it again, you’ll get the same <code>ActionGroup</code> back. This simple optimization allows you to use the factory function to retrieve the action wherever you need it instead of passing it around. In my case, I needed this because the library doesn’t expose the actions used by NgRX and I wanted to let the developers using SmartNgRX use the actions in their code if they desired.</p>\n<h2 id=\"Reducers\"><a href=\"#Reducers\" class=\"headerlink\" title=\"Reducers\"></a>Reducers</h2><p>Similarly, I’ve wrapped <code>createReducer</code> with a factory function that takes the feature and entity name and returns a reducer. Again, this is all you need to ensure the reducer is unique.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> reducerFactory&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">SmartNgRXRowBase</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">entity</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">): <span class=\"title class_\">ActionReducer</span>&lt;<span class=\"title class_\">EntityState</span>&lt;T&gt;&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> adapter = entityDefinitionCache&lt;T&gt;(feature, entity).<span class=\"property\">entityAdapter</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> initialState = adapter.<span class=\"title function_\">getInitialState</span>();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> actions = actionFactory&lt;T&gt;(feature, entity);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title function_\">createReducer</span>(</span><br><span class=\"line\">    initialState,</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">add</span>, <span class=\"function\">(<span class=\"params\">state, &#123; row &#125;</span>) =&gt;</span> adapter.<span class=\"title function_\">upsertOne</span>(row, state)),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">addSuccess</span>, <span class=\"function\">(<span class=\"params\">state, &#123; newRow &#125;</span>) =&gt;</span></span><br><span class=\"line\">      adapter.<span class=\"title function_\">upsertOne</span>(newRow, state),</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">updateMany</span>, <span class=\"function\">(<span class=\"params\">state, &#123; changes &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> adapter.<span class=\"title function_\">updateMany</span>(changes, state);</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">remove</span>, <span class=\"function\">(<span class=\"params\">state, &#123; ids &#125;</span>) =&gt;</span> adapter.<span class=\"title function_\">removeMany</span>(ids, state)),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">update</span>, <span class=\"function\">(<span class=\"params\">state, &#123; <span class=\"keyword\">new</span>: &#123; row &#125; &#125;</span>) =&gt;</span></span><br><span class=\"line\">      adapter.<span class=\"title function_\">upsertOne</span>(row, state),</span><br><span class=\"line\">    ),</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">storeRows</span>, <span class=\"function\">(<span class=\"params\">state, &#123; rows &#125;</span>) =&gt;</span> adapter.<span class=\"title function_\">upsertMany</span>(rows, state)),</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Effects\"><a href=\"#Effects\" class=\"headerlink\" title=\"Effects\"></a>Effects</h2><p>Finally, I’ve wrapped <code>createEffect</code> with a factory function that takes the feature and entity name and returns an effect. This is the same as the other two examples.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> effectsFactory&lt;T <span class=\"keyword\">extends</span> <span class=\"title class_\">SmartNgRXRowBase</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">feature</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">entityName</span>: <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">effectsServiceToken</span>: <span class=\"title class_\">InjectionToken</span>&lt;<span class=\"title class_\">EffectService</span>&lt;T&gt;&gt;,</span><br><span class=\"line\">): <span class=\"title class_\">Record</span>&lt;<span class=\"title class_\">EffectsFactoryKeys</span>, <span class=\"title class_\">FunctionalEffect</span>&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> actions = actionFactory&lt;T&gt;(feature, entityName);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> entityDefinition = entityDefinitionCache&lt;T&gt;(feature, entityName);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> adapter = entityDefinition.<span class=\"property\">entityAdapter</span>;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to delete the row specified</span></span><br><span class=\"line\"><span class=\"comment\">     * by the ID in the action.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">delete</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      <span class=\"title function_\">deleteEffect</span>(effectsServiceToken, actions),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to determine what rows</span></span><br><span class=\"line\"><span class=\"comment\">     * need to be loaded yet and returns dummy rows for those rows.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">loadByIdsPreload</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      <span class=\"title function_\">loadByIdsPreloadEffect</span>(feature, entityName, actions),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to load the rows specified</span></span><br><span class=\"line\"><span class=\"comment\">     * from the server.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">loadByIds</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      <span class=\"title function_\">loadByIdsEffect</span>(effectsServiceToken, actions, feature, entityName),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to update the row specified</span></span><br><span class=\"line\"><span class=\"comment\">     * by the row in the action.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">update</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      updateEffect&lt;T&gt;(effectsServiceToken, actions, feature, entityName),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Ends up calling the `EffectService` to add the row specified</span></span><br><span class=\"line\"><span class=\"comment\">     * by the row in the action.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">add</span>: <span class=\"title function_\">createEffect</span>(<span class=\"title function_\">addEffect</span>(effectsServiceToken, actions), dispatchTrue),</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Handles adding the new row to the store and removing the dummy row</span></span><br><span class=\"line\"><span class=\"comment\">     * that was added so we could edit it.</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"attr\">addSuccess</span>: <span class=\"title function_\">createEffect</span>(</span><br><span class=\"line\">      addSuccessEffect&lt;T&gt;(effectsServiceToken, actions, adapter),</span><br><span class=\"line\">      dispatchFalse,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>By now, you get the general idea. A couple of things to note about the <code>effectsFactory</code>.</p>\n<p>First we pass in an <code>InjectionToken</code> that is used to get the <code>EffectService</code> that is used by the effects. By doing this, all we need to do is make sure your effects services conform to the <code>EffectService</code> abstract class and we can use them in the effects.</p>\n<p>This is how SmartNgRX can hide NgRX from the developer and just let them implement the specifics for each entity.</p>\n<p>You’ll also notice that to keep the code clean, I’ve implemented the details in other functions that I call. If you want to see the details, you can <a href=\"https://github.com/DaveMBush/SmartNgRX/tree/cbec5143855b1916e0c67776b22a6134a18d5ee4/libs/smart-ngrx/src/effects\">look at the source code for the effects in SmartNgRX</a>.</p>\n<p>Second, we use the cached <code>ActionGroup</code> by calling the <code>actionFactory</code> function to get the actions we need for the effects instance. Now we don’t need to know about a specific instance and find some way to pass it into the effect.</p>\n<p>Finally, we need access to the EntityAdapter for the entity we are working with. We create the entity adapter when we configure SmartNgRX. The two lines of code, above, that retrieve the adapter are retrieving it from a map where we set it during SmartNgRX setup</p>\n<p>And that’s how you avoid NgRX boilerplate in your code.</p>\n<h2 id=\"Too-Many-Actions-and-Reducers\"><a href=\"#Too-Many-Actions-and-Reducers\" class=\"headerlink\" title=\"Too Many Actions and Reducers\"></a>Too Many Actions and Reducers</h2><p>I’ve been saying this for several years and still managed to get this “wrong” while writing my code.</p>\n<p>Here’s the basic issue. Reducers and Effects have specific purposes. Where I went wrong is with my reducers. But I’ll address both Reducers and Effects here.</p>\n<p>But first, let’s take a detour and talk about an ideal NgRX setup.</p>\n<p>The Redux pattern, generally, and NgRX, specifically, were created to store states predictably. “State only” is my motto. This means that logic should be kept out of our NgRX code. This keeps our NgRX code simple and reduces bugs. You wouldn’t believe some of the code I’ve seen that violates this principle. Then again, you could. You’ve probably written it.</p>\n<p>So, if we want to keep logic out of NgRX, where should it go?</p>\n<p>It goes in a service. When you call an action, it should already have the data in the form that NgRX ultimately needs. The reducer can then take this data and store it in the store without doing anything to it.</p>\n<p>Notice how small my reducer code is.</p>\n<p>Similarly, when you call an effect, it should already have the data to do whatever it needs. Again, in an ideal world, all the effect does is call what I’ve come to term the effect service. The effect service can do whatever work needs to be done.</p>\n<p>For example, say you are calling the server, but the shape of the data you get back isn’t what your application will need. The place to do the transformation is in the effect service. Not in the effect.</p>\n<p>By doing this, you’ll only need actions that perform basic CRUD operations. You shouldn’t see actions for every possible way you could change the state of your application. Most of that can, and should, be handled in a service.</p>\n<p>There has been a lot of noise in the community about using the “facade” pattern with NgRX but most implementations I’ve seen just put a class in front of the same actions we’ve always had. This is not a facade pattern. This is just a bulky, excessive layer in front of what we’ve always been doing.</p>\n<p>What I’m doing is closer to a facade pattern because now all those action calls become calls to a service. The service does the transformations and dispatches whatever action is appropriate to update the store.</p>\n<p>Moreover, by doing this, the question of using the command or event patterns with NgRX becomes moot. The argument for using the event pattern is that your actions now give you some idea of what triggered them by using the action name as the where. In the pattern I’ve described, 100% of your actions (should) get triggered by the same code every time if you’ve structured things correctly.  That code gets triggered by multiple other places just like any other function in your code does. Now, you can evaluate the call stack. You can still use the event pattern. But, there isn’t a strong argument for it anymore.</p>\n<p>The best part about using this pattern is that I’m in a great position to convert SmartNgRX to use Signals instead of Observables and most of my code won’t change.</p>\n<p>As far as NgRX code is concerned, the only NgRX place you should have any logic at all is in Selectors, but that’s a topic for another day.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "smart-ngrx"
            ]
        },
        {
            "id": "http://davembush.github.com/smart-ngrx/",
            "url": "http://davembush.github.com/smart-ngrx/",
            "title": "smart-ngrx",
            "date_published": "2024-07-07T17:36:27.000Z",
            "content_html": "<p>Imagine an NgRX world where you almost never knew you were using NgRX. A world where you never had to write a <code>reducer</code>, <code>action</code>, or <code>effect</code>. A world where you never had to call <code>store.dispatch()</code>. A world where the data you worked automatically persist to the server. A world where the data is retrieved from the server as it is needed and removed from memory when it is not, or never removed if that’s what you want. A world where the data automatically refreshes from the server, or you can use websocket messages to refresh the data and, in either case, the only data that refreshes is the data the code is actively using. A world where optimistic UI is built into the framework.</p>\n<span id=\"more\"></span>\n\n<p>Introducing <a href=\"https://www.npmjs.com/package/@smarttools/smart-ngrx\">SmartNgRX</a>. A framework I’ve been working on for over a year that does everything I just mentioned and more. It’s a framework that is built on top of NgRX and works with your existing NgRX code.</p>\n<p>The full documentation is available at <a href=\"https://davembush.github.io/SmartNgRX/home\">SmartNgRX Documentation</a> but let me give you a brief overview of how it works.</p>\n<h2 id=\"Brief-Overview\"><a href=\"#Brief-Overview\" class=\"headerlink\" title=\"Brief Overview\"></a>Brief Overview</h2><p>First, there are two providers you will need to add to your application. The first is <code>provideSmartNgRX()</code> which is added to the <code>providers</code> array in you <code>AppModule</code>. The second is <code>provideSmartNgRX()</code> which is added to the module, or route, nearest where you’ll use it.</p>\n<p>These two providers setup the configuration information that SmartNgRX will need to work. They control things such as how often to refresh the data, when to remove unused data from memory, what service to call to retrieve the data for an NgRX slice looks like and what a placeholder row looks like for a particular slice of data.</p>\n<p>In order for you to define the service an the SmartNgRX effect will call, you’ll need to create an EffectService. This service is where you control how the CRUD operations interact with the server. This and the selectors are the only code you’ll need to write.</p>\n<p>Which brings us to the selectors. Instead of using the <code>createSelector</code> function from NgRX, you’ll use the <code>createSmartNgRXSelector</code> function from SmartNgRX. This function defines the relationship between a parent selector and any children it may have.</p>\n<p>That’s it. All the other code you normally write is handled by SmartNgRX.</p>\n<p>Give it a try and let me know what you think.</p>\n",
            "tags": [
                "angular",
                "ngrx"
            ]
        },
        {
            "id": "http://davembush.github.com/optimizing-angular-for-speed/",
            "url": "http://davembush.github.com/optimizing-angular-for-speed/",
            "title": "Optimizing Angular For Speed",
            "date_published": "2024-03-09T13:34:41.000Z",
            "content_html": "<p>I was recently asked how I would optimize an Angular site for speed. Interestingly, I’ve never written about this explicitly even though I’ve done a lot of work related to this issue.</p>\n<p>For the purposes of this article, I’m going to assume you have already implemented most of the things that Angular gives you “for free.” For example, we won’t discuss “Tree Shaking” or “AOT.” Those are given.</p>\n<p>Here are my 30 or so tips on how to optimize an Angular application for speed.</p>\n<span id=\"more\"></span>\n<h2 id=\"Change-Detection\"><a href=\"#Change-Detection\" class=\"headerlink\" title=\"Change Detection\"></a>Change Detection</h2><h3 id=\"OnPush-Notification\"><a href=\"#OnPush-Notification\" class=\"headerlink\" title=\"OnPush Notification\"></a>OnPush Notification</h3><p>Much has been written about how Angular Change Detection works, so I’m not going to go into much detail about this other than reiterate the basics.</p>\n<p>Without OnPush notification, angular will check the component to see if anything changes whenever an event occurs. This means something as simple as a mouse move will cause change detection evaluation.</p>\n<p>With OnPush, change detection on a component will happen only if one of the component’s properties (field marked with @Input() attribute) has changed or if you’ve explicitly told Angular that a change has occurred.</p>\n<p>In my experience, this isn’t going to generate enough of a performance difference that you can measure in seconds. But it will make a difference overall and is generally a quick win. So, start here.</p>\n<p>One quick way to ensure all your future components use OnPush when using the CLI to generate components is to ensure you add the OnPush configuration to your Angular.json file.</p>\n<p>You can find a good article about this <a href=\"https://indepth.dev/overriding-angular-schematics/\">here</a>.</p>\n<h3 id=\"Small-Components\"><a href=\"#Small-Components\" class=\"headerlink\" title=\"Small Components\"></a>Small Components</h3><p>OnPush notification is only going to be useful if your components are small. Remember that once change detection has determined the component is dirty and needs to be re-rendered, the WHOLE component will be re-calculated even though there is no Virtual DOM diffing in IVY.</p>\n<h3 id=\"Run-Outside-Zones\"><a href=\"#Run-Outside-Zones\" class=\"headerlink\" title=\"Run Outside Zones\"></a>Run Outside Zones</h3><p>It helps to understand how change detection works in Angular to optimize Angular change detection. Part of that equation is that it hooks into the fired events. This is how, for example, Angular knows it should update your screen when a click event occurs or when data is returned from an HttpClient request.</p>\n<p>But sometimes, we may trigger that event in our code when we know that change detection is unnecessary.</p>\n<p>For example, I have code that runs every 20 seconds to see if we should automatically log the user out. To keep this from running the change detection logic, I run this outside of the Zones logic.</p>\n<p>The specific API you are looking for, is <code>Zones.runOutsideAngular()</code></p>\n<p>Another place to look out for is the time-based RxJS operators such as <code>debounceTime()</code>, <code>throttleTime()</code>, etc. These operators will trigger change detection every time they fire. If you are using them in your code, consider running them outside of the Zones logic or use unpatched versions of the operators.</p>\n<h3 id=\"Turn-Off-Zones\"><a href=\"#Turn-Off-Zones\" class=\"headerlink\" title=\"Turn Off Zones\"></a>Turn Off Zones</h3><p>Change detection might get triggered in multiple ways. And, in fact, your app probably doesn’t need all of them.</p>\n<p>You can turn things off using <code>__Zone_ignore_on_properties</code>.</p>\n<p>There is more information on this <a href=\"https://github.com/angular/zone.js/blob/master/STANDARD-APIS.md\">here</a>.</p>\n<p>That being said, I’ve done some performance testing and it turns out that <a href=\"../ngzones-performance-impact/\">Change Detection is not the first place to look if your screen is rendering slowly</a>.</p>\n<h3 id=\"Use-Pipes\"><a href=\"#Use-Pipes\" class=\"headerlink\" title=\"Use Pipes\"></a>Use Pipes</h3><p>This tip is only really valuable in the cases where the Functional programming’s pure functions is relevant.</p>\n<p>The idea behind pure functions, at least as it applies to pipes, is that a pure function will always return the same value when given the same parameters. So, for example, the function <code>Add(a, b)</code> will always return 4 given the parameters 2 and 2.</p>\n<p>Why recompute the value when you give it the same parameters as the previous time you called it?</p>\n<p>Using memoization, you can further take advantage of this optimization on functions that take extra time. This is what Angular Pipes do for you under the hood. But by implementing it yourself, you can cache more than the last value. I’m talking about the practice of holding onto a computed value and using the parameters as a key to look up the return value. Thus avoiding the computation completely.</p>\n<p>Use this optimization tip intelligently, though. Sometimes, values might be “the same,” but the content is different. I’m thinking about times when you would mutate the contents of an object. Say an array you added a value to instead of creating a new array. The array object pointer is still the same, so your pure function will not recompute the return value because the pointer didn’t change.</p>\n<p>If OnPush isn’t giving you all the optimization that you are looking for, creating a pure Pipe is the next step along the same lines.</p>\n<p>However, this is one place where I’d spend the extra time to verify that my “optimization” isn’t making the performance worse.</p>\n<h3 id=\"Use-NgRX-Selectors\"><a href=\"#Use-NgRX-Selectors\" class=\"headerlink\" title=\"Use NgRX Selectors\"></a>Use NgRX Selectors</h3><p>Many people aren’t aware that NgRX has a Selector mechanism allowing memoization. When you call the Selector,  if nothing it depends on has changed, you get back the same answer you got the previous time you executed the method without having to run all the code that gave you the answer the first time.</p>\n<p>It also looks a lot cleaner than the <code>() =&gt; state.subState</code> mechanism we started out with.</p>\n<p>Note that parameterized selectors can’t take advantage of this memoization unless you roll your own.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> selectMemoizedThing = <span class=\"title function_\">createSelector</span>(...);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vs</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">selectCantBeMemoized</span> = (<span class=\"params\">param</span>) =&gt;</span><br><span class=\"line\">  <span class=\"title function_\">createSelector</span>(... uses param <span class=\"keyword\">in</span> here...)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Don’t-Bind-to-Computed-Values\"><a href=\"#Don’t-Bind-to-Computed-Values\" class=\"headerlink\" title=\"Don’t Bind to Computed Values\"></a>Don’t Bind to Computed Values</h3><p>If your value is computed, Angular can’t easily determine if it has changed unless it calculates it.</p>\n<p>There are three ways to solve this issue.</p>\n<p>The first and most popular is to use a pipe, as described above. But it is the least desirable because it still forces the change detector to do more work than necessary.</p>\n<p>The second way to achieve this goal is by assigning a member field the computed value during the component’s <code>ngOnChanges</code> event. Do this when the computed value uses values all internal to the component.</p>\n<p>Third, you can perform ALL the calculations in a Selector so that the data you need is already available and is easy to detect by the time you are binding.</p>\n<p>Finally, if you can, do the computation on the server so it isn’t even an issue on the client.</p>\n<p>For more information on this topic see my article <a href=\"../how-to-avoid-binding-to-computed-values-in-angular/\">How to Avoid Binding to Computed Values in Angular</a></p>\n<h3 id=\"NgRX-Features\"><a href=\"#NgRX-Features\" class=\"headerlink\" title=\"NgRX Features\"></a>NgRX Features</h3><p>And while we are on the subject of NgRX, instead of creating one monster state to rule them all in the AppModule, use the Features to only instantiate the store reducers, effects, etc., as you need them.</p>\n<h3 id=\"Use-RxJS-distinct\"><a href=\"#Use-RxJS-distinct\" class=\"headerlink\" title=\"Use RxJS distinct()\"></a>Use RxJS distinct()</h3><p>Did you know that your component is probably re-rendering more times than needed? This is because <code>@Input()</code> values will mark the component every time it thinks it might have received a new value. You can prevent this by using <code>distinctUntilChanged()</code> on the Observable.</p>\n<h3 id=\"Use-RxJX-replay\"><a href=\"#Use-RxJX-replay\" class=\"headerlink\" title=\"Use RxJX replay()\"></a>Use RxJX replay()</h3><p>Another trick you can use is to use <code>replay()</code> on the Observable. There are various ways to configure this, but the advantage is that this is another way to prevent calculations you don’t need. If the value isn’t going to change as you render the content multiple times on the screen, you only need to compute once and allow <code>replay()</code> to memoize the return.</p>\n<p>Be careful with this trick though, because using it incorrectly can cause memory leaks.</p>\n<h3 id=\"Use-RxJS-asapScheduler\"><a href=\"#Use-RxJS-asapScheduler\" class=\"headerlink\" title=\"Use RxJS asapScheduler\"></a>Use RxJS asapScheduler</h3><p>There are times when you need to schedule a task to run as soon as possible but asynchronously.</p>\n<p>You might think the best way to do this is by using interval(0) or some other mechanism.</p>\n<p>Maybe you want to use debounceTime(0) or throttleTime(0) to prevent the task from running too often.</p>\n<p>Did you know that RxJS has another scheduler, called the asapScheduler that allows you to run things faster than the default scheduler?</p>\n<p>The default scheduler uses the “macro queue”. This is what setTimeout() uses. The asapScheduler uses the “micro queue” which is what Promise.resolve uses.</p>\n<p>The difference is that if you schedule something with setTimeout(), and then run something with Promise.resolve(), the Promise.resolve() will run first. Make those asynchronous calls seems a bit more synchronous.</p>\n<h3 id=\"Upgrade-to-IVY\"><a href=\"#Upgrade-to-IVY\" class=\"headerlink\" title=\"Upgrade to IVY\"></a>Upgrade to IVY</h3><p>In general, I suggest that you always keep your Angular version up to date.</p>\n<p>While we are on the topic of upgrades, in an enterprise environment, I suggest never to fall more than 2 major versions behind and never use the current major version. I keep my team using the latest version of the major version before the current version. This keeps us relatively current but far enough behind that someone else has figured out all the quirks of the version we are using.</p>\n<p>At a minimum, ensure you use a version that uses the IVY rendering engine to take advantage of the performance gains it introduced.</p>\n<h2 id=\"Be-smart-about-HTML-and-CSS\"><a href=\"#Be-smart-about-HTML-and-CSS\" class=\"headerlink\" title=\"Be smart about HTML and CSS\"></a>Be smart about HTML and CSS</h2><h3 id=\"Style-the-Host-of-your-Components\"><a href=\"#Style-the-Host-of-your-Components\" class=\"headerlink\" title=\"Style the Host of your Components\"></a>Style the Host of your Components</h3><p>Another place you can eak out a bit of performance without a lot of work is by eliminating the wrapping DIV element from your components.</p>\n<p>Most Angular developers are unaware that when the HTML template is rendered, the tag you use to render the component is also rendered.  So if you have a component who’s tag is &lt;foo&gt; and inside that component you included a DIV element that wraps all your control’s content, what actually renders on the screen is</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">foo</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    html for component here</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">foo</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Now, it is true that the &lt;foo&gt; will get ignored by the browser. But it still has to evaluate it and determine that it shouldn’t do anything with it and it is extra context that has to be packaged by webpack.</p>\n<p>By styling &lt;foo&gt; to look like a DIV element by using</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-pseudo\">:host</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  ... whatever other styling you</span><br><span class=\"line\">  might have given your <span class=\"selector-tag\">div</span> tag here</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>we can eliminate the inner DIV from our component and gain a bit of performance without going to a lot of trouble. The amount of performance gain you will see will depends on how many child components are being displayed at any one time.</p>\n<h3 id=\"Don’t-overuse-SASS-x2F-SCSS\"><a href=\"#Don’t-overuse-SASS-x2F-SCSS\" class=\"headerlink\" title=\"Don’t overuse SASS&#x2F;SCSS\"></a>Don’t overuse SASS&#x2F;SCSS</h3><p>My general advice is to use CSS for your application and SASS for your component library or theme. Although, even in your component library, most of what you need to do can be done easily with CSS.</p>\n<p>I admit. When LESS and SASS first came out, I saw all the advantages. Since then, I’ve been persuaded by three events.</p>\n<p>First, if you write your Angular components small enough and use view encapsulation, you shouldn’t need any of the features that SASS would provide.</p>\n<p>Second, I’ve seen SASS abused more often than I’ve seen it used well. One project I worked on had 200 character class names because one of the developers was using &amp; to concatenate the class names. The template code was cluttered with these long class names, making it difficult to read. Please! Don’t do this to your future self!</p>\n<p>Third, CSS has grown up. CSS variables now do most of what we may have needed to use SASS for. And, if you can keep your font and color information strictly in a theme.css file, you should never need to access them from your application components.</p>\n<p>Simple CSS is performant CSS.</p>\n<h3 id=\"ng-content-Bad-Practices\"><a href=\"#ng-content-Bad-Practices\" class=\"headerlink\" title=\"ng-content Bad Practices\"></a>ng-content Bad Practices</h3><p>I’ve only recently realized that some of you are doing some pretty strange things with <code>ng-content</code>, and then you wonder why your application is slow.</p>\n<p>As a refresher, &#96;ng-content&#96;&#96; is what you use when you want to use content projection to pass content into a component. For example, if you wanted to pass in a list of items to a component, you might do something like this:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">my-component</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> *<span class=\"attr\">ngFor</span>=<span class=\"string\">&quot;let item of items&quot;</span>&gt;</span></span><br><span class=\"line\">    &#123;&#123;item&#125;&#125;</span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">my-component</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Now, the first thing you should ask yourself here is, “Do I need to use content projection here?”</p>\n<p>We’ve found a significant performance penalty for using content projection. So, if you can avoid it, you should.</p>\n<p>Notice, I said avoid. Not eliminate. There are some valid reasons for using content projections. For example, low-level components often need to use content projection because they could be a container for displaying anything.</p>\n<p>But, if you are using content projection to display exactly the same content or choice of content every time, consider eliminating the content projection and just hard-coding the content into the component. This will make the code easier to understand, and it will make the content render faster.</p>\n<p>The other crazy implementation I’ve seen recently is using ngIf inside ng-content.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">ng-content</span> *<span class=\"attr\">ngIf</span>=<span class=\"string\">&quot;foobar&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">ng-content</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>It may not be obvious, but you should evaluate your DOM when the page is rendered with foobar equal to false. What you’ll see may surprise you. Inside of ng-content will be all the elements that are projected into the ng-content DOM element, but they will all be hidden.</p>\n<p>So what? So, they will all have to be evaluated by the browser even though they aren’t visible. This is a waste of resources and time rendering.</p>\n<h3 id=\"Data-Binding-Issues\"><a href=\"#Data-Binding-Issues\" class=\"headerlink\" title=\"Data Binding Issues\"></a>Data Binding Issues</h3><h4 id=\"innerHTML\"><a href=\"#innerHTML\" class=\"headerlink\" title=\"innerHTML\"></a>innerHTML</h4><p>Did you know that binding data to <code>innerHTML</code> is slower than binding to the interpolation markers within the element?</p>\n<p>Often, we use</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> [<span class=\"attr\">innerHTML</span>]=<span class=\"string\">&quot;someValue&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>instead of</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;&#123;someValue&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>to get around string sanitation issues (which is another problem) but then we get someone on our team who is just learning Angular and they do this by default.</p>\n<p>In both cases, however, you’ll find if you measure the performance that the interpolation markers are significantly faster than the innerHTML binding.</p>\n<h4 id=\"Avoid-Binding-to-Functions\"><a href=\"#Avoid-Binding-to-Functions\" class=\"headerlink\" title=\"Avoid Binding to Functions\"></a>Avoid Binding to Functions</h4><p>We mentioned this above but, another place where you can eak out a bit of performance is by avoiding binding to functions. If you do, you can use a pipe to memoize the return value of the function. But, using a pipe is the lazy man’s way of optimizing against the function issue.</p>\n<p>Why? Because you are still have the overhead of calling a function every time change detection runs, you just aren’t doing the calculation every time. It is better than doing the calculation but it is worse than binding to a field where the change detector can see if anything changed before it does anything else.</p>\n<p>In the interviews we run, we have a section that covers this issue. Code is clearly calling a function inside the template.  We are happy with the “use a pipe” answer. But I’m even more impressed if someone says something like, “This should all be done on the server, or if it can’t be done on the server, it should be done when we retrieve the data from the server.”</p>\n<p>But this can’t always be done. So, if you are going to bind to a function, ask yourself, “how far down the stack can I move this functionality?”</p>\n<p>In order of possibilities, I’d suggest:</p>\n<ul>\n<li>Do the calculation in the pipe if nothing else is possible</li>\n<li>Do the calculation in the component’s TS file when the @Input() value changes</li>\n<li>Do the calculation in a Selector that the component is looking at</li>\n<li>Do the calculation right after you retrieve the data from the server</li>\n<li>Do the calculation on the server</li>\n</ul>\n<h3 id=\"HostBinding\"><a href=\"#HostBinding\" class=\"headerlink\" title=\"HostBinding()\"></a>HostBinding()</h3><p>Related to binding to functions, keep in mind that @HostBinding is databinding.  If you @HostBinding is using a function, it has the same issues as binding to a function in the template.</p>\n<h3 id=\"Dynamic-CSS-Classes\"><a href=\"#Dynamic-CSS-Classes\" class=\"headerlink\" title=\"Dynamic CSS Classes\"></a>Dynamic CSS Classes</h3><p>There are multiple ways of dynamically adding classes to an element. Each one of them, essentially do the same thing. But worse, they all do them individually. So, if you end up using all three methods in your code, you are going to make at least 3 calls to the DOM to add or remove the class.</p>\n<p>Currently, using <code>ngClass</code> adds and removes each class in it individually. You’d think it would be optimized to add them more efficiently but currently (2023-11-11) they do not.</p>\n<p>I’m hoping this gets fixed by the next major version of Angular.</p>\n<h3 id=\"SVG-references-vs-SVG-inlining\"><a href=\"#SVG-references-vs-SVG-inlining\" class=\"headerlink\" title=\"SVG references vs SVG inlining\"></a>SVG references vs SVG inlining</h3><p>Another similar, hidden performance issue is the use of SVG Inlining. When you inject an SVG image into the page using inlining, the browser must evaluate the DOM elements. If you inline the same SVG image multiple times, the browser has to evaluate the DOM elements multiple times.</p>\n<p>The cure is to inline the SVG images once, and then, when you need to display the image, you can reference it using the SVG reference mechanism. There are multiple ways you might do this. One is to load them up front using a sprite and inject the sprite into the DOM. Another would be to inject the SVG image into the DOM using JavaScript the first time it is used and then reference it from that point forward.</p>\n<h3 id=\"Measure-your-CSS\"><a href=\"#Measure-your-CSS\" class=\"headerlink\" title=\"Measure your CSS\"></a>Measure your CSS</h3><p>The most overlooked area of performance I know of is measuring CSS. I can’t go into a lot of detail about this here because it would take far too much time to explain (and read about) but there are good articles on the internet that discuss measuring browser performance using flame charts and other mechanisms that are part of your browser’s developer tools.</p>\n<h2 id=\"Compile-for-Production\"><a href=\"#Compile-for-Production\" class=\"headerlink\" title=\"Compile for Production\"></a>Compile for Production</h2><p>Another place where we shouldn’t have to mention that it is even an option is compiling for production. </p>\n<p>In one product I worked on, I discovered we were deploying code using the development environment instead of the production environment. I only discovered this because we were getting the change detection after change warning in production. That’s the most notable difference. But this check happens with every change detection cycle and further slows down the code.</p>\n<h2 id=\"Cache-your-code-on-the-browser\"><a href=\"#Cache-your-code-on-the-browser\" class=\"headerlink\" title=\"Cache your code on the browser\"></a>Cache your code on the browser</h2><p>If you build your application with an option that attaches a hash code to the file name, you can cache your javascript code on the browser so that the next time that browser tries to access the code, it will load it from the cache.</p>\n<p>Do not cache your index.html file, as you need to make sure that file always gets downloaded.</p>\n<p>Specifically, the options you want to implement on your server for your static files are:</p>\n<ul>\n<li>immutable</li>\n<li>max-age 365</li>\n</ul>\n<p>This will prevent the browser from even checking the server for new code.</p>\n<h2 id=\"CDN\"><a href=\"#CDN\" class=\"headerlink\" title=\"CDN\"></a>CDN</h2><p>Similarly, putting your files closer to the people retrieving them will improve your performance around “time to first render.”</p>\n<h2 id=\"Perception-Beats-Reality\"><a href=\"#Perception-Beats-Reality\" class=\"headerlink\" title=\"Perception Beats Reality\"></a>Perception Beats Reality</h2><p>One place that gets overlooked when discussing performance is the “time to first render.”</p>\n<p>We recently ran into a situation where the code took so long to load that the client didn’t even see the spinner we had put in place to indicate we were loading data.</p>\n<p>To fix this, we added spinner code directly into our html file. It takes slightly longer to load the index.html file but displays more quickly than if we waited for our javascript to load.</p>\n<h2 id=\"TrackBy-X-in-ngFor\"><a href=\"#TrackBy-X-in-ngFor\" class=\"headerlink\" title=\"TrackBy X in ngFor\"></a>TrackBy X in ngFor</h2><p>Another way to eak out more performance is by implementing the <code>trackBy</code> property in your <code>ngFor</code> loops.</p>\n<p>This is particularly useful when displaying a list that updates multiple times from the server. Because it is a brand-new object, every refresh will update the whole list.</p>\n<p>By using trackBy, you can tell Angular only to update the elements in the list that have changed by whatever you specify in TrackBy.</p>\n<h2 id=\"Lazy-Loading\"><a href=\"#Lazy-Loading\" class=\"headerlink\" title=\"Lazy Loading\"></a>Lazy Loading</h2><h3 id=\"Lazy-Load-Routes\"><a href=\"#Lazy-Load-Routes\" class=\"headerlink\" title=\"Lazy Load Routes\"></a>Lazy Load Routes</h3><p>Most applications have multiple routes that they access. But even if yours doesn’t, you should set your code up to use Lazy Loading for three reasons.</p>\n<p>First, small apps grow up. Eventually, you will have multiple routes. If your app is so small that it doesn’t, implementing Lazy Loading of routes isn’t going to hurt anything.</p>\n<p>Second, implementing Lazy Loading will break your code down further into multiple files. Most of the code in those files will never change, so once they are loaded and cached as instructed above, the only code that will ever need to be downloaded is code in your route when it changes.</p>\n<p>Third, having more files to download could help in the initial load of your application, as the client now has more opportunities to download the files in parallel. Measure this! I’ve seen this overused to the point of causing worse performance!</p>\n<h3 id=\"Pre-load-Lazy-Loaded-Routes\"><a href=\"#Pre-load-Lazy-Loaded-Routes\" class=\"headerlink\" title=\"Pre-load Lazy Loaded Routes\"></a>Pre-load Lazy Loaded Routes</h3><p>Once you’ve started your app, you should load all the other routes in the background so your customer doesn’t have to wait for the next page to render.</p>\n<p>This is even more important when your application is on a mobile device that doesn’t have an Internet connection at times.</p>\n<p>You can also be selective about which routes you pre-load.</p>\n<h3 id=\"Lazy-Loading-Resources\"><a href=\"#Lazy-Loading-Resources\" class=\"headerlink\" title=\"Lazy Loading Resources\"></a>Lazy Loading Resources</h3><p>Angular does most of this for you. Especially as it concerns CSS, but if your application has a lot of images, you should consider lazy loading those images.</p>\n<h3 id=\"Virtual-Scrolling\"><a href=\"#Virtual-Scrolling\" class=\"headerlink\" title=\"Virtual Scrolling\"></a>Virtual Scrolling</h3><p>There are multiple implementations of this. But the idea is only to render what the user can see as the user scrolls rather than rendering everything into the DOM and then letting the browser to the scrolling.</p>\n<p>I reduced the rendering time from 8 seconds to 1 second on one mega app I worked on by implementing this concept.</p>\n<h2 id=\"Good-Architecture\"><a href=\"#Good-Architecture\" class=\"headerlink\" title=\"Good Architecture\"></a>Good Architecture</h2><h3 id=\"General-Patterns-and-Practices\"><a href=\"#General-Patterns-and-Practices\" class=\"headerlink\" title=\"General Patterns and Practices\"></a>General Patterns and Practices</h3><p>I’ve worked on optimizing an application where one of the first things we did was to straighten out the basic architecture.<br>I often tell people, “If you had any idea how software gets created, you’d be amazed that anything works as well as it does.” This application was no different.</p>\n<p>Someone had wanted to implement a feature in the next version of NgRX, so they copied code from the next version into the version we were using.</p>\n<p>It sounds harmless. But the result was the NgRX change detection got thrown into a loop that took thousands of cycles to resolve instead of just one or two. This, in turn, slowed the rendering time down on the application to a point where just switching routes took multiple seconds. On the order of 5–10 seconds.</p>\n<p>Upgrading the application to the version we wanted to use solved the problem.</p>\n<p>Other similar issues with this code were solved simply by fixing how the code had been assembled.</p>\n<h3 id=\"Avoid-Code-That-Changes-Angular\"><a href=\"#Avoid-Code-That-Changes-Angular\" class=\"headerlink\" title=\"Avoid Code That Changes Angular\"></a>Avoid Code That Changes Angular</h3><p>Similar to the issue above is code that adds directives or other functionality that changes how Angular fundamentally works.</p>\n<p>There are two major reasons for this. The first is that we always want to be able to enlist people to help us with our code. Most of the time, we are trying to hire good Angular developers. If our code no longer looks like Angular, why hire Angular developers?</p>\n<p>Second, if the code changes how Angular works, it is probably hooking into some Angular internal that could change in a subsequent version of Angular. This means that you will have to wait for the code’s author to update their code before you can upgrade your application.</p>\n<p>Third, you can’t be sure some little project that thought it would be cool to add some feature to Angular to get around some perceived issue has fully tested their code. You could introduce a bug into your application that you must track down.</p>\n<p>Finally, you have to ask yourself. Does this feature, or set of features, solve a problem that would still exist if I’d written my code correctly in the first place? The one package I have in mind as I write this has contributed more to the technical debt on my project than any other package or programmer we’ve had interact with our code.</p>\n<p>Be careful what code you allow into your application; it could cost you far more than it is worth in the long run.</p>\n<h2 id=\"Data-Access\"><a href=\"#Data-Access\" class=\"headerlink\" title=\"Data Access\"></a>Data Access</h2><p>So far, we’ve talked about what to do once we’ve retrieved the data into our application, but many performance issues can be avoided simply by paying attention to how and when we load our data from the server.</p>\n<h3 id=\"Only-Load-What-You-Need\"><a href=\"#Only-Load-What-You-Need\" class=\"headerlink\" title=\"Only Load What You Need\"></a>Only Load What You Need</h3><p>One guiding principle for data access is that you should only load the data you need from the server at the point you need it.</p>\n<p>An example of where you might see this performance issue is that we tend to do a massive join of data on the server and return everything we retrieved, even if we don’t need the data for the operation at hand.</p>\n<p>The less data you access, the faster your application will perform.</p>\n<h3 id=\"Normalization-is-a-Curse\"><a href=\"#Normalization-is-a-Curse\" class=\"headerlink\" title=\"Normalization is a Curse\"></a>Normalization is a Curse</h3><p>One way to send less data back to the server is to send it back in raw form rather than nested and normalized.</p>\n<p>For this, I recommend a product called Normalizr. This takes the nested data and breaks it into multiple tables. The product was originally written for client-side code to make using Redux and NgRX easier. But there are now server-side implementations you can use that structure the data before sending it back so that you only send back one instance of the data you need rather than multiple instances because multiple parent rows use it.</p>\n<p>Better than using Normalizr, which is now a bit dated, you should consider only asking for un-normalized data from the server and dumping it into NgRX entities. You can use NgRX selectors to join the data together however needed. Now that everyone should at least be using HTTP2, the cost of simultaneously making multiple requests to the server is negligible.</p>\n<h3 id=\"Pre-load-Lookup-Tables\"><a href=\"#Pre-load-Lookup-Tables\" class=\"headerlink\" title=\"Pre-load Lookup Tables\"></a>Pre-load Lookup Tables</h3><p>Along with this same idea. We often have nested data that is the result of some lookup table. By using Normalizr, you could load those tables up front and then only return the key to those tables and use Normalizr and NgRX Selectors to do the JOIN on the client side, further reducing the overall amount of data that you need to retrieve at any one time.</p>\n<h3 id=\"Virtual-Arrays\"><a href=\"#Virtual-Arrays\" class=\"headerlink\" title=\"Virtual Arrays\"></a>Virtual Arrays</h3><p>I mentioned Virtual Scrolling above as one way to reduce the rendering time. By combining this with a concept I refer to as Virtual Arrays, you can similarly only retrieve the data the user can see, further reducing the perceived time to render.</p>\n<p>A Virtual Array is an object that looks like an array from an API perspective, but the implementation uses the database as the storage location. You can either retrieve the data from the database whenever it is requested from the array or memoize it so that it is only retrieved once.</p>\n<h2 id=\"Memory-Management\"><a href=\"#Memory-Management\" class=\"headerlink\" title=\"Memory Management\"></a>Memory Management</h2><p>When most people think of performance, they immediately think of “how to impact the performance of good code.” But the most overlooked performance issue in JavaScript generally is memory. Specifically memory leaks.</p>\n<p>There are now several tools available for detecting and tracking down memory leaks. Find one and use it.</p>\n<h2 id=\"Micro-Tweaks\"><a href=\"#Micro-Tweaks\" class=\"headerlink\" title=\"Micro Tweaks\"></a>Micro Tweaks</h2><h2 id=\"Avoid-Iterators\"><a href=\"#Avoid-Iterators\" class=\"headerlink\" title=\"Avoid Iterators\"></a>Avoid Iterators</h2><p>As a general rule, using forEach, for&#x2F;of, Array.map, Array.forEach, etc is slower than using for&#x2F;next because all but the for&#x2F;next loop uses the iterator under the hood which has a significant cost. If you know your loop is going to be small, it probably doesn’t matter but if you are iterating over a large array, you should consider using for&#x2F;next instead.</p>\n<p>I’ve created a forNext() function that takes an array and a callback function so that I still enjoy the benefits of forEach without the cost of using the iterator.</p>\n<p>For an extra (micro) performance boost, you should make the callback function a standard, named, function instead of an anonymous or fat arrow function.</p>\n<h2 id=\"Leverage-Iterators\"><a href=\"#Leverage-Iterators\" class=\"headerlink\" title=\"Leverage Iterators\"></a>Leverage Iterators</h2><p>On the other hand, if there is a lot of setup code in your loop to get you to a point where you can start processing the loop, and you do that pre-processing multiple times per instance, you might consider creating your own iterator and doing your setup in the constructor so you can iterate through the data without having to do the setup each time.</p>\n<p>Use the right tool for the job 😁.</p>\n<h2 id=\"Avoid-Duplicate-Work\"><a href=\"#Avoid-Duplicate-Work\" class=\"headerlink\" title=\"Avoid Duplicate Work\"></a>Avoid Duplicate Work</h2><h3 id=\"Arrays\"><a href=\"#Arrays\" class=\"headerlink\" title=\"Arrays\"></a>Arrays</h3><p>One obvious place to avoid duplicate work is with the Array map, filter, reduce, etc. functions. When you use these functions chained to each other, you are creating a new array for each function in the chain.</p>\n<p>Again, this may not make a significant difference with a sort array, but it can be a significant performance hit with a large array.</p>\n<h3 id=\"RxJS\"><a href=\"#RxJS\" class=\"headerlink\" title=\"RxJS\"></a>RxJS</h3><p>You’ll also find that you are performing more work than you need to because you are using RxJS operators such as combineLatest() incorrectly.</p>\n<p>Here’s a tip. If you are using combineLatest() to combine selectors, consider creating a selector instead. In this way, you’ll take advantage of the memoization that NgRX provides.</p>\n<p>Speaking of Selectors, avoid using factory selectors aka parameterized selectors. They can’t take advantage of memoization. Instead, make the parameter part of the state and use a normal selector. While this isn’t always possible, when you can do this, you’ll naturally take advantage of memoization and improve your performance.</p>\n<h3 id=\"DevTools\"><a href=\"#DevTools\" class=\"headerlink\" title=\"DevTools\"></a>DevTools</h3><p>Unless you use the profiling tools that are part of the browser’s developer tools, you won’t know where your performance issues are. You can’t fix what you can’t measure.</p>\n<p>Get comfortable with the performance tools in your browser’s developer tools. They are your best friend when it comes to optimizing your application.</p>\n<h3 id=\"Control-your-object’s-shape\"><a href=\"#Control-your-object’s-shape\" class=\"headerlink\" title=\"Control your object’s shape\"></a>Control your object’s shape</h3><p>Under the hood, every object you create generates a Class in the browser’s memory. Even object literals end up creating a Class. This is a way the browser tries to optimize your code. Great.</p>\n<p>Now the bad news. If you add a field to an object, or reorder the fields in an object, the browser has to create a new Class for that object or decide it isn’t worth it and forget about using that optimization for the object. Something as simple as using the spread operator and then putting the changed field at the end of the object can cause the browser to deoptimize the object.</p>\n<p>If you can, create your objects as classes and, when you change the object, use the class to do it so you can keep the shape of the object the same as it is being used.</p>\n<h3 id=\"Service-Workers\"><a href=\"#Service-Workers\" class=\"headerlink\" title=\"Service Workers\"></a>Service Workers</h3><p>Similar in concept to the virtual arrays above but a standard API that you can implement globally. You can use service workers to cache data from the server and only ask the server for it again after you consider it stale.</p>\n<p>You can also use this to cache the index.html file locally, so you don’t have to retrieve it until there is a new version.</p>\n<h3 id=\"WebAssembly\"><a href=\"#WebAssembly\" class=\"headerlink\" title=\"WebAssembly\"></a>WebAssembly</h3><p>I’ve yet to find my code is so slow that this actually makes sense, but it is theoretically possible that you’d find even more performance by creating services using WebAssembly. This would mean you’d need to write the code in something other than TypeScript and Angularize it by wrapping it in TypeScript&#x2F;Angular code. But I’ve seen at least one article on the web where they did just that.</p>\n<h3 id=\"WebWorkers-and-Shared-Workers\"><a href=\"#WebWorkers-and-Shared-Workers\" class=\"headerlink\" title=\"WebWorkers and Shared Workers\"></a>WebWorkers and Shared Workers</h3><p>This is another place where there is at least a theoretical possibility that it would provide additional performance. At the very least, it can provide the appearance of performance.</p>\n<p>Some places to consider using Shared Workers specifically are with Web Sockets and Data Retrieval. By placing Web Socket listeners in a Shared Worker, you create one connection to the server. The Shared Worker can then relay those messages to the client code on as many windows as are currently open.</p>\n<p>Similarly, by using a Shared Worker as the main place that retrieves your data, you can cache the data and rebroadcast the new data to all the open browser windows listening to the Shared Worker.</p>\n<h2 id=\"Server-Side-Considerations\"><a href=\"#Server-Side-Considerations\" class=\"headerlink\" title=\"Server Side Considerations\"></a>Server Side Considerations</h2><h3 id=\"Normalization-is-a-Curse-Here-Too\"><a href=\"#Normalization-is-a-Curse-Here-Too\" class=\"headerlink\" title=\"Normalization is a Curse Here Too\"></a>Normalization is a Curse Here Too</h3><p>I once worked on an application where the data was being retrieved from 20 tables joined together. When we looked at what was going on, we realized that most of that data was static when the client was using it and that we could dump most of the join results into a flat table and use it instead. This was another case where we went from an 8-second load time to 1 second.</p>\n<p>The performance considerations around JOINs vary depending on what database you are using. But it is something to keep in mind all the same.</p>\n<h3 id=\"Server-Side-Caching\"><a href=\"#Server-Side-Caching\" class=\"headerlink\" title=\"Server Side Caching\"></a>Server Side Caching</h3><p>In many systems similar to the one I mentioned above, most of our calls to the server could be considered Functionally pure enough that we could cache the data.</p>\n<p>I <a href=\"/what%E2%80%99s-the-truth-about-running-asp-net-webapi-asynchronously/\">did some timings on this several years ago</a> and the results, even caching for a second, gave some pretty impressive results.</p>\n<p>For example, those lookup tables I discussed earlier don’t need to be retrieved from the database every time we make a call for them. We should be able to make a call for the data once and then return that data every time it is requested until the data is refreshed.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>There are probably other ways to optimize your application that I’ve forgotten or, more likely, do out of habit now.</p>\n<p>What I’ve written about above are the ones that stand out as the often overlooked issues.</p>\n",
            "tags": [
                "angular",
                "performance",
                "best practice"
            ]
        },
        {
            "id": "http://davembush.github.com/using-workers-from-an-angular-library/",
            "url": "http://davembush.github.com/using-workers-from-an-angular-library/",
            "title": "Using Workers from an Angular Library",
            "date_published": "2022-12-03T20:21:48.000Z",
            "content_html": "<p>This past week several of us have been working hard to implement a SharedWorker from a library. We found a number of articles on the web that demonstrated how to get Web Workers setup for Angular that all assumed the Web Worker was being generated in the main Angular app. We wanted to use a library and include that file in the main app.</p>\n<span id=\"more\"></span>\n\n<p>If that’s what you are trying to do, I hope this post saves you the time we spent this week figuring it out.</p>\n<h2 id=\"The-Problem\"><a href=\"#The-Problem\" class=\"headerlink\" title=\"The Problem\"></a>The Problem</h2><p>As all the article state, you need to use a generator to create the Web Worker files and modify your configs. The Angular documentation gives you the steps here: <a href=\"https://angular.io/guide/web-worker\">https://angular.io/guide/web-worker</a>.</p>\n<p>What isn’t clear from this documentation is that this ONLY works for apps. If you specify a library, the compiler doesn’t know what to do with it.</p>\n<h2 id=\"The-Solution\"><a href=\"#The-Solution\" class=\"headerlink\" title=\"The Solution\"></a>The Solution</h2><p>The solution is relatively simple. Create the worker files in the library. In the library put a file that implements the worker. In the worker file that the schematic generated in your app, import the worker file from the library.</p>\n<p>Everything else stays the same as is documented elsewhere.</p>\n",
            "tags": [
                "angular",
                "web-workers",
                "libraries"
            ]
        },
        {
            "id": "http://davembush.github.com/avoiding-ngrx-boilerplate/",
            "url": "http://davembush.github.com/avoiding-ngrx-boilerplate/",
            "title": "Avoiding NgRx Boilerplate",
            "date_published": "2022-11-19T17:17:54.000Z",
            "content_html": "<p>One of the recurring complaints I hear about NgRX is that it requires too much boiler plate code. But, it doesn’t have to be this way. In fact, I’ve been working on a project that has a lot of NgRX code and I’ve been able to reduce the amount of boilerplate code to a minimum and gain features in the process.</p>\n<span id=\"more\"></span>\n\n<p>If you look at your NgRX code you should find that your actions, reducers, and effects are all very similar. If you don’t find this to be true in your own code, you should consider this a code smell. While how we each use NgRX may vary from project to project, within a project there should be enough consistency that you can reduce the boiler plate code you write and just supply the differences rather than repeating yourself over and over again.</p>\n<h2 id=\"NgRX-Entities\"><a href=\"#NgRX-Entities\" class=\"headerlink\" title=\"NgRX Entities\"></a>NgRX Entities</h2><p>One reason you may find your code does not lend itself to common actions, reducers, and effects is because you have not yet discovered NgRX Entities. NgRX Entities are an “Optional” NgRX add-on that allow you to reduce quite a bit of redundant code, especially in the Reducers where you can just make a call to an Adapter function to do all the work for you. The end result is that your store is an array of IDs and an object of type <code>Record&lt;string, T&gt;</code> where <code>T</code> describes the shape of your record and <code>string</code> is the ID of the record. Using this pattern it is very easy to find a record by the ID so we can easily join to slices of our store together using a selector.</p>\n<p>The remainder of this article assumes you are familiar with NgRX Entities and how to use them. If you are not, I recommend you read the <a href=\"https://ngrx.io/guide/entity\">NgRX Entity Documentation</a> and then come back to this article.</p>\n<h2 id=\"Actions\"><a href=\"#Actions\" class=\"headerlink\" title=\"Actions\"></a>Actions</h2><p>The first, very obvious place we find boiler plate code in NgRX is with actions. The more recent release of NgRX already makes creating actions relatively easy by providing the <code>createActionGroup</code> function. This function allows you to create a group of actions with a single function call. However, it still requires you to provide the action type and the action payload. This is where we can start to reduce the boiler plate code.</p>\n<p>Let’s say, for a start, that all your actions look something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityActions = <span class=\"title function_\">createActionGroup</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">source</span>: <span class=\"string\">&#x27;Entity Name Here&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">events</span>:&#123;</span><br><span class=\"line\">    <span class=\"title class_\">Load</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAll</span>: props&lt;&#123; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllSuccess</span>: props&lt;&#123; <span class=\"attr\">entities</span>: <span class=\"title class_\">Entity</span>[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Create</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Update</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: <span class=\"title class_\">Entity</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Delete</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteSuccess</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Even if you create some generator to create this code for you, it is still quite a bit of code that needs to be compiled and shipped to the browser.</p>\n<p>What if, instead, all we had to do was write this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityActions = <span class=\"title function_\">createActionGroup</span>(</span><br><span class=\"line\">  <span class=\"string\">&#x27;Entity Name Here&#x27;</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>All you need to do, for this to work, is create a new <code>createActionGroup</code> function that returns the NgRX version of the same method with everything filled out.</p>\n<p>Well, “all you have to do” is a bit of an exaggeration as there are some typing issues you’ll need to address.</p>\n<p>Here is the code:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; createActionGroup <span class=\"keyword\">as</span> ngrxCreateActionGroup, props &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgrxActionGroup</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./types/ngrx-action-group.type&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * StringLiteralCheck was copied from NgRX because it is hidden.  It forces</span></span><br><span class=\"line\"><span class=\"comment\"> * the source parameter to be a string literal.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">StringLiteralCheck</span>&lt;</span><br><span class=\"line\">  <span class=\"title class_\">Str</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>,</span><br><span class=\"line\">  <span class=\"title class_\">Name</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span></span><br><span class=\"line\">&gt; = <span class=\"built_in\">string</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Str</span> ? <span class=\"string\">`<span class=\"subst\">$&#123;Name&#125;</span> must be a string literal type`</span> : <span class=\"built_in\">unknown</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">type</span> <span class=\"title class_\">StringLiteralSource</span>&lt;<span class=\"title class_\">Source</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>&gt; = <span class=\"title class_\">Source</span> &amp;</span><br><span class=\"line\">  <span class=\"title class_\">StringLiteralCheck</span>&lt;<span class=\"title class_\">Source</span>, <span class=\"string\">&#x27;source&#x27;</span>&gt;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * createActionGroup creates all the actions an entity will need reducing quite a bit</span></span><br><span class=\"line\"><span class=\"comment\"> * of boilerplate code.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * The `source` parameter is the same as the `source` parameter in NgRX&#x27;s createActionGroup.</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> createActionGroup = &lt;<span class=\"title class_\">Source</span> <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>, T&gt;(</span><br><span class=\"line\">  <span class=\"attr\">source</span>: <span class=\"title class_\">StringLiteralSource</span>&lt;<span class=\"title class_\">Source</span>&gt;</span><br><span class=\"line\">): <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt; =&gt;</span><br><span class=\"line\">  <span class=\"title function_\">ngrxCreateActionGroup</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// because ngrxCreateActionGroup expects a string literal</span></span><br><span class=\"line\">    <span class=\"comment\">// we have to cast as any to get around the type check</span></span><br><span class=\"line\">    <span class=\"comment\">// this is why we made sure our source parameter does the</span></span><br><span class=\"line\">    <span class=\"comment\">// string literal check.</span></span><br><span class=\"line\">    <span class=\"attr\">source</span>: source <span class=\"keyword\">as</span> <span class=\"built_in\">any</span>,</span><br><span class=\"line\">    <span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">      <span class=\"title class_\">Load</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadAll</span>: props&lt;&#123; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadAllSuccess</span>: props&lt;&#123; <span class=\"attr\">entities</span>: T[] &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">LoadAllFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Create</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">CreateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">CreateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Update</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">UpdateSuccess</span>: props&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">UpdateFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">Delete</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">DeleteSuccess</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">      <span class=\"title class_\">DeleteFailure</span>: props&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that I’ve added a new type <code>NgrxActionGroup</code> as the return value. This ensures that the return value is strongly typed to the information provided.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">type</span> <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt; = <span class=\"title class_\">ActionGroup</span>&lt;</span><br><span class=\"line\">  <span class=\"comment\">// using any here is the only way I could get this to work</span></span><br><span class=\"line\">  <span class=\"comment\">// without worse hacks or rewriting createActionGroup</span></span><br><span class=\"line\">  <span class=\"built_in\">any</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"title class_\">Load</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAll</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">ids</span>: <span class=\"built_in\">string</span>[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entities</span>: T[] &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">LoadAllFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Create</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">CreateFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Update</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">entity</span>: T &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">UpdateFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">Delete</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteSuccess</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    <span class=\"title class_\">DeleteFailure</span>: <span class=\"title class_\">ActionCreatorProps</span>&lt;&#123; <span class=\"attr\">error</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&gt;;</span><br></pre></td></tr></table></figure>\n\n<p>Most of the work in getting that all working correctly was with the strong typing. You may need to tweak for your purposes, but this is the basic idea.</p>\n<p>If you need to add actions that are unique to a particular entity, you can use the <code>createActionGroup</code> function from NgRX and then return the combined actions using the spread operator.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityActions = &#123;</span><br><span class=\"line\">  ...<span class=\"title function_\">createActionGroup</span>(<span class=\"string\">&#x27;Entity Name Here&#x27;</span>),</span><br><span class=\"line\">  ...<span class=\"title function_\">ngrxCreateActionGroup</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">source</span>: <span class=\"string\">&#x27;Entity Name Here&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">events</span>: &#123;</span><br><span class=\"line\">      <span class=\"title class_\">UniqueAction</span>: props&lt;&#123; <span class=\"attr\">id</span>: <span class=\"built_in\">string</span> &#125;&gt;(),</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Reducers\"><a href=\"#Reducers\" class=\"headerlink\" title=\"Reducers\"></a>Reducers</h2><p>Reducers are very similar. Once again, NgRX already gives us a way of creating a Reducer function with one call.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityReducer = <span class=\"title function_\">createReducer</span>(</span><br><span class=\"line\">  initialState,</span><br><span class=\"line\">  <span class=\"title function_\">on</span>(entityActions.<span class=\"property\">Load</span>, <span class=\"function\">(<span class=\"params\">state, &#123; id &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      ...state,</span><br><span class=\"line\">      <span class=\"attr\">loading</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">  &#125;),</span><br><span class=\"line\">  <span class=\"comment\">// etc...</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>But if the on() code is the same, why repeat it over and over?  Just create a new factory function that specifies what is unique and let it do the rest of the work.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> createReducer = &lt;T, N <span class=\"keyword\">extends</span> <span class=\"built_in\">string</span>&gt;(</span><br><span class=\"line\">  <span class=\"attr\">adapter</span>: <span class=\"title class_\">EntityAdapter</span>&lt;T&gt;, <span class=\"comment\">// EntityAdapter is an NgRX Entities type</span></span><br><span class=\"line\">  <span class=\"attr\">entityName</span>: N,</span><br><span class=\"line\">  <span class=\"attr\">actions</span>: <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt;</span><br><span class=\"line\">): <span class=\"title class_\">ActionReducer</span>&lt;<span class=\"title class_\">EntityState</span>&lt;T&gt;&gt; =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"title function_\">ngrxCreateReducer</span>(</span><br><span class=\"line\">    adapter.<span class=\"title function_\">getInitialState</span>(),</span><br><span class=\"line\">    <span class=\"title function_\">on</span>(actions.<span class=\"property\">load</span>, <span class=\"function\">(<span class=\"params\">state, &#123; id &#125;</span>) =&gt;</span></span><br><span class=\"line\">      adapter.<span class=\"title function_\">upsertOne</span>(id, state)</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    <span class=\"comment\">// etc...</span></span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>And now, you can create all your reducers using your new createReducer function.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> entityReducer = <span class=\"title function_\">createReducer</span>(</span><br><span class=\"line\">  entityAdapter,</span><br><span class=\"line\">  <span class=\"string\">&#x27;Entity Name Here&#x27;</span>,</span><br><span class=\"line\">  entityActions</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Effects\"><a href=\"#Effects\" class=\"headerlink\" title=\"Effects\"></a>Effects</h2><p>Effects are a little more complicated. The basic idea is that you want to create an generic class with abstract methods it can use to pull in what is different from the class that implements it. To be honest, there is still quite a bit of code you have to write but there are two advantages. Since you are only providing the differences, there is much less code to write and because it is the same code being used everywhere, once you get it working, it works everywhere, reducing the chance of errors.</p>\n<p>Because your code is probably going to look much different than the code I’m using, I’m going to provide samples of the code rather than the full blown implementation.</p>\n<p>This also takes advantage of the new createEffect() function in NgRX 8.0.0.</p>\n<p>Our generic class is going to look something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SmartEffects</span>&lt;T&gt; &#123;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * actions is the action group for this entity</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">get</span> <span class=\"title function_\">actions</span>(): <span class=\"title class_\">NgrxActionGroup</span>&lt;T&gt;;</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * adapter is the entity adapter for this entity</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">get</span> <span class=\"title function_\">adapter</span>(): <span class=\"title class_\">EntityAdapter</span>&lt;T&gt;;</span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * updateOperator is the method that will run when the update</span></span><br><span class=\"line\"><span class=\"comment\">   *   action is dispatched.  You would create a similar operator</span></span><br><span class=\"line\"><span class=\"comment\">   *   method for any other calls you&#x27;d make to the server or other</span></span><br><span class=\"line\"><span class=\"comment\">   *   insertion points you would need for an effect</span></span><br><span class=\"line\"><span class=\"comment\">   * <span class=\"doctag\">@param</span> <span class=\"variable\">action</span></span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"keyword\">protected</span> <span class=\"keyword\">abstract</span> <span class=\"title function_\">updateOperator</span>(</span><br><span class=\"line\">    <span class=\"comment\">// have to use any here because that is how NgRX defines it</span></span><br><span class=\"line\">    <span class=\"attr\">action</span>: &#123;<span class=\"attr\">row</span>: T&#125; &amp; <span class=\"title class_\">TypedAction</span>&lt;<span class=\"string\">`[<span class=\"subst\">$&#123;<span class=\"built_in\">any</span>&#125;</span>] Update`</span>&gt;</span><br><span class=\"line\">  ): <span class=\"title class_\">Observable</span>&lt;T&gt;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You might thing you could use an abstract field instead of  an abstract getter. But, javascript initializes the parent class prior to the child class and the field you need won’t be available when the effects are created.</p>\n<p>You’ll need to make the calls to the createEffect() methods inside the constructor. Again, the order that code gets executed between parent classes and child classes forces this to be done in the constructor.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>Once you’ve created a consistent way of using NgRX throughout your code, you not only reduce the amount of boiler plate code you have to write, but you also reduce errors, make your code more maintainable, and create consistency throughout your code which will make it significantly more understandable.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "state-management"
            ]
        },
        {
            "id": "http://davembush.github.com/clean-state-management-with-ngrx/",
            "url": "http://davembush.github.com/clean-state-management-with-ngrx/",
            "title": "Clean State Management with NgRx",
            "date_published": "2022-07-04T16:46:07.000Z",
            "content_html": "<p>Once again I’ve run into a situation where the code I’m looking at doesn’t resemble how the code was meant to be written.</p>\n<p>I’ve spent the last month fixing bugs that can all be summarized by the following problems:</p>\n<ul>\n<li>Reducers updating nested data.</li>\n<li>Storing data manipulations that Selectors could perform</li>\n<li>Using Effects as Selectors</li>\n<li>Components doing too much data manipulation</li>\n<li>Too many actions and indirection</li>\n</ul>\n<span id=\"more\"></span>\n\n<p>Unfortunately, the people who need to hear this the most are the ones who will never read this article. Some of what I’m about to say, I may have discovered over the last several years of programming but I’m sure I didn’t discover this in isolation.</p>\n<p>So, lets review how NgRX should be used effectively.</p>\n<h2 id=\"The-Problem-with-Nested-Data\"><a href=\"#The-Problem-with-Nested-Data\" class=\"headerlink\" title=\"The Problem with Nested Data\"></a>The Problem with Nested Data</h2><p>If you’ve ever worked on a system with nested state data as part of one slice, you know that updating that nested data is a pain. For those of you who haven’t, having to update that data makes your reducer 10 times longer and 3 times more complicated than it needs to be.</p>\n<p>This means, first, you’ve written more code than you need. This means there is a higher possibility of errors.  But beyond that, the code your customer has to download is also larger than it needs to be.  Worse, because it runs every time the nested data is updated, the code performs slower than it needs to.</p>\n<p>That last point might surprise you. Why does it run slower? Simply because you may end up running that code when it was not necessary.</p>\n<h2 id=\"The-Problem-with-Storing-State-the-Way-You-Want-to-Use-It\"><a href=\"#The-Problem-with-Storing-State-the-Way-You-Want-to-Use-It\" class=\"headerlink\" title=\"The Problem with Storing State the Way You Want to Use It\"></a>The Problem with Storing State the Way You Want to Use It</h2><p>Related to nested data is the urge to store state the way you want to use it later on in the application.</p>\n<p>The main problem with doing this is that you need to make sure that state gets updated correctly from every place you update the raw data. In the process, you will invariably run the the derived state code multiple times when you could have only run it once or in many cases, not at all.</p>\n<p>Instead, you should modify the data into something your presentation needs using Selectors. Since everyone should be using the Selectors to get the information they need, and that selector is looking at the raw data, you can be sure that everyone is getting the correct data. Also, if nothing is listening to the observable that the selector returns, you will not be running the selector code more times than is necessary.</p>\n<p>You also have the advantage of taking advantage of memoization so that this data manipulation only happens when the data is needed and when it changes.</p>\n<h2 id=\"Storing-State\"><a href=\"#Storing-State\" class=\"headerlink\" title=\"Storing State\"></a>Storing State</h2><p>Rule number one of state management is to store state at the most granular level you can. This means, in part, that each slice of your state, the table in your store, should be flat.</p>\n<p>What does it mean that the data is flat? It means that the object only contains primitive values. Strings, number, booleans, dates, or collections of objects that only contain primitive values. Just like you would in a relational database table.</p>\n<p>But, this may not be the most granular level.</p>\n<p>Say you have a row in your database that contains 3 fields that you always want but 50 or so that you only want if a particular presentation is running.  I would recommend creating a slice for the 3 main fields and then another slice or more, for the remaining fields and allow for the fact that you may not have all of them all the time.</p>\n<p>While most systems don’t need this. The system I’m working on does.</p>\n<p>This solves the storing nested data issue.</p>\n<h2 id=\"The-Job-of-Effects\"><a href=\"#The-Job-of-Effects\" class=\"headerlink\" title=\"The Job of Effects\"></a>The Job of Effects</h2><p>Apparently, some people think that the job of an effect is to manipulate data.  But as we’ve already established, manipulating data is the job of selectors. No, the job of Effects is to retrieve data from wherever we are persisting it and to update the persistent store with any changes we’ve made. If we need to manipulate data to do either of those, again, Selectors is where we would do this work.</p>\n<p>Once you’ve narrowed the job of your effects down to this, you no longer need to return multiple actions from an effect.  Ideally an effect should fire one action.  But, no more than two.</p>\n<h2 id=\"The-Job-of-Reducers\"><a href=\"#The-Job-of-Reducers\" class=\"headerlink\" title=\"The Job of Reducers\"></a>The Job of Reducers</h2><p>Reducers only have three jobs: add new data to the slice, remove data from the slice, and update data in the slice. That’s it. If your reducers are doing more than that, you’re doing it wrong.</p>\n<h2 id=\"Extra-Credit\"><a href=\"#Extra-Credit\" class=\"headerlink\" title=\"Extra Credit\"></a>Extra Credit</h2><p>The above, is the bare minimum and may server you well for small projects. However, for larger projects you will want to consider using NgRX Entities.  This will reduce the amount of boiler plate code you need to write as well as making it easy to join your slices however you need to.</p>\n<p>One place in the code I’m working on this would be particularly useful is to see what slice owns another slice.  As the data is stored and returned we only know who the children are most of the time.  To find the parent, we have to iterate through the data to find the child and then look at what parent we are in.</p>\n<p>It gets even more complicated when a row of data could have more than one parent.</p>\n<h2 id=\"Thinking-About-Code\"><a href=\"#Thinking-About-Code\" class=\"headerlink\" title=\"Thinking About Code\"></a>Thinking About Code</h2><p>The last point I want to make regarding state management is that how we think about our code impacts how we write our code.</p>\n<p>I’ve discovered over the years that most of us think about code from a GUI perspective. But, by doing this, we also tend to put a lot of logic in our components and keep doing so, until that doesn’t work any more. At that point, we start to consider state management.</p>\n<p>But what if we thought about code strictly from a data perspective? If every time you thought about the code you were writing and though, “what if I didn’t have a presentation layer? What problem am I trying to solve really? How can I do this without a presentation layer?” Then, your code would be more flexible, easier to maintain, and more scalable.</p>\n<p>How would it be more flexible?</p>\n<p>Back as the dotCom days were starting I had a manager come to me with a VB6 😝 application he had had build and said, “I’d like to take this code and run it on the web, or from a phone, or from the desktop.”  And my response to him was, “You can’t get their from here.” because the code was so tightly coupled to the presentation layer.</p>\n<p>But to bring it today, we often have the same kind of requirements. We originally solve a problem only to have our managers come to us with a new requirement that suggest using the same data to look at the code in a different way.  If all your data logic is in the presentation layer, you might achieve the goal but you’ll also have a lot of duplicate code if you are very careful. But, lets say you manage to pull that off. Six months later you are working on a bug in one of those two views. You fix it, but you forget about that other view and never think to fix it there too. And this is where your troubles begin.</p>\n<p>By pushing code as far down the stack as is practical, you reduce the amount of code you write, reduce the size of the code that your customer has to download, reduce the code you have to maintain, and in the case of NgRX end up writing code that performs faster.</p>\n<p>So, how might you force yourself to think in this way? By following this simple rule: Presentational components should only 1) display the data they’ve been give or 2) fire events indicating that some action has taken place.</p>\n<p>There is another type of component generally referred to as “Smart” components. They too have a rule. They should only 1) retrieve data from the store via Selectors and 2) fire actions to update the Store or trigger an Effect.</p>\n<h2 id=\"Storing-Ancillary-State\"><a href=\"#Storing-Ancillary-State\" class=\"headerlink\" title=\"Storing Ancillary State\"></a>Storing Ancillary State</h2><p>Thinking about your code this way leads to the last point I want to make. If your data is always your single source of truth, you’ll want to store information in the Store that will help you determine things like sort order and filtering as well as other information that may be in your form.</p>\n<p>Personally, I tend to store all my form data in my store beyond, and including, the data I need to send back to the server. This helps me derive the data for my presentation layer and allows my actions to have smaller payloads.</p>\n<p>Many of you send all your form data with your action to update the database because you still think of the update as something the presentation layer is doing. The way I work with data is I just send an action that notifies the store that I want to update the data with the data from my form. The Effect grabs that data from the store and sends it to the server.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>While I’ve centered the discussion above to NgRX. The main ideas port to other methods of state management including things like Redux, MobX, and even Apollo GraphQL.</p>\n<p>By following the above architecture and design patterns your code will be easier to maintain, have fewer bugs and scale better.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "state-management"
            ]
        },
        {
            "id": "http://davembush.github.com/ngzones-performance-impact/",
            "url": "http://davembush.github.com/ngzones-performance-impact/",
            "title": "NgZones Performance Impact",
            "date_published": "2022-05-28T23:03:40.000Z",
            "content_html": "<p>I’ve been working on this article for a month, off and on. When I started, I set out to demonstrate the performance impact of change detection in Angular. In particular, I wanted to demonstrate that turning zones off would have a significant impact on performance even if you followed all my other advice regarding performance optimization.</p>\n<p>That is, if you had:</p>\n<span id=\"more\"></span>\n<ul>\n<li>Implement OnPush notification</li>\n<li>Keep your components small</li>\n<li>Use pure pipes</li>\n<li>Use NgRX Selectors</li>\n<li>Use distinctUntilChanged on your Observables</li>\n<li>Don’t bind to computed values.</li>\n<li>User RxJS distinct()</li>\n<li>Use RxJS replay()</li>\n<li>Style the :host</li>\n<li>Use TrackBy x in ngFor</li>\n<li>Lazy-load routes</li>\n<li>Preload lazy-loaded routes</li>\n<li>Lazy-load resources</li>\n<li>Use virtual scrolling</li>\n<li>Don’t use nested data in your store</li>\n<li>Pre-load lookup tables.</li>\n<li>Use virtual arrays</li>\n<li>Tune your server</li>\n</ul>\n<p>Once you’ve done all those things, the only question left is “exactly how much time does the change detection cycle take if nothing has changed?”</p>\n<h2 id=\"First-Attempts\"><a href=\"#First-Attempts\" class=\"headerlink\" title=\"First Attempts\"></a>First Attempts</h2><p>Assuming that change detection would be an issue, I set out to determine how much of a performance impact I would see with some pretty simple code.  So I created a component that updated a value when a button was clicked.</p>\n<p>I then used the performance tools in developer tools to see just how long the update cycle would take.</p>\n<p>At first I thought I was on to something, but it was actually the compiler kicking in on the first run. When I clicked the button a second time, the performance was not any different regardless of where I put the changes.</p>\n<p>I thought maybe the difference was the number of @Inputs that were being watched, but even updating all those did not make any significant difference.  Even using prop drilling, if the component didn’t actually use the value from the @Input() there was no difference in performance.</p>\n<h2 id=\"How-Much-Time-Does-ChangeDetection-Take\"><a href=\"#How-Much-Time-Does-ChangeDetection-Take\" class=\"headerlink\" title=\"How Much Time Does ChangeDetection Take?\"></a>How Much Time Does ChangeDetection Take?</h2><p>So, today I set out to see just how much time change detection takes if nothing updates in the app.  Just trigger a change detection cycle.</p>\n<p>That’s easy, create a button that you can click nested in the inner most component.</p>\n<p>To get a better sense of timing I also created a tree of components 1000 levels deep.</p>\n<p>The entire click event where the change detection cycle occurs take about 20ms with the developer tools CPU performance set to 4x.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>If you are turning off zones as THE way of optimizing your performance you are masking architectural issues that should have been addressed first. Don’t let anyone tell you otherwise. It just isn’t true. Take it from someone who tried to prove it was.</p>\n",
            "tags": [
                "angular",
                "performance",
                "change-detection"
            ]
        },
        {
            "id": "http://davembush.github.com/rethinking-action-names-redux-ngrx/",
            "url": "http://davembush.github.com/rethinking-action-names-redux-ngrx/",
            "title": "Rethinking Action Names (Redux/NgRX)",
            "date_published": "2021-05-29T10:52:47.000Z",
            "content_html": "<p>If you’ve been using some form of Redux, you are familiar with the basic flow of data through the Redux loop. Central to this flow are Actions, the messages that trigger code in our Reducer or Effect&#x2F;Epic&#x2F;Saga (depending on what flavor of Redux you are using).</p>\n<p>The model allows us to disconnect our code so that it only cares that an action was triggered in some way.  That is, “when this action occurs, I will run this code.”</p>\n<p>Because of this, we can create an action that triggers multiple code blocks to run. Our only concern is that the code that gets triggered can’t depend on each other.</p>\n<p>In fact, much of the official literature encourages this practice.</p>\n<p>And, this is where all our troubles begin.</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Current-Recommendation\"><a href=\"#Current-Recommendation\" class=\"headerlink\" title=\"Current Recommendation\"></a>Current Recommendation</h2><p>You see, the official literature around actions also suggest a naming convention that is tied to what we want to happen, rather than what just happened or something otherwise more generic.</p>\n<p>For example, take the simple act of loading a list of employees from the server. To do this, we would typically create two actions.  The first would be <code>LoadEmployees</code> and the second would be <code>LoadEmployeeResults</code>. Both of these actions represent what we want to do, not what just happened.</p>\n<p>Now, let’s say we also want to display some sort of wait state and that we want to control it using Redux.  For that we would create a Reducer in our store.  Let’s call it <code>Wait</code>. And for the purposes of this post, we will assume that <code>Wait</code> tracks wait state by incrementing and decrementing a counter.</p>\n<p>But, we don’t need to create new Actions for our Wait state because we can re-use the actions we’ve already created. When we fire <code>LoadEmployees</code> we can increment <code>Wait</code> and when we fire <code>LoadEmployeesResult</code> we can decrement the load.</p>\n<h2 id=\"What’s-Wrong-With-That\"><a href=\"#What’s-Wrong-With-That\" class=\"headerlink\" title=\"What’s Wrong With That?\"></a>What’s Wrong With That?</h2><p>Do you see the problem here? We now have a reducer responding to an event that is not obviously tied to an action that has anything to do with the code that is getting executed. <code>Wait</code> is not a <code>LoadEmployees</code> thing although, you might reasonably say it is a <code>Load</code> thing.</p>\n<p>And so how might we think about restructuring our code so that this makes more sense.</p>\n<h2 id=\"A-Change-In-Perspective\"><a href=\"#A-Change-In-Perspective\" class=\"headerlink\" title=\"A Change In Perspective\"></a>A Change In Perspective</h2><p>What if instead of naming actions what we wanted to do, we named them something more along the lines of what just happened.  That would make our <code>LoadEmployees</code> action <code>NeedEmployees</code> and our <code>LoadEmployeesResult</code> action, <code>EmployeesLoaded</code>.</p>\n<p>Even these names don’t get at the fact that Needing Employees doesn’t mean we need to increment the wait state.</p>\n<h2 id=\"Rethinking-The-Problem\"><a href=\"#Rethinking-The-Problem\" class=\"headerlink\" title=\"Rethinking The Problem\"></a>Rethinking The Problem</h2><p>One way we can think about this problem is to look at other messaging systems, like the windows messaging system. It’s been a while since I’ve used the raw messages in Windows but I seem to recall a <code>WM_BUTTON</code> or <code>WM_BUTTON_CLICK</code> message that would get passed to my application when a button was clicked.  One message for every button in my system that had, as part of the payload, what button was clicked so my code could listen for that message for that button and do something because of it.</p>\n<p>We could do something similar with the code above. Instead of tying the actions to particular code we want to run, our actions could be more generic.<br>What if we had two generic messages, <code>Load</code> and <code>LoadResult</code>. The payload for these messages could then have a <code>LoadType</code> property that defined WHAT we were loading so that we could Load Employees, Addresses, and Phone Numbers all using the same two actions and we could also use <code>Load</code> and <code>LoadResult</code> to increment and decrement our wait state.</p>\n<p>This would work except we still have a problem.</p>\n<h2 id=\"That’s-Not-How-It-Was-Designed\"><a href=\"#That’s-Not-How-It-Was-Designed\" class=\"headerlink\" title=\"That’s Not How It Was Designed\"></a>That’s Not How It Was Designed</h2><p>Most of the tools we currently have in place to reduce the boiler plate code we need to write are based on a one-to-one relationship between actions and the code that gets run. This isn’t to say that we couldn’t adapt them but doing so would be more trouble than it is worth because we would be working against the intended design.</p>\n<p>And so, I would suggest to you that the advice the current literature gives us about using Actions to trigger multiple blocks of code is wrong. Since Actions are primarily used as loosely coupled method calls, using them in unrelated places violates the Single Responsibility Principle and makes the code hard to follow.</p>\n<p>I’ve seen one code base where the code that gets triggered has absolutely nothing to do with the Action that triggers it. Not something in the simple case of LoadEmployee triggering Wait, but in more obscure relationship like <code>LoadCandyBars</code> triggering <code>LoadSteakDinner</code>.  The result is that the code becomes extremely difficult to follow. This is one of the biggest causes of bugs in this system.</p>\n<h2 id=\"Maybe-This-Will-Work\"><a href=\"#Maybe-This-Will-Work\" class=\"headerlink\" title=\"Maybe This Will Work\"></a>Maybe This Will Work</h2><p>For our discussion about the Wait state, I would suggest that we create a separate set of Actions for our Wait state, possibly WaitStart() and WaitEnd() that get fired when we fire EmployeeLoad() and EmployeeLoadResult(). You could wrap these calls in a function or method to ensure they always get called together, but the actions themselves need to be unique to make the code easier to follow.</p>\n<p>Currently, this is my recommended implementation. While not ideal, it gets the job done and makes maintaining the code simple and straight forward even if I do have to duplicate more Actions that I would like to.</p>\n",
            "tags": [
                "angular",
                "react",
                "ngrx",
                "redux"
            ]
        },
        {
            "id": "http://davembush.github.com/how-to-avoid-binding-to-computed-values-in-angular/",
            "url": "http://davembush.github.com/how-to-avoid-binding-to-computed-values-in-angular/",
            "title": "How to Avoid Binding to Computed Values in Angular",
            "date_published": "2021-05-08T15:55:53.000Z",
            "content_html": "<p>In my previous article about <a href=\"../optimizing-angular-for-speed/\">Angular Performance</a>, I indicated that one of the many ways you can produce an Angular application that performs well is by ensuring that you bind to a computed value.</p>\n<p>First, what did I mean by that?</p>\n<span id=\"more\"></span>\n\n<p>There two ways you might bind to a computed value.</p>\n<p>The most obvious way is by calling a method in the template’s corresponding class. But, properties count to. To be clear, a property is some code that uses a <code>get</code> prefix.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">get</span> <span class=\"title function_\">somePropertyNameHere</span>() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"string\">&#x27;something here&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Now, you might think you need to avoid this when you use the square brackets to assign a variable to a component property, but this also goes for ngIf and ngFor code as well.</p>\n<p>What we are striving for is to not have the template recompute anything unless the data has actually changed.</p>\n<p>The only exception to this is the ngFor trackBy attribute which is used to ensure the whole list doesn’t re-render just because the array changed. I’m assuming you are using this.</p>\n<p>But, you say, I NEED to compute those values in order to display them correctly.</p>\n<p>OK, let’s assume for a second that this is true. The way you do this is with pipes.</p>\n<h2 id=\"Pipes\"><a href=\"#Pipes\" class=\"headerlink\" title=\"Pipes\"></a>Pipes</h2><p>You should already be familiar with pipes because this is how we format dates, format numbers and subscribe to observables in the template.  But you aren’t limited to using the built-in pipes. You can create your own, and it is quite easy to do.</p>\n<p>All you need is a class with the <code>@pipe</code> attribute that implements the <code>PipeTransform</code> interface.</p>\n<p>The code you would normally place in the method of property of your component class can go in here instead.</p>\n<p>By doing this, Angular can see that the variable that is passed to it has changed, or not, and can determine when the code needs to be recomputed.</p>\n<h2 id=\"ngOnChanges\"><a href=\"#ngOnChanges\" class=\"headerlink\" title=\"ngOnChanges()\"></a>ngOnChanges()</h2><p>Another way you might achieve the same goal is by trapping the <code>ngOnChanges()</code> event for the component.</p>\n<p>Many times, any value that we would compute in a method or property to be pulled from the template is only going to change if an <code>@input</code> value changed.</p>\n<p>Instead of pulling the value and computing it on every change detection cycle, you can listen for the dependency during the <code>ngOnChanges</code> event and assign the new value to a class field and have your template look at the field instead.</p>\n<p>Be careful though. If you are lazy and recompute the field every time <code>ngOnChanges()</code> is called, you really haven’t gained anything by it.  <code>ngOnChanges()</code> will pass into you exactly what changed and you can use that to determine if the value should be recomputed.</p>\n<h2 id=\"NgRX-Store-Selector\"><a href=\"#NgRX-Store-Selector\" class=\"headerlink\" title=\"NgRX Store Selector\"></a>NgRX Store Selector</h2><p>My favorite means of achieving the goal of not calling computed values is by using NgRX Store Selectors.</p>\n<p>When you are new to NgRX you may only be using the simple selector.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> observerThing = <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">pipe</span>(<span class=\"title function_\">select</span>(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">storeSlice</span>));</span><br></pre></td></tr></table></figure>\n\n<p>And of course you can drill down from storeSlice into children if you need to.</p>\n<p>If you’ve graduated to Feature Selectors, your code may have graduated to:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> observerThing = <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">pipe</span>(<span class=\"title function_\">select</span>(featureSelector));</span><br></pre></td></tr></table></figure>\n\n<p>where <code>featureSelector</code> looks something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  <span class=\"title function_\">createFeatureSelector</span>(<span class=\"string\">&#x27;feature&#x27;</span>),</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">featureSlice</span>);</span><br></pre></td></tr></table></figure>\n\n<p>but there are other uses for <code>createSelector</code>.</p>\n<p>You can use it to combine slices:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  slice1Selector,</span><br><span class=\"line\">  slice2Selector,</span><br><span class=\"line\">  <span class=\"function\">(<span class=\"params\">s1, s2</span>) =&gt;</span> combineLogicGoesHere</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>Or, you can use it to create a selector for a specific bit of information.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  sliceSelector,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">s1</span> =&gt;</span> s1.<span class=\"property\">s1Part</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>And by combining this, we can create a selector that does our formatting for us only when the underlying data has changed.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> partSelector = <span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  sliceSelector,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">s1</span> =&gt;</span> s1.<span class=\"property\">s1Part</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> formatedPart = <span class=\"title function_\">createSelector</span>(</span><br><span class=\"line\">  partSelector,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">ps</span> =&gt;</span> <span class=\"title function_\">formatPsHere</span>(ps)</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>And now, our template can listen to this the same as it would listen to any other selector.</p>\n<p>This is the method I most prefer. By pushing this code down into a selector, I don’t have to be concerned with explicitly detecting what has changed. I let the selector do that for me. I just respond to the change when it happens.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "functional",
                "reactive",
                "mvp"
            ]
        },
        {
            "id": "http://davembush.github.com/an-angular-application-architecture-that-works/",
            "url": "http://davembush.github.com/an-angular-application-architecture-that-works/",
            "title": "An Angular Application Architecture That Works",
            "date_published": "2020-01-01T16:55:53.000Z",
            "content_html": "<p>The purpose of this article is to specify a working architecture that everyone can use for any Angular applications.  This architecture aims to achieve the following goals:</p>\n<ul>\n<li>Ensure that all parts of an application have a home so that anyone can pick up any application that uses this architecture and modify the application without having to learn where everything lives.</li>\n<li>Reduce the overall complexity of any one application by using well-established design patterns that work within the Angular ecosystem.</li>\n<li>Reduce the number of bugs introduced into an application by reducing the need for duplicate code.</li>\n</ul>\n<span id=\"more\"></span>\n\n<h2 id=\"Guiding-Principles\"><a href=\"#Guiding-Principles\" class=\"headerlink\" title=\"Guiding Principles\"></a>Guiding Principles</h2><ul>\n<li>Largely adhere to the <a href=\"https://angular.io/guide/styleguide\">Angular Style Guide</a></li>\n<li>Prefer Functional&#x2F;Reactive programming over Imperative&#x2F;Object Oriented programming.</li>\n<li>Prefer Composition over Inheritance when using Object Oriented programming</li>\n<li>For Object Oriented code, and where it applies, Functional&#x2F;Reactive code, make your code S..D<ul>\n<li>Adhere to the Single Responsibility Principle:<ul>\n<li>Keep the size of the individual files (html, css, ts) small</li>\n<li>Separate file for each class, function, interface, enum, etc.</li>\n<li>Keep the cyclomatic complexity of functions and methods small.</li>\n</ul>\n</li>\n<li>Keep your code DRY</li>\n<li>Because we prefer Composition over Inheritance, the OLI part of SOLID don’t apply.</li>\n</ul>\n</li>\n<li>Prefer composition over child routes.</li>\n</ul>\n<h2 id=\"Directory-Structure\"><a href=\"#Directory-Structure\" class=\"headerlink\" title=\"Directory Structure\"></a>Directory Structure</h2><p>Let’s start with the directory structure our applications will use.  To start with, the directory structure outlined in the <a href=\"https://angular.io/guide/styleguide\">Angular Style Guide</a> should be used with some minor modifications that still obey the general principles outlined in the style guide.</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">projectFolder</span><br><span class=\"line\">+- src</span><br><span class=\"line\">  +- core</span><br><span class=\"line\">  +- dialogs</span><br><span class=\"line\">    +- dialog1</span><br><span class=\"line\">      +- helper-component-1</span><br><span class=\"line\">      +- helper-component-2</span><br><span class=\"line\">      main dialog files go here directly</span><br><span class=\"line\">      under the dialog directory</span><br><span class=\"line\">        - html, css, ts</span><br><span class=\"line\">        - dialog specific NgRX code</span><br><span class=\"line\">    +- dialog2</span><br><span class=\"line\">      +- helperComponent3</span><br><span class=\"line\">      main dialog files go here</span><br><span class=\"line\">    +- etc...</span><br><span class=\"line\">  +- routes</span><br><span class=\"line\">    +- route-1</span><br><span class=\"line\">      +- supporting-component-1</span><br><span class=\"line\">      +- store</span><br><span class=\"line\">        supporting route specific NgRX files go here</span><br><span class=\"line\">        these include actions, effects, services, reducers,</span><br><span class=\"line\">        and selectors.  Each set of files get their own</span><br><span class=\"line\">        directory. The extensions for each are:</span><br><span class=\"line\">        - *.actions.ts</span><br><span class=\"line\">        - *.effects.ts</span><br><span class=\"line\">        - *.service.ts</span><br><span class=\"line\">        - *.reducer.ts</span><br><span class=\"line\">        - *.selector.ts</span><br><span class=\"line\">        route store slice module goes here</span><br><span class=\"line\">      route1 components go here</span><br><span class=\"line\">      route1 module goes here</span><br><span class=\"line\">    +- route-1-subroute-a</span><br><span class=\"line\">      similar to above.  This is only IF you have sub-routes.</span><br><span class=\"line\">      I strongly advise against them.</span><br><span class=\"line\">  +- shared</span><br><span class=\"line\">    +- components</span><br><span class=\"line\">      only components that are shared between routes go here</span><br><span class=\"line\">    +- store</span><br><span class=\"line\">      only store files that are shared between routes go here</span><br><span class=\"line\">    +- services</span><br><span class=\"line\">      only services, if any, that aren&#x27;t used by your store go here</span><br></pre></td></tr></table></figure>\n\n<p>What is slightly different from the style guide is that a separate directory is created for dialogs and routes as these will be where my top-level components will live.  Within a route or a dialog, everything that route or dialog needs should live under it.  In the case where a class is needed by multiple routes or dialogs, these files live under shared.</p>\n<p>As a guiding principle, you should think of each route as a stand-alone application with its own module.  It should be able to run on its own using the classes, functions, etc from either its directory and sub-directories or the classes, functions, etc in the shared directory.</p>\n<p>This leads us to Lazy Loading</p>\n<h2 id=\"Lazy-Loading\"><a href=\"#Lazy-Loading\" class=\"headerlink\" title=\"Lazy Loading\"></a>Lazy Loading</h2><p>While it is possible to create an application where the routes are all specified in one file, this file will quickly get out of hand if you are working with a large application.  You can save yourself a lot of trouble and reduce the cognitive load necessary to digest one file with all the routes if you commit to lazy loading up front.</p>\n<h3 id=\"Routes\"><a href=\"#Routes\" class=\"headerlink\" title=\"Routes\"></a>Routes</h3><p>What this means from a practical perspective is that each route will be loaded in as it is needed. One of the side benefits of this is that the files necessary to run each route will only be loaded as they are needed. This will decrease the time it takes to load the application.</p>\n<p>You will, however, need to ensure that each route can be loaded directly because sometimes taking the expected path will load modules that you forgot to load as part of the route.</p>\n<h3 id=\"NgRX\"><a href=\"#NgRX\" class=\"headerlink\" title=\"NgRX\"></a>NgRX</h3><p>Similarly, you should make use of feature stores in NgRX so that you can dynamically add in store slices with each module rather than loading them all in when the application loads.  Done correctly, this will also reduce the cognitive load around your store structure as you will only need to be concerned about the store structure for each route.</p>\n<p>For consistency’s sake, I create feature slices in my shared folder for NgRX slices that are shared rather than load them all at the application level. Again, this reduces the cognitive load necessary to understand any one part of the application. It has the added benefit of making it easier to move slices of the store from a route feature to a shared feature because the structure remains essentially the same.</p>\n<h2 id=\"Components\"><a href=\"#Components\" class=\"headerlink\" title=\"Components\"></a>Components</h2><p>A large part of the front-end code is written using components which include the route, controls, and components that encompass blocks of components.</p>\n<p>The following addresses how to create components in a way that can be maintained.</p>\n<h3 id=\"Keep-em-Small\"><a href=\"#Keep-em-Small\" class=\"headerlink\" title=\"Keep em Small\"></a>Keep em Small</h3><p>One of the main problems I’ve seen in my career with all code, but especially components, is that we try to put all the code for a page all in one place. We don’t even think of the third category of components.  My advice for your template code is that once it has gotten past the point of code that can’t fit in a file that is 150 lines long and 80 characters wide, or has nested to a point beyond 6 elements, you should consider breaking them out. There may be a few exceptions, but this metric will keep your code easy to understand.</p>\n<p>One way you can reduce the nesting without a lot of effort is to style the @host element of the template rather that using a containing DIV tag around the other elements that are the functional components of your component.  Other than because it reduces nesting, it also eliminates a layer of HTML that needs to be rendered. Since we are going to favor lots of small components over a few large components, this will, ultimately, impact the performance of your application.</p>\n<p>Another way you can reduce nesting is by recognizing patterns in your code and extracting them into their own component.</p>\n<p>Finally, consider measuring the cyclomatic complexity of your templates.  Codelyzer has a rule you can add to your linting.  I’d set this to no more than 10.  Cyclomatic complexity measures how many paths there are through your code.  Once you’ve added if, switch or for loops in your template, you’ve introduced some cyclomatic complexity. If you keep to the metrics I’ve already mentioned, you should never hit the cyclomatic complexity metric.</p>\n<h3 id=\"Component-Services\"><a href=\"#Component-Services\" class=\"headerlink\" title=\"Component Services\"></a>Component Services</h3><p>Let’s talk about the purpose of components for a bit. The point of components is to allow the end user to interact with the program. In practical terms this means it has two jobs:</p>\n<ul>\n<li>Display data that is meaningful to the user</li>\n<li>Allow the user to issue commands that either manipulate the data or take them to another screen.</li>\n</ul>\n<p>This is true for whatever programming environment you are using.</p>\n<p>I’ve been programming now for 32 years and I still see programmers who try to make the component, or the view as they are sometimes called, do something else.</p>\n<p>This also means that business rules have no place in a component.</p>\n<p>Having said that, it is often true that to get the data to display we often need to introduce logic into our component somewhere. Once we’ve introduced logic, it would be great if we could also write unit tests for that logic without a lot of pain.</p>\n<p>If we put this code in the TS file that is our component, this means that in order to test the logic we need to scaffold the component.  Wouldn’t it be better or at least easier, if we didn’t need the component at all?</p>\n<p>This is where component services come in.  If you are familiar with the Model View Presenter design pattern, this is an adaptation of that.</p>\n<p>You can read details of how this is implemented on the following two sites:</p>\n<ul>\n<li><a href=\"https://davembush.github.io/model-view-presenter-angular-and-testing/\">Model View Presenter, Angular, and Testing</a></li>\n<li><a href=\"https://dev.to/this-is-angular/model-view-presenter-with-angular-533h\">Model View Presenter with Angular</a></li>\n</ul>\n<p>The basic idea is that you leave the component as the thing that only presents the data and receives notifications from the user. Any logic that is needed goes into an Angular service that is registered with the component using the viewProviders property of the @Component decorator.</p>\n<p>One thing to be careful of here is that you may be tempted, as I have been for a while, to pull the information from the service up into the view. The problem with this is that it is not an optimal implementation for change detections.</p>\n<p>The preferred method would be to use the model as it was originally intended and have the service set fields in the presentation layer so that change detection only happens when the data actually changes rather than every time the component is checked simply because your data has to be computed in a property or method every time.</p>\n<p>And while we are discussing change detection, you should also avoid changing the state of your component internally. By using OnPush notification, all changes have to come in on an <code>@Input()</code> field for the component to know it has to do change detection. You can, of course, get around this by using <code>markForCheck()</code> but the disadvantage there is that you may force change detection more often than it is actually needed.</p>\n<p>This is why we prefer the smart component&#x2F;dumb component model. It forces many of these issues. To do this properly, you’ll probably need to create child components so you can take advantage of the <code>@Input()</code> fields.</p>\n<h3 id=\"Smart-x2F-Dumb\"><a href=\"#Smart-x2F-Dumb\" class=\"headerlink\" title=\"Smart&#x2F;Dumb\"></a>Smart&#x2F;Dumb</h3><p>Broadly speaking, Angular components can be classified as “Smart Components” or “Dumb Components”.  Smart Components get their data form the outside world and pass data out to the outside world.  In the architecture defined here, that will be from the NgRX store via selectors and into the NgRX store using Actions.</p>\n<p>Dumb Components render data they are passed via the @Input() decorators and fire events back up to the containing component via @Output() decorators.</p>\n<p>A lot of people understand these concepts but misunderstand how they apply to an Angular application. You can’t follow these rules simply by wrapping your Dumb Components in Smart Components. While this technically obeys the definition, the result is code that is hard to understand. What we want is a central location in our code that is always responsible for getting data to and from the store.</p>\n<p>We do this by specifying that our Routes are the Smart Components.  This includes child routes, if you have them.</p>\n<p>I’ve found that it is often easier to make a dialog a smart component as well, so if you find this is easier than passing the data that the dialog needs to the dialog, you can make dialogs smart as well. This is why we have a <code>dialogs</code> directory and a <code>routes</code> directory as immediate children of the <code>app</code> directory.</p>\n<h3 id=\"Forms\"><a href=\"#Forms\" class=\"headerlink\" title=\"Forms\"></a>Forms</h3><p>Technically, there are two ways of programming forms using Angular. The first way uses the old 2-way data-binding model and is called “Templated Forms.” These were popular in AngularJS (aka Angular 1).  The second is new to Angular (aka Angular 2+) and is called “Reactive Forms”. Our architecture will use the newer model because it conforms to the guiding principle of keeping things as Functional as possible and removing as much logic from the component as possible.</p>\n<p>There are several implications of how we program our forms related to this.</p>\n<p>First, you will define your FormGroup(s) in the Route’s component service.</p>\n<p>Second, in order to keep your templates small, you may be a need to put bits of your form in child components. You will find that each child component needs its own <code>formGroup</code> attribute around the <code>formControls</code> that it is responsible for.  The best way to do this is to pass the <code>formGroup</code> down from the router into the child components and then assign that variable to the <code>formGroup</code> attribute in the child component’s template.</p>\n<p>For particularly complex forms, I recommend creating a formGroup object as a separate file in each component’s directory and then use <code>Object.assign()</code> to concatenate the parts into one whole.  This keeps the related code together while allowing you to assemble them into a form that Angular can use.</p>\n<h3 id=\"onPush-Notification\"><a href=\"#onPush-Notification\" class=\"headerlink\" title=\"onPush Notification\"></a>onPush Notification</h3><p>One of the optimizations available to Angular is a method of change detection called “Push Notification”.  Simply stated, with Push Notification enabled, change detection for the component is only initiated if new data has been pushed into it via one of it’s @Input() variables. Otherwise it is skipped.</p>\n<p>In a large application, the performance gains using this mechanism are enormous. This is particularly true of an application that has an extremely nested or repetitive set of components. Each instance will be checked with each event that would cause the change detection cycle to kick off.</p>\n<p>Since we will be striving to keep our components small, our apps are even more susceptible to the problems associated with change detection.</p>\n<p>While it is true that Push Notification handles most of the situations, you will find that occasionally data in your component changes for some other reason. For this, you should use the ChangeDetectorRef methods.</p>\n<h3 id=\"Styling\"><a href=\"#Styling\" class=\"headerlink\" title=\"Styling\"></a>Styling</h3><p>In an ideal world, you would have a theme that is external to all of your projects and that can be <code>npm install</code>ed into all the projects you work on.  This should control the basic look and feel of your application including:</p>\n<ul>\n<li>font color, size, family etc</li>\n<li>background color</li>\n<li>default style for common components</li>\n</ul>\n<p>Lacking a separate project for your theming information, place this information in a global styles.css file.</p>\n<p>Under no circumstance would you ever place the above information directly in a component file within your application.</p>\n<p>Also, because all the main information is going to be in your theme, there is no benefit to using SCSS within your project. And, in fact, every project I’ve ever been a part of that tried to use SCSS as part of the project has become more of a mess and harder to maintain because of it.</p>\n<p>Use SCSS for your theme project and CSS for your application projects.</p>\n<h2 id=\"NgRX-1\"><a href=\"#NgRX-1\" class=\"headerlink\" title=\"NgRX\"></a>NgRX</h2><p>We’ve already addressed some of how NgRX should be used when we talked about using Features instead of one great big Store blob.</p>\n<p>But, there are some other major places where NgRX gets misused that need to be addressed.</p>\n<h3 id=\"One-to-One-vs-One-to-Many\"><a href=\"#One-to-One-vs-One-to-Many\" class=\"headerlink\" title=\"One to One vs One to Many\"></a>One to One vs One to Many</h3><p>If you are new to NgRX, one of the first things that will seem like a really good idea is that you should be able to create an action and have multiple Reducers or Effects respond to it. If you were to act on this impulse, you would (eventually) find that this ultimately makes your code hard to maintain because you are now calling multiple functions “at the same time.”</p>\n<p>From a maintenance perspective, this is a problem.  Imagine trying to track down the flow of execution in your application only to find that when you get to point X you now have to trace the action down multiple paths, not really knowing which ultimately is executing the code you are really interested in.</p>\n<p>But, you have a further hidden problem. The order those functions get called is, for all practical purposes, undefined. At least, from a programming perspective, they should be considered undefined. The order is probably deterministic for any particular version of NgRX that you are running, but when you upgrade there is no reason to believe the code will still execute in the same order.</p>\n<p>Similarly, your actions, reducers, and effects should only relate to each other. You shouldn’t have an action that is part of slice A being handled by slice B even if it is a one-to-one relationship.</p>\n<p>Some code I’ve seen has also aliased actions so that, technically action A is actually action B. Don’t do that! All the above make your code incredibly hard to track flow of control.</p>\n<p>If you were to do this, which I still don’t recommend, you should create actions that are clearly multi-use actions.</p>\n<p>So what if indeed a particular event needs to kick-off or update seperate slices of a store? The can be answered in a few ways.</p>\n<ul>\n<li><p>It may be worthwhile re-examining the architecture of your overall store. Is there a good rational for why a single Action will impact separate slices of a store in the first place? This is especially important if the resulting actions end up doing the same thing or are using the same data. If so, consider normalizing the store slices and removing redundancies.</p>\n</li>\n<li><p>If that passes the sniff test, consider dispatching different actions in sequence for that event. For example, you may be updating different parts of the application each with different information and structure or different service calls. Under this scenario, separate store slices will be updated via different store action sets and different information structures, regardless of whether they were initiated by the same event.</p>\n</li>\n</ul>\n<p>To reiterate, do not mix the various store slice actions just to intercept the same event.</p>\n<h3 id=\"Flat-Store\"><a href=\"#Flat-Store\" class=\"headerlink\" title=\"Flat Store\"></a>Flat Store</h3><p>Another temptation you may encounter when you start working with NgRX is that you’ll return data from the server in a nested format and then try to deal with it in your reducer in that form.</p>\n<p>Don’t do that!</p>\n<p>Instead, flatten the data into multiple slices and use the Selectors to reassemble the data when you need it.</p>\n<p>If you are going to flatten the data on the client side, you should use <a href=\"https://www.npmjs.com/package/normalizr\">Normalizr</a>. Or, you could use <a href=\"https://www.npmjs.com/package/normalizr\">NgRX-Normalizr</a> and let it do some of the work for you.</p>\n<p>If you have the option, you should flatten your data on the server before you return it. The main advantage to doing this is that you will return less data.</p>\n<p>The reason you want to work with a flat store is because of immutability. Because the store is immutable, or at least, it SHOULD be, you will need to ensure that when you change an element of the data the object pointers above it all change as well. If you don’t, your change detection mechanisms won’t work correctly.</p>\n<p>If you use Normalizr and reassemble the nesting in your selectors, you won’t have to deal with this mess.</p>\n<h3 id=\"Store-Everything\"><a href=\"#Store-Everything\" class=\"headerlink\" title=\"Store Everything\"></a>Store Everything</h3><p>You also may be tempted to only store some of your application state in the NgRX store.  Maybe you think storing search form data is overkill. That you’ll pass the data over as it is needed. That might work, for a while.</p>\n<p>But think about this. Once you’ve placed the data in the store, when you come back to a particular route, the data is still there. If you don’t, the data is gone and you have to fill in the form again.</p>\n<p>You might say, “But that’s what I want them to do.” Yes, but, what if the customer changes their mind? Now you have options.</p>\n<p>Another advantage to the “Store Everything” approach is that you’ve pushed the logic for handling the data changes further down the stack. One place this becomes noticeable is that when you decide to process the data, you no longer have to pass the data with the Action to process the data. The Effect that processes the Action can now retrieve the data from the store.</p>\n<p>If nothing else, this makes the code easier to test.  Code that is easier to test is code that is easier to maintain, even if you never write any test for the code.</p>\n<h3 id=\"Data-Transformation\"><a href=\"#Data-Transformation\" class=\"headerlink\" title=\"Data Transformation\"></a>Data Transformation</h3><p>There are two places where data transformations might need to occur.  The first is after we retrieve the data or right before we send the data back. In an ideal world the server would always send back exactly what we need in the form we need it and we would send it back in a similar form. There are at least two advantages to this.  The first is that it will reduce the amount of processing that the client side code has to perform. Second, the data that that comes back will be generally smaller.</p>\n<p>The second place is as we are working with the data on the client side.</p>\n<p>One scenario where this would occur is when you update a field and the side effect is that data someplace else on the screen should change as well. Not because you retrieved data from somewhere but simply because you changed data in an input field.</p>\n<p>As I’ve already mentioned, we want to keep processing of data out of our components or even our component services unless the processing is specific to what the component does. The next logical place to put the processing of our store data is in our reducers.  But this has problems too. Maybe the data you want to display has no resemblance to the data that is in your store. Beyond that, this gets difficult to manage.</p>\n<p>Instead, the best place to handle data transformation is in your selector. Selectors have a function call as their last parameter that takes all the data slices from the previous parameters. This function can manipulate the data and return it in any way that makes sense for the application. It has the added advantage of being able to leverage memoization and changing the object pointer as I’ve already mentioned.</p>\n<h3 id=\"Services\"><a href=\"#Services\" class=\"headerlink\" title=\"Services\"></a>Services</h3><p>A final temptation may be to ditch the Services that the Effects use and go after the REST end points directly. This seems to make sense since the Effects and the Services are both <code>@Injectable()</code>s but the problem with this is primarily that it violates the Single Responsibility Principle.</p>\n<p>For retrieval of data, the Service is responsible for retrieving the data and possibly morphing it into the shape that we want it in. The Effect is primarily responsible for moving the resulting data into the store.</p>\n<p>The reverse is also true. Effects are responsible for collecting the data from wherever it is in the store and passing it to the Service.  The Service is responsible for sending that data to the server in the form that it needs it.</p>\n<p>One error I’ve seen is to inject the Store into the Service. The only <code>@Injectable()</code> that should be injected into your HTTP Service is HttpClient.</p>\n<h2 id=\"Angular-as-Functional-x2F-Reactive\"><a href=\"#Angular-as-Functional-x2F-Reactive\" class=\"headerlink\" title=\"Angular as Functional&#x2F;Reactive\"></a>Angular as Functional&#x2F;Reactive</h2><p>At the beginning of this article, I said one of the guiding principles of how we code is that we prefer Functional&#x2F;Reactive programming over Imperative&#x2F;Object Oriented programming.</p>\n<p>What does that mean?</p>\n<p>Imperative programming is code most of us are familiar with. It is code that says, do this, then do that, then do something else. Everything happens in sequence and it is very clear what happens when because the code says so.</p>\n<p>The problem with imperative programming is that it often contributes to tightly coupled code. In fact, this is the main reason Object Oriented code uses dependency injection and inversion of control.</p>\n<p>Object Oriented programming adds a layer on to imperative programming and tries to model everything in the world as a thing.  For example, a database Table, and User Interfaces are things. They lend themselves well to Object Oriented programming. By layering in dependency injection they decouple a lot of the code.</p>\n<p>But Object Oriented code still suffers from a problem. Not everything we are trying to write code for is a thing. Most of what we code is a process. Until recently, we’ve tried to shoehorn in a programming model that works for things and tried to make processes things somehow. It hasn’t worked well.</p>\n<p>Another problem with Imperative&#x2F;Object Oriented programming is that it mutates memory and each function can return different values even though I’ve passed in the same values. This can make this model difficult to test.</p>\n<p>Think about it, which would you rather write a test for?  Code that given the same parameters always returns the same value, or code that is indeterminate.</p>\n<p>But wait, you say, all code is deterministic. Or is it?</p>\n<p>Take for example a method in a class that has two member variables.  The method itself takes a parameter and makes a call out to a database. How many possible return values are there for any given value we pass in?</p>\n<p>Well, here’s the problem, you actually have 4 parameters and one of these is difficult to control. Oh, sure, you could mock the call to the database and get some control. But if you could write code that didn’t require taming, wouldn’t that be helpful?</p>\n<p>Which leads us to Functional Programming. In Functional Programming we have a number of key advantages. First any given function passed the same parameters always returns the same value. Testing issues solved! Second, strictly functional code has no variables. As one article I read states, “You can’t screw up what you can’t change.” Third, everything is a function.</p>\n<p>This is an oversimplification, you can read more on functional programming elsewhere. One final advantage that most of the literature doesn’t mention is that Functional Programming models processes better than Object Oriented programming. And because of the features I mentioned above, it is also much easier to test and much more deterministic.</p>\n<p>Which leads to Reactive. Aside from the fact that we are using RxJS in Angular which is a Reactive library, this also means that we react to “events” that get fired.  This is essentially what is happening when you dispatch an action in NgRX, what you are effectively saying is, “someone do this thing for me.”</p>\n<p>In the past, you would have just coded for that process to start. Here, that action could just as easily happen on some other computer, or at least some other thread. And so, instead of coding “do this, then that, then this other thing.”  You are coding, “when I get notified, I’m going to do this and then, optionally, notify the system that I’m done.”</p>\n<p>And so, we favor Functional&#x2F;Reactive programming because it makes our programs more stable but we admit that not everything can be done using a Functional&#x2F;Reactive model.</p>\n<h2 id=\"Data-over-Presentation\"><a href=\"#Data-over-Presentation\" class=\"headerlink\" title=\"Data over Presentation\"></a>Data over Presentation</h2><p>This is a specific instance of the previous point, but I want to call it out directly because I recognize that it is not quite as obvious to most people as it is to me.</p>\n<p>Most programmers, because they are still thinking in an imperative model, think of their code in terms of the presentation layer. What this means in terms of how they code is that when an event occurs in the view, they tend to fire an action. Sometimes this is the right thing to do. But, if the action that just occurred in the view also changed the state of your data in someway, it would make more sense to observe the data change in your store and react to it there than to fire off an event from the view to do the same thing.</p>\n<p>By following the rule of Data over Presentation, you benefit in two ways. The first is that more of your code will transfer to whatever JavaScript framework or library becomes popular in the future because RxJS is agnostic to which one you use.</p>\n<p>Second, by observing the data using <code>distinctUntilChanged()</code> you can ensure that you only respond when the data actually changed instead of every time it looks like there may have been a change.</p>\n",
            "tags": [
                "angular",
                "ngrx",
                "functional",
                "reactive",
                "mvp"
            ]
        },
        {
            "id": "http://davembush.github.com/typescript-basics-for-angular-developers/",
            "url": "http://davembush.github.com/typescript-basics-for-angular-developers/",
            "title": "TypeScript Basics for Angular Developers",
            "date_published": "2018-09-08T10:30:30.000Z",
            "content_html": "<p>For the most part, TypeScript feels a lot like JavaScript.  Most people pick it up without having any formal training.</p>\n<p>But, here’s the deal.  “Just because you can, doesn’t mean you should.” </p>\n<p>The thing that makes me most nervous about Angular is that it is structured so that you can write some really clean code.  But, you don’t have to.  Which mean most won’t. </p>\n<p>In fact, recruiters continue to contact me about Angular jobs with rates that make it obvious that hiring an Angular programmer is the same as hiring an HTML “programmer” 10 years ago.  Sorry gang, JavaScript has grown up and so has Angular. </p>\n<p>So, here are a few things you need to know about TypeScript that will make you a better Angular developer. <figure><img src=\"/uploads/2017/07/TypescriptBasicsForAngular.jpg\" title=\"TypeScript Basics for Angular Developers\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/mujitra/8059355303/\">MIKI Yoshihito. (#mikiyoshihito)</a> via <a href=\"//visualhunt.com/re/b6d829\">VisualHunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Variable-Declaration\"><a href=\"#Variable-Declaration\" class=\"headerlink\" title=\"Variable Declaration\"></a>Variable Declaration</h2><p>There are three ways of declaring a variable in TypeScript.  You can either use the JavaScript <code>var</code> keyword like you’ve always done or you can use the <code>let</code> keyword or the <code>const</code> keyword. </p>\n<p>But first, what problem are we trying to solve? </p>\n<p>In the old JavaScript world, we would declare variables in a block of code, but where-ever we declared that variable, the actual declaration was “hoisted” to the top of the function.  In fact, there never was anything like block scope.  Just function scope. </p>\n<p>This caused one particular problem that was rather common.  If I created a for&#x2F;next loop that called an asynchronous function, the asynchronous function would use the last value of the for&#x2F;next incrementer. </p>\n<p>The primary benefit of using <code>let</code> or <code>const</code> is that they effectively provide for block level scope so that we can write code like I described above and it will behave in the way we would expect from other languages. </p>\n<p>Unless you explicitly want to avoid block level scope, you should never use the <code>var</code> keyword to declare a variable in TypeScript.  This falls under the “just because you can, doesn’t mean you should” rule. </p>\n<p>In my experience, you will use <code>const</code> more often than <code>let</code>.  Here’s the difference. </p>\n<p>If you are declaring a variable that will only ever be assigned one value, you declare it using <code>const</code>.  What isn’t obvious is that changing the contents of an object does not change the value of an object.  So, doing something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> myArray = [];  </span><br><span class=\"line\">myArray.<span class=\"title function_\">push</span>(&#123;&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Would be more valid as:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> myArray = [];</span><br><span class=\"line\">myArray.<span class=\"title function_\">push</span>(&#123;&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Because pushing something into the array doesn’t change the value, or the pointer, of myArray.  It only changes the content of the array.</p>\n<p>You DID know that, right?</p>\n<h2 id=\"Types\"><a href=\"#Types\" class=\"headerlink\" title=\"Types\"></a>Types</h2><p>The main thing that makes TypeScript what it is, is that it allows us to type-check our code.  You don’t have to.  In fact, there are times when this might get in your way.  But, you have a choice. </p>\n<p>By default, TypeScript uses inference when it can to figure out the type of a variable.  This is important because I can bet one of the first errors you are going to see is a type mismatch error. You might try to do something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> v = <span class=\"string\">&#x27;abc&#x27;</span>;  </span><br><span class=\"line\"><span class=\"comment\">// some other code, and then ...  </span></span><br><span class=\"line\">v = <span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<p>That’s not going to compile. But you could do something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">v</span>: <span class=\"built_in\">any</span> = <span class=\"string\">&#x27;abc&#x27;</span>;  </span><br><span class=\"line\"><span class=\"comment\">// some other code, and then …  </span></span><br><span class=\"line\">v = <span class=\"number\">20</span>;</span><br></pre></td></tr></table></figure>\n\n<p>That is telling the TypeScript compiler that we are OK with the variable v being any type. </p>\n<p>Other than the Classes and Interfaces that are either part of JavaScript or that we, or a third party, create, there are boolean, number, string, array, enum, any, void, tuple, never, null, and undefined. </p>\n<p>I’m going to assume that until I mentioned “tuple” you were ok with the types I mentioned.  So, let’s dig a little deeper on those last few. </p>\n<p>A tuple is a type that wars have been fought over.  Well, it isn’t that bad, but it is controversial. What we care about here is why you might want to use it.  It allows you to return a highly defined array or object directly into local variables.  That is, I can specify that a function returns an array or object that has a specific number of elements and each element is a specific type.  It has its uses, but it is probably one of the types that you want to reserve for special cases.  It saves you from having to access array elements or object fields or properties.  That’s the long and short of it. </p>\n<p>The never type allows you to specify that a function never returns.  There are two reasons why this would be true.  First, you’ve entered an infinite loop or second, you’ve thrown an exception.  Again, not something you are likely to use. </p>\n<p>You can also explicitly specify that a type can only handle null or undefined.  But what is much more likely is that you specify that you don’t want to use these.</p>\n<h2 id=\"Combined-Types\"><a href=\"#Combined-Types\" class=\"headerlink\" title=\"Combined Types\"></a>Combined Types</h2><p>So, let’s say you have a parameter or a variable that accepts multiple types.  You could just use any and go on your merry way.  But, wouldn’t it be nice if you could say, “I want this type to be either a string or a number.”?  Well, you can.  Simply by using the pipe operator between types.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">v</span>: <span class=\"built_in\">string</span> | <span class=\"built_in\">number</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Remember our example above where we said we needed a variable to be either a number or a string, the above syntax is a much better way of typing the variable to do this because it limits the variable to exactly the types that we want to allow rather than letting anything be assigned to it.</p>\n<p>Amd we can take this even further.  Let’s say we want to make sure that the variable is a particular class type that we also want to be sure implements a specific interface.  For that, we use the ampersand.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">v</span>: <span class=\"title class_\">Person</span> &amp; <span class=\"title class_\">Manager</span>;</span><br></pre></td></tr></table></figure>\n\n<p>And while we are at it, what if we want to make sure that a variable only accepts string types that are not null or undefined?  By default, the compiler allows null and undefined to be assigned to anything, but there is a compiler switch that turns that feature off.  If you use the compiler switch and you want to allow null or undefined, you’ll need to use the pipe operator to include them.</p>\n<h2 id=\"Interface\"><a href=\"#Interface\" class=\"headerlink\" title=\"Interface\"></a>Interface</h2><p>For the most part, a TypeScript Interface looks a lot like an Interface in other languages. However, there are some differences that you need to know about. </p>\n<p>First, you don’t need to create a class that implements an Interface and then instantiate an object from that class in order to have an object of a particular interface type.  Actually, if you stop to think about it, this makes sense.  The problem is, there are a lot of people teaching TypeScript who are still using interfaces this way. </p>\n<p>But, in JavaScript, you can create an Object Literal.  TypeScript adds to JavaScript.  So, it only makes sense that TypeScript also allows you to create an Object Literal.  So, let’s say you have a parameter that takes an interface of type Name.  As long as the object we pass in conforms to the interface definition, the code will compile.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// interface Name with firstName and lastName as properties  </span></span><br><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">firstName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"attr\">lastName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// function that takes a Name as a parameter  </span></span><br><span class=\"line\"><span class=\"title function_\">foo</span>(<span class=\"params\">name: Name</span>) &#123;</span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// call the function with an object literal  </span></span><br><span class=\"line\"><span class=\"title function_\">foo</span>(&#123;<span class=\"attr\">firstName</span>: <span class=\"string\">&#x27;Dave&#x27;</span>, <span class=\"attr\">lastName</span>: <span class=\"string\">&#x27;Bush&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Optional\"><a href=\"#Optional\" class=\"headerlink\" title=\"Optional\"></a>Optional</h2><p>We’ve been talking a lot about Parameters and Interfaces.  In both cases, we often want to define a parameter or a property as optional. </p>\n<p>For example, most people have a middle name, but our Name interface doesn’t account for that.  If we added it, we’d want to make it optional since it is possible for that to not be included.  On the other hand, we don’t want people added whatever they want. </p>\n<p>The way we make sure a parameter is optional is by placing a question mark after the property, but before the colon.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Name</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">firstName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"comment\">// middleName is optional</span></span><br><span class=\"line\">  middleName?: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"attr\">lastName</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">&#125;  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// foo() now takes an optional name parameter  </span></span><br><span class=\"line\"><span class=\"title function_\">foo</span>(<span class=\"params\">name?: Name</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>I would highly recommend that you tweak your tslint rules to require type annotations on all of your code.  Out of the box, the tslint rules that come with the Angular-CLI are a bit too lax in this area.</p>\n<h2 id=\"this\"><a href=\"#this\" class=\"headerlink\" title=\"this\"></a>this</h2><p>The <code>this</code> keyword in JavaScript is probably the hardest concept to fully understand.  And while recent advances in the language have helped tame it, it still doesn’t fully conform to the model most people have in their mind of how an Object-Oriented language should behave.  This is because, of course, JavaScript isn’t an Object-Oriented language.  It is a Prototypal language.  There are similarities, but they aren’t they same. </p>\n<p>TypeScript, on the other hand, is more object oriented.  I say “more” because it is really only object-oriented in the places where you are taking advantage of TypeScript specific features, such as a Class.  If you create an object literal that has an inline function, you are back in JavaScript land. </p>\n<p>In a class, if you have a method that calls another method in the same class, you must use the <code>this</code> keyword to go after it.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SomeClass</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">someFunction</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"title function_\">someOtherFunction</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">   <span class=\"variable language_\">this</span>.<span class=\"title function_\">someFunction</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This may take some getting used to if you are coming from JavaScript where you can call any function that is in scope without using the this keyword.  But, I can assure you that having this rule imposed on the language solves a lot of bugs caused the “this” side effects, that it is well worth the adjustment.</p>\n<h2 id=\"Arrow-Functions\"><a href=\"#Arrow-Functions\" class=\"headerlink\" title=\"Arrow Functions\"></a>Arrow Functions</h2><p>Fat Arrow functions, Arrow Functions, or Lambda Expressions all refer to the same concept.  They are probably one of my favorite features of the latest version of TypeScript and JavaScript both because they allow me to write code with fewer characters and because they solve a very real problem that has confused JavaScript developers for years. </p>\n<p>First the problem. </p>\n<p>If you’ve written any serious application using JavaScript, one of the following scenarios will be familiar to you. </p>\n<p>Any time you create an event handler, when the function gets called, the ‘this’ keyword isn’t pointing to the object you are in, it is pointing to the context of the event that fired it.  This could be null, a windows object, or something else.  We often get around this problem by using the bind() function to wrap the context of the function. </p>\n<p>What the arrow functions in TypeScript do is that they form a closure around the current ‘this’ context by taking advantage of how TypeScript is compiled into JavaScript. </p>\n<p>You see, when your TypeScript code is compiled, every place you referred to <code>this</code> it refers to a variable named <code>_this</code>.  Inside the arrow function, they refer to this same <code>_this</code> instead of creating a new one or looking at the context the function was called from. </p>\n<p>The main difference between a regular anonymous function and an arrow function is that we leave out a lot of junk. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> newFunc = <span class=\"keyword\">function</span>(<span class=\"params\">x</span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// do something with x  </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Compared to:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title function_\">newFunc</span> = (<span class=\"params\">x</span>) =&gt; &#123;  </span><br><span class=\"line\">  <span class=\"comment\">// do something with x  </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>But wait! There’s more.  </p>\n<p>If you only have one line, you can remove the curly braces. </p>\n<p>Let’s say you want to create an arrow function that returns the square of some number.  You could write this as:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title function_\">newFunct</span> = (<span class=\"params\">x</span>) =&gt; x * x;</span><br></pre></td></tr></table></figure>\n\n<p>Fat arrow functions return the value from the function automatically.</p>\n<h2 id=\"Decorators\"><a href=\"#Decorators\" class=\"headerlink\" title=\"Decorators\"></a>Decorators</h2><p>I don’t want to spend a lot of time on decorators.  If you’ve been using .NET, you’ll recognized decorators as “Attributes”. Java programmers are probably used to calling them annotations. </p>\n<p>Effectively, what a decorator does is that it adds additional information to a function, field, or class that marks it for special use.  While you can create your own decorators, we will only concentrate on implementing decorators that have already been defined for us. </p>\n<p>You’ll know that something is a decorator because it is a symbol prefixed with the at symbol.</p>\n<h2 id=\"Import-and-Export\"><a href=\"#Import-and-Export\" class=\"headerlink\" title=\"Import and Export\"></a>Import and Export</h2><p>Last in our discussion of TypeScript are the keywords import and export. </p>\n<p>Now, why do we need these keywords? </p>\n<p>If you are familiar with other languages such as C#, VB.NET or Java, you will recognize the concept of Import as the keyword that says, “Tell this file I’m going to reference code from that other file over there in here.”  And then when we compile our code, the compiler makes sure that we are using that other code correctly. </p>\n<p>A similar thing happens in TypeScript, but in Angular we get the added benefit of also being able to use this information so that we only include the code we are actually using. </p>\n<p>You see, in the old days, we would suck in entire JavaScript libraries just because we were using a few functions.  But now with concepts like “Tree Shaking” that we will cover later, we can look at the actual code we are referencing and only include that code.  This reduces the size and number of files that our customer has to download to use our applications. </p>\n<p>The export keyword, on the other hand, tells the compiler what functions, classes, and interfaces external code is able to reference.  If it isn’t exported, it is only available to code in the file it was declared in.</p>\n<h2 id=\"More\"><a href=\"#More\" class=\"headerlink\" title=\"More\"></a>More</h2><p>I have barely scratched the surface of TypeScript here.  There is a lot more available in the language than what I’ve introduced to you here and knowing the parts I’ve left out will ultimately make you a better programmer and make your code more stable.  But the parts I have introduced will get you going and will make you familiar with the parts you will see most often.</p>\n",
            "tags": [
                "angular",
                "typescript"
            ]
        },
        {
            "id": "http://davembush.github.com/where-to-store-angular-configurations/",
            "url": "http://davembush.github.com/where-to-store-angular-configurations/",
            "title": "Where To Store Angular Configurations",
            "date_published": "2018-08-11T10:59:34.000Z",
            "content_html": "<p>Because this is a frequent problem, because it is so often done incorrectly and because there is a great alternative, today I want to discuss where to store Angular configurations. You know, all that information that changes as you move from your local development environment to the Development, QA and Production servers?</p>\n<p>There’s a place for that!</p>\n<span id=\"more\"></span>\n\n<h2 id=\"Wrong-Place\"><a href=\"#Wrong-Place\" class=\"headerlink\" title=\"Wrong Place\"></a>Wrong Place</h2><p>I know it is tempting, but the environment.ts and environment.prod.ts files were never meant for configuration information other than to tell the run-time you are running a production version of the code instead of developing the code locally. Yes, I know it is possible to create a file for your different environments and you can effectively use the file for your configuration information. But, just because you can, doesn’t mean you should.</p>\n<p>In an ideal world, you would build a release candidate and place it on your Development server and then move it from there to QA and then to Production. You would never rebuild the application. You want to be absolutely sure that the code you tested in the Development environment is the code you ran in the QA environment and that the code you ran in the QA environment is the code that is running in the Production environment. You want to know for sure that the only possible reason why something isn’t working is because the configuration information is incorrect.</p>\n<p>There are other ways to mitigate the risk, but they all involve recompiling the code and tagging your repository so you can get the same code back. This works when there isn’t a better way. But, there is a better way!</p>\n<h2 id=\"Where-Instead\"><a href=\"#Where-Instead\" class=\"headerlink\" title=\"Where Instead?\"></a>Where Instead?</h2><p>If we can’t put our configuration information in our code, where do we put it? Obviously external to your code. This leaves us several solutions. One is to create a static json file that gets copied into your dist directory when the code is deployed to each environment. Another place that I’ve see work is to place the code in a database. The advantage to the database method is that you can have one database that handles the configuration information for all of your applications and even all of your environments. Put a good administration GUI on top of it and you can change the configuration easily without having to deploy even a file.</p>\n<h2 id=\"Jumping-The-Hurdle\"><a href=\"#Jumping-The-Hurdle\" class=\"headerlink\" title=\"Jumping The Hurdle\"></a>Jumping The Hurdle</h2><p>Now that you’ve put your configuration information in an external location, you realize that you’ll need to make a GET request to retrieve that information. You may also quickly realize that you need that configuration information as soon as your application starts up. Maybe putting that information in an external file wasn’t such a great idea after all?</p>\n<p>Well, not so fast!</p>\n<p>There is a little known API feature in Angular that lets us load stuff up front and will actually wait until the loading has completed before continuing on with our code.</p>\n<h2 id=\"APP-INITIALIZER\"><a href=\"#APP-INITIALIZER\" class=\"headerlink\" title=\"APP_INITIALIZER\"></a>APP_INITIALIZER</h2><p>APP_INITIALIZER is a multi provider type that lets you specify a factory that returns a promise. When the promise completes, the application will continue on. So when you get to the place in your code where you need the configuration information, you can be sure it has been loaded. It’s pretty slick.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_INITIALIZER</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">    ....</span><br><span class=\"line\">    <span class=\"attr\">providers</span>: [</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_INITIALIZER</span>,</span><br><span class=\"line\">            <span class=\"attr\">useFactory</span>: load,</span><br><span class=\"line\">            <span class=\"attr\">multi</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n\n<p>where <code>load</code> is a <code>function</code> that returns a <code>function</code> that returns a <code>Promise&lt;boolean&gt;</code>. The promise function loads your configuration information and stores it in your application.  Once your configuration has been loaded, you resolve the promise using <code>resolve(true)</code>.</p>\n<p>This last point is really important.  If you get this wrong, the code won’t wait for this to finish loading before moving on.  <code>useFactory</code> points to a <code>function</code> that returns a <code>function</code> that returns a <code>Promise&lt;boolean&gt;</code>!</p>\n<p>The <code>multi: true</code> thing is because APP_INITIALIZER allows multiple instances of this provider. They all run simultaneously, but the code will not continue beyond APP_INTITIALIZER until all of the Promises have resolved.</p>\n<h2 id=\"An-example\"><a href=\"#An-example\" class=\"headerlink\" title=\"An example.\"></a>An example.</h2><p>Now, as a discussion point, let’s assume that you have a regular Angular CLI based project and you need to load in the base location of your REST endpoints.  You might have a config.json file that looks something like this:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;baseUrl&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;https://davembush.github.io/api&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>You would create a different one of these for each of the environments you wanted to deploy to, and, as part of your deployment process, you would copy the appropriate file to <code>config.json</code> in the same location that you deploy all of your Angular CLI generated static files.</p>\n<h3 id=\"Basic-App-Initializer\"><a href=\"#Basic-App-Initializer\" class=\"headerlink\" title=\"Basic App Initializer\"></a>Basic App Initializer</h3><p>Now, the thing we want to do is to load this config file at runtime using APP_INITIALIZER.  To do that, let’s add an APP_INITIALIZER provider to our app.module.ts file.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_INITIALIZER</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">AppComponent</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.component&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">AppComponent</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [&#123;</span><br><span class=\"line\">    <span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_INITIALIZER</span>,</span><br><span class=\"line\">    <span class=\"attr\">useFactory</span>: load,</span><br><span class=\"line\">    <span class=\"attr\">multi</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;],</span><br><span class=\"line\">  <span class=\"attr\">bootstrap</span>: [<span class=\"title class_\">AppComponent</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>For now, you’ll notice, we are ignoring the implementation of the <code>load()</code> function.  Typically, I add load to another file and import it, but for the purposes of explaining how this works, we will leave it as part of this code.</p>\n<h3 id=\"Type-the-load-function\"><a href=\"#Type-the-load-function\" class=\"headerlink\" title=\"Type the load() function\"></a>Type the load() function</h3><p>Since I made such a big deal about the typing of the load function, we should type the load function to make sure it actually returns what we have in mind. The following is skeleton code that we will embellish.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\"></span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>At this point, the code doesn’t do anthing useful, but you should be able to compile and run the code at this point without seeing any errors in the console.</p>\n<h3 id=\"Proof-that-it-waits\"><a href=\"#Proof-that-it-waits\" class=\"headerlink\" title=\"Proof that it waits\"></a>Proof that it waits</h3><p>Next, we want to prove that this really is stopping the rest of our code from running.  To do this, we are going to use a simple <code>setTimeout()</code> to simulate a long running process that we need to wait on to complete.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\"></span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>), <span class=\"number\">10000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This code waits for 10 seconds before resolving.  You can play with the timeout value to prove to yourself that this code really is waiting.</p>\n<h3 id=\"The-fun-begins\"><a href=\"#The-fun-begins\" class=\"headerlink\" title=\"The fun begins\"></a>The fun begins</h3><p>Now, the purpose of this code is to load the config.json file.  For that we are going to need to get access to the HttpClient service. Normally, we use dependency injection to access this, and this code is no different.</p>\n<p>Back in the provider, add a <code>deps: []</code> section.  To inject HttpClient, use:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deps</span>: [<span class=\"title class_\">HttpClient</span>]</span><br></pre></td></tr></table></figure>\n\n<p>And change the load function to take HttpClient as a parameter.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\">http: HttpClient</span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>), <span class=\"number\">10000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Don’t forget to import <code>HttpClientModule</code> into your module.</p>\n<p>And, once we load the configuration file, we will want to save the information some place.  There are a couple of ways that you might do this, but the most Angular like would be to create a service.  In our case our service will have one field named <code>baseUrl</code>.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Injectable</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">providedIn</span>: <span class=\"string\">&#x27;root&#x27;</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ConfigService</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">baseUrl</span>: <span class=\"built_in\">string</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>) &#123; &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Since our service is using the new <code>provideIn</code> flag, we don’t need to worry about adding it to a module.</p>\n<p>In order to set this, we will need to add ConfigService to the <code>deps:</code> array.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">deps</span>: [</span><br><span class=\"line\">  <span class=\"title class_\">HttpClient</span>,</span><br><span class=\"line\">  <span class=\"title class_\">ConfigService</span></span><br><span class=\"line\">],</span><br></pre></td></tr></table></figure>\n\n<p>And make it a parameter of our <code>load()</code> function.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\">http: HttpClient, config: ConfigService</span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>), <span class=\"number\">10000</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Loading-config-json\"><a href=\"#Loading-config-json\" class=\"headerlink\" title=\"Loading config.json\"></a>Loading config.json</h3><p>The rest is pretty straight forward Angular code.  We will</p>\n<ul>\n<li>http.get(‘.config.json’)</li>\n<li>if it gives us a 404 error, we set default values</li>\n<li>if it succeeds we set the values from the data that got loaded.</li>\n</ul>\n<p>Now, why would we get a 404 error?</p>\n<p>Well, the one place where this file won’t be available is when we are using <code>ng serve</code> during development.  But when we load this with a regular server like Apache, IIS, or Nginx, the file will be available.</p>\n<p>Now, where we have the <code>setTimeout()</code> code, replace it with <code>http.get()</code> code.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;./config.json&#x27;</span>)</span><br><span class=\"line\"> .<span class=\"title function_\">pipe</span>(</span><br><span class=\"line\">   <span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">x: ConfigService</span>) =&gt;</span> &#123;</span><br><span class=\"line\">     config.<span class=\"property\">baseUrl</span> = x.<span class=\"property\">baseUrl</span>;</span><br><span class=\"line\">     <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">   &#125;),</span><br><span class=\"line\">   <span class=\"title function_\">catchError</span>((<span class=\"attr\">x</span>: &#123; <span class=\"attr\">status</span>: <span class=\"built_in\">number</span> &#125;, <span class=\"attr\">caught</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"built_in\">void</span>&gt;): <span class=\"title class_\">ObservableInput</span>&lt;&#123;&#125;&gt; =&gt; &#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (x.<span class=\"property\">status</span> !== <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">       <span class=\"title function_\">resolve</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     config.<span class=\"property\">baseUrl</span> = <span class=\"string\">&#x27;http://localhost:8080/api&#x27;</span>;</span><br><span class=\"line\">     <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">     <span class=\"keyword\">return</span> <span class=\"title function_\">of</span>(&#123;&#125;);</span><br><span class=\"line\">   &#125;)</span><br><span class=\"line\"> ).<span class=\"title function_\">subscribe</span>();</span><br></pre></td></tr></table></figure>\n\n<p>I’m not going to bother explaining all of the details of RxJS 6, you can look that all up if you are interested.</p>\n<h2 id=\"Caveats\"><a href=\"#Caveats\" class=\"headerlink\" title=\"Caveats\"></a>Caveats</h2><p>Regardless of which of the two methods you use, you’ll need to make sure that your code will not need to change to access the database or the config file. If you are going to use a database, even then, I would not hard-code anything other than a relative URL. If the database is on some external server, make sure that you can proxy the code to is from your application’s server so that if and when the database location changes, you won’t need to recompile your code.</p>\n<h2 id=\"Full-resulting-code\"><a href=\"#Full-resulting-code\" class=\"headerlink\" title=\"Full resulting code\"></a>Full resulting code</h2><p>Just in case I left out a step or you are otherwise lost or maybe all you really care about is the code so you can copy and paste it.</p>\n<p>Here it is:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"variable constant_\">APP_INITIALIZER</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">BrowserModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">HttpClientModule</span>, <span class=\"title class_\">HttpClient</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/common/http&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">AppComponent</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.component&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ConfigService</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./config.service&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"keyword\">of</span>, <span class=\"title class_\">Observable</span>, <span class=\"title class_\">ObservableInput</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;../../node_modules/rxjs&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; map, catchError &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;rxjs/operators&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">load</span>(<span class=\"params\">http: HttpClient, config: ConfigService</span>): (<span class=\"function\">() =&gt;</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (): <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt; =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Promise</span>&lt;<span class=\"built_in\">boolean</span>&gt;((<span class=\"attr\">resolve</span>: <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">boolean</span></span>) =&gt;</span> <span class=\"built_in\">void</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">       http.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;./config.json&#x27;</span>)</span><br><span class=\"line\">         .<span class=\"title function_\">pipe</span>(</span><br><span class=\"line\">           <span class=\"title function_\">map</span>(<span class=\"function\">(<span class=\"params\">x: ConfigService</span>) =&gt;</span> &#123;</span><br><span class=\"line\">             config.<span class=\"property\">baseUrl</span> = x.<span class=\"property\">baseUrl</span>;</span><br><span class=\"line\">             <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">           &#125;),</span><br><span class=\"line\">           <span class=\"title function_\">catchError</span>((<span class=\"attr\">x</span>: &#123; <span class=\"attr\">status</span>: <span class=\"built_in\">number</span> &#125;, <span class=\"attr\">caught</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"built_in\">void</span>&gt;): <span class=\"title class_\">ObservableInput</span>&lt;&#123;&#125;&gt; =&gt; &#123;</span><br><span class=\"line\">             <span class=\"keyword\">if</span> (x.<span class=\"property\">status</span> !== <span class=\"number\">404</span>) &#123;</span><br><span class=\"line\">               <span class=\"title function_\">resolve</span>(<span class=\"literal\">false</span>);</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">             config.<span class=\"property\">baseUrl</span> = <span class=\"string\">&#x27;http://localhost:8080/api&#x27;</span>;</span><br><span class=\"line\">             <span class=\"title function_\">resolve</span>(<span class=\"literal\">true</span>);</span><br><span class=\"line\">             <span class=\"keyword\">return</span> <span class=\"title function_\">of</span>(&#123;&#125;);</span><br><span class=\"line\">           &#125;)</span><br><span class=\"line\">         ).<span class=\"title function_\">subscribe</span>();</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">AppComponent</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span>,</span><br><span class=\"line\">    <span class=\"title class_\">HttpClientModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [&#123;</span><br><span class=\"line\">      <span class=\"attr\">provide</span>: <span class=\"variable constant_\">APP_INITIALIZER</span>,</span><br><span class=\"line\">      <span class=\"attr\">useFactory</span>: load,</span><br><span class=\"line\">      <span class=\"attr\">deps</span>: [</span><br><span class=\"line\">        <span class=\"title class_\">HttpClient</span>,</span><br><span class=\"line\">        <span class=\"title class_\">ConfigService</span></span><br><span class=\"line\">      ],</span><br><span class=\"line\">      <span class=\"attr\">multi</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">bootstrap</span>: [<span class=\"title class_\">AppComponent</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "angular",
                "configuration",
                "devops"
            ]
        },
        {
            "id": "http://davembush.github.com/ngrx-actions-class-vs-object-literal/",
            "url": "http://davembush.github.com/ngrx-actions-class-vs-object-literal/",
            "title": "NgRX Actions - Class vs Object Literal",
            "date_published": "2018-07-03T10:30:58.000Z",
            "content_html": "<p>When NgRX 4 came out and I discovered that the “right” way of creating Actions is to use TypeScript classes and not Object Literals, I was a bit surprised.  Why would you use a Class that requires you to use the “new” keyword?  Why would you put multiple classes in one file?  This is insane! <figure><img src=\"/uploads/2018/07/2018-07-04.png\" title=\"NgRX Actions - Class vs Object Literal\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/dkobras/8342620023/\">dkobras</a> &#x2F; <a href=\"//creativecommons.org/licenses/by-sa/2.0/\"> CC BY-SA</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Options\"><a href=\"#Options\" class=\"headerlink\" title=\"Options\"></a>Options</h2><p>An Action is an object that contains a type variable and optionally, a payload. Depending on how you code your action, the payload may or may not have “payload” as the variable name. In NgRX version 2, payload was an optional variable. To improve type checking, payload was removed from the Action interface. </p>\n<p>The official documentation for NgRX version 4 encourages us to create a class for each action we want to dispatch. </p>\n<p>Suppose you have a Wait reducer that needs a Start action and an End action.  The code might look something like:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">Action</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">START</span> = <span class=\"string\">&#x27;Wait.Start&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Start</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">START</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">END</span> = <span class=\"string\">&#x27;Wait.End&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">End</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">END</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>To use this code in our reducer or effects you would import like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> <span class=\"title class_\">Wait</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.actions&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>And then we would dispatch the action using the store we’ve injected into our code. We’ll cover that later. But for now, the dispatch basically looks like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Wait</span>.<span class=\"title class_\">Start</span>());</span><br></pre></td></tr></table></figure>\n\n<p>If you need to pass other information to an Action, your constructor can accept them: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">ACTION_WITH_MESSAGE</span> = <span class=\"string\">&#x27;Wait.ActionWithMessage&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ActionWithMessage</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">ACTION_WITH_MESSAGE</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> message: <span class=\"built_in\">string</span></span>) &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This allows us to access the action payload as <code>Wait.message</code> instead of <code>Wait.payload</code>. Contrast this to putting the same code in a class with static methods as I’ve explained in previous articles:</p>\n<ul>\n<li><a href=\"/how-to-upgrade-ngrx-to-4-x/\">How to Upgrade to NgRX 4</a></li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Wait</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"variable constant_\">START</span> = <span class=\"string\">&#x27;Wait.Start&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"variable constant_\">END</span> = <span class=\"string\">&#x27;Wait.Start&#x27;</span>;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> <span class=\"variable constant_\">ACTION_WITH_MESSAGE</span> = <span class=\"string\">&#x27;Wait.ActionWithMessage&#x27;</span>;    </span><br><span class=\"line\">  <span class=\"title function_\">start</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"attr\">type</span>: <span class=\"title class_\">Wait</span>.<span class=\"property\">START</span>&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">end</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"attr\">type</span>: <span class=\"title class_\">Wait</span>.<span class=\"property\">END</span>&#125;;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"title function_\">actionWithMessage</span>(<span class=\"params\">message: <span class=\"built_in\">string</span></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">type</span>: <span class=\"title class_\">Wait</span>.<span class=\"property\">ACTION_WITH_MESSAGE</span>,</span><br><span class=\"line\">      <span class=\"attr\">payload</span>: message&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>In summary, we can have multiple classes and new them up.  Or we can have one class with multiple static methods that return object literals.</p>\n<h2 id=\"Advantage-Object-Literal\"><a href=\"#Advantage-Object-Literal\" class=\"headerlink\" title=\"Advantage Object Literal\"></a>Advantage Object Literal</h2><p>The main advantage to using the object literal way is that you don’t need to create an object.  You also stay with the “One class, one file” model that is so common in Angular. On the surface, this seems to be a clear winner.</p>\n<h2 id=\"Advantage-Classes\"><a href=\"#Advantage-Classes\" class=\"headerlink\" title=\"Advantage Classes\"></a>Advantage Classes</h2><p>But, because of the way we import the class bundles, the way we end up using the code looks nearly the same.  The main difference is that we must instantiate the class.  But we also get the option of having a different variable type for each action, we aren’t forced to use a variable named “payload” to hold all the associated data.  Further, if you need multiple payloads, you can do that.  You aren’t limited by how many parameters&#x2F;member variables each of your Action classes use.  When using Effects, we can type the return value of the Effect to the Action we want it to return. </p>\n<p>In fact, it is this type safety that is the main reason we should be creating Actions using the Class method instead of the object literal method.</p>\n<h2 id=\"Tweaking-Classes-For-Bigger-Advantage\"><a href=\"#Tweaking-Classes-For-Bigger-Advantage\" class=\"headerlink\" title=\"Tweaking Classes For Bigger Advantage\"></a>Tweaking Classes For Bigger Advantage</h2><p>There is a further tweak we can make to using classes that will give us an additional advantage when we use the code in our Reducers. Instead of marking the action types as strings, we can make them enums.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">Action</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">Types</span> &#123;</span><br><span class=\"line\">  <span class=\"variable constant_\">START</span> = <span class=\"string\">&#x27;Wait.Start&#x27;</span>,</span><br><span class=\"line\">  <span class=\"variable constant_\">END</span> = <span class=\"string\">&#x27;Wait.End&#x27;</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Start</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"title class_\">Types</span>.<span class=\"property\">START</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">End</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"title class_\">Types</span>.<span class=\"property\">END</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You’ll see below that this will give us extra type safety in our Reducers.</p>\n<h2 id=\"Type-Safety-in-Reducers\"><a href=\"#Type-Safety-in-Reducers\" class=\"headerlink\" title=\"Type Safety in Reducers\"></a>Type Safety in Reducers</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">ActionReducer</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> <span class=\"title class_\">Wait</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.actions&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This could go in wait.actions.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">type</span> <span class=\"title class_\">Action</span> = <span class=\"title class_\">Wait</span>.<span class=\"property\">End</span> | <span class=\"title class_\">Wait</span>.<span class=\"property\">Start</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">WaitReducer</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">  state = <span class=\"number\">0</span>, action: Action</span>): <span class=\"built_in\">number</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(action.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">Wait</span>..<span class=\"property\">Types</span>.<span class=\"property\">START</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> state + <span class=\"number\">1</span>;</span><br><span class=\"line\">      <span class=\"keyword\">case</span> <span class=\"title class_\">Wait</span>.<span class=\"property\">Types</span>.<span class=\"property\">END</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> state - <span class=\"number\">1</span>;</span><br><span class=\"line\">      <span class=\"attr\">default</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>We’ve ensured that the only Actions we will get are from Wait.</p>\n<p>Now, what you can’t see here is that if the payload we were send were of different types, each case statement would automatically typecast the action to the proper type.  This only works with Enums.  If you try this with strings, it won’t work the same way.</p>\n<h2 id=\"Type-Safety-in-Effects\"><a href=\"#Type-Safety-in-Effects\" class=\"headerlink\" title=\"Type Safety in Effects\"></a>Type Safety in Effects</h2><figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> <span class=\"title class_\">Wait</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.actions&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WaitEffects</span> &#123;</span><br><span class=\"line\">  <span class=\"meta\">@Effect</span>()</span><br><span class=\"line\">  <span class=\"attr\">start$</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span>&gt; =</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">actions$</span></span><br><span class=\"line\">      .<span class=\"title function_\">ofType</span>(<span class=\"title class_\">Wait</span>.<span class=\"property\">START</span>)</span><br><span class=\"line\">      .<span class=\"title function_\">switchMap</span>(<span class=\"function\">(<span class=\"params\">action: Wait.Add</span>) =&gt;</span></span><br><span class=\"line\">        <span class=\"title class_\">Observable</span>.<span class=\"title function_\">timer</span>(<span class=\"number\">1</span>).<span class=\"title function_\">take</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">      )</span><br><span class=\"line\">      .<span class=\"title function_\">map</span>((): <span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span> =&gt;</span><br><span class=\"line\">        (&#123;<span class=\"attr\">type</span>: <span class=\"title class_\">Wait</span>.<span class=\"property\">ADD</span>, <span class=\"attr\">payload</span>: <span class=\"number\">1</span>&#125;));</span><br><span class=\"line\">        </span><br><span class=\"line\">  <span class=\"meta\">@Effect</span>()</span><br><span class=\"line\">  <span class=\"attr\">end$</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span>&gt; =</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">actions$</span></span><br><span class=\"line\">      .<span class=\"title function_\">ofType</span>(<span class=\"title class_\">Wait</span>.<span class=\"property\">END</span>)</span><br><span class=\"line\">      .<span class=\"title function_\">switchMap</span>(<span class=\"function\">(<span class=\"params\">action: Wait.End</span>) =&gt;</span></span><br><span class=\"line\">        <span class=\"title class_\">Observable</span>.<span class=\"title function_\">timer</span>(<span class=\"number\">1</span>).<span class=\"title function_\">take</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">      )</span><br><span class=\"line\">    .<span class=\"title function_\">map</span>((): <span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span> =&gt;</span><br><span class=\"line\">      (&#123;<span class=\"attr\">type</span>: <span class=\"title class_\">Wait</span>.<span class=\"property\">ADD</span>, <span class=\"attr\">payload</span>: -<span class=\"number\">1</span>&#125;));</span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> actions$: Actions</span>)&#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>We’ve ensured that the only Action that get returned from either Effect is the Add action.</p>\n<h2 id=\"Tweak-Object-Literal-Implementation\"><a href=\"#Tweak-Object-Literal-Implementation\" class=\"headerlink\" title=\"Tweak Object Literal Implementation\"></a>Tweak Object Literal Implementation</h2><p>Now, you might think, “I can get all that type safety by creating a separate interface for each action type.  And this would be true.  But this would be even more files and the only thing to be gained is that your Action object gets created faster because you are using Object Literals.  I’m not sure the advantage is worth the pain.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>If you are converting an NgRX 2 site to NgRX 4, you’ll probably want to follow the advice I originally gave for upgrading.  But, once you’ve upgraded, you’ll want to move to using Classes so that you can take advantage of the stronger typings this will afford you.</p>\n",
            "tags": [
                "angular",
                "NgRX"
            ]
        },
        {
            "id": "http://davembush.github.com/vmware-s-clarity-design-system-for-angular/",
            "url": "http://davembush.github.com/vmware-s-clarity-design-system-for-angular/",
            "title": "VMWare's Clarity Design System for Angular",
            "date_published": "2018-03-20T10:30:51.000Z",
            "content_html": "<p>Unless you are a CSS wizard, you are probably using one of two CSS frameworks for your Angular projects or some sort of adaptation of them.  Bootstrap or Angular Material.  These have served us well, but they have one major flaw.  They target the “Mobile First” method of design.  This is great if your application must work on a mobile device.  But most corporate web applications target web applications.</p>\n<p>Have you ever heard any of these objections from your end users?</p>\n<ul>\n<li>Why is everything so big?</li>\n<li>Why can’t I have the label NEXT to the input field?</li>\n</ul>\n<p>And then you explain, it is so the screen can run on a mobile device and you hear, “But, this application will never run on a mobile device!”  Which is a valid point. </p>\n<p>Therefore, I was so excited to hear that VMWare has finally taken up the challenge of creating a Desktop First CSS Framework called <a href=\"//vmware.github.io/clarity/\">Clarity</a>. </p>\n<figure style=\"text-align: center\">\n<img src=\"/vmware-s-clarity-design-system-for-angular/2018-03-20.jpg\" class=\"\" title=\"VMWare&#39;s Clarity Design System for Angular\"><figcaption>Photo credit: [Sean Hering Photography](//visualhunt.com/author/2edd3b) on [Visual Hunt](//visualhunt.com/re/764a8a) / [ CC BY](//creativecommons.org/licenses/by/2.0/)</figcaption>\n </figure> \n\n<span id=\"more\"></span>\n\n<h2 id=\"What-Is-Clarity\"><a href=\"#What-Is-Clarity\" class=\"headerlink\" title=\"What Is Clarity?\"></a>What Is Clarity?</h2><p>To call it a CSS Framework though doesn’t really do it justice.  It is a UI&#x2F;UX System.  Much like Angular Material.  In fact, an application written using Clarity is going to end up looking a lot like a Material Design application.  The main differences are going to be, it will be built for the desktop rather than a mobile device.  This means the components won’t be so fat and the components will look more like what you would expect from a desktop application.</p>\n<h2 id=\"Why-Clarity\"><a href=\"#Why-Clarity\" class=\"headerlink\" title=\"Why Clarity?\"></a>Why Clarity?</h2><p>Aside from the Desktop vs Mobile issue, there are other reasons you might want to consider using Clarity.</p>\n<h3 id=\"Material-Meets-Bootstrap\"><a href=\"#Material-Meets-Bootstrap\" class=\"headerlink\" title=\"Material Meets Bootstrap\"></a>Material Meets Bootstrap</h3><p>Now, while the end result looks a lot like Angular Material, the way you style your application feels a lot more like Bootstrap.  This is something that has always bothered me about Angular Material.  In fact, one of the main reasons we didn’t use Angular Material at one of the places I’ve worked is specifically because it was too hard to make the site follow the design guides that were handed down to us.  Bootstrap, on the other hand, gave us an easy way to adapt the CSS to fit the requirements.  Give me components that provide functionality and provide a way that I can style them.  But don’t make common components their own special component just so you can add CSS to the standard element.  Make that a common CSS thing that you can change with CSS!</p>\n<h3 id=\"508-Compliance\"><a href=\"#508-Compliance\" class=\"headerlink\" title=\"508 Compliance\"></a>508 Compliance</h3><p>Another big motivation for me to look at Clarity is that they have stricter 508 compliance if you use the default theme.  The one that is particularly important to me is the issue of contrast to support people who are color blind like me.  That’s 10% of the population that is impacted by color blindness in general which is a pretty large sample size to be pissing off with your color choices when there are tools that will let you see what it will look like to the various type of color blind people.  There compliance doesn’t end there, but that is the one that impacts me, so I care more about it.</p>\n<h3 id=\"More-x2F-Better-Components\"><a href=\"#More-x2F-Better-Components\" class=\"headerlink\" title=\"More&#x2F;Better Components\"></a>More&#x2F;Better Components</h3><p>Third, several components exist that meet some requirements that the team I’m currently working on could have benefited from. While Angular Material is moving to fill in some of the gaps, the Clarity system has those components already.</p>\n<h3 id=\"Great-Documentation\"><a href=\"#Great-Documentation\" class=\"headerlink\" title=\"Great Documentation\"></a>Great Documentation</h3><p>While it isn’t necessarily unique to Clarity, I found the documentation complete and easy to locate.  However, just like any of the other systems, you should take the time to read through most of the documentation, so you understand how it should work prior to actually trying to code anything.</p>\n<h3 id=\"Easy-to-Use\"><a href=\"#Easy-to-Use\" class=\"headerlink\" title=\"Easy to Use\"></a>Easy to Use</h3><p>Finally, I took Clarity for a spin and found it MUCH easier to use than either Bootstrap or Angular Material.  Everything worked the way I expected it to and I don’t believe there was one time I had to add CSS to one of my components to make it do what I really wanted it to do.  This says a lot for a product that hasn’t even been officially released yet.</p>\n<h3 id=\"VMWare\"><a href=\"#VMWare\" class=\"headerlink\" title=\"VMWare\"></a>VMWare</h3><p>Oh, and did I mention that it is backed by VMWare?  I always like it when an open source project is backed by a major company that doesn’t appear to be going away anytime soon.  This is why I tend to stay away from some of the smaller projects, like Vue, regardless of how great they are.  Yes, I know it has a big community.  But, people need to eat.  A project with corporate sponsorship is much more likely to be run well, progress at a steady pace, and be responsive to issues that crop up.</p>\n<h2 id=\"Why-You-Might-Want-to-Pass\"><a href=\"#Why-You-Might-Want-to-Pass\" class=\"headerlink\" title=\"Why You Might Want to Pass\"></a>Why You Might Want to Pass</h2><p>For all these benefits, there are a couple of reasons why you might want to at least wait if not ignore Clarity. </p>\n<p>As I mentioned above, the product hasn’t been released yet and therefore there will be breaking changes as the project makes its way to version 1.0.  This is easily mitigated by freezing your development efforts to the current release and only upgrading when you have time to address the breaking changes. </p>\n<p>You also might want to avoid using Clarity if you really need Mobile First.  I’m sure you could adapt the CSS to work with Mobile as well as Desktop.  Personally, I’d just make sure all of my business logic was outside my components so that I could develop a Mobile front-end and a Desktop front-end without losing any functionality.  This would mean one site would use Bootstrap, Angular Material, or IONIC and the other would use Clarity.</p>\n<h2 id=\"Installation-The-Right-Way\"><a href=\"#Installation-The-Right-Way\" class=\"headerlink\" title=\"Installation - The Right Way\"></a>Installation - The Right Way</h2><p>The clarity site has instructions for installing Clarity that are general enough that you could use the styles on multiple frameworks.  What follows is an adaptation of those instructions that are specific to an Angular site that uses the Angular CLI.</p>\n<ul>\n<li><p><code>npm install --save @webcomponents/custom-elements@^1.0.0</code></p>\n<ul>\n<li><p>This is a polyfill that we will add to our polyfills.ts file</p>\n<p>  <code>import &#39;@webcomponents/custom-elements/custom-elements.min&#39;;</code></p>\n</li>\n</ul>\n</li>\n<li><p><code>npm install --save @clr/icons</code></p>\n</li>\n<li><p><code>npm install --save @clr/ui</code></p>\n</li>\n<li><p><code>npm install --save bootstrap@4.0.0-alpha.5</code>(note I didn’t try using the current release version.  It may, or may not, work.)</p>\n</li>\n<li><p><code>npm install --save @clr/angular</code></p>\n</li>\n<li><p>Add the icon css and js files to the .angular-cli.json file in the “styles” and “scripts” section:</p>\n</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;styles&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;styles.css&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"string\">&quot;../node_modules/@clr/icons/clr-icons.css&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"string\">&quot;../node_modules/@clr/ui/clr-ui.min.css&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;../node_modules/@clr/icons/clr-icons.min.js&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li>Import the clarity module into your AppModule to make the components available</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ClarityModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@clr/angular&#x27;</span>;</span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span>,</span><br><span class=\"line\">    <span class=\"title class_\">ClarityModule</span></span><br><span class=\"line\">],</span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<ul>\n<li><code>npm start</code> to make sure everything builds correctly.  If everything builds and you run the app, you will see that the page has bigger fonts than you may be used to.  If it looks like it has always looked, you probably don’t have it configured correctly yet.</li>\n</ul>\n<p>If Clarity looks like it might meet your requirements better than the alternatives, I encourage you to take <a href=\"//vmware.github.io/clarity/\">Clarity</a> for a spin.</p>\n<h2 id=\"Other-Places-Talking-About-VMWare-Clarity\"><a href=\"#Other-Places-Talking-About-VMWare-Clarity\" class=\"headerlink\" title=\"Other Places Talking About VMWare Clarity\"></a>Other Places Talking About VMWare Clarity</h2><ul>\n<li><a href=\"//www.starwindsoftware.com/blog/vmware-clarity-why-should-you-care\">VMware Clarity – Why should you care</a></li>\n<li><a href=\"//devchat.tv/adv-in-angular/aia-172-clarity-project-vmware-eudes-petonnet-vincent-matt-hippely\">The Clarity Project at VMware</a> (podcast episode)</li>\n</ul>\n",
            "tags": [
                "angular",
                "css",
                "clarity",
                "ui",
                "ux"
            ]
        },
        {
            "id": "http://davembush.github.com/property-based-testing-in-angular-with-jsverify/",
            "url": "http://davembush.github.com/property-based-testing-in-angular-with-jsverify/",
            "title": "Property Based Testing in Angular with jsVerify",
            "date_published": "2018-02-06T11:30:58.000Z",
            "content_html": "<p>Several weeks ago, I mentioned that I’ve been playing around with <a href=\"/property-based-testing-revealed-a-better-way-to-test/\">Property Based Testing</a>.  In particular, I’ve been using it with my Angular code.  The framework I’ve chosen is <a href=\"//github.com/jsverify/jsverify\">jsVerify</a> because it seemed like the most straight forward of the available tools and it has a documented way of integrating with Jasmine, which Angular test use by default.  Angular with jsVerify.  How does that work?</p>\n<p>The documentation for how to use jsVerify seems to be written for people who already understand Property Based Testing from some other environment.  This makes picking it up and using it awkward at best.</p>\n<p>Here’s what I’ve learned along the way. <figure><img src=\"/uploads/2018/02/2018-02-06.jpg\" title=\"Property Based Testing in Angular with jsVerify\"><figcaption>Photo credit: <a href=\"//visualhunt.com/author/a3b62c\">Official U.S. Navy Imagery</a> on <a href=\"//visualhunt.com/re/d44953\">Visual Hunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span>\n\n<h2 id=\"The-Basics\"><a href=\"#The-Basics\" class=\"headerlink\" title=\"The Basics\"></a>The Basics</h2><p>To install jsVerify into your dev environment, use:</p>\n<p><code>npm install --save-dev jsverify</code></p>\n<p>To use the code in your spec file, import jsverify using:</p>\n<p><code>import * as jsc from &#39;jsverify&#39;;</code></p>\n<p>We us ‘jsc’ because jsVerify originated from <a href=\"//github.com/douglascrockford/JSCheck\">jsCheck</a>.  Why not just use jsCheck?  Well, because it looks even less well documented.  That doesn’t mean that it is, but that is how I felt when I went to the sites and I couldn’t be bothered to wade through the wall of text the documentation site presented me with.</p>\n<h2 id=\"A-Simple-Test\"><a href=\"#A-Simple-Test\" class=\"headerlink\" title=\"A Simple Test\"></a>A Simple Test</h2><p>Now to setup a simple test.  We won’t really test anything.  I just want to show the structure of the test.</p>\n<p>There are two methods you might use that seem very similar.  <code>assertForall()</code> and <code>checkForall()</code>.  What I didn’t realize at first is that <code>assertForall()</code> is the one you want to use because it will throw the exception that Jasmine is listening for so that I knows the test failed.  If you use <code>checkForall()</code> the test will fail, but Jasmine will think it succeeded.  And if you’re thinking, yeah but you should use expect() with checkForAll(), that doesn’t always work quite the way you would expect.  No pun intended.</p>\n<p>The basic structure of a test will go inside of your <code>it()</code> block.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;Any two numeric values&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;should equal 20&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    jsc.<span class=\"title function_\">assertForall</span>(jsc.<span class=\"property\">integer</span>, jsc.<span class=\"property\">integer</span>,</span><br><span class=\"line\">      <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">number</span>, b: <span class=\"built_in\">number</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> a_and_b_equal_20 = a + b === <span class=\"number\">20</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a_and_b_equal_20;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>This test will, obviously, fail.  A test we would expect to pass would look like this.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">describe</span>(<span class=\"string\">&#x27;Any two numeric values&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">it</span>(<span class=\"string\">&#x27;should be able to be added in any order&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    jsc.<span class=\"title function_\">assertForall</span>(jsc.<span class=\"property\">integer</span>, jsc.<span class=\"property\">integer</span>,</span><br><span class=\"line\">      <span class=\"function\">(<span class=\"params\">a: <span class=\"built_in\">number</span>, b: <span class=\"built_in\">number</span></span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">const</span> a_and_b_equal_20 = a + b === b + a;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> a_and_b_equal_20;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>You may have guessed by now that <code>assertForall()</code>takes a variable number of parameters.  The last parameter is a callback that runs our test.  The parameters before the callback describe the kinds of parameters that will be passed to the callback.  The description of the parameter is of type Arbitrary.  So, what we’ve said above is something to the effect of, “generate two random integers and pass them to the callback.”  You can check the jsVerify site for “Primitive Arbitraries” to see what is built in.</p>\n<h2 id=\"Adding-Complexity\"><a href=\"#Adding-Complexity\" class=\"headerlink\" title=\"Adding Complexity\"></a>Adding Complexity</h2><p>It won’t be long before you run into a situation where the primitive arbitraries won’t do the job for you and you’ll need to resort to the combinators.  This allows you to create a brand new arbitrary by combining primitives together.  The one I found myself using the most was <code>oneof()</code> where you pass a list of arbitraries as an array and the system will pick from the list and generate a new random value from the list.  Don’t confuse this with <code>either()</code>.  I’ve used <code>oneof()</code> in combination with <code>constant()</code>for cases where I’ve needed to create a random value from a list of possible values.</p>\n<p>Where things really got interesting though was when I needed to create an object with random values for the properties.  For this, you’ll need to use a record.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> recordArb = jsc.<span class=\"title function_\">record</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">firstName</span>: jsc.<span class=\"property\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">lastName</span>: jsc.<span class=\"property\">string</span>,</span><br><span class=\"line\">  <span class=\"attr\">arrayThing</span>: jsc.<span class=\"title function_\">array</span>(jsc.<span class=\"title function_\">record</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">fieldOne</span>: jsc.<span class=\"property\">integer</span>,</span><br><span class=\"line\">    <span class=\"attr\">dateField</span>: jsc.<span class=\"property\">datetime</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>This will let us pass random objects to our tests.  This is great for testing Reducers.  You’ll notice we even were able to create a nested array.  This will create a random length array with random records inside of it.</p>\n<h2 id=\"Arbitraries-from-Generators\"><a href=\"#Arbitraries-from-Generators\" class=\"headerlink\" title=\"Arbitraries from Generators\"></a>Arbitraries from Generators</h2><p>Now that I’ve been working with it for a while, I can’t remember why it was so difficult.  But the one place I did have some trouble was the concept of Generators vs Arbitraries.  Arbitraries are what we need to pass into <code>assertForall().</code> Generators are what we use when we need to come up with some way of creating our own special random data.  You rarely need to use this, but when you do, being able to convert the Generator to an Arbitrary will become critical.</p>\n<p>To convert a generator to an arbitrary, use bless.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">jsc.<span class=\"property\">generator</span>.<span class=\"title function_\">bless</span>(generatorThing);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Typing\"><a href=\"#Typing\" class=\"headerlink\" title=\"Typing\"></a>Typing</h2><p>As of this writing, the typing for <code>checkForall()</code> is incorrect.  It is typed as returning <code>Result&lt;any&gt;</code>when it in fact returns <code>Result&lt;any&gt; | boolean</code>I just discovered this so I haven’t entered a pull request that will fix the issue.  If you decide to use <code>checkForall()</code> instead of <code>assertForall()</code>, you’ll need to fix up the typings yourself.</p>\n<h2 id=\"Puzzles\"><a href=\"#Puzzles\" class=\"headerlink\" title=\"Puzzles\"></a>Puzzles</h2><p>The one thing I’m still trying to figure out is the best way of running the test.  The fact of the matter is that jsVerify tests do not lend themselves to the structure of a Jasmine test.  And since I have to generate 100 instances of random data for each test, it may not be efficient to separate each test out into separate it statements.</p>\n<p>For now, I’m running all related evaluations within one it statement and using the back-tick string delimiter to allow me to have a multi-line it() string that describes all that I’m testing.  But, by combining all of my test like this, I can no longer determine which of my test actually failed.</p>\n<p>I’m not exactly sure what the best solution to that is (yet) and right now, there don’t seem to be a lot of people using jsVerify or any other property based framework with Jasmine to get a lot of hints on how we might write tests that are easy to use.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>I encourage you to give jsVerify a try.  It really isn’t that hard to pick up and hopefully, this short article will smooth over some of the problems you may have as you get started.  Despite the puzzles I mentioned above the advantages of using it over example based testing encourage me to see just how far I can push this framework.</p>\n",
            "tags": [
                "angular",
                "jasmine",
                "property based testing"
            ]
        },
        {
            "id": "http://davembush.github.com/why-more-angular-modules-are-better-than-one/",
            "url": "http://davembush.github.com/why-more-angular-modules-are-better-than-one/",
            "title": "Why more Angular Modules are Better than One",
            "date_published": "2018-01-16T11:30:00.000Z",
            "content_html": "<p>I recently reviewed some Angular code that uses one module.  The AppModule. To manage the entire code base.  And, this isn’t tiny code base.  The main excuse I’ve heard for this is that the code originated during the beta cycle, prior to NgModule being added to the framework.  I call it out as an excuse because once it was added, it was clear that we needed to have more than one module.  The fact that this code base doesn’t have more than one module shows a disregard for doing things right over doing things fast.  In the best case, it shows ignorance.</p>\n<p>But, the larger question this code base raises for me is this: “Why are more modules better than fewer modules?”  After all, using one module obviously works.  Isn’t the fact that it works sufficient enough?</p>\n<p>And here are three really good reasons to use more modules. <figure><img src=\"/uploads/2018/01/2018-01-16-1.jpg\" title=\"Why more Angular Modules are Better than One\"><figcaption>Photo credit: <a href=\"//visualhunt.com/author/1d5a2d\">goodrob13</a> on <a href=\"//visualhunt.com/re/0a04dc\">Visualhunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Avoid-Component-Collision\"><a href=\"#Avoid-Component-Collision\" class=\"headerlink\" title=\"Avoid Component Collision\"></a>Avoid Component Collision</h2><p>For discussion purposes, let’s say you have an application with two routes.  Each route allows you to edit different kinds of content.  You may be inclined to create some child components in each route to assist with your functionality.  In the process of doing this, you may end up with two components that have the same name.  Both as a class and as a selector.  If you are including everything in one mega module, you will need to artificially give the components different names.  However, if each route has its own module, you can declare the components in the declaration section of each module with the same name and each route will be able to call the appropriate component.  Components aren’t shared across modules until you export the component.  In that case, you would also want the component to live in a shared module where we would give it a more meaningful, generic, name that made sense as a shared module.</p>\n<h2 id=\"Lazy-Loading\"><a href=\"#Lazy-Loading\" class=\"headerlink\" title=\"Lazy Loading\"></a>Lazy Loading</h2><p>Once you’ve created modules for each of your routes, the next logical step in your development effort will be lazy loading the module.  Lazy loading provides more advantages than just the ability to load only what you need when you need it.  That’s just the most obvious gain.  Lazy loading also provides a separate context for @Injectables.  Once again, just like having the ability to isolate the components, by using modules in conjunction with lazy loading, we have the ability to have route specific @Injectables with the same name and each route&#x2F;module will behave appropriately.</p>\n<p>There is one caveat.  You can’t provide an @Injectable in a lazy loaded module and an application level module and expect things to work correctly.  And, if you are still using a framework like NgRX 2 that needs to have access to services, you’ll need to make your services globally available.  This is one of many reasons why I believe you should upgrade to NgRX 4 as soon as is possible.  This allows you to take full advantage of the Angular Lazy Loading capabilities and all their benefits.</p>\n<h2 id=\"Cleaner-Code\"><a href=\"#Cleaner-Code\" class=\"headerlink\" title=\"Cleaner Code\"></a>Cleaner Code</h2><p>Even if you’ve never seen a major application with one module, I’m sure you can imagine what a mess that module is.  I don’t think I really need to say much more about this.</p>\n<p>For more on Angular Modules, I recommend <a href=\"//angular.io/guide/ngmodule-faq\">this FAQ that the Angular team put together</a>. <a href=\"//medium.com/@cyrilletuzi/understanding-angular-modules-ngmodule-and-their-scopes-81e4ed6f7407\">This Medium article</a> is also pretty good.</p>\n",
            "tags": [
                "angular",
                "modules",
                "ngmodule"
            ]
        },
        {
            "id": "http://davembush.github.com/attaching-an-angular-child-component-s-form-to-a-parent/",
            "url": "http://davembush.github.com/attaching-an-angular-child-component-s-form-to-a-parent/",
            "title": "Attaching an Angular Child Component's Form to a Parent",
            "date_published": "2018-01-02T11:30:57.000Z",
            "content_html": "<p>This past week I implemented a pattern I’ve been pondering for almost a year now.  I like to create rather modular and granular code such that if my data structures are nested, the components that represent them on the screen should be nested as well. The question becomes, how does one create a reactive form in a child component and attach that form to the parent form in a way that:</p>\n<ol>\n<li>Leaves the definition of the child form entirely in the child</li>\n<li>Leaves the processing of the data in the parent where the parent form is the “Smart Component” and the child is a “Dumb Component”</li>\n</ol>\n<p>Most solutions I was able to find attack this problem assuming the child component will be part of an array of controls.  And I suppose, if you wanted to, you could implement that pattern using an array with one element.  But, that just felt like a hack.  If you are interested in that solution, this is the wrong article. <figure><img src=\"/uploads/2018/01/2018-01-02.jpg\" title=\"Attaching an Angular Child Component&#39;s Form to a Parent\"> Photo by <a href=\"//visualhunt.com/author/e29ed9\">loomingy1</a> on <a href=\"//visualhunt.com/re/b9f011\">Visual hunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Avoiding-the-Problem\"><a href=\"#Avoiding-the-Problem\" class=\"headerlink\" title=\"Avoiding the Problem\"></a>Avoiding the Problem</h2><p>Up until recently, I’ve been able to avoid this problem entirely by creating separate forms and listening to each individually.  I could have done the same thing here.  But, every time I use this solution, I feel like there must be a better way.  Besides, when you do this correctly, you only need to have one place where you are listening for changes to the form and one place where you send changes into the form.  The work around requires multiples of each.</p>\n<h2 id=\"Basics-of-Nested-Forms\"><a href=\"#Basics-of-Nested-Forms\" class=\"headerlink\" title=\"Basics of Nested Forms\"></a>Basics of Nested Forms</h2><p>Another way of avoiding the problem is to create the form as one monolithic component.  A very simple implementation would be to have a form that looked something like this:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;mainInput&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">formGroupName</span>=<span class=\"string\">&quot;childGroup&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;childInput&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">  &lt;/<span class=\"attr\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>And the reactive definition in the typescript that looked like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">form</span>: <span class=\"title class_\">FormGroup</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder: FormBuilder</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">      <span class=\"attr\">mainInput</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">childGroup</span>: formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">        <span class=\"attr\">childInput</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And then we would grab the data from the valueChanges observable or patch the data into the form using </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">childGroup.<span class=\"property\">childInput</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Creating-the-Child-Component\"><a href=\"#Creating-the-Child-Component\" class=\"headerlink\" title=\"Creating the Child Component\"></a>Creating the Child Component</h2><p>But what if you we want everything in the childGroup to be a control?  That control would look something like this: </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span>&gt;</span> </span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;childInput&quot;</span>&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>and then our TypeScript code looks like a normal formGroup:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">childInput</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Embedding-the-Child-in-the-Parent\"><a href=\"#Embedding-the-Child-in-the-Parent\" class=\"headerlink\" title=\"Embedding the Child in the Parent\"></a>Embedding the Child in the Parent</h2><p>Now that we have a separate component for our child form, we can use normal directives to add it into our main form.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;mainInput&quot;</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">app-child</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">app-child</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>And our TypeScript code now only needs a reference to mainInput.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder: FormBuilder</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">mainInput</span>: <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Connecting-the-Child-to-the-Parent\"><a href=\"#Connecting-the-Child-to-the-Parent\" class=\"headerlink\" title=\"Connecting the Child to the Parent\"></a>Connecting the Child to the Parent</h2><p>The problem is, whenever the childInput element changes, the parent form’s valueChanges observer won’t get notified because the parent form no longer knows about the child form.  And this is where things interesting.</p>\n<p>Hooking the child form to the parent form is actually pretty straight forward.  The trick is knowing when in the component life-cycle to run the code.</p>\n<p>The first thing to know is that we aren’t going to be able to hookup the child in the parent until after the child component has been created.  This happens after ngOnInit() so we need to find another lifecycle hook to wire everything up in.  It just so happens that ngAfterViewInit() is the perfect place for this. </p>\n<p>Second, it might be tempting to hookup everything in the child component during it’s ngOnInit() method.  But this would too tightly couple the child component to the parent.  Something we would like to avoid. </p>\n<p>So, the next thing we need to do is that we need to use @ViewChild() to allow the parent to get a hold of the child component, and ultimately the formGroup member variable it will initialize for us.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ViewChild</span>(<span class=\"title class_\">ChildComponent</span>) <span class=\"attr\">childComponent</span>: <span class=\"title class_\">ChildComponent</span>;</span><br></pre></td></tr></table></figure>\n\n<p>And now in <code>ngAfterViewInit()</code> we can add the child’s <code>FormGroup</code> as an additional “control” and set the parent <code>FormGroup</code> to the parent control’s <code>FormGroup</code>.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">ngAfterViewInit</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">form</span>.<span class=\"title function_\">addControl</span>(<span class=\"string\">&#x27;childForm&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">childComponent</span>.<span class=\"property\">form</span>);</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">childComponent</span>.<span class=\"property\">form</span>.<span class=\"title function_\">setParent</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">form</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And finally, you’ll want to subscribe to <code>valueChanges</code> and your NgRX <code>Store</code> in <code>ngAfterViewInit()</code> after this wire-up code.</p>\n",
            "tags": [
                "angular",
                "reactive forms",
                "child component"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-cross-field-validation/",
            "url": "http://davembush.github.com/angular-cross-field-validation/",
            "title": "Angular Cross Field Validation",
            "date_published": "2017-12-19T11:30:36.000Z",
            "content_html": "<p>This past week I had my first need to do use cross field validation in Angular.  While the general mechanics are pretty trivial, my particular implementation ran into some issues that you might be interested in. <figure><img src=\"/uploads/2017/12/2017-12-19.jpg\" title=\"Angular Cross Field Validation\"> Photo by <a href=\"//visualhunt.com/author/525a6d\">MSVG</a> on <a href=\"//visualhunt.com/re/2a53de\">VisualHunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"The-Basics\"><a href=\"#The-Basics\" class=\"headerlink\" title=\"The Basics\"></a>The Basics</h2><p>As I said, the mechanics of implementing cross field validation in Angular is rather trivial.  It all hinges on the concept of a FieldGroup which is a key concept of <a href=\"/tags/reactive-forms/\">Reactive Forms</a>. What we need to do to implement cross field validation is to attach a validation function to the form instead of the field. </p>\n<p>I’m going to use the AppComponent to host the FormBuilder for simplicity:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">form</span>:<span class=\"title class_\">FormGroup</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder: FormBuilder</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">form</span>=formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">      <span class=\"comment\">// form field definitions here</span></span><br><span class=\"line\">    &#125;, &#123;</span><br><span class=\"line\">      <span class=\"attr\">validator</span>: <span class=\"title class_\">AppComponent</span>.<span class=\"property\">formGroupValidationFunction</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that <code>formBuilder.group()</code> takes a second parameter which takes a <code>validator</code> function or function array.  This parameter can also the <code>asyncValidator</code> key or the <code>state</code> key. </p>\n<p>The function we are pointing to takes the <code>FormGroup</code> as a parameter.  So, within the function, we can access the controls that are part of the <code>FormGroup</code>.  Once we have the fields, we can access the values of the fields and perform whatever comparisons we need, which is pretty trivial.  Then, if there is an error, we call setError() on the control(s) that are impacted.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"title function_\">formGroupValidationFunction</span>(<span class=\"attr\">formGroup</span>: <span class=\"title class_\">FormGroup</span>):<span class=\"built_in\">void</span> &#123;</span><br><span class=\"line\">  constfield1=formGroup.<span class=\"property\">controls</span>[<span class=\"string\">&#x27;field1&#x27;</span>];</span><br><span class=\"line\">  constfield2=formGroup.<span class=\"property\">controls</span>[<span class=\"string\">&#x27;field2&#x27;</span>];</span><br><span class=\"line\">  <span class=\"comment\">// compare field1 to field2</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(error) &#123;</span><br><span class=\"line\">    field1.<span class=\"title function_\">setError</span>(&#123;<span class=\"attr\">formGroupValidationFunction</span>:<span class=\"literal\">true</span>&#125;);</span><br><span class=\"line\">    field2.<span class=\"title function_\">setError</span>(&#123;<span class=\"attr\">formGroupValidationFunction</span>:<span class=\"literal\">true</span>&#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Dealing-with-Field-Validations\"><a href=\"#Dealing-with-Field-Validations\" class=\"headerlink\" title=\"Dealing with Field Validations\"></a>Dealing with Field Validations</h2><p>One of the problems I ran into was that my fields also had individual validations on them.  Specifically, the two fields were numbers that I was validating to make sure they were positive and only displayed two decimal places.  By the time I entered the validation for the FormGroup, that validation had already run.  I also wanted to clear any pre-existing errors from my form validation.</p>\n<p>It turns out that the way Angular determines if there is an error is if the forms errors object exist.  If it is null, it is assumed there aren’t any errors. </p>\n<p>Now, to clear the pre-existing errors, the safest thing to do is to first delete the error I was adding from each field, and then check to see if there are any other errors in the errors object.  If there aren’t any errors, we then call <code>setError(null)</code> to clear out the error object.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(field1.<span class=\"property\">errors</span>&amp;&amp;field1.<span class=\"property\">errors</span>.<span class=\"property\">formGroupValidationFunction</span>) &#123;</span><br><span class=\"line\">  deletefield1.<span class=\"property\">errors</span>.<span class=\"property\">formGroupValidationFunction</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(field1.<span class=\"property\">errors</span>).<span class=\"property\">length</span>===<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">    field1.<span class=\"title function_\">setErrors</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>When adding the <code>FormGroup</code> error, we only call <code>setError()</code> if the errors object is null.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span>(!field1.<span class=\"property\">errors</span>) &#123;</span><br><span class=\"line\">  field1.<span class=\"title function_\">setError</span>(&#123; <span class=\"attr\">formGroupValidationFunction</span>:<span class=\"literal\">true</span> &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>By doing this, we ensure that the field validation errors aren’t overwritten by the <code>FormGroup</code> validations.</p>\n<h2 id=\"Alternatives\"><a href=\"#Alternatives\" class=\"headerlink\" title=\"Alternatives\"></a>Alternatives</h2><p>The code I’ve shown works well enough if you only have a one-off validation.  But in my case, I needed to use the validation between multiple sets of fields.  To do this, I created a function that returns another function. </p>\n<p>The outer function takes two parameters.  Strings that are keys into the controls of the form group.  So, now instead of:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder:FormBuilder</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">form</span>=formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// form stuff here</span></span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">    <span class=\"attr\">validator</span>:formGroupValidationFunctionHere</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>I have:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">constructor</span>(<span class=\"params\">formBuilder:FormBuilder</span>) &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">form</span>=formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// form stuff here</span></span><br><span class=\"line\">  &#125;, &#123;</span><br><span class=\"line\">    <span class=\"attr\">validator</span>:<span class=\"title function_\">formGroupValidationFunction</span>(<span class=\"string\">&#x27;field1&#x27;</span>, <span class=\"string\">&#x27;field2&#x27;</span>)</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And my validation function looks something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"title function_\">formGroupValidationFunction</span>(<span class=\"attr\">f1</span>: <span class=\"built_in\">string</span>, <span class=\"attr\">f2</span>: <span class=\"built_in\">string</span>): <span class=\"title class_\">Function</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (<span class=\"attr\">formGroup</span>: <span class=\"title class_\">FormGroup</span>): <span class=\"function\"><span class=\"params\">void</span> =&gt;</span> &#123;</span><br><span class=\"line\">    constfield1=formGroup.<span class=\"property\">controls</span>[f1];</span><br><span class=\"line\">    constfield2=formGroup.<span class=\"property\">controls</span>[f2];</span><br><span class=\"line\">    <span class=\"comment\">// compare field1 to field2</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(error) &#123;</span><br><span class=\"line\">      field1.<span class=\"title function_\">setError</span>(&#123;<span class=\"attr\">formGroupValidationFunction</span>: <span class=\"literal\">true</span>&#125;);</span><br><span class=\"line\">      field2.<span class=\"title function_\">setError</span>(&#123;<span class=\"attr\">formGroupValidationFunction</span>: <span class=\"literal\">true</span>&#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice that my <code>setError()</code> uses the name of the function as the error key.  I just do this for clarity.  You CAN name it whatever you want.  I name it the same to be consistent with how the Angular validations work. </p>\n<p>Finally, I like to put my custom validations in a separate Static Class rather than including them in the component code.  I’ve only placed them in the component code here for illustrative purposes.</p>\n",
            "tags": [
                "angular",
                "formgroup",
                "validation"
            ]
        },
        {
            "id": "http://davembush.github.com/how-to-really-screw-up-an-angular-project/",
            "url": "http://davembush.github.com/how-to-really-screw-up-an-angular-project/",
            "title": "How to Really Screw Up an Angular Project",
            "date_published": "2017-12-12T11:30:38.000Z",
            "content_html": "<p>We all know about best practices.  But what does it take to really mess up a project?  Well, for starters, you do EVERYTHING wrong.  You don’t just ignore one or two best practices, you ignore them all.  By evaluating the mess you can get yourself into by ignoring best practices, I think we can all learn better why these recommendations exist. <figure><img src=\"/uploads/2017/12/2017-12-12.png\" title=\"How to Really Screw Up an Angular Project\"> Photo on <a href=\"//visualhunt.com/re/f81060\">VisualHunt</a></figure></p>\n<span id=\"more\"></span>\n\n<h2 id=\"Don’t-Use-the-CLI\"><a href=\"#Don’t-Use-the-CLI\" class=\"headerlink\" title=\"Don’t Use the CLI\"></a>Don’t Use the CLI</h2><p>I can grant a pass if you aren’t using the Angular CLI because you started your project before the CLI became viable.  But, by this point you should have already converted your project over to use the CLI or be making plans to move to the CLI.</p>\n<p>Why is this a problem? </p>\n<p>Because 99% of the developers you are going to find will expect that when you ask for an Angular developer, what you mean is that you are looking for someone who can write Angular code using the Angular CLI.  This brings with is a certain number of expectations about how your code is laid out.  Some of these are outlined below.  But just as a way of generalizing, if your code doesn’t look like it started as an Angular CLI project, you are going to slow down any future developers you hire.</p>\n<h2 id=\"Ignore-Naming-Conventions\"><a href=\"#Ignore-Naming-Conventions\" class=\"headerlink\" title=\"Ignore Naming Conventions\"></a>Ignore Naming Conventions</h2><p>Ignoring naming conventions may seem trivial, but naming conventions add clarity.  The reason we name component files as components is so we know they are all part of a component.  Reducer file names should be named <code>foo-bar.reducer.ts</code>.  Not naming the files in a way that is clear reduces the ability to maintain the code in a clear and efficient way. </p>\n<p>Maybe you’ve come up with your own naming conventions for your organization.  This is better.  But still this is not best.  This means that you probably won’t be able to use the CLI to scaffold out your code and any future developer is going to have to learn your way of writing Angular instead of the industry standard way of writing Angular. </p>\n<p>But the absolute worst thing you can do is to not have any standard or to mix standards.  This is confusing and just looks ugly.</p>\n<h2 id=\"Cluster-Code-by-Function-Instead-of-Feature\"><a href=\"#Cluster-Code-by-Function-Instead-of-Feature\" class=\"headerlink\" title=\"Cluster Code by Function Instead of Feature\"></a>Cluster Code by Function Instead of Feature</h2><p>The other thing you might be tempted to do is to cluster your code by function.  That is, you might want to group all of your components together.  And then all your services under another folder.  Maybe put your reducers under one folder and your effects under another. </p>\n<p>Trust me, this just adds fuel to the argument that “NgRX is confusing”.  Group all your similar NgRX code together and put all of your code together grouped by feature.  If you’ve named the files correctly, you won’t need the directories to keep things sorted out and you won’t be forced to use one module for your entire project.</p>\n<h2 id=\"Use-one-Module\"><a href=\"#Use-one-Module\" class=\"headerlink\" title=\"Use one Module\"></a>Use one Module</h2><p>Maybe you don’t know any better.  Or maybe it is because you’ve violated the rules above.  But no matter the reason, if you end up putting all your imports, providers, and declarations in your app module, you’ll soon see just how ugly this looks.  One for the whole application violates the single responsibility principle.  You want a module per feature at the very least.  I often create modules just to provide an additional level of granularity that further implements the single responsibility principle.</p>\n<h2 id=\"No-Lazy-Loading\"><a href=\"#No-Lazy-Loading\" class=\"headerlink\" title=\"No Lazy Loading\"></a>No Lazy Loading</h2><p>Yes, even if your application has only one route.  You want to lazy load your code so that a different bundle gets created for each route.  Done well, you can make changes to one route without impacting any of the others.  When you deploy the new code, your end user should only have to reload the route(s) that changed.  Without lazy loading, when you redeploy, they’ll have to reload an entirely new set of files.</p>\n<h2 id=\"Embed-Colors-and-Fonts-in-Component-CSS\"><a href=\"#Embed-Colors-and-Fonts-in-Component-CSS\" class=\"headerlink\" title=\"Embed Colors and Fonts in Component CSS\"></a>Embed Colors and Fonts in Component CSS</h2><p>You should have a theme file, or an application level CSS file that defines the fonts, and colors that should be used throughout your application.  The only CSS that should be included at the component level is CSS that is necessary to layout the html within the component.  That is, position information.  If you are putting color information in, or specifying a font size or font, you are probably doing it wrong. </p>\n<p>Why is this an issue?  </p>\n<p>Well, let’s suppose that someone decides that all of your warnings should be a different color.  If you can make that change in one CSS file, that is going to be a lot easier than looking through all the CSS in all of your components to make sure you found every place the color needs to be changed. </p>\n<p>Don’t repeat yourself makes just as much sense in CSS as anywhere else in your code.</p>\n<h2 id=\"Mix-Template-Files-and-Strings\"><a href=\"#Mix-Template-Files-and-Strings\" class=\"headerlink\" title=\"Mix Template Files and Strings\"></a>Mix Template Files and Strings</h2><p>As you should know by now, you can create the HTML templates and the CSS templates either by using strings in the TS file or by using separate HTML and CSS files.  You should use one style and use it consistently.  I’ve seen one project where they were using a mix of both and they had at least one file that was using a string for the HTML but still had the HTML file next to the TS and CSS file.  That’s just confusing.  Don’t do that!</p>\n<h2 id=\"Don’t-Remove-Dead-Code\"><a href=\"#Don’t-Remove-Dead-Code\" class=\"headerlink\" title=\"Don’t Remove Dead Code\"></a>Don’t Remove Dead Code</h2><p>As we work on code, we might create a variable, or use an import that no longer is needed.  The linter is really good about telling us what code is no longer needed.  Use it and keep you code cleaned up.</p>\n<h2 id=\"Don’t-Stay-Up-to-Date\"><a href=\"#Don’t-Stay-Up-to-Date\" class=\"headerlink\" title=\"Don’t Stay Up to Date\"></a>Don’t Stay Up to Date</h2><p>Angular is progressing at a pretty fast rate and the Angular CLI is as well.  I realize that it isn’t always possible to keep the version you are working on up to date with the latest tools.  But not keeping your tools up to date for several months at a time is also something you want to avoid.  The sooner you update, the easier the update will be. </p>\n<p>Will the update break something?  </p>\n<p>Yes, that is likely.  You should plan that into your work flow.  Otherwise, you’ll get to the point where it will take so long to update, you’ll never get approval to do it because it will take too long.</p>\n",
            "tags": [
                "angular",
                "best practices",
                "cli"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-ionic-and-angular-cli/",
            "url": "http://davembush.github.com/angular-ionic-and-angular-cli/",
            "title": "Angular Ionic and Angular CLI",
            "date_published": "2017-11-14T11:30:12.000Z",
            "content_html": "<p>As you might have noticed from last week’s post, I’ve shifted my focus from pure Angular to learning Angular Ionic.  And while last week’s post focused more on just <a href=\"/angular-ionic-putty-ssh-authorized_keys-format\">getting Ionic setup on a Windows environment</a>, this post will focus more on integrating Ionic and Angular CLI to work together. </p>\n<p>If you are familiar with Ionic, you should already know that it provides its own CLI that allows you to scaffold out a new application using a basic template.  This CLI is also used to help register the project with the Ionic Dashboard and scaffold out a limited number of file types if you use Ionic 3.  However, there are several problems I have with using the Ionic CLI.  First, and probably most important to me, is there is no test scaffolding!  Second, it neither follows the standard naming convention for files nor does it comply with the Angular Style Guide when it comes to directory structure. </p>\n<p>My first attempt at correcting the problem was to try to add Ionic to an existing Angular CLI project.  I almost had that working, but I got stuck trying to get the SCSS implementation working.  I finally gave up once I realized that Ionic seems to load files on demand, including SCSS files and templates.  I might come back to this once I’ve gained more experience with Ionic and have a better idea of how it works under the hood. </p>\n<p>Then, my second thought was to just add the Angular CLI to an existing Ionic CLI project.  It turns out this was much easier to get working.  This allows me to use the standard <code>ng</code> commands to scaffold out my components, services, interfaces, etc… and because I’m using the Angular CLI scaffolding, the tests also get scaffold out for me. <figure><img src=\"/uploads/2017/11/2017-11-14.jpg\" title=\"Angular Ionic and Angular CLI\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/internetarchivebookimages/14762635481/\">Internet Archive Book Images</a> via <a href=\"//visualhunt.com/re/09daa4\">VisualHunt.com</a> &#x2F; <a href=\"//flickr.com/commons/usage/\"> No known copyright restrictions</a></figcaption></figure></p>\n<span id=\"more\"></span>  \n\n<p>For the purposes of this post, I’m going to assume you’ve already created a project using the Ionic CLI.  What follows are the steps you need to take to add in the Angular CLI.</p>\n<h2 id=\"Add-Angular-CLI\"><a href=\"#Add-Angular-CLI\" class=\"headerlink\" title=\"Add Angular CLI\"></a>Add Angular CLI</h2><p>All of the additions to the package.json file are in devDependencies.  The version numbers I’ve included are for the version at the time of this writing. You’ll want to modify for newer versions as they are released. First, of course, add the angular cli</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;@angular/cli&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.4.9&quot;</span> </span><br></pre></td></tr></table></figure>\n\n<p>This will give you the ability to use the <code>ng</code> commands to scaffold out files.  To allow the tests to run, you’ll also want to add the following:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;@types/jasmine&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~2.5.53&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;@types/jasminewd2&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~2.0.2&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;@types/node&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~6.0.60&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;jasmine-core&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~2.6.2&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;jasmine-spec-reporter&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~4.1.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;karma&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~1.7.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;karma-chrome-launcher&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~2.1.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;karma-cli&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~1.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;karma-coverage-istanbul-reporter&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^1.2.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;karma-jasmine&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~1.1.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;karma-jasmine-html-reporter&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^0.2.2&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;protractor&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~5.1.2&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;ts-node&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~3.2.0&quot;</span><span class=\"punctuation\">,</span></span><br></pre></td></tr></table></figure>\n\n<p>I also use tslint quite extensively in my projects, so I also add in the following:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;codelyzer&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~3.2.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;tslint&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;~5.7.0&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;tslint-immutable&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;^4.4.0&quot;</span><span class=\"punctuation\">,</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"angular-cli-json\"><a href=\"#angular-cli-json\" class=\"headerlink\" title=\".angular-cli.json\"></a>.angular-cli.json</h2><p>The main file that makes the Angular CLI recognize the project as an Angular CLI project is the <code>.angular-cli.json</code> file.  The easiest thing to do is to take an existing file from another project and copy it into your Ionic project.  This file belongs in the root of your project. </p>\n<p>Once you’ve done that, there is one small change you need to make.  The <code>main.ts</code> file that is the entry point of the application lives under the <code>app</code> directory in an Ionic project rather than directly under <code>src</code> like it does with an Angular CLI project.  It would be tempting to change the location of the file, but the Ionic build process is looking for it under the <code>app</code> directory.  An easier fix is to change the location in our <code>.angular-cli.json</code> file so that our tests can find it.  It is the only place that needs to know of the new location. Change .angular-cli.json so main points to the right location:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;$schema&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./node_modules/@angular/cli/lib/config/schema.json&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;project&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;ionic-with-angular-cli&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;apps&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;root&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;src&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;outDir&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;dist&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;assets&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">          <span class=\"string\">&quot;assets&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">          <span class=\"string\">&quot;favicon.ico&quot;</span></span><br><span class=\"line\">      <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;index&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;index.html&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      **<span class=\"attr\">&quot;main&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;app/main.ts&quot;</span><span class=\"punctuation\">,</span>**</span><br><span class=\"line\">      <span class=\"attr\">&quot;polyfills&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;polyfills.ts&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;test&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;test.ts&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"> ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"karma-conf-js\"><a href=\"#karma-conf-js\" class=\"headerlink\" title=\"karma.conf.js\"></a>karma.conf.js</h2><p>To run your tests, you’ll need a <code>karma.conf.js</code> file in your root directory.  Again, the easiest thing to do is to copy this file over from a project you created with the Angular CLI.</p>\n<h2 id=\"tsconfig-json\"><a href=\"#tsconfig-json\" class=\"headerlink\" title=\"tsconfig.json\"></a>tsconfig.json</h2><p>You should already have a <code>tsconfig.json</code> file in your project root directory.  If you open it, you’ll see it has an exclude section that is excluding <code>node_modules</code>.  You’ll need to tell it to exclude <code>test.ts</code> and <code>*.spec.ts</code> files so it doesn’t pick up the test files during a normal compile cycle.</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;exclude&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">  <span class=\"string\">&quot;node_modules&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"string\">&quot;test.ts&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"string\">&quot;**/*.spec.ts&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"polyfills-ts\"><a href=\"#polyfills-ts\" class=\"headerlink\" title=\"polyfills.ts\"></a>polyfills.ts</h2><p>The tests use the <code>polyfills.ts</code> file, so you’ll need to add one that was originally created using the Angular CLI.  This belongs in your <code>src</code> directory.</p>\n<h2 id=\"test-ts\"><a href=\"#test-ts\" class=\"headerlink\" title=\"test.ts\"></a>test.ts</h2><p>Copy a <code>test.ts</code> file into your <code>src</code> directory from a project that you created with the <code>Angular CLI</code>.  If you don’t put this file in, you won’t be able to run any tests.</p>\n<h2 id=\"tsconfig-spec-json\"><a href=\"#tsconfig-spec-json\" class=\"headerlink\" title=\"tsconfig.spec.json\"></a>tsconfig.spec.json</h2><p>The tests use <code>tsconfig.spec.json</code> located in the <code>src</code> directory.  The problem is, a standard <code>tsconfig.spec.json</code> file inherits from the <code>tsconfig.json</code> file we just modified above which doesn’t look at all like the <code>tsconfig.json</code> file in an Angular CLI project.  I found the easiest thing to do was to create a new copy of <code>tsconfig.spec.json</code> that is a merge of the two files in an Angular CLI project.  This worked at the time of this writing, if you run into trouble, you may need to merge the two files you started with on your own.  My result looks like this:</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;compileOnSave&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">false</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;compilerOptions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;outDir&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;../out-tsc/spec&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;sourceMap&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">true</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;declaration&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">false</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;moduleResolution&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;node&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;emitDecoratorMetadata&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">true</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;experimentalDecorators&quot;</span><span class=\"punctuation\">:</span> <span class=\"keyword\">true</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;target&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;es5&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;typeRoots&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"string\">&quot;node_modules/@types&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;lib&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"string\">&quot;es2017&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;dom&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;baseUrl&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;./&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;module&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;commonjs&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;types&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"string\">&quot;jasmine&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      <span class=\"string\">&quot;node&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;files&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;test.ts&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;include&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;**/*.spec.ts&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"string\">&quot;**/*.d.ts&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"typings-d-ts\"><a href=\"#typings-d-ts\" class=\"headerlink\" title=\"typings.d.ts\"></a>typings.d.ts</h2><p>I’m not sure this file was needed, but it was another file I found in an Angular CLI project that wasn’t in my Ionic CLI project, so I added it.  It goes in your <code>src</code> directory and is just a copy of the file that is in your Angular CLI project.</p>\n<h2 id=\"pages\"><a href=\"#pages\" class=\"headerlink\" title=\"pages\"></a>pages</h2><p>You’ll notice that your <code>pages</code> directory is at the same level as your <code>src</code> directory which doesn’t comply with the Angular CLI.  I moved mine so that it is under the <code>src</code> directory just to keep things consistent.  You’ll need to fix up imports once you move it of course.</p>\n<h2 id=\"Regenerate-Pages\"><a href=\"#Regenerate-Pages\" class=\"headerlink\" title=\"Regenerate Pages\"></a>Regenerate Pages</h2><p>Because the pages that got generated don’t conform to the style guide and don’t have any tests, I just regenerated mine and copied the relevant code into the newly generated files.</p>\n<h2 id=\"Tests\"><a href=\"#Tests\" class=\"headerlink\" title=\"Tests\"></a>Tests</h2><p>At this point, you should have a project that looks a lot more like an Angular CLI project.  You’ll still use the Ionic command to do your regular build and development cycle and the ng commands for testing and generating new files.  Running tests works the same as you should already be used to from using Angular.  The one thing you will notice is that you’ll see a warning in your test: </p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Critical dependency: the request of a dependency is an expression</span><br></pre></td></tr></table></figure>\n\n<p>This is a known “error” that neither the  Angular CLI group or the Ionic group seem interested in addressing. </p>\n<p>At this point, I haven’t tried any E2E tests using this setup so I don’t know if there are any additional tweaks that need to be made. </p>\n<p>You can find the code for this at this branch of a project I’m working on. <a href=\"//github.com/DaveMBush/ionic-crud/tree/Add-Angular-CLI\">https://github.com/DaveMBush/ionic-crud/tree/Add-Angular-CLI</a></p>\n",
            "tags": [
                "angular",
                "ionic",
                "angular-cli"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-ionic-putty-ssh-and-authorized-keys-format/",
            "url": "http://davembush.github.com/angular-ionic-putty-ssh-and-authorized-keys-format/",
            "title": "Angular IONIC, Putty SSH, and authorized_keys Format",
            "date_published": "2017-11-07T16:29:21.000Z",
            "content_html": "<p>I started playing with IONIC last week.  Since I do all my development on a Windows computer, this has already lead to a particular Windows based challenge that I was able to track down and deduce the solution for.  But I was unable to find a solution that specifically addressed using IONIC, putty SSH, and authorized_keys Format, which is what someone is likely to search for when they see this issue. <figure><img src=\"/uploads/2017/10/2017-11-07.jpg\" title=\"Angular IONIC, Putty SSH, and authorized_keys\"> Photo via <a href=\"//visualhunt.com/re/64a968\">VisualHunt</a></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Connect-to-the-dashboard\"><a href=\"#Connect-to-the-dashboard\" class=\"headerlink\" title=\"Connect to the dashboard?\"></a>Connect to the dashboard?</h2><p>When you setup an IONIC project, everything goes pretty much as planned until you get to the question “Do you want to connect to the dashboard?”  I’m going to assume you’ve answered that question in the affirmative and that you’ve already created an IONIC account and successfully logged in or you wouldn’t be here. </p>\n<p>The next thing that is likely to happen is that you’ll try to have it generate an SSH key for you.  But, since you don’t have OpenSSL installed, it failed.  The next thing you probably did was to search for the Windows install of OpenSSL only to find that it hasn’t been maintained in quite a while and that the recommended way of creating a public&#x2F;private key pair is to use Putty.  Which you did. </p>\n<p>Now, what brought you here is that you have a public key in a file that you are trying to upload to IONIC.  The error you are continuing to see is “<em>filename</em> does not appear to be a valid SSH public key. (Not in authorized_keys file format.)</p>\n<h2 id=\"No-Public-Key\"><a href=\"#No-Public-Key\" class=\"headerlink\" title=\"No Public Key?\"></a>No Public Key?</h2><p>OK.  Maybe you got to this site and you don’t have a public&#x2F;private key pair yet.  You don’t even know what putty is.  You can find some good instructions about installing and <a href=\"//www.chiark.greenend.org.uk/~sgtatham/putty/docs.html\">using putty here</a>.</p>\n<p>You will be most interested in the section on using PuttyGen to create a public&#x2F;private key pair (you want to use RSA, the default).</p>\n<h2 id=\"Putty-to-authorized-keys\"><a href=\"#Putty-to-authorized-keys\" class=\"headerlink\" title=\"Putty to authorized_keys\"></a>Putty to authorized_keys</h2><p>And the question you have now is, “How do I convert my putty SSH public key into “authorized_keys format?”  Whatever that is. </p>\n<p>Well you are in luck because, I can tell you exactly what you need to do. </p>\n<p>First, open that public key text file you have in a text editor.  You’ll see it is in the format of: </p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---- BEGIN SSH2 PUBLIC KEY ----</span><br><span class=\"line\">Comment: &quot;rsa-key-20171026&quot;</span><br><span class=\"line\">AAAAB3NzaC1yc2EAAAABJQAAAQEAicxYxlgFjQDMtkuuCY3GsnkdWEy38NSgi7N8</span><br><span class=\"line\">/SBj1ohas2GU/0bY2H6Inpg6lQ6oYmvaIy5rQZ8+pcOPQNLNo0EyWbWhmBfWI+b5</span><br><span class=\"line\">XHg5F6eIhaTjKVViJG3tDe3V4boMvgE18Rzof8ZJSa7cH0kqL32SPqnQdgtpDNc5</span><br><span class=\"line\">qjBHN+mQ5fMcxMM4YaViGtq8j6M7obt7oJrnVQWdPWQQYuo6TSm4LCjQ4/q77vqF</span><br><span class=\"line\">L59IFFd6nUnEltpkrh8RXKu6By1+G4eN66AdpZ/h9Z41qwN/oJ2kOf0qqT1t6Wa6</span><br><span class=\"line\">8RcgWxSIgMzE16imwB84o8p9DQtnEb7BVK0UXzt+Wp2ToC3arw==</span><br><span class=\"line\">---- END SSH2 PUBLIC KEY ----</span><br></pre></td></tr></table></figure>\n\n<p>The first thing you want to do is to delete the first two lines and the last line.  Once that is done, remove the line feeds so that the remaining RSA key is all on one line. </p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AAAAB3NzaC1yc2EA...t+Wp2ToC3arw==</span><br></pre></td></tr></table></figure>\n\n<p>Now, prefix the line with “ssh-rsa “.  Make sure there is a space after “ssh-rsa” and before the body of the key. </p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-rsa AAAAB3NzaC1yc2EA...t+Wp2ToC3arw==</span><br></pre></td></tr></table></figure>\n\n<p>Officially, this puts the key in “authorized_keys file format” but to get IONIC to accept it, you also need to put the email you used when you signed up for IONIC dashboard at the end of the key.  This mean you’ll need to add a space after the double equals that indicates the end of the key, and then your email address goes immediately after that. </p>\n<p>Save the file.  </p>\n<p>Unless you like living dangerously, you should save it to another file.  </p>\n<p>Now upload the file to ionic using: </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ionic ssh add</span><br></pre></td></tr></table></figure>\n\n<p>This command will prompt you for the file name, as before, but this time you’ll give it the file you just saved, and it should work.  The only reason I can think of why it might not is if you deleted too many characters when you were removing the line feeds.</p>\n<h2 id=\"IONIC-Private-Key\"><a href=\"#IONIC-Private-Key\" class=\"headerlink\" title=\"IONIC Private Key\"></a>IONIC Private Key</h2><p>For some reason, IONIC only understands OpenSSL for both sides.  I wasted nearly a day trying to get PAgent working.  Don’t waste your time. </p>\n<p>Back in PuttyGen, there is a Conversions menu option.  Under that, what you want to select is the option “Export OpenSSH Key…”  Give it a filename etc. </p>\n<p>Now, back in the terminal window for your IONIC project, finish the setup as they’ve directed on their site, but just before you run “git push ionic master” run </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ionic ssh use path_to_the_filename_you_just_exported.</span><br></pre></td></tr></table></figure>\n\n<p>Once you’ve done this, go to <code>c:\\users\\[username]\\.ssh</code> and look for a file named “<code>config</code>“.  Open the file in an editor that understands files with no carriage returns and make sure the line that starts with “IdentityFile” has quotes around the path to the file if the path has a space in it.  On my computer it doesn’t, but I’ve seen reports from others that this has caused them hours of trouble. </p>\n<p>With all of that configured, now you can run </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git push ionic master</span><br></pre></td></tr></table></figure>\n\n<p>If your private key has a password, it will prompt for the password and you are off to the races. </p>\n",
            "tags": [
                "angular",
                "ionic",
                "putty",
                "ssh"
            ]
        },
        {
            "id": "http://davembush.github.com/what-i-learned-using-angular-material/",
            "url": "http://davembush.github.com/what-i-learned-using-angular-material/",
            "title": "What I Learned Using Angular Material",
            "date_published": "2017-10-31T10:30:06.000Z",
            "content_html": "<p>This past week I took Angular Material for a spin.  In the process, I learned a few things you might find helpful.  Some may be helpful even if you aren’t interested in using Angular Material for your projects. <figure><img src=\"/uploads/2017/10/2017-10-31.png\" title=\"What I Learned Using Angular Material\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/30478819@N08/36098571263/\">wuestenigel</a> via <a href=\"//visualhunt.com/re/3c147a\">VisualHunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Choose-Wisely\"><a href=\"#Choose-Wisely\" class=\"headerlink\" title=\"Choose Wisely\"></a>Choose Wisely</h2><p>Up until recently, I’ve been reluctant to try Angular Material for two basic reasons.  First, it didn’t seem quite ready for prime time.  I found out that it now has all of the components I would need for most of the applications I would want to develop.  Second, using Angular Material is a commitment.  Instead of writing primarily HTML, you write primarily angular material tags.  I thought this was a problem.  That I wouldn’t have the flexibility to switch between Angular Material and some other CSS framework.  But, as it turns out.  Angular Material doesn’t really lock me in any more than any other CSS framework or component library.  Which leads to the first lesson learned.  Choose your CSS frameworks and component library wisely.  If you decide to make a change mid-course, it is likely to suck up a lot of time from your project.  I would recommend doing some proof of concepts prior to committing to any component library or CSS framework.</p>\n<h2 id=\"Less-Filling\"><a href=\"#Less-Filling\" class=\"headerlink\" title=\"Less Filling\"></a>Less Filling</h2><p>Because Angular Material is both a CSS framework and a component library, it turns out that writing templates using Angular Material is significantly terser than say, Bootstrap.  I don’t mean to imply that it produces less HTML.  Just that writing the templates tends to be a bit cleaner overall.</p>\n<h2 id=\"import\"><a href=\"#import\" class=\"headerlink\" title=\"@import\"></a>@import</h2><p>I’ve written before about <a href=\"https://medium.com/@davembush/adding-css-and-javascript-to-an-angular-cli-project-2b843a8283f3\">how to include CSS in your Angular project</a>, but I’ve learned a new trick while implementing Angular Material. </p>\n<p>This might be a relative new thing with the Angular CLI, but apparently, you can <code>@import</code> local and external CSS in your styles.css file.  When I evaluated the code that gets built, I found that the build process knows to keep the external code external yet bundles the internal code with the project.  This is something you could use regardless of what CSS framework or component library you are using.</p>\n<h2 id=\"Layout\"><a href=\"#Layout\" class=\"headerlink\" title=\"Layout\"></a>Layout</h2><p>As I suspected, a lot of layout expects you to use Flex CSS.  Since I already had decided to use Flex-Layout to manage my layout with Bootstrap, this was not a big surprise.  The Flex-Layout project started its life as part of the Angular JS Material project and split out as a separate project when both moved to support Angular.  At times, figuring out where to use what directive may require you to use Developer Tools.  But I didn’t find this to be any more of a deterrent than using CSS in any other platform.  Just keep in mind that some of the Flex CSS is already defined in the Material components.</p>\n<h2 id=\"Creating-Components-from-Injectables\"><a href=\"#Creating-Components-from-Injectables\" class=\"headerlink\" title=\"Creating Components from @Injectables\"></a>Creating Components from @Injectables</h2><p>While creating my demo project, there were two places where I needed to create “snack bars” or dialogs.  In Angular Material, the way you accomplish this is by calling a method on an @Injectable.  aka, a Service.  This is interesting to me and I’m going to have to dig deeper to find out exactly how this works.</p>\n<h2 id=\"Testing\"><a href=\"#Testing\" class=\"headerlink\" title=\"Testing\"></a>Testing</h2><p>The first time you write unit tests, you’ll get a warning that says, “Could not find Angular Material core theme…”.  To remove this error, you’ll need to open karma.conf.js and add a “files:” section right under the “plugins:” section.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">files</span>: [&#123; </span><br><span class=\"line\">  <span class=\"attr\">pattern</span>: <span class=\"string\">&#x27;./node_modules/@angular/material/prebuilt-themes/indigo-pink.css&#x27;</span>, </span><br><span class=\"line\">  <span class=\"attr\">included</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">  <span class=\"attr\">watched</span>: <span class=\"literal\">true</span> </span><br><span class=\"line\">&#125;],</span><br></pre></td></tr></table></figure>\n\n<p>You can add whatever pre-built theme you’d like.  I’ve added indigo-pink here.</p>\n<h2 id=\"Common-declare-x2F-import-x2F-export\"><a href=\"#Common-declare-x2F-import-x2F-export\" class=\"headerlink\" title=\"Common declare&#x2F;import&#x2F;export\"></a>Common declare&#x2F;import&#x2F;export</h2><p>Strictly speaking, this isn’t Angular Material specific.  But it was because of Angular Material that I discovered this trick.  Again, because it isn’t Angular Material specific, you can use this in any of your Angular code that it makes sense. </p>\n<p>Angular Material requires you to import each of the component modules individually.  This allows tree shaking to be more effective.  Rather than put this code in <code>app.module.ts</code>, I created a <code>material-design.module.ts</code> file and imported it into my <code>app.module.ts</code>. </p>\n<p>Now, if you are familiar with how imports work, you’ll already know that the components that are part of a module you import are only available to the parent module’s components or below.  But we want the component to be available to any module that imports <code>material-design.module.ts</code>.  To do that, we need to export the same list of modules we imported. </p>\n<p>That sounded like too much repeating myself.  In an effort to make my code DRYer, I created a read only array with all my Material modules in it and then used the spread operator to include those in my imports and exports statement.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">materialDesignComponents</span>: <span class=\"title class_\">ReadonlyArray</span>&lt;<span class=\"title class_\">Type</span>&lt;<span class=\"built_in\">any</span>&gt;&gt; = [</span><br><span class=\"line\">  <span class=\"title class_\">MatSidenavModule</span>,</span><br><span class=\"line\">  <span class=\"title class_\">MatToolbarModule</span>,</span><br><span class=\"line\">  <span class=\"title class_\">MatListModule</span>,</span><br><span class=\"line\">...</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">CommonModule</span>,</span><br><span class=\"line\">    ...materialDesignComponents</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">exports</span>: [</span><br><span class=\"line\">    ...materialDesignComponents</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: []</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MaterialDesignModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>This saved me a lot of time, not just in typing, but in tracking down bugs because I simply forgot to include the modules in both places.</p>\n<h2 id=\"Sample-Project\"><a href=\"#Sample-Project\" class=\"headerlink\" title=\"Sample Project\"></a>Sample Project</h2><p>If you are interested, you can find <a href=\"//github.com/DaveMBush/angular-material-demo\">my sample project on GitHub</a>.</p>\n",
            "tags": [
                "angular",
                "angular material"
            ]
        },
        {
            "id": "http://davembush.github.com/implementing-ngrx-4/",
            "url": "http://davembush.github.com/implementing-ngrx-4/",
            "title": "Implementing NgRX 4+",
            "date_published": "2017-10-24T10:30:46.000Z",
            "content_html": "<p>There seems to be a lot of confusion about Implement NgRX 4 and above in an Angular application.  Some of it I’ve contributed to because NgRX 2 isn’t quite the same as NgRX 4 and as I’ve transitioned, I’ve learned better ways.  In other words, I was wrong and I’m correcting my mistake!  Below is the correct, NgRX approved way, of implementing NgRX 4. </p>\n<p>If you are looking for information about how to convert to NgRX 4 from NgRX 2, you can visit my previous article, <a href=\"/how-to-upgrade-ngrx-to-4-x/\">How to Upgrade to NgRX 4</a>. </p>\n<p>Before we get started, make sure you have TypeScript 2.4.x or above installed in your local project.  The CLI may complain, depending on what version of it you are using.  But, NgRX 4 requires us to use TypeScript 2.4.x. You should also have RxJS 5.4.x or above installed. </p>\n<p>You will also need to install @ngrx.  You can do this using the following NPM command: </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save @ngrx/store @ngrx/effects</span><br></pre></td></tr></table></figure>\n\n<p>And finally, I’ve found that I need to use the –aot switch both when I’m using production and development builds, so you’ll want to add that to your scripts in your <code>package.json</code> file. <figure><img src=\"/uploads/2017/10/2017-10-24.jpg\" title=\"Implementing NgRX 4\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/cfaobam/12119410373/\">cfaobam</a> via <a href=\"//visualhunt.com/re/300eff\">VisualHunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h3 id=\"Actions\"><a href=\"#Actions\" class=\"headerlink\" title=\"Actions\"></a>Actions</h3><p>An Action is an object that contains a type variable and optionally, a payload.  Depending on how you code your action, the payload may or may not have “payload” as the variable name.  In NgRX version 2, payload was an optional variable.  To improve type checking, payload was removed from the Action interface. </p>\n<p>The official documentation for NgRX version 4 encourages us to create a class for each action we want to dispatch. </p>\n<p>Assuming we have a Wait component we want to display when a counter is incremented and that should be removed when the counter returns to zero, you might want a Start wait action and an End wait action.  So, you would create a wait.action.ts file that has two classes in it.  A Start action and an End action. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">Action</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>; </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">START</span> = <span class=\"string\">&#x27;Wait.Start&#x27;</span>; </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Start</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123; </span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">START</span>; </span><br><span class=\"line\">&#125; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">END</span> = <span class=\"string\">&#x27;Wait.End&#x27;</span>; </span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">End</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123; </span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">END</span>; </span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n\n<p>While this violates the “one class per file” rule, it actually provides us the ability to group our Actions together in one file, as you will see soon. </p>\n<p>To use these actions in our code, we would import them as a bundle: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> <span class=\"title class_\">Wait</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.actions&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>This particular way of importing a packages groups all of the exported items under the variable named Wait.  Which allows us to dispatch the action using the store we’ve injected into our code using:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">Wait</span>.<span class=\"title class_\">Start</span>());</span><br></pre></td></tr></table></figure>\n\n<p>Start is an exported class from <code>wait.actions</code> that we’ve grouped under <code>Wait</code>. </p>\n<p>What makes this method of creating actions useful is that when we need to pass additional data along with our action, we can do that simply by adding parameters to our constructor.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">ADD</span> = <span class=\"string\">&#x27;Wait.Add&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Add</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">ADD</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> payload: <span class=\"built_in\">number</span></span>)&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>We don’t even have to call the payload, “payload.”  How about calling it “value.” </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">ADD</span> = <span class=\"string\">&#x27;Wait.Add&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Add</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"variable constant_\">ADD</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> value: <span class=\"built_in\">number</span></span>)&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And if you need more than one payload item, you can pass in multiple parameters.</p>\n<h3 id=\"Improved-Actions\"><a href=\"#Improved-Actions\" class=\"headerlink\" title=\"Improved Actions\"></a>Improved Actions</h3><p>We can improve our actions even further by using <code>enums</code> instead of <code>const</code>.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">Types</span> &#123;</span><br><span class=\"line\">  <span class=\"variable constant_\">START</span> = <span class=\"string\">&#x27;Wait.Start&#x27;</span>,</span><br><span class=\"line\">  <span class=\"variable constant_\">END</span> = <span class=\"string\">&#x27;Wait.End&#x27;</span>,</span><br><span class=\"line\">  <span class=\"variable constant_\">ADD</span> = <span class=\"string\">&#x27;Wait.Add&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And then we can use the types in our Action classes like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"variable constant_\">ADD</span> = <span class=\"string\">&#x27;Wait.Add&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Add</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Action</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">readonly</span> <span class=\"keyword\">type</span> = <span class=\"title class_\">Types</span>.<span class=\"property\">ADD</span>;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">public</span> value: <span class=\"built_in\">number</span></span>)&#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>What this does for us that <code>const</code> doesn’t is that it when we use our case statements in the reducer, it will save us having to cast everything because TypeScript will know what type it should be because of the <code>enum</code> that was assigned to the type field.</p>\n<h3 id=\"Reducers\"><a href=\"#Reducers\" class=\"headerlink\" title=\"Reducers\"></a>Reducers</h3><p>Reducers are functions that allow us to change the state of our entity within our application Store.  Reducers respond to the actions that have been dispatched and return a new object based on the changes requested. </p>\n<p>To continue on with our Wait example, <code>wait.reducer.ts</code> might look like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">ActionReducer</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> <span class=\"title class_\">Wait</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.actions&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// This could (and probably should) go in wait.actions.ts</span></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">type</span> <span class=\"title class_\">Action</span> =</span><br><span class=\"line\">    <span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span> | <span class=\"title class_\">Wait</span>.<span class=\"property\">End</span> | <span class=\"title class_\">Wait</span>.<span class=\"property\">Start</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">WaitReducer</span>(<span class=\"params\"></span></span><br><span class=\"line\"><span class=\"params\">  state = <span class=\"number\">0</span>, action: Action</span>): <span class=\"built_in\">number</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">switch</span>(action.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"title class_\">Wait</span>.<span class=\"property\">Types</span>.<span class=\"property\">START</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state + <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"title class_\">Wait</span>.<span class=\"property\">Types</span>.<span class=\"property\">END</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state - <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> <span class=\"title class_\">Wait</span>.<span class=\"property\">Types</span>.<span class=\"property\">ADD</span>:</span><br><span class=\"line\">      <span class=\"comment\">// TypeScript knows that our action have a value field here</span></span><br><span class=\"line\">      <span class=\"keyword\">return</span> state + action.<span class=\"property\">value</span>;</span><br><span class=\"line\">    <span class=\"attr\">default</span>:</span><br><span class=\"line\">      <span class=\"keyword\">return</span> state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>Notice that we have a <code>default</code> in our switch statement.  Don’t forget to add this.  It isn’t an accident.  You see, when we register our Reducers and Effects with the store and then subsequently dispatch actions to them, all the reducers and effects get called.  In the case of reducers, if you don’t return something for each one of them, you’ll end up with a store that doesn’t know what kind of state it is in.  So, always return the current state as your default. </p>\n<p>The one thing that may not be obvious here is that the Reducer is a function.  Not a class.  This means you can’t inject other classes into it.  This is one of the reasons that the file is named <code>wait.reducer.ts</code> and not <code>wait.reducer**s**.ts</code>. But, Effects are different.</p>\n<h3 id=\"Effects\"><a href=\"#Effects\" class=\"headerlink\" title=\"Effects\"></a>Effects</h3><p>Effects are classes.  Each Effect within the Effects class is a member variable.  This means, we name our Effects file for Wait, <code>wait.effects.ts</code>. </p>\n<p>Now, remember I said that Effects were for things that caused side effects?  You may wonder, why kind of side effect does our Wait stuff need? </p>\n<p>Under normal circumstances, not any.  However, you can get into a situation in development mode where one of the safe guards Angular provides for you detects that you’ve changed the state of wait multiple times in a change detection loop.  Angular expects changes to be static. </p>\n<p>One way we can deal with this is to delay incrementing and decrementing to another change detection loop using setTimeout() indirectly. </p>\n<p>To do this, we are going to rip out the START and END case statements from our Reducer and add them into our Effects class. And then in <code>wait.effects.ts</code>:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Observable</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;rxjs/Rx&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Injectable</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">Actions</span>, <span class=\"title class_\">Effect</span> &#125; <span class=\"keyword\">from</span><span class=\"string\">``</span><span class=\"string\">&#x27;@ngrx/effects&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> <span class=\"title class_\">Wait</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.actions&#x27;</span>;</span><br><span class=\"line\"><span class=\"meta\">@Injectable</span>()</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WaitEffects</span> &#123;</span><br><span class=\"line\">  <span class=\"meta\">@Effect</span>()</span><br><span class=\"line\">    <span class=\"attr\">start$</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span>&gt; =</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">actions$</span></span><br><span class=\"line\">      .<span class=\"title function_\">ofType</span>(<span class=\"title class_\">Wait</span>.<span class=\"property\">START</span>)</span><br><span class=\"line\">      .<span class=\"title function_\">switchMap</span>(<span class=\"function\">() =&gt;</span></span><br><span class=\"line\">        <span class=\"title class_\">Observable</span>.<span class=\"title function_\">timer</span>(<span class=\"number\">1</span>).<span class=\"title function_\">take</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">      ).<span class=\"title function_\">map</span>((): <span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span> =&gt;</span><br><span class=\"line\">        (<span class=\"keyword\">new</span> <span class=\"title class_\">Wait</span>.<span class=\"title class_\">Add</span>(<span class=\"number\">1</span>)));</span><br><span class=\"line\">        </span><br><span class=\"line\">  <span class=\"meta\">@Effect</span>()</span><br><span class=\"line\">    <span class=\"attr\">end$</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span>&gt; =</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">actions$</span></span><br><span class=\"line\">      .<span class=\"title function_\">ofType</span>(<span class=\"title class_\">Wait</span>.<span class=\"property\">END</span>)</span><br><span class=\"line\">        .<span class=\"title function_\">switchMap</span>(<span class=\"function\">(<span class=\"params\">action: Wait.End</span>) =&gt;</span></span><br><span class=\"line\">          <span class=\"title class_\">Observable</span>.<span class=\"title function_\">timer</span>(<span class=\"number\">1</span>).<span class=\"title function_\">take</span>(<span class=\"number\">1</span>)</span><br><span class=\"line\">        ).<span class=\"title function_\">map</span>((): <span class=\"title class_\">Wait</span>.<span class=\"property\">Add</span> =&gt;</span><br><span class=\"line\">          (<span class=\"keyword\">new</span> <span class=\"title class_\">Wait</span>.<span class=\"title class_\">Add</span>(-<span class=\"number\">1</span>)));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"keyword\">private</span> actions$: Actions</span>)&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You can name the member variables whatever you want.  They never get used.  <code>ofType()</code> is a filter that makes the observable stuff only fire for that particular type. </p>\n<p>The magic happens in the <code>Observable.timer(1).take(1)</code>.  Here we wait for one millisecond, take the first item out of the stream and immediately close the observable.  Once that completes, the <code>map()</code> returns a new action. </p>\n<p>Every Effect must return an action or you must tell the Effect that it won’t return an action.  Notice that we don’t dispatch the action.  That is done by NgRX for us.  We just return the action. </p>\n<p>To tell an Effect that no action will be returned, pass <code>&#123;dispatch: false&#125;</code> into <code>@Effect()</code>. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Effect</span>(&#123;<span class=\"attr\">dispatch</span>: <span class=\"literal\">false</span>&#125;) …</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Returning-Multiple-Actions-from-Effects\"><a href=\"#Returning-Multiple-Actions-from-Effects\" class=\"headerlink\" title=\"Returning Multiple Actions from Effects\"></a>Returning Multiple Actions from Effects</h3><p>At the other end of possibilities, you may need to return multiple Actions from an Effect.  One way to do this is by using mergeMap().</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.<span class=\"title function_\">mergeMap</span>(<span class=\"function\">(<span class=\"params\"><span class=\"comment\">/* previous value here */</span></span>) =&gt;</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">ActionGroup</span>.<span class=\"title class_\">Action1</span>(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> <span class=\"title class_\">ActionGroup</span>.<span class=\"title class_\">Action2</span>()</span><br><span class=\"line\">  ];</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Registration\"><a href=\"#Registration\" class=\"headerlink\" title=\"Registration\"></a>Registration</h3><p>Now, none of this is going to work if we don’t register our Reducers and Effects with the NgRX Store. </p>\n<p>If you look at a lot of the literature on how to write NgRX code, you’ll often see that they recommend that you put the code in AppModule.  That will work, but how much more effective to put the code for your Store in its own module.  I create a Module class called AppStores and put it in a file named <code>app.stores.ts</code>.  I know, technically it is a module and it should be <code>app-stores.module.ts</code>.  Using <code>app.stores.ts</code> isolates it from a normal module.  All I want to put in here is Store stuff. </p>\n<p>Then, in my <code>app.stores.ts</code> file, I put code that looks like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">WaitEffects</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.effects&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">AppState</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app.state&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">WaitReducer</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./wait.reducer&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">NgModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">StoreModule</span>, <span class=\"title class_\">ActionReducerMap</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/store&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">EffectsModule</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@ngrx/effects&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">reducers</span>: <span class=\"title class_\">ActionReducerMap</span>&lt;<span class=\"title class_\">AppState</span>&gt; = &#123;</span><br><span class=\"line\">  <span class=\"attr\">wait</span>: <span class=\"title class_\">WaitReducer</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">StoreModule</span>.<span class=\"title function_\">forRoot</span>(reducers),</span><br><span class=\"line\">    <span class=\"title class_\">EffectsModule</span>.<span class=\"title function_\">forRoot</span>([<span class=\"title class_\">WaitEffects</span>])</span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppStore</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>And the AppState interface that I used for my reducer map looks like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">AppState</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">wait</span>: <span class=\"built_in\">number</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>A couple of things you should notice about this code.  First, the reducers object we create at the top of the file describes what our store looks like.  So far, we have an entity named “wait” that is controlled by our WaitReducer. </p>\n<p>Then to register the reducers with our application, we pass them on to <code>StoreModule.forRoot()</code> in the imports section of our module definition. </p>\n<p>Similarly, we must register our Effects with the application.  We do this by passing an array of Effects to <code>EffectsModule.forRoot()</code> in the imports section of our module definition. </p>\n<p>Of course, none of this code will even get included in your project unless you import this module into your AppModule class. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">AppComponent</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span>,</span><br><span class=\"line\">    **<span class=\"title class_\">AppStore</span>**</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [],</span><br><span class=\"line\">  <span class=\"attr\">bootstrap</span>: [<span class=\"title class_\">AppComponent</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Retrieving-Data\"><a href=\"#Retrieving-Data\" class=\"headerlink\" title=\"Retrieving Data\"></a>Retrieving Data</h2><p>Retrieving an entity from a store is quite simple.  Leaving out the imports that a good editor should help you with, here is the relevant code: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppComponent</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">wait</span>: <span class=\"title class_\">Observable</span>&lt;<span class=\"built_in\">number</span>&gt;;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">store: Store&lt;AppState&gt;</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">wait</span> = store.<span class=\"title function_\">select</span>(<span class=\"function\">(<span class=\"params\">s: AppState</span>)</span></span><br><span class=\"line\"><span class=\"function\">      =&gt;</span> s.<span class=\"property\">wait</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>And now you can subscribe to wait and whenever the value changes, you’ll get a notification and can do something with it.</p>\n<h2 id=\"Lazy-Loading-NgRX\"><a href=\"#Lazy-Loading-NgRX\" class=\"headerlink\" title=\"Lazy-Loading NgRX\"></a>Lazy-Loading NgRX</h2><p>Prior to NgRX version 4, all our state stuff had to live in the root of the application.  This was problematic because it also meant we were unable to easily locate our Actions, Reducers and Effects with the Routes they belonged to.  So, we had feature level components but everything else was more function based.  That is, all our State stuff lived together in one directory separate from the feature they supported.  Ugly! </p>\n<p>But now, we can create Reducers and Effects that live with the feature we support.</p>\n<h3 id=\"Always-Import-forRoot\"><a href=\"#Always-Import-forRoot\" class=\"headerlink\" title=\"Always Import forRoot()\"></a>Always Import forRoot()</h3><p>The first thing you’ll need to be aware of is that even if you aren’t storing any state at the application level, you will need to call <code>StoreModule.forRoot()</code> and <code>EffectsModule.forRoot()</code> with an empty object and array. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">imports</span>: [</span><br><span class=\"line\">  <span class=\"title class_\">StoreModule</span>.<span class=\"title function_\">forRoot</span>(&#123;&#125;),</span><br><span class=\"line\">  <span class=\"title class_\">EffectsModule</span>.<span class=\"title function_\">forRoot</span>([])</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"AppState-vs-FeatureState\"><a href=\"#AppState-vs-FeatureState\" class=\"headerlink\" title=\"AppState vs FeatureState\"></a>AppState vs FeatureState</h3><p>You’ll remember that you’ll typically use an interface called AppState to define the structure of the Store for your application.  You are going to want to create a separate interface for each set of feature reducers you are loading.</p>\n<h3 id=\"Feature-Name-as-AppState-Property\"><a href=\"#Feature-Name-as-AppState-Property\" class=\"headerlink\" title=\"Feature Name as AppState Property\"></a>Feature Name as AppState Property</h3><p>When you add a feature reducer, you’ll need to supply a name as the first parameter. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">imports</span>: [</span><br><span class=\"line\">  <span class=\"title class_\">StoreModule</span>.<span class=\"title function_\">forFeature</span>(<span class=\"string\">&#x27;featureName&#x27;</span>,</span><br><span class=\"line\">    featureReducers),</span><br><span class=\"line\">  ...</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>Where <code>featureReducers</code> is the map of reducers for the feature.  Like what we did for the root level reducers. </p>\n<p>This “featureName” becomes the name of the store entity you’ll need to select to get at the store entities in your feature reducers. </p>\n<p>Imagine you have a feature named “featureName” as we’ve coded above and your <code>featureReducer</code> object has a feature property named “sub”.  Not super original, but it will do for an example. To select “sub” from your store, you would use code that would look something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.<span class=\"title function_\">select</span>(<span class=\"function\"><span class=\"params\">s</span> =&gt;</span></span><br><span class=\"line\">  s.<span class=\"property\">featureName</span>.<span class=\"property\">sub</span>);</span><br></pre></td></tr></table></figure>\n\n<p>This means that if you want to strongly type your selections using AppState, you will need to define a field in your AppState interface as “featureName” that is typed as the State interface for that feature.  Let’s call that FeatureState. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">FeatureState</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">sub</span>: <span class=\"title class_\">SubModel</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And then our AppState would look like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">AppState</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">featureName</span>: <span class=\"title class_\">FeatureState</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And now we can write our select code like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.<span class=\"title function_\">select</span>(<span class=\"function\">(<span class=\"params\">x: AppState</span>) =&gt;</span> x.<span class=\"property\">featureName</span>.<span class=\"property\">sub</span>);</span><br></pre></td></tr></table></figure>\n\n<p>If you have Effects that go with your reducers, you’ll also need to import them with </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">imports</span>: [</span><br><span class=\"line\">  <span class=\"title class_\">EffectsModule</span>.<span class=\"title function_\">forFeature</span>([</span><br><span class=\"line\">    …list <span class=\"keyword\">of</span> effects here</span><br><span class=\"line\">  ])</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Features-Without-AppState\"><a href=\"#Features-Without-AppState\" class=\"headerlink\" title=\"Features Without AppState\"></a>Features Without AppState</h3><p>It is possible to access the feature state without putting it in your AppState.  This alternate method may be the only way you can access the code, but you might want to implement this method generally so that your features don’t necessarily have to know about the application. </p>\n<p>To implement this access method, you use the <code>createFeatureSelector()</code>and <code>createSelector()</code> methods which you can import from <code>@ngrx/store</code>. The above code using these methods would look something like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> featureSelector = createFeatureSelector&lt;<span class=\"title class_\">FeatureState</span>&gt;(<span class=\"string\">&#x27;featureName&#x27;</span>); <span class=\"keyword\">const</span> subSelector = <span class=\"title function_\">createSelector</span>(featureSelector, <span class=\"function\">(<span class=\"params\">x: FeatureState</span>) =&gt;</span> x.<span class=\"property\">sub</span>));</span><br><span class=\"line\">store.<span class=\"title function_\">select</span>(subSelector);</span><br></pre></td></tr></table></figure>\n\n<p>Where store is injected using </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">constructor</span>(<span class=\"params\">store: Store&lt;FeatureState&gt;</span>)&#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Note: I’m not suggesting that you write your code like this.  If you are repeating the <code>createFeatureSelector()</code> <code>createSelector()</code> code in multiple places, you should look for a way of not repeating yourself.  I’ve put it all in one place here, so you can see how the methods tie together in the bigger picture.  In my production code, I tend to write this as a separate function in a separate file that can be called from anywhere.</p>\n",
            "tags": [
                "angular",
                "NgRX"
            ]
        },
        {
            "id": "http://davembush.github.com/using-ngrx-to-cleanly-aggregate-data/",
            "url": "http://davembush.github.com/using-ngrx-to-cleanly-aggregate-data/",
            "title": "Using NgRX to Cleanly Aggregate Data",
            "date_published": "2017-10-03T10:30:50.000Z",
            "content_html": "<p>For the last 18 months, I’ve been working for an organization that has what some might consider a unique requirement.  Because of where our application’s data is sourced, we need to aggregate data on the client side rather than on the server.  What this means is that for any one screen, we may make multiple calls to the server to grab all the data we need.  Fortunately, because we adopted NgRX early in our adoption of Angular, we could avoid a lot of the headaches associated with client-side aggregation. <figure><img src=\"/uploads/2017/09/2017-10-03.png\" title=\"Using NgRX to Cleanly Aggregate Data\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/gsfc/14486243743/\">NASA Goddard Photo and Video</a> via <a href=\"//visualhunt.com/re/296da9\">Visualhunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"The-Problem\"><a href=\"#The-Problem\" class=\"headerlink\" title=\"The Problem\"></a>The Problem</h2><p>There are multiple ways this problem might manifest itself in an application.  But one of the most common is a basic search screen that displays a list of results.  Everything is simple when your data comes back with all the data you need.  But in our case, the data that is returned might contain all but one or two fields that we need.  Those fields exist in other end points.  To keep the basic problem small, let’s just assume that you search for a list of records.  That search returns 10 items.  For each of those records, you now need to make two more calls to retrieve the content of the two missing fields.  This means that to get a complete result set back, you need to make a total of 21 calls.  The problem becomes even worse if you have a total of 100 records, or you now have 3 fields that you need to retrieve for each row.</p>\n<h2 id=\"The-Old-Way\"><a href=\"#The-Old-Way\" class=\"headerlink\" title=\"The Old Way\"></a>The Old Way</h2><p>Prior to using NgRX, the main way we might solve this problem would be to introduce callback hell, or promise hell if you are that lucky.</p>\n<ul>\n<li>Make a call for the original list</li>\n<li>When the list gets returned<ul>\n<li>Iterate through the records and<ul>\n<li>Make a call for Child Record One<ul>\n<li>When callback returns, add the new value to the parent record</li>\n</ul>\n</li>\n<li>Make a call for Child Record Two<ul>\n<li>When the callback returns, add the new value to the parent record</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Once all the calls have returned, return the list so it can be displayed.</li>\n</ul>\n<p>As you can see, this not only becomes difficult to manage, but it also introduces a system that is going to be perceived as slow. </p>\n<p>But, now, we can do better.</p>\n<h2 id=\"Using-NgRX\"><a href=\"#Using-NgRX\" class=\"headerlink\" title=\"Using NgRX\"></a>Using NgRX</h2><p>By using NgRX, we use a series of Effects to retrieve our data, typically via a Service.  When the effect is done, it returns the results to a reducer which puts them in our store entity for us. </p>\n<p>The basic work flow looks like something like this:</p>\n<ul>\n<li>Dispatch an action to get the main results</li>\n<li>Effect hears the action and makes a call for the top-level list</li>\n<li>When the list returns,<ul>\n<li>Iterate through the records and<ul>\n<li>we dispatch an action to get Child Record One</li>\n<li>we dispatch an action to get Child Record Two</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Return an Action that will use a reducer to fill our list</li>\n<li>Child Record One Effect hears the actions for each of the rows</li>\n<li>When each of the values are retrieved the Effect returns an Action that uses a Reducer to put the value in the store</li>\n<li>Child Record Two Effect hears the actions for each of the rows</li>\n<li>When each of the values are retrieved, the Effect returns an Action that uses a Reducer to put the value in the store</li>\n</ul>\n<p>You’ll notice, we no longer have the nesting mess that we had using the old way and we can list our results as soon as the first set of data is returned.</p>\n<h2 id=\"Meanwhile-back-on-our-View\"><a href=\"#Meanwhile-back-on-our-View\" class=\"headerlink\" title=\"Meanwhile, back on our View\"></a>Meanwhile, back on our View</h2><p>Now, there are two ways you can deal with displaying this information in your view and it all depends on what you are doing. </p>\n<p>The easy way is to just let the View display the information as it comes back.  Most of the time this will work.  If you need to filter your data in the display once it comes back, you will need to decide if data that doesn’t have the child fields yet should, or should not be displayed. </p>\n<p>Another quirk I had to deal with was that we were displaying child rows with child rows.  Letting the data display as we got it back gave the screen a kind of exploding effect.  For this, I added a debounceTime(500) to the store observer so that the screen only updated once all the data had been retrieved.  Using the pattern above was still easier to reason about than the old way, we just didn’t get the added benefit of being able to see the data as it was being retrieved.</p>\n<h2 id=\"Watch-Out\"><a href=\"#Watch-Out\" class=\"headerlink\" title=\"Watch Out!\"></a>Watch Out!</h2><p>One of the wrong ways you might be tempted to use this pattern would be to chain all the child stuff in one effect and dispatch actions to your reducers from within the one Effect.  This would be a mistake.  Sure, it would work.  But now because your effect is doing more than one thing, your code becomes MUCH harder to reason about.  While each of your Effects may ultimately call the same reducer function, or not, you definitely want to have a separate set of Actions and Effects that retrieve the data from the server.</p>\n",
            "tags": [
                "angular",
                "design patterns",
                "NgRX"
            ]
        },
        {
            "id": "http://davembush.github.com/upgrade-to-angular-from/",
            "url": "http://davembush.github.com/upgrade-to-angular-from/",
            "title": "Upgrade to Angular from...",
            "date_published": "2017-09-26T10:30:23.000Z",
            "content_html": "<p>As I’ve been interviewing for a new contract, the question, “How do we Upgrade to Angular from …?” has come up several times.  And as I’ve thought about the question, several patterns have emerged. <figure><img src=\"/uploads/2017/09/2017-09-26.jpg\" title=\"Upgrade Angular from ...\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/archer10/12414442945/\">archer10 (Dennis) 102M Views</a> via <a href=\"//visualhunt.com/re/426124\">Visualhunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by-sa/2.0/\"> CC BY-SA</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"From-a-Portal\"><a href=\"#From-a-Portal\" class=\"headerlink\" title=\"From a Portal\"></a>From a Portal</h2><p>The first time I was asked this question, the team I was talking with had an existing Web 1.0 site setup using WebSphere Portal.  Not something that you can easily plug any Single Page Application (SPA) into. But all is not lost. </p>\n<p>One of the easiest ways to solve the problem is to create a reverse proxy.  One popular tool for this is mod_proxy for the Apache server.  If you are using IIS, you could use URL Rewrite rules to setup a reverse proxy. </p>\n<p>In either case, you will need to setup rules that ensure that anyone trying to access a URL that is still on the old portal site would still be able to access that directly.  Once that is in place, you would create one page, or maybe a set of related pages, at a time and stand them up on another server.  Then you would change your rules so that anyone trying to access the old URLs that are no longer being served by the old site get redirected to the new SPA application. </p>\n<p>Now, this sounds pretty simple.  But, I imagine keeping everything in sync as you go might be more of a pain that you might imagine.  If you have pages that link to each other, you’ll need to convert links to routes as you go.  Say you convert page one.  It still has links to the old site.  Not a big problem.  But as the pages it is linking to now become part of the SPA, you’ll want to convert those links to route directives.  One way you might mitigate this issue is to convert pages with the fewest links out first.  It might help to create a graph, or at least a spreadsheet, to help you manage the interdependent relationships. </p>\n<p>An added advantage of this setup is that any pages in the portal that have relatively static content, and any resources, can be cached, or even moved, to the proxy server where they will probably be served up faster than the original portal.</p>\n<h2 id=\"From-a-Web-1-0-Site\"><a href=\"#From-a-Web-1-0-Site\" class=\"headerlink\" title=\"From a Web 1.0 Site\"></a>From a Web 1.0 Site</h2><p>Switching from an existing Web 1.0 site might be a bit easier.  Although, using the proxy method there still might be the best choice.  Many of the same issues exist.  But in the case of an existing Web 1.0 site that doesn’t depend on a portal, you’ll probably have greater control over the server.  Again, you are probably running the site on Apache, nginx, or IIS.  In all of those cases, you can setup a rule that says, “if you can’t find the URL, load up this page over here instead.”  Where “this page over here” is your Angular site you are converting to.  You’ll need to implement something like this anyhow for your Angular SPA to work correctly, so this is probably the least amount of extra work to get you where you need to be. </p>\n<p>Then, you convert a page or a set of related pages at a time like I described in the Portal implementation.</p>\n<h2 id=\"From-Another-Framework\"><a href=\"#From-Another-Framework\" class=\"headerlink\" title=\"From Another Framework\"></a>From Another Framework</h2><p>Let’s say that you are moving from React, or some other framework to Angular.  I know of a company that is doing just this.  The wrinkle is, they have no plans on converting their existing pages to Angular.  This makes the transition relatively simple.  You setup rules on your server, similar to how you would setup a conversion from a Web 1.0 site.  “URLs that look like this, go to the old index.html page and URLs that look like that go to the new index.html page.” </p>\n<p>Once again, you’ll need to keep track of routes as you change from one to the other.  But it is manageable.</p>\n<h2 id=\"Converting-AngularJS-to-Angular\"><a href=\"#Converting-AngularJS-to-Angular\" class=\"headerlink\" title=\"Converting AngularJS to Angular\"></a>Converting AngularJS to Angular</h2><p>Yes, I know ngUpgrade exist.  But, if you don’t need to use it, why would you.  ngUpgrade exist so you can embed Angular in AngularJS or AngularJS in Angular.  But, it might make more sense to create a new SPA for Angular and have the two sites reference each other similar to how you would do this for a Web 1.0 site or if you were converting from an entirely different framework. </p>\n<p>The reason I recommend using the two-site method first is because Angular really is a different framework.  There are similarities between AngularJS and Angular.  But that is all they are.  What if you just pretended they weren’t at all related.  That the ngUpdate bridge didn’t exist.  Wouldn’t that make life just a bit easier in the long run?  I think it would.</p>\n",
            "tags": [
                "angular",
                "react.js",
                "portal",
                "web 1.0",
                "web 2.0"
            ]
        },
        {
            "id": "http://davembush.github.com/this-one-tweak-improved-my-angular-code/",
            "url": "http://davembush.github.com/this-one-tweak-improved-my-angular-code/",
            "title": "This One Tweak Improved my Angular Code",
            "date_published": "2017-09-12T10:30:10.000Z",
            "content_html": "<p>I made a tweak to my Angular code process over the last month or so that has resulted in greater productivity in my development environment and fewer bugs. </p>\n<p>Now, I didn’t make this change because I thought it would improve my productivity.  At least that wasn’t the primary reason.  I made the change because I thought it would reduce the chance of introducing bugs into my code.  And while it does reduce the number of bugs in my code, the result has been generally improved productivity. </p>\n<p>What is this great secret? <figure><img src=\"/uploads/2017/09/2017-09-12.jpg\" title=\"This One Tweak Improved my Angular Code\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/sheila_sund/36859429262/\">docoverachiever</a> via <a href=\"//visualhunt.com/re/d75fb5\">Visual Hunt</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"History\"><a href=\"#History\" class=\"headerlink\" title=\"History\"></a>History</h2><p>Before I tell you the secret, I want to tell you how I got here.  Yesterday, I was listening to a podcast that was reviewing another framework with the creators of that framework.  All during the podcast they were comparing their framework to Angular and React.  Fine, compare and contrast is good.  Except, they were comparing and contrasting something they knew really well, their framework, to something they had a lesser understanding of.  So, in the process, one of their complaints about Angular was that Angular doesn’t take full advantage of TypeScript.  Or, it doesn’t take as full advantage of TypeScript as their framework does. </p>\n<p>As I listened to this I realized that most Angular developers probably aren’t taking as full advantage of TypeScript as they could.  I think this is by design.  But, it is too our hurt.  Fortunately, we can turn things on that Angular leaves turned off.</p>\n<h2 id=\"Type-Safety\"><a href=\"#Type-Safety\" class=\"headerlink\" title=\"Type Safety\"></a>Type Safety</h2><p>Now, if you are like most developers I know, you just want to get your code working.  And so, you don’t pay attention to things like Linters.  And you have learned enough TypeScript to get your code working.  This is especially true of those who are coming from “old school” JavaScript. </p>\n<p>Now, I’m going to challenge you to do two things.  First, use TSLint.  Next, make the rules as rigid as possible.</p>\n<h3 id=\"TSLint\"><a href=\"#TSLint\" class=\"headerlink\" title=\"TSLint\"></a>TSLint</h3><p>If you are using the Angular CLI, TSLint is built in.  To run TSLint, all you need to do is to run </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run lint</span><br></pre></td></tr></table></figure>\n\n<p>On the command line. </p>\n<p>This will verify that you haven’t made any really stupid syntax mistakes by default. </p>\n<p>Next, the editor you are using should have a way of hooking TSLint up to the editor so that you can tell you have a problem in your code as you write your code.  If your editor doesn’t have a way of doing this, find a new editor.  The two editors I recommend are VS Code and WebStorm.  Each have their own strengths and weaknesses.</p>\n<h3 id=\"Rules\"><a href=\"#Rules\" class=\"headerlink\" title=\"Rules\"></a>Rules</h3><p>The rules that come with the Angular CLI are, in my opinion, too relaxed.  They are strong enough to not annoy JavaScript programmers.  They protect you from making really stupid TypeScript programming errors.  But, they don’t help you write code that you have a high assurance will work correctly the first time without running it. </p>\n<p>We are going to fix this. </p>\n<p>The main thing we want to do is that we want to tighten up type checking.  So, instead of using the defaults that either let variables be anything or default them to the type they are assigned to when they are declared if that can be determined, we are going to force variables to be declared.</p>\n<h2 id=\"Why-This-Helps\"><a href=\"#Why-This-Helps\" class=\"headerlink\" title=\"Why This Helps\"></a>Why This Helps</h2><p>When I first made this kind of change, I was doing it to <a href=\"/typescript-functional-programming/\">improve my NgRX code</a>.  Once I did that, I immediately saw that by enforcing type safety, I could easily tell if the functions I was using in my Observable chains was going to end up returning what I thought it was going to.  This means, I can write my code and if I don’t get any tslint warnings in my editor, I can have a high degree of certainty that the code will run correctly once I compile it and run it. </p>\n<p>Maybe you think type safety is for sissies.  OK then, you can continue to run your code multiple times to find the same error that I can find before I ever run the code.  I think we all know who will be more productive. </p>\n<p>Once I saw this productivity gain, I determined to add type safety to my entire project.  This took much less time than you would expect and I was able to apply the rules incrementally so that I was not disrupting the progress of the project I was working on.</p>\n<h2 id=\"Implementation\"><a href=\"#Implementation\" class=\"headerlink\" title=\"Implementation\"></a>Implementation</h2><p>The implementation is actually pretty simple.  The first thing you are going to want to do is that you’ll want to change the npm lint script from: </p>\n<p><code>&quot;lint&quot;: &quot;ng lint&quot;</code> </p>\n<p>to </p>\n<p><code>&quot;lint&quot;: &quot;ng lint --type-check --fix&quot;</code> </p>\n<p>This does two things.  First it allows us to change to tslint rules to use rules that require type checking.  And second it will cause the tslint to fix any problems it finds that it can fix automatically. </p>\n<p>Next, you’ll want to install tslint-immutable, which will allow us to add in rules for immutability that I mentioned in my previous post that I linked to above.  As of this writing, I’m using version 4.1.0 </p>\n<p><code>npm install --save-dev tslint-immutable</code> </p>\n<p>Next, open up tslint.json which should be at the root of your application. </p>\n<p>Inside this file, right before the rulesDirectory section, add this code: </p>\n<p><code>&quot;extends&quot;: [&quot;tslint-immutable&quot;],</code> </p>\n<p>This will allow us to access the immutable rules we just added with <code>npm install</code>.</p>\n<h3 id=\"typedef\"><a href=\"#typedef\" class=\"headerlink\" title=\"typedef\"></a>typedef</h3><p>The first thing we want to do is that we want to force everything to have a type definition. </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&quot;typedef&quot;</span>: [ <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;call-signature&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;arrow-call-signature&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;parameter&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;arrow-parameter&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;property-declaration&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;variable-declaration&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;member-variable-declaration&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;object-destructuring&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;array-destructuring&quot;</span></span><br><span class=\"line\">],</span><br></pre></td></tr></table></figure>\n\n<p>The one place where you might have a problem is that by default, the no-inferable-types rule is turned on, which is what we want.  Currently, tslint is not smart enough to know that no-inferable-types should take precedence over typedef.  So, you’ll need to occasionally exclude the rule using the <a href=\"//palantir.github.io/tslint/usage/rule-flags/\">tslint comment exclusion</a>.  I exclude the typedef when I run into this problem. </p>\n<p>If you are interested, you can google each of the typedef declarations (rather than linking to them and have the links go stale).</p>\n<h3 id=\"no-any\"><a href=\"#no-any\" class=\"headerlink\" title=\"no-any\"></a>no-any</h3><p>Now that we are forcing everything to have a type definition, the next thing you want to do is that you’ll want to disallow using “any” as a type definition.  Otherwise, why force the type definition at all?  I’d love to be able to disallow “object” as well, but there is currently no definition for that so until someone creates that rule, you’ll just have to use discipline.</p>\n<p><code>&quot;no-any&quot;: true,</code></p>\n<p>You may complain that sometimes you want to have the variable really be anything.  Anything?  Really?  I bet most of the time what you really want to be able to do is that you’ll want to define the variable as one of two, maybe three types.  You can achieve this definition as of TypeScript 2.4, by using the pipe operator.</p>\n<p><code>var stringOrNumber: string | number;</code></p>\n<h3 id=\"no-unused-variable\"><a href=\"#no-unused-variable\" class=\"headerlink\" title=\"no-unused-variable\"></a>no-unused-variable</h3><p>To keep your code clean, the next rule you want to enable is to disallow creating variables that you aren’t using.  This will have the side effect of cleaning up your import statements as well. </p>\n<p><code>&quot;no-unused-variable&quot;: true,</code> </p>\n<p>Those are all the rules I use that impact type safety.  Here are a few more you might want to consider adding.</p>\n<h3 id=\"Cyclomatic-Complexity\"><a href=\"#Cyclomatic-Complexity\" class=\"headerlink\" title=\"Cyclomatic Complexity\"></a>Cyclomatic Complexity</h3><p>Cyclomatic Complexity is a measure of how complicated your functions and methods are.  While the default implementation for this is 20, I find that if I’ve written a function that is that complex, even I have trouble understanding it any more.  While keeping my complexity lower than 10 contributes to extremely readable code.  Yes, there are times when there really isn’t any good way of breaking the code into smaller chunks.  But that is rare and code comment exclusions will let you handle those exceptions. </p>\n<p><code>&quot;cyclomatic-complexity&quot;: [true, 10],</code></p>\n<h2 id=\"Optional-Rules\"><a href=\"#Optional-Rules\" class=\"headerlink\" title=\"Optional Rules\"></a>Optional Rules</h2><p>Some other rules you might want to consider adding in that could improve your code include:</p>\n<h3 id=\"array-type-generic\"><a href=\"#array-type-generic\" class=\"headerlink\" title=\"array-type generic\"></a>array-type generic</h3><p>Coming from a C# background, I prefer to define my arrays as Array<T> instead of T[].  By default nothing is defined.  If it is just you working on the code, it probably doesn’t matter than much.  But on a team, I find consistency useful. </p>\n<p><code>&quot;array-type&quot;: [true, &quot;generic&quot;],</code></p>\n<h3 id=\"readonly-array\"><a href=\"#readonly-array\" class=\"headerlink\" title=\"readonly-array\"></a>readonly-array</h3><p>For my NgRX code, I like to have readonly-array turned on to ensure immutability.  I’ve found that I rarely need to turn this off in the rest of my code since NgRX is where I would be mutating anything that isn’t local to a function.  So, I just turn this rule on globally. </p>\n<p><code>&quot;readonly-array&quot;: [true, &quot;ignore-local&quot;],</code></p>\n<h2 id=\"Final-Notes\"><a href=\"#Final-Notes\" class=\"headerlink\" title=\"Final Notes\"></a>Final Notes</h2><p>I mentioned above that if you are using TypeScript 2.4.n, you can use the pipe operator to combine types.  You also get stronger type checking if you use that version.  However, if you are using codelyzer, as of this writing, you’ll have trouble if you use TypeScript 2.4.n with a version of Codelyzer greater than 3.0.1.  I keep trying the newer versions to see if this issue has been corrected.  Anyhow, your mileage may vary moving your code to TypeScript 2.4.n.</p>\n<h2 id=\"My-TSLint-file\"><a href=\"#My-TSLint-file\" class=\"headerlink\" title=\"My TSLint file\"></a>My TSLint file</h2><p>For those who are curious, my full tslint.json file is below. </p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">&quot;extends&quot;</span>: [<span class=\"string\">&quot;tslint-immutable&quot;</span>],</span><br><span class=\"line\">    <span class=\"string\">&quot;rulesDirectory&quot;</span>: [</span><br><span class=\"line\">        <span class=\"string\">&quot;node_modules/codelyzer&quot;</span></span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"string\">&quot;rules&quot;</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;typedef&quot;</span>: [<span class=\"literal\">true</span>, </span><br><span class=\"line\">            <span class=\"string\">&quot;call-signature&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;arrow-call-signature&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;parameter&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;arrow-parameter&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;property-declaration&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;variable-declaration&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;member-variable-declaration&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;object-destructuring&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;array-destructuring&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;array-type&quot;</span>: [<span class=\"literal\">true</span>, <span class=\"string\">&quot;generic&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;readonly-keyword&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;readonly-array&quot;</span>: [<span class=\"literal\">true</span>, <span class=\"string\">&quot;ignore-local&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;no-let&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-any&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;cyclomatic-complexity&quot;</span>: [<span class=\"literal\">true</span>, <span class=\"number\">10</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;no-unused-variable&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;arrow-return-shorthand&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;callable-types&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;class-name&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;comment-format&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-space&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;curly&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;eofline&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;forin&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;import-blacklist&quot;</span>: [<span class=\"literal\">true</span>, <span class=\"string\">&quot;rxjs&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;import-spacing&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;indent&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;spaces&quot;</span>,</span><br><span class=\"line\">            <span class=\"number\">4</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;interface-over-type-literal&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;label-position&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;max-line-length&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"number\">140</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;member-access&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;member-ordering&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;static-before-instance&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;variables-before-functions&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;no-arg&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-bitwise&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-console&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;debug&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;info&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;time&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;timeEnd&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;trace&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;no-construct&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-debugger&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-duplicate-super&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-duplicate-variable&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-empty&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-empty-interface&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-eval&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-inferrable-types&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-misused-new&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-non-null-assertion&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-shadowed-variable&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-string-literal&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-string-throw&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-switch-case-fall-through&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-unnecessary-initializer&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-trailing-whitespace&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-unused-expression&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-use-before-declare&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-var-keyword&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;object-literal-sort-keys&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;one-line&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-open-brace&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-catch&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-else&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-whitespace&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;prefer-const&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;quotemark&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;single&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;radix&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;semicolon&quot;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&quot;always&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;triple-equals&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;allow-null-check&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;typedef-whitespace&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;call-signature&quot;</span>: <span class=\"string\">&quot;nospace&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;index-signature&quot;</span>: <span class=\"string\">&quot;nospace&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;parameter&quot;</span>: <span class=\"string\">&quot;nospace&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;property-declaration&quot;</span>: <span class=\"string\">&quot;nospace&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;variable-declaration&quot;</span>: <span class=\"string\">&quot;nospace&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;typeof-compare&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;unified-signatures&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;variable-name&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;whitespace&quot;</span>: [</span><br><span class=\"line\">            <span class=\"literal\">true</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-decl&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-operator&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-separator&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;check-type&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;directive-selector&quot;</span>: [<span class=\"literal\">true</span>, <span class=\"string\">&quot;attribute&quot;</span>, <span class=\"string\">&quot;app&quot;</span>, <span class=\"string\">&quot;camelCase&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;component-selector&quot;</span>: [<span class=\"literal\">true</span>, <span class=\"string\">&quot;element&quot;</span>, <span class=\"string\">&quot;app&quot;</span>, <span class=\"string\">&quot;kebab-case&quot;</span>],</span><br><span class=\"line\">        <span class=\"string\">&quot;use-input-property-decorator&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;use-output-property-decorator&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;use-host-property-decorator&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-input-rename&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-output-rename&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;use-life-cycle-interface&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;use-pipe-transform-interface&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;component-class-suffix&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;directive-class-suffix&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;no-access-missing-member&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;templates-use-public&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;invoke-injectable&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "angular",
                "typescript"
            ]
        },
        {
            "id": "http://davembush.github.com/model-view-presenter-angular-and-testing/",
            "url": "http://davembush.github.com/model-view-presenter-angular-and-testing/",
            "title": "Model View Presenter, Angular, and Testing",
            "date_published": "2017-08-29T10:30:33.000Z",
            "content_html": "<p>While testing Components is possible, it is not easy and is often pointless.  Using the Model View Presenter pattern, or a variation of it, solves the problem. </p>\n<p>Here’s the deal. Long time readers of my blog know I’ve been a proponent of Unit Testing for a very long time. While I was learning React, I went through the exercise of trying to write test as I was learning.  Now, the great thing about Angular and React is that it is possible to test your components.  The problem with testing components is that you are either testing that your HTML ended up in the right spot, that Angular directives did what they should, or you are evaluating the DOM to verify that component logic worked.  In most cases, putting tests that do any of these at the component level is the wrong way to test. <figure><img src=\"/uploads/2017/08/2017-08-27.jpg\" title=\"Model View Presenter, Angular, and Testing\"><figcaption>Photo credit: <a href=\"//www.flickr.com/photos/tamworthboroughcouncil/15657023428/\">Tamworth Borough Council</a> via <a href=\"//visualhunt.com/re/e21893\">Visualhunt.com</a> &#x2F; <a href=\"//creativecommons.org/licenses/by/2.0/\"> CC BY</a></figcaption></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Evaluating-HTML\"><a href=\"#Evaluating-HTML\" class=\"headerlink\" title=\"Evaluating HTML\"></a>Evaluating HTML</h2><p>Ignoring for a second that setting up a component test is awkward, the question I want to address here is, “is that really an appropriate test?” </p>\n<p>If all your smart component does is pass data down to dumb component, all you really need to verify is that given a dumb component with an html fragment, and another one with another fragment, they will all end up sequentially after each other.  It is a pretty easy test to setup. </p>\n<p>But all you’ve ended up testing is that Angular does what it says it will. It won’t tell you what you can’t already see by running the code. </p>\n<p>Dumb components are even more obvious.  Let’s go for something obvious.  You have a ngFor that allows you to display a list of HTML.  You setup your component so that it has an array of three known items, you pass that into the component, do a change detection cycle, and verify that your HTML displays as expected. </p>\n<p>Great, you’ve verified that Angular works again.  You will have a hard time convincing me that you’ve really tested anything.</p>\n<h2 id=\"Angular-Directives\"><a href=\"#Angular-Directives\" class=\"headerlink\" title=\"Angular Directives\"></a>Angular Directives</h2><p>In this case, you are going to try to verify that when you click on a component, or pass it some data, or… whatever, that Angular does what it should.  Maybe you do need to verify that when you click an element, something else happens.  But this is not the place. </p>\n<p>You might create an integration test, which would, by definition, take longer to run.  It would be better if you tested this using an end to end test.  But testing this as a unit test, doesn’t tell you much more than that Angular has said that it would. </p>\n<p>“But, I need to verify that the code in my event handler does what it should!”  You might complain.  Yes, you do, but you don’t need to fire a click event to do that, just call the event handler.</p>\n<h2 id=\"Big-Fat-Hairy-Logic\"><a href=\"#Big-Fat-Hairy-Logic\" class=\"headerlink\" title=\"Big Fat Hairy Logic\"></a>Big Fat Hairy Logic</h2><p>And then there is that “big fat hairy logic” issue.  You’ve created some sort of component that has some rather complex logic.  OK, that happens.  A grid control is a perfect example.  But, maybe your logic is in the wrong place?</p>\n<h2 id=\"A-Better-Solution\"><a href=\"#A-Better-Solution\" class=\"headerlink\" title=\"A Better Solution\"></a>A Better Solution</h2><p>There is a design pattern called “Model View Presenter” Like all of the MV* patterns it aims to separate out logic from the view so that we can test things easier.  It was popular with WebForms in ASP.NET when that was how you wrote ASP.NET web sites.  The way this worked was that you would create an Interface for your WebForm that represented all of the things you wanted to have access to from your logic code.  Your presenter.  All your component or page code did was respond to events on the page and expose data to the data driven forms.  In a lot of ways, Angular isn’t much different from WebForms.  Your TypeScript file is essentially a “code-behind” file and your template is similar to an ASPX page. </p>\n<p>The beauty of the MVP pattern is that when you do it right, your component has no logic at all.  It renders data and responds to events by calling down to the presenter.  In an Angular world, I doubt the Presenter would ever need to call up to the view.  This is prefect.  Now I can create a test for my component logic in a way very similar to how I would test any other Injectable.  Because Injectables are what we are going to use here.</p>\n<h3 id=\"Injectable-Presenters\"><a href=\"#Injectable-Presenters\" class=\"headerlink\" title=\"Injectable Presenters\"></a>Injectable Presenters</h3><p>For the point of illustration, let’s assume that all components would follow this pattern.  Now a simple component would have four files instead of the normal three.</p>\n<ul>\n<li>*.component.ts</li>\n<li>*.component.html</li>\n<li>*.component.css</li>\n<li>*.component.presenter.ts</li>\n</ul>\n<p>The <code>*.component.presenter.ts</code> file is our new Injectable.  Any properties in our component would pass on down to the presenter.  Any methods, which should be few to none, would pass on down to the presenter.  The presenter is where we do all the work.</p>\n<h3 id=\"Make-the-Presenter-Available-to-the-Component\"><a href=\"#Make-the-Presenter-Available-to-the-Component\" class=\"headerlink\" title=\"Make the Presenter Available to the Component\"></a>Make the Presenter Available to the Component</h3><p>Now, if you’ve studied the Angular tutorials, you probably already know this, but my bet is most people programming the new Angular don’t.  You can make an Injectable available by providing it in a module, or by providing it in a component.  If you provide it in the module, it is globally available.  If you provide it in the component, it is only available to that component or its child components.  This is perfect for our use case here.  So, we provide it in our component and then inject it into our component’s constructor. </p>\n<p>Everything else we might have injected into our component can now be injected into our presenter.</p>\n<h2 id=\"Look-Ma-No-DOM\"><a href=\"#Look-Ma-No-DOM\" class=\"headerlink\" title=\"Look Ma, No DOM\"></a>Look Ma, No DOM</h2><p>The side effect of this pattern is now, the complexity of the methods in our component should be 1.  This means they don’t really need to be tested.  And because they don’t need to be tested, we don’t really need a DOM available to run our tests.  This makes it MUCH easier to use jsDOM to run our unit test without having to wire in a bunch of polyfills just to make it all “work.”</p>\n",
            "tags": [
                "unit test",
                "angular",
                "mvp"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-observable-secrets-revealed/",
            "url": "http://davembush.github.com/angular-observable-secrets-revealed/",
            "title": "Angular Observable Secrets Revealed",
            "date_published": "2017-08-08T10:30:11.000Z",
            "content_html": "<p>If you’ve been programming JavaScript based applications for any length of time, you’ve probably already made the progression from callback hell to promises, but just to recap.  Whenever we make any kind of asynchronous call in JavaScript, we need to provide a callback function to the call so that, when the call completes, the function can be called with any resulting data.  Function calls you may typically make that need this kind of feature are <code>setTimeout()</code>, <code>setInterval(),</code> and AJAX calls using the various libraries that support this. </p>\n<p>The problem with using callbacks is that you can end up with “Callback Hell” where you have callbacks inside of other callbacks.  Our code becomes messy and difficult to reason about. </p>\n<p>To try to flatten this situation out, promises were created.  Instead of creating a callback function and passing it into the asynchronous function, the asynchronous function returns a promise that has a function we can pass our function into.  This function can return yet another promise.  The result is that instead of having nested callbacks, all of our callbacks live at the same level. </p>\n<p>However, in the process, we lost the ability to cancel an asynchronous function using callbacks.  Most of the time, this was not a huge concern, but in the case of AJAX calls, we did end up making more request than we really needed to.  Most people never even recognized this as an issue.  But if you go and take a look at some of your older code, you will see that you have several places where the code would work more efficiently if you were able to cancel a call that was being superseded by a new call. </p>\n<p>Meanwhile, some additional functions were added to JavaScript Arrays.  Maybe you’ve seen some of them?  map(), reduce(), and filter() are three of the more common functions. </p>\n<p>What?  You haven’t seen these?  If you have and you know how they work, you can skip this next section.  But, if you haven’t, pay careful attention because this next section is critical to understanding how Observables work. <figure><img src=\"/uploads/2017/08/2017-08-08.jpg\" title=\"Angular Observable Secrets Revealed\"> Photo via <a href=\"//visualhunt.com/re/4ba464\">VisualHunt.com</a></figure></p>\n<span id=\"more\"></span> \n\n<h2 id=\"Array-Functions\"><a href=\"#Array-Functions\" class=\"headerlink\" title=\"Array Functions\"></a>Array Functions</h2><h3 id=\"map\"><a href=\"#map\" class=\"headerlink\" title=\"map()\"></a>map()</h3><p>Let’s say you have a list of objects that you need to transform into another form.  In the example below, we want to transform our list of objects into a list that can be used in a dropdown list using fullName for the display and id for the value. </p>\n<p>Without using <code>map()</code>, your code might look something like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someList = [</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">Dave</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Bush</span>’&#125;,</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">John</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Doe</span>’&#125;,</span><br><span class=\"line\">   …</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"keyword\">var</span> i;</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArray = []; </span><br><span class=\"line\"><span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; someList.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> item = someList[i];</span><br><span class=\"line\">   newArray.<span class=\"title function_\">push</span>(&#123;<span class=\"attr\">fullName</span>: item.<span class=\"property\">firstName</span> + ‘ ‘ +</span><br><span class=\"line\">       item.<span class=\"property\">lastName</span>, <span class=\"attr\">id</span>: item.<span class=\"property\">id</span>&#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The thing is, we do most of the code from <code>newArray = []</code> on down over and over again.  It is only the code in the <code>push()</code> that changes. </p>\n<p>What if we were to make the code into a function?  That’s what <code>map()</code> does.  It takes a function as a parameter that takes an item as a parameter.  Inside the function, we use that item to specify how we want to transform the item and the whole map() function returns the new array. </p>\n<p>The code above, turns into this.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someList = [</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">Dave</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Bush</span>’&#125;,</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">John</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Doe</span>’&#125;,</span><br><span class=\"line\">   …</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArray = someList.<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> &#123;<span class=\"attr\">fullName</span>: item.<span class=\"property\">firstName</span> + ‘ ‘ +</span><br><span class=\"line\">       item.<span class=\"property\">lastName</span>, <span class=\"attr\">id</span>: item.<span class=\"property\">id</span>&#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"filter\"><a href=\"#filter\" class=\"headerlink\" title=\"filter()\"></a>filter()</h3><p>Now, let’s say that for some reason, you only want to include items in the new array that include a last name that starts with ‘B’. Our old style code would look something like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someList = [</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">Dave</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Bush</span>’&#125;,</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">John</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Doe</span>’&#125;,</span><br><span class=\"line\">   …</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"keyword\">var</span> i;</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArray = []; </span><br><span class=\"line\"><span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; someList.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> item = someList[i];</span><br><span class=\"line\">   <span class=\"keyword\">if</span>(item.<span class=\"property\">lastName</span>.<span class=\"title function_\">startsWith</span>(<span class=\"params\">‘B’</span>) &#123;</span><br><span class=\"line\">       newArray.<span class=\"title function_\">push</span>(item);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And once again, this is code we tend to write quite a bit.  So, what if we had a function that did this for us? </p>\n<p>This is exactly what the <code>filter()</code> function is for.  So, rewriting the code above using <code>filter()</code> would look like this.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someList = [</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">Dave</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Bush</span>’&#125;,</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">John</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Doe</span>’&#125;,</span><br><span class=\"line\">   …</span><br><span class=\"line\">];</span><br><span class=\"line\">newArray = someList.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> item.<span class=\"property\">lastName</span>.<span class=\"title function_\">startsWith</span>(‘B’);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Chaining\"><a href=\"#Chaining\" class=\"headerlink\" title=\"Chaining\"></a>Chaining</h3><p>Once again, you can see that we passed in a function that takes the current item as a parameter.  The function returns true or false.  If it returns true, the item gets included in the new array. </p>\n<p>What if we want to filter AND transform the data? </p>\n<p>The temptation for programmers new to this model is to use the map and push the item into an array that was declared outside of the map. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someList = [</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">Dave</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Bush</span>’&#125;,</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">John</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Doe</span>’&#125;,</span><br><span class=\"line\">   …</span><br><span class=\"line\">];</span><br><span class=\"line\"><span class=\"keyword\">var</span> newArray = [];</span><br><span class=\"line\">someList.<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">if</span>(item.<span class=\"property\">lastName</span>.<span class=\"title function_\">startsWith</span>(‘B’)) &#123;</span><br><span class=\"line\">       newArray.<span class=\"title function_\">push</span>(&#123;<span class=\"attr\">fullName</span>: item.<span class=\"property\">firstName</span> + ‘ ‘ +</span><br><span class=\"line\">           item.<span class=\"property\">lastName</span>, <span class=\"attr\">id</span>: item.<span class=\"property\">id</span>&#125;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>But that really isn’t all that much better than if we were just using a for&#x2F;next loop like we’ve been doing.  Old habits die hard. </p>\n<p>Instead, we can take advantage of function chaining. What this allows us to do is to filter and then map. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> someList = [</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">1</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">Dave</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Bush</span>’&#125;,</span><br><span class=\"line\">   &#123;<span class=\"attr\">id</span>: <span class=\"number\">2</span>, <span class=\"attr\">firstName</span>: ‘<span class=\"title class_\">John</span>’, <span class=\"attr\">lastName</span>: ‘<span class=\"title class_\">Doe</span>’&#125;,</span><br><span class=\"line\">   …</span><br><span class=\"line\">];</span><br><span class=\"line\">newArray = someList.<span class=\"title function_\">filter</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> item.<span class=\"property\">lastName</span>.<span class=\"title function_\">startsWith</span>(‘B’);</span><br><span class=\"line\">&#125;.<span class=\"title function_\">map</span>(<span class=\"keyword\">function</span>(<span class=\"params\">item</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> &#123;<span class=\"attr\">fullName</span>: item.<span class=\"property\">firstName</span> + ‘ ‘ +</span><br><span class=\"line\">       item.<span class=\"property\">lastName</span>, <span class=\"attr\">id</span>: item.<span class=\"property\">id</span>&#125;;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>So much cleaner.</p>\n<h3 id=\"reduce\"><a href=\"#reduce\" class=\"headerlink\" title=\"reduce()\"></a>reduce()</h3><p>The final useful function we have available to us for dealing with common array loops is reduce().  reduce() allows to loop through an array and accumulate the items in an array into another array, an object, or a value. </p>\n<p>The reduce() function take two parameters.  The first parameter is a function.  The second parameter is the starting value for the accumulator. </p>\n<p>The function that we pass in takes three parameters.  The current value of the accumulator, the current item, and the current item index.  Most people only use the first two parameters in their function.  The function returns the new accumulator value that then gets passed into the next call to the function. </p>\n<p>So, a really simple example would be, given an array of numbers, add them all up. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> numbers = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>];</span><br><span class=\"line\"><span class=\"keyword\">var</span> total = numbers.<span class=\"title function_\">reduce</span>(<span class=\"keyword\">function</span>(<span class=\"params\">sum, item</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">return</span> sum + item;</span><br><span class=\"line\">&#125;, <span class=\"number\">0</span>);</span><br></pre></td></tr></table></figure>\n\n<p>I’ve also used this to turn an array of name&#x2F;value pairs into an object where the properties are the name and the values are the values that were paired with the names.</p>\n<h2 id=\"Events-as-Arrays\"><a href=\"#Events-as-Arrays\" class=\"headerlink\" title=\"Events as Arrays\"></a>Events as Arrays</h2><p>Now, imagine that events that fire are part of one long continuous array.  An array that never ends. If this were true listening to events would be as familiar as processing an array. </p>\n<p>This is all an observable is.  It treats everything as though it were an array, adds several other functions that give us even greater functionality, and several functions that allow us to deal with the fact that events are not only sequential, but also time based. </p>\n<p>And because events aren’t really arrays, we call this series of items a “stream.”  So, when you read about “streams” while working with Observables think, “list of items.”</p>\n<h3 id=\"Button-Click\"><a href=\"#Button-Click\" class=\"headerlink\" title=\"Button Click\"></a>Button Click</h3><p>For example, let’s say you have a button on your screen and you want to know when it is pressed.  Let’s say your button is represented by a member variable name “myButton”.  In your code, you would listen to a button click by writing code that looks something like: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Observable</span>.<span class=\"title function_\">fromEvent</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">myButton</span>,<span class=\"string\">&#x27;click&#x27;</span>).<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span> </span><br><span class=\"line\">   <span class=\"comment\">/* do something in response to the click here */</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>You will notice that we used the <code>subscribe()</code> function instead of <code>map()</code>.  We still have a <code>map()</code> function.  But, <code>subscribe()</code> is how we tell the application, “we want to start listening to the stream now.”  Otherwise, <code>subscribe()</code> works just like map() does. </p>\n<p>Yes, I know what you’re thinking.  “How is that better than just having the template call an event handler?” </p>\n<p>Well, the fact of the matter is, it really isn’t all that much better.  But, here is where it does make more sense.</p>\n<h3 id=\"Debouncing-Keystrokes\"><a href=\"#Debouncing-Keystrokes\" class=\"headerlink\" title=\"Debouncing Keystrokes\"></a>Debouncing Keystrokes</h3><p>If you’ve been writing application in JavaScript for a while, I’m sure you’ve written classic debounce handlers.  You know.  Don’t actually fire this event until you are no longer receiving change events from the input field. </p>\n<p>I won’t write out the old code here.  It is relatively long, hard to follow, and therefore somewhat complicated. </p>\n<p>But here is how we handle it using Observables. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">Observable</span>.<span class=\"title function_\">fromEvent</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">myInput</span>,<span class=\"string\">&#x27;change&#x27;</span>).<span class=\"title function_\">debounceTime</span>(<span class=\"number\">250</span>).<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">event</span>) =&gt;</span></span><br><span class=\"line\">   <span class=\"comment\">/* do something in response to the input field change here */</span></span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p><code>debounceTime(250)</code> tells the Observable to wait for 250 milliseconds to see if there is some other event that comes in and use that event instead.  That is much easier than the old way.</p>\n<h3 id=\"AJAX\"><a href=\"#AJAX\" class=\"headerlink\" title=\"AJAX\"></a>AJAX</h3><p>While you could handle button clicks and debounce logic using old school JavaScript tricks, in Angular, it is practically impossible to make an AJAX call without using Observables.  This is because the <code>Http</code> service and the <code>HttpClient</code> that was introduced in Angular 4.3 use Observables instead of callbacks or promises to manage dealing with the data that eventually is returned from the AJAX call. </p>\n<p>Since <code>Http</code> and <code>HttpClient</code> are similar, we will continue our discussion of handling AJAX calls using <code>HttpClient</code>.  The main advantage to using <code>HttpClient</code> is that it handles parsing the response into a JavaScript object we can use.  <code>Http</code> just returns the raw Response object and parsing it out is up to us. </p>\n<p><code>HttpClient</code>, on the other hand, returns the object we would have parsed out with <code>Http</code>. </p>\n<p>NOw, assuming you’ve injected HttpClient into the class that is going to use it, a typical get might looks something like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">httpClient</span>.<span class=\"property\">get</span>&lt;<span class=\"title class_\">TypeInfo</span>&gt;(<span class=\"string\">&#x27;/api/get-data&#x27;</span>)</span><br><span class=\"line\">   .<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">x: TypeInfo</span>) =&gt;</span> <span class=\"comment\">/* do something with the data */</span> );</span><br></pre></td></tr></table></figure>\n\n<p>So, walking through this, you may notice that some things look very similar to Promises and then, there are some other things that aren’t so much.  But trust me this gets much better.  We are just starting out small. </p>\n<p>First, what is that <code>TypeInfo</code> thing? </p>\n<p>You see, our get call is what is normally referred to as a “templated method.”  In simple terms, get doesn’t know what type it returns until you tell it.  So, we are telling it that it returns a <code>TypeInfo</code> type.  <code>TypeInfo</code> is just a name I made up.  You would create an interface that is relevant to the type of information that your AJAX code is returning. </p>\n<p>Other than that, we subscribe to the observable that get() returns and process the data. </p>\n<p>Noq, what if our get call fails? </p>\n<p>Oh! We have methods for that. </p>\n<p>First, we can trap failures with a <code>catch()</code> call. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">httpClient</span>.<span class=\"property\">get</span>&lt;<span class=\"title class_\">TypeInfo</span>&gt;(‘/api/get-data’)</span><br><span class=\"line\">   .<span class=\"title function_\">catch</span>(<span class=\"attr\">err</span>: <span class=\"function\"><span class=\"params\">Error</span> =&gt;</span> <span class=\"comment\">/* do something with the error */</span>)</span><br><span class=\"line\">   .<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">x: TypeInfo</span>) =&gt;</span> <span class=\"comment\">/* do something with the data */</span>);</span><br></pre></td></tr></table></figure>\n\n<p>Next, maybe you want to <code>retry</code> the failed call before you give up. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">httpClient</span>.<span class=\"property\">get</span>&lt;<span class=\"title class_\">TypeInfo</span>&gt;(‘/api/get-data’)</span><br><span class=\"line\">   .<span class=\"title function_\">retry</span>(<span class=\"number\">3</span>)</span><br><span class=\"line\">   .<span class=\"title function_\">catch</span>(<span class=\"attr\">err</span>: <span class=\"function\"><span class=\"params\">Error</span> =&gt;</span> <span class=\"comment\">/* do something with the error */</span>)</span><br><span class=\"line\">   .<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">x: TypeInfo</span>) =&gt;</span> <span class=\"comment\">/* do something with the data */</span>);</span><br></pre></td></tr></table></figure>\n\n<p>And because we have a <code>catch()</code>, with must have a <code>finally</code> too, right? </p>\n<p>Try doing all of that with a Promise or a Callback. </p>\n<p>Oh, and did I mention you can cancel AJAX calls using Observables?  Yep.  It’s true.  In fact, my experience has been that if you make the same call from the same service two times in a row, it will cancel the first call before it makes the second.  Pretty cool. </p>\n<p>The final thing that tends to trip people up who are learning about Observables is that nothing in the observable chain executes until you subscribe to the observable and an event happens. </p>\n<p>Once you start getting comfortable with all of the methods you have available to you, you’ll begin to see the power of using Observables over using Promises or Callbacks, even if there are similarities.</p>\n",
            "tags": [
                "angular",
                "observables",
                "RxJS"
            ]
        },
        {
            "id": "http://davembush.github.com/how-to-implement-angular-routing/",
            "url": "http://davembush.github.com/how-to-implement-angular-routing/",
            "title": "How to Implement Angular Routing",
            "date_published": "2017-07-18T10:30:23.000Z",
            "content_html": "<p>In the old world where all of our pages were on the server and every change on the client side required a full round trip to the server, each page was a unique URL on the server.  In the SPA world, we only load one “Page” from the server and the client takes care of making it look like we have moved from one page to another. </p>\n<p>When done well, we can create pages that reuse existing content on the screen causing a minimal screen refresh while still allowing the user to link to a specific “Page” in our application. </p>\n<p>These “Pages” are called “Routes”  As in, here is the route to some code I want to execute. <figure><img src=\"/uploads/2017/07/2017-07-18.png\" title=\"How to Implement Angular 2+ Routing\"> Photo via <a href=\"//visualhunt.com/re/9589c4\">Visual Hunt</a></figure></p>\n<span id=\"more\"></span>  Sounds pretty cool.  But there is a down side that shows up every time someone tries to do this for the first time.  You won’t see this problem until the first time you try to deploy your code because the development server handles this issue for you. \n\n<p>The problem is this.  When a server receives a request from the browser, it tries to find that file on the server.  If it doesn’t exist, the server returns a 404 error.  File not found. </p>\n<p>Most servers provide ways of circumventing this issue by providing rules.  Essentially, you write a server rule that says, “If the browser ask for a file that doesn’t exist, send them back index.html instead.”  You may need to provide exceptions or otherwise refine the rule if your server is also rerouting other traffic. If you are running on an IIS server, <a href=\"/asp-net-angular-js-html5mode/\">I wrote instructions for how to take care of this issue</a> for AngularJS (1.x).  The instructions work for any client side framework that implements routing. </p>\n<p>Assuming you have that end of things working correctly, here are the steps to get basic routing working in your Angular application.</p>\n<h2 id=\"Define-Your-Routes\"><a href=\"#Define-Your-Routes\" class=\"headerlink\" title=\"Define Your Routes\"></a>Define Your Routes</h2><p>While we could easily define our routes in app.module.ts, the code we write will be much easier to maintain if we create a separate module file named app-routes.module.ts.  So to start, create an app-routes.module.ts file right next to your app.module.ts file.  You can do this with the Angular CLI by typing the following in the command line from within the src&#x2F;app directory: </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng g module app-routes</span><br></pre></td></tr></table></figure>\n\n<p>When you create a module with the Angular CLI, it will put it in a sub-directory.  In this case, it created an app-routes sub-directory.  We want it next to our app.module.ts file.  So, now we need to move the module up a directory and remove the app-routes directory. </p>\n<p>Open up the file, it has some stuff in it that we don’t need.  Remove the CommonModule references and the declarations section of the @NgModule decorator. </p>\n<p>In this new file, you will create an empty Routes array, called routes and decorate the class with @NgModule </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppRoutesModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You need to also import Routes and while you are doing that, you might as well import RouterModule because you are going to need that soon too. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">RouterModule</span>, <span class=\"title class_\">Routes</span>&#125; <span class=\"keyword\">from</span> ‘<span class=\"meta\">@anguler</span>/router’; </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppRoutesModule</span> &#123;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Next, in your app.modules.ts file, import AppRoutesModule using both the TypeScript import and as part of the imports section of the @NgModule decorator.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">AppRoutesModule</span>&#125; <span class=\"keyword\">from</span> ‘./app-routes.<span class=\"property\">module</span>’;</span><br><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  …,</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">  …,</span><br><span class=\"line\">  <span class=\"title class_\">AppRoutesModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  …</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>We really haven’t done anything useful yet, we’ve just setup some boilerplate code that will compile so we won’t have to think about it any more. </p>\n<p>Now, back to the app-routes.module.ts file. </p>\n<p>Each element in our Routes array defines a specific route in our system relative to the parent route it is a part of.  At the top level the parent route would be the root of the application. </p>\n<p>Here are the properties that are available to us:</p>\n<h3 id=\"path\"><a href=\"#path\" class=\"headerlink\" title=\"path\"></a>path</h3><p>The path property allows us to specify what path, or URL, will load this route.  If you want the component to load for any path, use ‘<strong>’ as the value.  If you want the component to load for the root element, use ‘’ for the path and specify pathMatch: ‘full’ as another property.  You can also use the value ‘</strong>’ to mean, “match anything.”  We typically use ** to match what would typically be thought of as 404 errors.  For this to work correctly, it should be the last element in your top most route definition.</p>\n<h3 id=\"pathMatch\"><a href=\"#pathMatch\" class=\"headerlink\" title=\"pathMatch\"></a>pathMatch</h3><p>As we’ve already mentioned, pathMatch should be ‘full’ to match ‘’ as the exact path.  But you can also give this value ‘prefix’ to tell it to match any path that starts with the value.  You only need to specify this value if you want to use ‘full’. </p>\n<p>It should also be noted that this value only evaluates the part of the path you are in.  If you use this in a child path, it won’t match the whole path, but only the part that is in the child.</p>\n<h3 id=\"component\"><a href=\"#component\" class=\"headerlink\" title=\"component\"></a>component</h3><p>Component specifies what component should get loaded when the path is matched.</p>\n<h3 id=\"children\"><a href=\"#children\" class=\"headerlink\" title=\"children\"></a>children</h3><p>The children property allows us to specify an array of child paths.</p>\n<h2 id=\"Route-Components\"><a href=\"#Route-Components\" class=\"headerlink\" title=\"Route Components\"></a>Route Components</h2><p>Since our routes will need components, let’s start by creating several components so that we can illustrate routing. </p>\n<p>But first, a short word about how we organize our code. </p>\n<p>In many demos online, the tendency is to put all of our components right under the app directory.  But, in larger applications, I’ve found that it makes a lot more sense to create a route directory under the app directory that we place each of our routes in. </p>\n<p>Now, you might think that we would want to place our child routes as child directories under the routes they are a part of, but the problem with this is that we often have child components in our routes.  How do we know which directory represents a child route and which represents a child component? </p>\n<p>No.  </p>\n<p>What we really want to do is place even the components that represent child routes right under our routes directory.  So, say we have a Page1 route and there is a SubPage route that is a child of Page1.  To make it clear, we put SubPage in a directory named page1.sub-page. </p>\n<p>As for components that are common to multiple pages, we place those in a components directory which is right under the app directory.  This keeps our directories well organized and the code neatly organized as well. </p>\n<p>The next obvious thing that we need to do is that we need to create a routes directory.  Do that now. </p>\n<p>Now, at the command line, inside the new routes directory, execute the following Angular CLI commands </p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng g component page1</span><br><span class=\"line\">ng g component page2</span><br><span class=\"line\">ng g component page1-subpage</span><br></pre></td></tr></table></figure>\n\n<p>As you executed each command, it should have created a directory for each component with the corresponding css, html, ts and spec files.  Then it updated the app.module.ts file for you so that the components are available for use in the system. </p>\n<p>You may also notice that we created the component as page1-subpage instead of page1.subpage.  The reason for this is that the CLI doesn’t like period separation of file names.  Now, the next thing we are going to do is change the directory name to page1.subpage.  You will also need to change the TypeScript import line that references this directory in your app.module.ts file. </p>\n<p>Now that we have components to page to, let’s create our route definitions.  Back to the Routes array in our app-routes.module.ts file. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: ‘page1’,</span><br><span class=\"line\">  <span class=\"attr\">children</span>: [</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: ‘’,</span><br><span class=\"line\">    <span class=\"attr\">pathMatch</span>: ‘full’,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: ‘<span class=\"title class_\">Page1Component</span>’ &#125;,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"attr\">path</span>: ‘subpage’,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">Page1SubpageComponent</span></span><br><span class=\"line\">  &#125;]&#125;, &#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: ‘page2’,</span><br><span class=\"line\">  <span class=\"attr\">component</span>: <span class=\"title class_\">Page2Component</span></span><br><span class=\"line\">&#125;]</span><br></pre></td></tr></table></figure>\n\n<p>The first definition may look a bit odd.  We are setting up a route to page1, but the route is the children.  Then in the children we define a route to ‘’.  This is where the Page1Component is specified as the component we want to load. </p>\n<p>You will also note that we specified <code>pathMatch: &#39;full&#39;</code> for the Page1Component.  This is because we only want this component to be loaded when the child path is empty. </p>\n<p>Using this definition, everything loads into the top level router-outlet.  If we placed Page1Component at the same level as we defined the page1 path, then Angular would expect to have a router-outlet in Page1Component where Pag1SubpageComponent would be loaded. </p>\n<p>Needless to say, you need to be careful how you define your routes. </p>\n<p>Next, you will need to import the three components using the TypeScript import statement. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">Page1Component</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./routes/page1/page1.component&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">Page2Component</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./routes/page2/page2.component&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">Page1SubpageComponent</span>&#125;</span><br><span class=\"line\">  <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./routes/page1.subpage/page1-subpage.component&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Now that everything is defined, we just need to tell Angular where we want these components to show up.  For right now, open the app.component.html file and remove everything that is there and add the router-outlet component. </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">router-outlet</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">router-outlet</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Now, <code>router-outlet</code> is a component that is defined in the RouterModule, so we need to import that in the imports section of our AppRoutesModule.  But we don’t just import the RouterModule, we use RouterModule.forRoot() and pass in the route array we just defined into forRoot(). </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [<span class=\"title class_\">RouterModule</span>.<span class=\"title function_\">forRoot</span>(routes)],</span><br><span class=\"line\">  <span class=\"attr\">exports</span>: [<span class=\"title class_\">RouterModule</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AppRoutesModule</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>There is one final tweak that we need to make to our route definition.  Right now, if you go to the root of the application, there isn’t a component defined for it.  To fix this, we are going to add the following definition at the top of  our routes: </p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  path<span class=\"punctuation\">:</span> &#x27;&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  redirectTo<span class=\"punctuation\">:</span> &#x27;page1&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  pathMatch<span class=\"punctuation\">:</span> &#x27;full&#x27;</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br></pre></td></tr></table></figure>\n\n<p>You need <code>pathMatch: &#39;full&#39;</code> to tell the router to only match this rule when the path is ‘’ exactly, just like we did with the Page1Component in the children list.  Otherwise, it will match everything. </p>\n<p>The <code>redirectTo: &#39;page1&#39;</code> part tells it to redirect to the page1 path when this rule is true.</p>\n<h2 id=\"Lazy-Loading\"><a href=\"#Lazy-Loading\" class=\"headerlink\" title=\"Lazy Loading\"></a>Lazy Loading</h2><p>I realize that I still need to show you how to navigate to routes in your application, but first let’s look at lazy loading the routes. </p>\n<p>In the past, when building a Single Page Application, the custom was to load all of the JavaScript code we needed for the page up front.  But, if you have multiple pages in your application, some of those may never be needed by your user.  So, what are we doing loading stuff that will never get used? </p>\n<p>No, it is better to load only what we need when we need it.  While it might take longer if you totaled up each load, the user perceives the experience as faster.  Therefore what we want to do is to make each of our pages load as we need them. </p>\n<p>To do this, we need to create a module for each of the components that represent our top level routes.  We want to import modules and services into the module that is closest to where we need them.  This is why.  By only importing things where we need them, Angular can create the smallest package necessary all up and down the dependency tree. </p>\n<p>To make things easy and to do them the way you would have done them if you had done it this way to begin with, let’s delete all of the sub-directories under routes.  It’s OK.  We aren’t losing any work that we can’t quickly get back.  We haven’t added any code to these routes yet. </p>\n<p>At the command line, navigate to the routes directory and then type in the following Angular-CLI commands:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ng g module page1</span><br><span class=\"line\">ng g component page1</span><br><span class=\"line\">ng g module page1-subpage</span><br><span class=\"line\">ng g component page1-subpage</span><br><span class=\"line\">ng g module page2</span><br><span class=\"line\">ng g component page2</span><br></pre></td></tr></table></figure>\n\n<p>And then, just like we did the first time, rename the page1-subpage directory to page1.subpage. </p>\n<p>Now, go to the app.modules.ts file and remove the references to the Page1, Page2, and Page1Subpage components anywhere you see them. </p>\n<p>Do the same thing in the app-routes.module.ts file. </p>\n<p>Now, the way we define our routes changes slightly.  We will still need the redirect route, but everything else changes. </p>\n<p>The key to making this work is the property <code>loadChildren</code>, which is a string in the format of: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;pathToModule#ModuleClassName&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>We’ll work from the top down.  Change the routes array in app-routes.module.ts to look like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">redirectTo</span>: <span class=\"string\">&#x27;page1&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">pathMatch</span>: <span class=\"string\">&#x27;full&#x27;</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;page1&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">loadChildren</span>: <span class=\"string\">&#x27;./routes/page1/page1.module#Page1Module&#x27;</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;page2&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">loadChildren</span>: <span class=\"string\">&#x27;./routes/page2/page2.module#Page2Module&#x27;</span></span><br><span class=\"line\">&#125;]</span><br></pre></td></tr></table></figure>\n\n<p>When we try to access something from page1, it will load the Page1Module and try to resolve it from there.  When we try to access something from page2, it will load the Page2Module.  Both of these happen during run time. </p>\n<p>Next, go to page1.module.ts and, import RouterModule and add the following to the imports section of @NgModule.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">RouterModule</span>.<span class=\"title function_\">forChild</span>([&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">pathMatch</span>: <span class=\"string\">&#x27;full&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">component</span>: <span class=\"title class_\">Page1Component</span></span><br><span class=\"line\">&#125;, &#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;subpage&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">loadChildren</span>: ‘../page1.<span class=\"property\">subpage</span>/page1-subpage.<span class=\"property\">module</span>#<span class=\"title class_\">Page1SubpageModule</span>’</span><br><span class=\"line\">&#125;]),</span><br></pre></td></tr></table></figure>\n\n<p>Next move over to page2 and do something similar.  Since page2 doesn’t have a sub-route, you only need, one route. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">RouterModule</span>.<span class=\"title function_\">forChild</span>([&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">pathMatch</span>: <span class=\"string\">&#x27;full&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">component</span>: <span class=\"title class_\">Page2Component</span></span><br><span class=\"line\">&#125;]),</span><br></pre></td></tr></table></figure>\n\n<p>And again, similarly for page1-subpage. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">RouterModule</span>.<span class=\"title function_\">forChild</span>([&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">pathMatch</span>: <span class=\"string\">&#x27;full&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">component</span>: <span class=\"title class_\">Page1SubpageComponent</span></span><br><span class=\"line\">&#125;]),</span><br></pre></td></tr></table></figure>\n\n<p>If you haven’t already, move your command-line prompt back to the root of the project and type</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n\n<p>To start the server and compile your code.  If everything compiles, you should see 3 chunk files along with the other files we saw when we compiled the code without lazy loading. One each for each of the routes. </p>\n<p>Run the app in your browser now to make sure it works correctly. </p>\n<p>See how easy that was?  It isn’t really that much harder than specifying the routes like we did the first time, but we get huge benefits in performance.</p>\n<h2 id=\"Passing-Parameters\"><a href=\"#Passing-Parameters\" class=\"headerlink\" title=\"Passing Parameters\"></a>Passing Parameters</h2><p>The last thing you need to know about is how to pass parameters.  You would normally do this when you are coming from an existing list of items.  Each item has some sort of unique identifier.  We click some link and that takes us to another page to show details or to edit the content.  For our purposes here, it doesn’t matter. </p>\n<p>To specify that a route takes a parameter, use colon notation: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">path</span>: <span class=\"string\">&#x27;detail/:id&#x27;</span> </span><br></pre></td></tr></table></figure>\n\n<p>Angular knows it is a parameter when you use a URL to get to it because of the location.</p>\n<h2 id=\"Retrieving-Parameters\"><a href=\"#Retrieving-Parameters\" class=\"headerlink\" title=\"Retrieving Parameters\"></a>Retrieving Parameters</h2><p>Let’s say you have a component that represents a route with a parameter.  For that to be useful, you’ll need to pull the parameter out of the route information. </p>\n<p>To do this, you’ll need to inject <code>ActivatedRoute</code> into the component.  Then when you need the parameter(s) you can use: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">route.<span class=\"property\">params</span>.<span class=\"title function_\">take</span>(<span class=\"number\">1</span>).<span class=\"title function_\">subscribe</span>(</span><br><span class=\"line\">  <span class=\"function\"><span class=\"params\">params</span> =&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">// Use params[&#x27;id&#x27;], where ‘id’ is the name</span></span><br><span class=\"line\">  <span class=\"comment\">// we gave the parameter in the path.</span></span><br><span class=\"line\">  );</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Route-Navigation\"><a href=\"#Route-Navigation\" class=\"headerlink\" title=\"Route Navigation\"></a>Route Navigation</h2><p>Now that we have routes in place, we need to discuss how to navigate from one route to another.  The temptation, having just used URLs to go from one to the other, would be to use hyperlinks and put the information in the href attribute. </p>\n<p>No doubt, you could probably get that to work, but the main problem with using that method is that there is no safeguards to make sure that the URL you use to navigate when you are developing will work when you move the site to another environment. </p>\n<p>The reason for this is that we have to set the base href for the site.  During development this is normally ‘&#x2F;’.  But when you go to production, it could be some sub directory. </p>\n<p>Also, because of this base href, every page&#x2F;route we land on is still relative to that base.  This means that every route we want to navigate to would have to be hard wired to the base of the site, and again, that’s assuming that the site will always be in the same relative location when it is deployed. </p>\n<p>Now, if we can’t using a regular URL to navigate, what do we use instead?</p>\n<h3 id=\"routerLink\"><a href=\"#routerLink\" class=\"headerlink\" title=\"routerLink\"></a>routerLink</h3><p>You use the routeLink directive added to your anchor tag.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> [<span class=\"attr\">routerLink</span>]=<span class=\"string\">&quot;[&#x27;/page1&#x27;]&quot;</span>&gt;</span>go here<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>This may look a little different from what you expected, so let’s break this down. </p>\n<p>The routerLink directive takes an array.  Since we can’t pass an array as a string, the only way we can pass it is by evaluating it at run time.  Remember, the square bracket syntax is an indication to the Angular compiler that what we are assigning is something that should be evaluated.  Typically this would be pointing to a function or variable in our TypeScript code.  In this case, we are pointing to a literal array.  Everything between the opening and closing quotes is JavaScript. </p>\n<p>As for the actual parameter, the string in the single element array works much like you would use a URL.  The forward slash says to start at the root of the web application (instead of the root of the domain like a URL would.)  And the page1 is the route we’ve already defined.  If you leave the forward slash off, it is relative to the current route. </p>\n<p>But what about passing parameters? </p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> [<span class=\"attr\">routerLink</span>]=<span class=\"string\">&quot;[&#x27;/page1&#x27;, someVariable]&quot;</span>&gt;</span>go here<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Each comma delimited value represents a segment of your route.</p>\n<h3 id=\"Router-navigate\"><a href=\"#Router-navigate\" class=\"headerlink\" title=\"Router.navigate()\"></a>Router.navigate()</h3><p>The other way you might want to cause navigation to a page to occur is by using the navigate() method hanging off the Router class.  Using dependency injection, you inject the Router into the class that needs to use it and then use that instance to call navigate().  The parameter you pass in looks very similar to what you used for routerLink. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"title function_\">navigate</span>(‘/page1’,someVariable);</span><br></pre></td></tr></table></figure>\n\n<p>Yes, both routerLink and Router.navigate() both support URL like references using ‘.&#x2F;path’ or ‘..&#x2F;path’.</p>\n<h2 id=\"Where-Am-I-Now\"><a href=\"#Where-Am-I-Now\" class=\"headerlink\" title=\"Where Am I Now?\"></a>Where Am I Now?</h2><p>The last part of routing you will commonly need to know about is detecting what the current route is.  Once again this will require you to inject the Router object into the component that needs the information.  Once you have the router object, you can use code like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.<span class=\"property\">routerState</span>.<span class=\"property\">snapshot</span>.<span class=\"property\">url</span>;</span><br></pre></td></tr></table></figure>\n\n<p>This will get the current route url.  I normally grap this as part of listening for the router’s NavigationEnd. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">router</span>.<span class=\"property\">events</span></span><br><span class=\"line\">  .<span class=\"title function_\">filter</span>(<span class=\"function\"><span class=\"params\">arg</span> =&gt;</span> arg <span class=\"keyword\">instanceof</span> <span class=\"title class_\">NavigationEnd</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">arg</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">selectedTab</span> = router.<span class=\"property\">routerState</span>.<span class=\"property\">snapshot</span>.<span class=\"property\">url</span>.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;/&#x27;</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">selectedTab</span>;</span><br><span class=\"line\">  &#125;).<span class=\"title function_\">subscribe</span>();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Guards\"><a href=\"#Guards\" class=\"headerlink\" title=\"Guards\"></a>Guards</h2><p>Guards control access to our routes.  What happens if you have a route that only certain people should have access to.  Like an admin page.  Sure, you could leave the link off so no one can click the link to get to the page, but that doesn’t prevent someone from pasting the link to the forbidden page into the address bar of the browser and getting there anyhow. </p>\n<p>In Angular, we have four kinds of guards and two ways of creating them. </p>\n<p>The four types of guards are:</p>\n<ul>\n<li>CanActivate</li>\n<li>CanActivateChild</li>\n<li>CanDeactivate</li>\n<li>CanLoad</li>\n</ul>\n<p>If you follow my advice and always lazy load your routes, than the two you will most often use are CanLoad and CanDeactivate.  CanLoad provides rules for lazy loading a module.  CanDeactive provides rules for leaving a route. </p>\n<p>If you decide to bundle routes together, then you may also need CanActivate and CanActivateChild.  CanActivate is exactly what it sounds like.  Can I activate this route?  CanActivateChild would go on a route definition that has a children’s collection.  This rule determines if I can activate the children. </p>\n<p>To use Guards in our application, the first thing we need to do is to define them.  The easiest way to define them is as a function that returns a boolean value, a boolean Observable, or a boolean Promise.  For our purposes here, we will just return a boolean value.  But when you have some asynchronous call you need to make to determine if we should return true or false, you’ll want to return an Observable or a Promise.  I favor Observables. </p>\n<p>The definition for a Guard rule looks like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [&#123;</span><br><span class=\"line\">    <span class=\"attr\">provide</span>: <span class=\"string\">&#x27;ruleNameHere&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">useValue</span>: <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Then, to use the rule, you assign the appropriate rule the name of the rule. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;page1&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">canLoad</span>: [<span class=\"string\">&#x27;ruleNameHere&#x27;</span>],</span><br><span class=\"line\">  <span class=\"attr\">loadChildren</span>: <span class=\"string\">&#x27;./routes/page1/page1.module#Page1Module&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Notice that canLoad, as well as the other guard properties, takes an array.  This allows you to apply multiple rules to a route. </p>\n<p>The other way of defining a route is as a class that implements an interface, or multiple interfaces that include CanActivate, CanActivateChild, CanDeactivate, and CanLoad.  You them implement the corresponding functions in your class. </p>\n<p>Now, to include the rule you use the Class rather than a string: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  <span class=\"attr\">path</span>: <span class=\"string\">&#x27;page1&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">canLoad</span>: [<span class=\"title class_\">RuleClassHere</span>],</span><br><span class=\"line\">  <span class=\"attr\">loadChildren</span>: <span class=\"string\">&#x27;./routes/page1/page1.module#Page1Module&#x27;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"But-wait-there’s-more-…\"><a href=\"#But-wait-there’s-more-…\" class=\"headerlink\" title=\"But wait, there’s more …\"></a>But wait, there’s more …</h2><p>Believe it or not, there is even more to routing than we’ve discussed here.  But we’ll leave that for another day or this post will turn into a <a href=\"https://davembush.github.io/get-started-with-angular/\">book</a>. </p>\n",
            "tags": [
                "angular",
                "routing"
            ]
        },
        {
            "id": "http://davembush.github.com/upload-an-image-as-a-file-in-angular/",
            "url": "http://davembush.github.com/upload-an-image-as-a-file-in-angular/",
            "title": "Upload an Image as a File in Angular",
            "date_published": "2017-07-04T10:30:08.000Z",
            "content_html": "<p>This past week, I needed to be able to upload an image in my application to the server as a file so that I could crop it and upload it. </p>\n<p>Now, uploading an image that you pulled up using the file upload control is relatively straight forward.  But, in our case, the image we want to be able to upload didn’t always come from the user’s file system.  This causes two problems. </p>\n<p>First, you can’t crop an image you retrieved from a different URL using the HTML Canvas because of Cross Origin restrictions and second, you can’t upload the file using the standard file upload mechanism because you didn’t get it from the file system. <figure><img src=\"/uploads/2017/07/2017-07-04.jpg\" title=\"Upload an Image as a File in Angular\"> Photo via <a href=\"//visualhunt.com/re/3bc74d\">Visual Hunt</a></figure></p>\n<span id=\"more\"></span>\n\n<h2 id=\"Image-to-Data-without-Canvas\"><a href=\"#Image-to-Data-without-Canvas\" class=\"headerlink\" title=\"Image to Data without Canvas\"></a>Image to Data without Canvas</h2><p>Now, the standard way of converting an Image to a data URL is to</p>\n<ul>\n<li>create a new Image,</li>\n<li>set the onload event handler to a function</li>\n<li>set the Image src attribute to the file</li>\n<li>in the onload function,<ul>\n<li>draw the image onto the canvas</li>\n<li>call canvas.toDataUrl(mimeType) to get the data url.</li>\n</ul>\n</li>\n</ul>\n<p>It is pretty trivial code: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> canvas = <span class=\"variable language_\">document</span>.<span class=\"title function_\">createElement</span>(<span class=\"string\">&quot;canvas&quot;</span>);</span><br><span class=\"line\">context = canvas.<span class=\"title function_\">getContext</span>(<span class=\"string\">&#x27;2d&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> base_image = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">base_image.<span class=\"property\">src</span> = <span class=\"string\">&#x27;img/base.png&#x27;</span>;</span><br><span class=\"line\">base_image.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  context.<span class=\"title function_\">drawImage</span>(base_image, <span class=\"number\">100</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">  <span class=\"keyword\">let</span> dataUrl = canvas.<span class=\"title function_\">toDataURL</span>(<span class=\"string\">&#x27;image/jpeg&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>But, the trouble starts when you use a URL that doesn’t originate from the file system, or the same domain as the application your are running. </p>\n<p>The trick is to read the image using an XMLHttpRequest for foriegn URLs and then use a FileReader object and call readAsDataURL passing the result of the XMLHttpRequest.read. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> image = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> self = <span class=\"variable language_\">this</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> reader = <span class=\"keyword\">new</span> <span class=\"title class_\">FileReader</span>();</span><br><span class=\"line\">reader.<span class=\"property\">onloadend</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    reader.<span class=\"property\">onloadend</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"comment\">// make sure the image is loaded before we go</span></span><br><span class=\"line\">    <span class=\"comment\">// after width and height;</span></span><br><span class=\"line\">    image.<span class=\"property\">src</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    image.<span class=\"property\">onload</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        image.<span class=\"property\">onload</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"comment\">// do something with the new image here</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    image.<span class=\"property\">src</span> = reader.<span class=\"property\">result</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">image.<span class=\"property\">onload</span> = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    image.<span class=\"property\">onload</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> xhr = <span class=\"keyword\">new</span> <span class=\"title class_\">XMLHttpRequest</span>();</span><br><span class=\"line\">    xhr.<span class=\"property\">onload</span> = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">        reader.<span class=\"title function_\">readAsDataURL</span>(xhr.<span class=\"property\">response</span>);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    xhr.<span class=\"title function_\">open</span>(<span class=\"string\">&#x27;GET&#x27;</span>, image.<span class=\"property\">src</span>);</span><br><span class=\"line\">    xhr.<span class=\"property\">responseType</span> = <span class=\"string\">&#x27;blob&#x27;</span>;</span><br><span class=\"line\">    xhr.<span class=\"title function_\">send</span>();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(action.<span class=\"property\">payload</span> <span class=\"keyword\">instanceof</span> <span class=\"title class_\">File</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// won&#x27;t be using image.onload so we need to turn it off</span></span><br><span class=\"line\">    image.<span class=\"property\">onload</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    reader.<span class=\"title function_\">readAsDataURL</span>(action.<span class=\"property\">payload</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// this triggers image.onload which triggers reader.readAsDataURL</span></span><br><span class=\"line\">    image.<span class=\"property\">src</span> = action.<span class=\"property\">payload</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Now we can put the image using the data URL on the canvas and the canvas doesn’t know we got it from a foreign URL any more so we no longer get a cross origin URL. </p>\n<p>The entry point for this code is on line 27.  You see  that if we are working with a File, we just use the FileReader directly.  But if we are using http, we go through the XMLHttpRequest.</p>\n<h2 id=\"Fake-File-Upload\"><a href=\"#Fake-File-Upload\" class=\"headerlink\" title=\"Fake File Upload\"></a>Fake File Upload</h2><p>The only problem with this is that now we no longer have the file point, so if we want to upload the file, as a file, to the server we have come up with some way of creating a fake file object.  And believe it or not, that is a lot easier than you might think. </p>\n<p>You see, a File object is just a kind of Blob object.  So, all we really need to do is to create a Blob.  But, we have one additional issue.  Our image is in base 64 and we need to convert it to a binary byte array. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">b64toFile</span>(dataURI): <span class=\"title class_\">File</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// convert the data URL to a byte string</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> byteString = <span class=\"title function_\">atob</span>(dataURI.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">1</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// pull out the mime type from the data URL</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> mimeString = dataURI.<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;,&#x27;</span>)[<span class=\"number\">0</span>].<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;:&#x27;</span>)[<span class=\"number\">1</span>].<span class=\"title function_\">split</span>(<span class=\"string\">&#x27;;&#x27;</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Convert to byte array</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> ab = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayBuffer</span>(byteString.<span class=\"property\">length</span>);</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ia = <span class=\"keyword\">new</span> <span class=\"title class_\">Uint8Array</span>(ab);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> i = <span class=\"number\">0</span>; i &lt; byteString.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">        ia[i] = byteString.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Create a blob that looks like a file.</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> blob = <span class=\"keyword\">new</span> <span class=\"title class_\">Blob</span>([ab], &#123; <span class=\"string\">&#x27;type&#x27;</span>: mimeString &#125;);</span><br><span class=\"line\">    blob[<span class=\"string\">&#x27;lastModifiedDate&#x27;</span>] = (<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()).<span class=\"title function_\">toISOString</span>();</span><br><span class=\"line\">    blob[<span class=\"string\">&#x27;name&#x27;</span>] = <span class=\"string\">&#x27;file&#x27;</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">    <span class=\"comment\">// Figure out what extension the file should have</span></span><br><span class=\"line\">    <span class=\"keyword\">switch</span>(blob.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;image/jpeg&#x27;</span>:</span><br><span class=\"line\">            blob[<span class=\"string\">&#x27;name&#x27;</span>] += <span class=\"string\">&#x27;.jpg&#x27;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&#x27;image/png&#x27;</span>:</span><br><span class=\"line\">            blob[<span class=\"string\">&#x27;name&#x27;</span>] += <span class=\"string\">&#x27;.png&#x27;</span>;</span><br><span class=\"line\">            <span class=\"keyword\">break</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// cast to a File</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &lt;<span class=\"title class_\">File</span>&gt;blob;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You can use the resulting “File” anywhere you would use a File you had retrieved from the file system.</p>\n<h2 id=\"Upload-via-Http\"><a href=\"#Upload-via-Http\" class=\"headerlink\" title=\"Upload via Http\"></a>Upload via Http</h2><p>The last bit of this is that we need to upload this via the Http service.  This is going to be harder to show with code because it depends on what you need to do. </p>\n<p>In my case, I needed to just upload the file, so the post was pretty straight forward.  I used an Http.post() and passed the returned “file” as the data parameter. </p>\n<p>But, you may need to upload it by wrapping the file in a Form object and specifying varying headers.</p>\n<h2 id=\"The-End\"><a href=\"#The-End\" class=\"headerlink\" title=\"The End\"></a>The End</h2><p>I know it is a relatively short post, but I hope it is helpful to someone.  There are a lot of examples out there of how to do this in JavaScript and jQuery, but I was unable to find anything that was specific to TypeScript and Angular.</p>\n",
            "tags": [
                "angular",
                "images",
                "file upload"
            ]
        },
        {
            "id": "http://davembush.github.com/real-world-rxjs-marble-testing-revealed/",
            "url": "http://davembush.github.com/real-world-rxjs-marble-testing-revealed/",
            "title": "Real World RxJS Marble Testing Revealed",
            "date_published": "2017-06-13T10:30:25.000Z",
            "content_html": "<p>There must be some evil plot to keep this information a secret because whenever I search for how to use RxJS Marble Testing all I see is how to use it to write tests for RxJS.  Well I’ve finally “cracked the code.” </p>\n<p>In this article you’ll learn the basics of RxJS Marble Testing and how to apply Marble Testing to your own code.</p>\n<figure>![](/uploads/2017/06/2017-06-13.jpg \"Real World RxJS Marble Testing Revealed\") Photo via [Visualhunt](//visualhunt.com/re/9662e0)</figure>\n\n<span id=\"more\"></span> \n\n<h2 id=\"It-All-Started-When-…\"><a href=\"#It-All-Started-When-…\" class=\"headerlink\" title=\"It All Started When …\"></a>It All Started When …</h2><p>It all started about a month ago when I needed to write a unit test for code that updated the screen once every 15 seconds. Writing a test that would simulate the clock moving forward 15 seconds in old school JavaScript would have been pretty easy.  But I had written my code using RxJS instead of the old school <code>setTimeout()</code> method we’ve been using for this kind of feature in the past. </p>\n<p>Specifically, I had used <code>Observable.timer(0, 15000);</code> </p>\n<p>My first attempt to write tests for this were based on the assumption that, under the hood, <code>setTimeout()</code> was still being used. Just a simple matter of mocking the clock and advancing the timer. Right?</p>\n<p>Wrong!</p>\n<p>Then my initial search brought me to the NgRX 4 way of writing tests for Observables. Only, I didn’t find that out until I had written some code that didn’t work. </p>\n<p>Eventually, I found this thing called Marble Testing. But, as I’ve already mentioned, all the examples I’ve found for how to write test are for written test for the various methods available in the RxJS library. </p>\n<p>I’m guess, if you are still reading, I’ve described your journey as well.</p>\n<h2 id=\"Assumptions\"><a href=\"#Assumptions\" class=\"headerlink\" title=\"Assumptions\"></a>Assumptions</h2><p>For the remainder of this article, I’m going to assume you know how to use RxJS. If you don’t there is already a lot of good information available on that topic that you should easily be able to find by using one of the search engines.</p>\n<p>I’m also going to describe how to use marbles in your tests using Jasmine. I use Jasmine because that is the engine all the frameworks that I use end up using. There are other tools that may or may not be better. But I have no reason to leave what everyone else has already picked as a defacto standard.</p>\n<h2 id=\"Marble-Basics\"><a href=\"#Marble-Basics\" class=\"headerlink\" title=\"Marble Basics\"></a>Marble Basics</h2><p>Since there is a lot of detail on the basics of using Marbles, I only plan on summarizing what you need to know here.  For more details, check out <a href=\"//github.com/ReactiveX/rxjs/blob/master/doc/writing-marble-tests.md\">the documentation</a>.</p>\n<h3 id=\"Create-Observables\"><a href=\"#Create-Observables\" class=\"headerlink\" title=\"Create Observables\"></a>Create Observables</h3><p>First, you can create either hot observables or cold observables. To do this, you’ll need to create an instance of <code>TestScheduler</code> and then you call either <code>createHotObservable()</code> or <code>createColdObservable()</code> passing a string that defines what you want your observables to do. </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> testScheduler = <span class=\"keyword\">new</span> <span class=\"title class_\">TestScheduler</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> hotObservable = testScheduler.<span class=\"title function_\">createHotObservable</span>(hotMarbleString);</span><br><span class=\"line\"><span class=\"keyword\">const</span> coldObservable = testScheduler.<span class=\"title function_\">createColdObservable</span>(coldMarbleString);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Marble-Syntax\"><a href=\"#Marble-Syntax\" class=\"headerlink\" title=\"Marble Syntax\"></a>Marble Syntax</h3><ul>\n<li><code>&quot;-&quot;</code> time: 10 “frames” of time passage.</li>\n<li><code>&quot;|&quot;</code> complete: The successful completion of an observable. This is the observable producer signaling <code>complete()</code></li>\n<li><code>&quot;#&quot;</code> error: An error terminating the observable. This is the observable producer signaling <code>error()</code></li>\n<li><code>&quot;a&quot;</code> any character: All other characters represent a value being emitted by the producer signaling <code>next()</code></li>\n<li><code>&quot;()&quot;</code> sync groupings: When multiple events need to single in the same frame synchronously, parenthesis are used to group those events. You can group next values, a completion or an error in this manner. The position of the initial <code>(</code>determines the time at which its values are emitted.</li>\n<li><code>&quot;^&quot;</code> subscription point: (hot observables only) shows the point at which the tested observables will be subscribed to the hot observable. This is the “zero frame” for that observable, every frame before the <code>^</code> will be negative.</li>\n</ul>\n<p>The most simple of observables using marbles would look like this: </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">&#x27;a|&#x27;</span></span><br></pre></td></tr></table></figure>\n\n<p>This would cause an observable event to fire right away and it would pass “a” as the data for the observable.  The observable would then end because the | comes next. </p>\n<p>In the case of the timer I was testing, I don’t need the data, I just need the “event” to fire so my code runs.</p>\n<h2 id=\"Marbles-as-Mocks\"><a href=\"#Marbles-as-Mocks\" class=\"headerlink\" title=\"Marbles as Mocks\"></a>Marbles as Mocks</h2><p>So far, I probably haven’t told you anything that you couldn’t already figure out by doing a basic search.  But, the question remains, how do we use this marble stuff in our own test? </p>\n<p>And the answer that no one seems to be talking about is that you use marbles to mock out the real observable just like you might create a mock object to replace a real object in any other test. </p>\n<p>In the case of the timer problem above, what I needed to do was to make sure that <code>Observable.timer(0, 15000);</code> returns an observable that was created with a marble instead of an observable created with the timer.  In Jasmine, we do that with <code>spyOn()</code> </p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">testScheduler = <span class=\"keyword\">new</span> <span class=\"title class_\">TestScheduler</span>(<span class=\"literal\">null</span>);</span><br><span class=\"line\"><span class=\"title function_\">spyOn</span>(<span class=\"title class_\">Observable</span>, <span class=\"string\">&#x27;timer&#x27;</span>)</span><br><span class=\"line\">  .<span class=\"property\">and</span></span><br><span class=\"line\">  .<span class=\"title function_\">returnValue</span>(testScheduler.<span class=\"title function_\">createHotObservable</span>(<span class=\"string\">&#x27;---a|&#x27;</span>));</span><br></pre></td></tr></table></figure>\n\n<p>The rest of your code really doesn’t care what kind of observable it is, it will do whatever it is it has been coded to do. </p>\n<p>The only thing you need to do to make sure the observable and subscribes do their thing is to make sure you call <code>flush()</code> on the <code>TestScheduler</code> instance prior to running an <code>expect()</code> in your Jasmine test.</p>\n<h2 id=\"Other-Uses\"><a href=\"#Other-Uses\" class=\"headerlink\" title=\"Other Uses\"></a>Other Uses</h2><p>What I’ve shown so far takes care of my 15 second refresh issue. But now, what if I have an observable that expects data? For example, how would I write a test that uses an observable based on an AJAX request as a dependency? In Angular, this would be Http. </p>\n<p>This is actually very simple. The second parameter to either <code>createHotObservable()</code> or <code>createColdObservable()</code> is the data you want to send on to the subscribe when it hits the associated marble. You pass this in as an object literal. So, just to keep things simple. Say that when you hit the “a” marble, you want to pass the subscribe an object that has a first name and a last name. Your code might look something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">testScheduler</span><br><span class=\"line\">  .<span class=\"title function_\">createHotObservable</span>(</span><br><span class=\"line\">    <span class=\"string\">&#x27;-a|&#x27;</span>,</span><br><span class=\"line\">    &#123;<span class=\"attr\">a</span>: &#123;<span class=\"attr\">firstName</span>: <span class=\"string\">&#x27;Dave&#x27;</span>, <span class=\"attr\">lastName</span>: <span class=\"string\">&#x27;Bush&#x27;</span>&#125;&#125;</span><br><span class=\"line\">  );</span><br></pre></td></tr></table></figure>\n\n<p>By using this type of marble mocking, you could not just create unit tests, but you could also create End to End tests that use marbles to return consistent data rather than hitting the back end. Obviously, you would still need to write tests that ensure your back end is going to return the same type of data, but I see that as a separate issue from ensuring that the front end does everything it should do as a system. Anyhow, it is an option.</p>\n",
            "tags": [
                "angular",
                "RxJS",
                "Marble Testing"
            ]
        },
        {
            "id": "http://davembush.github.com/ngrx-store-coding-sanity-epiphany/",
            "url": "http://davembush.github.com/ngrx-store-coding-sanity-epiphany/",
            "title": "NgRX/Store Coding Sanity Epiphany",
            "date_published": "2017-06-06T10:30:44.000Z",
            "content_html": "<p>Maybe this is all obvious to you, but since I don’t see anyone talking about this when I search for “how to do NgRX” or the various variants, I thought I’d call it out in this weeks post.</p>\n<p>If you haven’t been following along, you’ll want to review <a href=\"/tags/ngrx/\">my previous posts on NgRX</a>.</p>\n<figure>![](/uploads/2017/06/2017-06-06.jpg \"NgRX/Store Coding Sanity Epiphany\")<figcaption>Photo credit: [spcbrass](//www.flickr.com/photos/spcbrass/394867154/) via [Visual Hunt](//visualhunt.com/re/cff786) / [ CC BY-SA](//creativecommons.org/licenses/by-sa/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<p>If it isn’t clear yet, I’m still sorting out a lot of this Angular&#x2F;Redux&#x2F;NgRX stuff. But as I was working on my current project this week, I realized I have WAY too much code in my presentation layer.</p>\n<h2 id=\"The-Epiphany\"><a href=\"#The-Epiphany\" class=\"headerlink\" title=\"The Epiphany\"></a>The Epiphany</h2><p>I have two main screens I’m working on. As you read the articles on the Internet that explain how to use this pattern or the Redux pattern it was derived from, you’ll quickly learn that you want to work with a “Smart Component.” This component is kind of a traffic cop. It uses observables to listen to state change in your Store and it sends actions to, primarily, update the database and change the store’s state. From what I’ve been able to gather, the expectation is that a lot of the logic that would be needed to actually process the data is going to go in this smart component. The first screen I worked on, followed this basic pattern. This put a whole crap load of code in my smart component.</p>\n<p>On the second page, I kind of stumbled onto what I believe is a cleaner model. I realized that I was hanging onto data in my smart component that was also in my store. That seems kind of dumb. If all I need is in my store, why not just fire off an action to do whatever it is I want to do and have the @Effect grab the data from the store?</p>\n<p>This is why I ended up making my smart component listen to the observables and dispatch events to the store based on changes in my components. This includes things like button clicks. Any other processing that needs to take place takes place in either an @Effect or is called from an @Effect.</p>\n<p>I can’t describe for you how much cleaner my codebase is as a result! WOW!</p>\n<p>But, will it work on the first page the same as it works on the second page?</p>\n<h2 id=\"The-Test\"><a href=\"#The-Test\" class=\"headerlink\" title=\"The Test\"></a>The Test</h2><p>You see, there is a big difference between the first page and the second page. The first page is basically a search and list page. The second page is an edit page for an item. On the first page, I had multiple store entities for the various parts. I had an entity for the search fields. An entity for the search results. And others. Let’s just say my model isn’t very flat.</p>\n<p>The fact of the matter is, the second page that I created wasn’t really all that flat either. But because I started with the concept of not putting any logic in my smart component, it felt easier to manage.</p>\n<p>So, the first thing I wanted to do was to create a reducer for the page. All this reducer will do is distribute the action down into sub-reducers. This allowed me to keep all of my action code the same. The only thing that changes is that the directories for my sub-reducers and the @Effects, Actions and Interfaces that are associated with them go under my directory for my main Reducer and Model.</p>\n<p>I still have a bit of code that I’d like to clean up, but on the whole, I like this pattern much better than what I was doing before.</p>\n<h2 id=\"Advantages\"><a href=\"#Advantages\" class=\"headerlink\" title=\"Advantages\"></a>Advantages</h2><p>The main advantage to using this new architecture is that it simplifies and reduces testing considerations.</p>\n<p>For example, because all my presentation layer is now doing is either reflecting the state that is in my store or telling my store to do something, there really isn’t much, if anything, left to test in my presentation layer. If you’ve written your code correctly, none of the methods in your view should have a cyclomatic complexity of greater than two. You may still want to write some end-to-end tests to make sure that the NgRX&#x2F;Store loop is working correctly. But that is an entirely different subject.</p>\n<p>This does not mean that we don’t have to test anything. All of that code had to go some place, right?</p>\n<p>But, here’s the deal. Because the code is in an @Effect or a Service (generally) your tests become much more simple. You might have to dummy up a store or a service. But for the most part, your tests won’t really look much different that tests you would write for regular JavaScript code without a framework.</p>\n<p>The other HUGE advantage to using this architecture is that it allows you to distribute your code so that no file is too large and hard to reason about. It allows you to follow the “Single Responsibility Principle” in greater granularity than you might otherwise be able to do.</p>\n<p>And finally, this architecture allows you to treat all the component code: the html template, the CSS, and the TypeScript file, as all View code. And I think this is where many people are confused about Angular.</p>\n<h2 id=\"View-Confusion\"><a href=\"#View-Confusion\" class=\"headerlink\" title=\"View Confusion\"></a>View Confusion</h2><p>In a MVC or even an MVVM pattern, we’ve also considered the HTML template the “View” and the JavaScript (or in our case, TypeScript) code the controller. This is a common misconception that I believe the ASP.NET crowd still gets wrong. Code-behind code isn’t your controller. It is helper code for your View. And so, we end up putting processing code in our view, when it really belongs in an entirely different file. This is what the Model View Presenter pattern solves. If you aren’t going to use NgRX and Reactive Forms, you should check out MVP as a way of architecting your code using the older Template Driven Forms approach that was common in AngularJS.</p>\n<h2 id=\"Code\"><a href=\"#Code\" class=\"headerlink\" title=\"Code\"></a>Code</h2><p>For the purposes of this article, I’m going to assume you’ve read my other articles which I’ve linked to at the beginning of this post.</p>\n<p>So first, the basic directory and file structure of this new method might look something like this:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app/</span><br><span class=\"line\"> +-store/</span><br><span class=\"line\">   +-route1/</span><br><span class=\"line\">     +-sub-reducer1/</span><br><span class=\"line\">       --sub-reducer1.actions.ts</span><br><span class=\"line\">       --sub-reducer1.effects.ts</span><br><span class=\"line\">       --sub-reducer1.model.ts</span><br><span class=\"line\">       --sub-reducer1.reducer.ts</span><br><span class=\"line\">     +-sub-reducer2/</span><br><span class=\"line\">     --route1.actions.ts</span><br><span class=\"line\">     --route1.effects.ts</span><br><span class=\"line\">     --route1.model.ts</span><br><span class=\"line\">     --route1.reducer.ts</span><br><span class=\"line\">   +-route2/</span><br></pre></td></tr></table></figure>\n\n<p>Some things to note:</p>\n<ol>\n<li>Your Actions are defined in the target. You would seldom, if ever, define an action at the route level.</li>\n<li>Effects are optional, just like any other time you would use them.</li>\n<li>Effects are seldom, if ever, defined at the route level.</li>\n<li>I’m using “route1” etc and “sub-reducer1” etc as sample names. Use names that represent your route names and the data you are storing.</li>\n<li>The only reducers that gets defined in our app.store.ts file are the reducers in the route directories.</li>\n<li>You still need to register each of your effects in app.store.ts as you have been doing.</li>\n</ol>\n<p>The next thing that is probably not clear is that your top-level model, ie “route1.model.ts” should only hold the sub-reducers. I’ve also found it useful to make all of my top-level properties optional.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Route1Model</span> &#123;</span><br><span class=\"line\">  subItem1?: <span class=\"title class_\">SubModel1</span>;</span><br><span class=\"line\">   subItem2?: <span class=\"title class_\">SubModel2</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>And this is used in your route reducer as:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">function</span> <span class=\"title function_\">route1Reducer</span>(<span class=\"params\">state: Route1Model =</span></span><br><span class=\"line\"><span class=\"params\">  &#123;</span></span><br><span class=\"line\"><span class=\"params\">    subReducer1: &#123;/* subReducer definition here */&#125;,</span></span><br><span class=\"line\"><span class=\"params\">    subReducer2: &#123;/* subReducer definition here */&#125;</span></span><br><span class=\"line\"><span class=\"params\">  &#125;, action: Action</span>) &#123;</span><br><span class=\"line\"> <span class=\"comment\">// process action here</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"title class_\">Route1Reducer</span>: <span class=\"title class_\">ActionReducer</span>&lt;<span class=\"title class_\">Route1Model</span>&gt; = route1Reducer;</span><br></pre></td></tr></table></figure>\n\n<p>Now, the trick we need to implement is that we need to delegate the actions down to the appropriate reducers and we only want to change the state object to a new object if a child state has changed.</p>\n<p>In the top level reducer, you need to put code that looks something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> reducerList = &#123;</span><br><span class=\"line\">  <span class=\"attr\">subReducer1</span>: subReducer1,</span><br><span class=\"line\">  <span class=\"attr\">subReducer2</span>: subReducer2</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">let</span> returnState = state;</span><br><span class=\"line\"><span class=\"title class_\">Object</span>.<span class=\"title function_\">keys</span>(reducerList).<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">item</span> =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> newState = reducerList[item](state[item], action);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(newState !== state[item]) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> newItem = &#123;&#125;;</span><br><span class=\"line\">      newItem[item] = newState;</span><br><span class=\"line\">      returnState = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, returnState, newItem);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"keyword\">return</span> returnState;</span><br></pre></td></tr></table></figure>\n\n<p>The key here is that you want the property names in the reducerList to be the same name as what is in the Route1Model and you want the values assigned to them to be the function pointer (notice, no parenthesis) that should be called.</p>\n<p>The actual sub-reducers look like a regular reducer.  The only real difference is that you will be calling the function that returns the state, the second export statement we normally put in our reducers that returns the ActionReducer&lt;&gt; is not needed.</p>\n<p>So, our Object.keys().map() processes each reducer and updates the parent object if the child has changed.</p>\n<p>Now, by way of reminder. You can observe all the store, or part of the store. So, your smart component might observe just a sub entity or the whole entity depending on the need at the moment.</p>\n<p>Finally, lets say you want to have a “Save” button that causes the information in your store to be persisted to a database. You would place a method in your smart component that gets triggered by the button and fires a “Save” action to an @Effect.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">save</span>(<span class=\"params\">event</span>) &#123;</span><br><span class=\"line\">  event.<span class=\"title function_\">stopPropagation</span>();</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">dispatch</span>(<span class=\"title class_\">Route1Actions</span>.<span class=\"title function_\">save</span>());</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Your @effect will respond, and since @Effects typically already have a store injected into them, you can use the store to retrieve the data.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Effect</span>(&#123;<span class=\"attr\">dispatch</span>: <span class=\"literal\">false</span>&#125;) _save$ = <span class=\"variable language_\">this</span>.<span class=\"property\">update$</span></span><br><span class=\"line\">  .<span class=\"title function_\">ofType</span>(<span class=\"title class_\">StagedEditActions</span>.<span class=\"property\">SAVE</span>)</span><br><span class=\"line\">  .<span class=\"title function_\">switchMap</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">select</span>(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">route1</span>).<span class=\"title function_\">first</span>();</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(<span class=\"function\"><span class=\"params\">route1Data</span> =&gt;</span> <span class=\"variable language_\">this</span>.<span class=\"property\">service</span>.<span class=\"title function_\">save</span>(route1Data))</span><br><span class=\"line\">  .<span class=\"title function_\">map</span>(requestId$ =&gt; &#123;</span><br><span class=\"line\">    requestId$.<span class=\"title function_\">subscribe</span>(<span class=\"function\"><span class=\"params\">id</span> =&gt;</span></span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">store</span>.<span class=\"title function_\">dispatch</span>(route1Actions.<span class=\"title function_\">load</span>(id))</span><br><span class=\"line\">    )</span><br><span class=\"line\">  &#125;);</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "angular",
                "design patterns",
                "NgRX"
            ]
        },
        {
            "id": "http://davembush.github.com/functional-reactive-angular-revealed/",
            "url": "http://davembush.github.com/functional-reactive-angular-revealed/",
            "title": "Functional Reactive Angular Revealed",
            "date_published": "2017-05-30T10:30:46.000Z",
            "content_html": "<p>Over the last month or so, I’ve been presenting the basics of <a href=\"/tags/ngrx/\">how to use NgRX&#x2F;Store with Angular</a>. In the past, I’ve praised the virtues of <a href=\"/tags/reactive-forms/\">Reactive Forms</a>, also known as <a href=\"/tags/model-driven/\">Model Driven Forms</a>. These along with RxJS make up the pillars of Functional Reactive Angular Programming.</p>\n<p>What is sad is that this reality is lost on so much of the Angular community. When I listen to podcast where they talk about any of these concepts individually, Function Reactive Programming (FRP) is barely, if ever, mentioned.</p>\n<p>But the scary thing is this, there are many people who are going to use the new Angular the way they used the old Angular and they will completely miss the main advantages. They may even jump from Angular to React or (even) Aurelia. And that’s just picking on the most recent frameworks. Some will want to go back to Egypt and decide jQuery is a good choice!</p>\n<p>Functional Reactive Programming is not just a hot new model. It solves a lot of problems.</p>\n<figure>![](/uploads/2017/05/2017-05-30.png \"Functional Reactive Angular Revealed\") Photo via [VisualHunt.com](//visualhunt.com/re/b10788)</figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Object-Oriented-Failure\"><a href=\"#Object-Oriented-Failure\" class=\"headerlink\" title=\"Object-Oriented Failure\"></a>Object-Oriented Failure</h2><p>Several years ago, I wrote an article called, “<a href=\"/object-oriented-programming-has-failed-us/\">Object-Oriented Programming Has Failed Us</a>”. In the article, I put forth the reality that most people are unable to think in object-oriented terms. Humans think sequentially and chunk down. Object-Oriented Programming requires us to think holistically, frequently in parallel, and chunk up.</p>\n<p>So, lets define some terms. Chunking down is the act of finding differences between things. This is why we discriminate. At times, it is useful to find differences. If you are a microbiologist, you want to do this so you know you are working with one strain of virus vs some other strain.</p>\n<p>As you might have guessed, Chunking Up, is the exact opposite. We look for commonalities. Given two different things, what is the same between them?</p>\n<p>The problem is, that’s not how most of us naturally process the world. There are other problems with Object-Oriented Programming.</p>\n<h3 id=\"Hard-to-Reason-About\"><a href=\"#Hard-to-Reason-About\" class=\"headerlink\" title=\"Hard to Reason About\"></a>Hard to Reason About</h3><p>Back when I was teaching for a training company, I was explaining some concept of Object-Oriented Programming, probably Virtual Functions, to a student that came from a procedural programming world. His comment was, “this is going to make the code really hard to debug!” to which I responded, “not if you step through with the debugger.” But, the truth is, he was right. Debugging Object-Oriented code is difficult because the code is hard to read and reason about. Looking at any one class, am I ever sure that I’m seeing the whole picture?</p>\n<p>Think about this. When you write a class, and have a member variable, how long is it before you’ve forgotten the fact that the variable exists and is implicitly a parameter that is being passed to your function. Not long! And this means that you can never really be sure that when you go to use that function, the state of the object will always be the same.</p>\n<p>This makes the code incredibly hard to test. I’m not even talking about using Test Driven Development. Just any kind of test that have way ensures that the code you’ve written does what you think it does and doesn’t do what you don’t think it does.</p>\n<h3 id=\"Single-Responsibility\"><a href=\"#Single-Responsibility\" class=\"headerlink\" title=\"Single Responsibility\"></a>Single Responsibility</h3><p>One of the rules for Object-Oriented Programming is that we should follow the “Single Responsibility Principle” I ask you, how far do we chunk down to ensure we are only doing one thing in our class?  In fact, many of the principles we have developed are trying to put fences around the inherent problems with programming in an Object-Oriented mindset.</p>\n<h2 id=\"Procedural-Programming\"><a href=\"#Procedural-Programming\" class=\"headerlink\" title=\"Procedural Programming\"></a>Procedural Programming</h2><p>The benefit of Procedural Programming is that I at least knew what parameters I was always going to get.  The disadvantage is that it was still incredibly hard to test because my function could call other function that could call yet other functions.  This meant that I could only really test the functions that were at the end of the hierarchy and really had no good way of mocking out child functions.  While testing is hard in an Object-Oriented world, it is nearly impossible in a procedural world.</p>\n<h2 id=\"What-If\"><a href=\"#What-If\" class=\"headerlink\" title=\"What If\"></a>What If</h2><p>But, what if there were a way to write code that solved most of these problems. A way that better mirrored how we thought, that is easier to reason about, that allows you to chunk down – that forced you to chunk down. A way of coding that was so easy to test, that you frequently didn’t even need to write the test. This is the advantage of Functional Programming generally, and the reason you want to use the combination of NgRX&#x2F;Store, Reactive Forms, and RxJS in the bulk of your Angular code.</p>\n<h2 id=\"How-To\"><a href=\"#How-To\" class=\"headerlink\" title=\"How To\"></a>How To</h2><h3 id=\"Basics\"><a href=\"#Basics\" class=\"headerlink\" title=\"Basics\"></a>Basics</h3><p>You’ll remember from our discussion of NgRX that we setup a reducer to return a new state object for a particular entity in our store. You’ll also remember that we are able to create an entity that has child entities and that we can subscribe to any entity using code that looks something like this:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.<span class=\"title function_\">select</span>(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">entityName</span>)</span><br></pre></td></tr></table></figure>\n\n<p>or</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">store.<span class=\"title function_\">select</span>(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x.<span class=\"property\">entityName</span>.<span class=\"property\">subEntity</span>)</span><br></pre></td></tr></table></figure>\n\n<p>If you need to, you can read my previous articles that I’ve already referred to.</p>\n<p>I normally setup an entity in my store for each screen, then for data I am just displaying I subscribe in the template using</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;(observerThing | async)?.variableThing&#125;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The <code>(observerThing | async)</code> is the same as the code we would normally write in TypeScript:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">observerThing.<span class=\"title function_\">subscribe</span>(<span class=\"function\"><span class=\"params\">x</span> =&gt;</span> x);</span><br></pre></td></tr></table></figure>\n\n<p><code>async</code> does the <code>subscribe</code> and returns <code>x</code>. The <code>?</code> ensures that we don’t attempt to go after <code>.variableThing</code> if <code>x</code> is <code>null</code> or <code>undefined</code>.</p>\n<p>This is all pretty basic stuff.</p>\n<p>But what about working with forms.</p>\n<h3 id=\"Forms\"><a href=\"#Forms\" class=\"headerlink\" title=\"Forms\"></a>Forms</h3><p>I’ve found that the best way to work with forms is to create a structure in my entity that maps directly to my form. So, if I have a form with firstName, lastName, and birthDate, I’ll define my form in my template with a form group using firstName, lastName, and birthDate as formControlName values.</p>\n<p>Next, in my TypeScript code, I’ll subscribe to the form group’s valueChanges property. Any time my form changes, the subscribe dispatches the changes to the reducer for my entity and updates the store.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span></span><br><span class=\"line\">  .<span class=\"property\">myFormGroup</span></span><br><span class=\"line\">  .<span class=\"property\">valueChanges</span></span><br><span class=\"line\">  .<span class=\"title function_\">subscribe</span>(</span><br><span class=\"line\">    <span class=\"function\"><span class=\"params\">x</span> =&gt;</span> store.<span class=\"title function_\">dispatch</span>(<span class=\"comment\">/* action thing goes here */</span>)</span><br><span class=\"line\">  );</span><br></pre></td></tr></table></figure>\n\n<p>Similarly, I can setup a <code>subscribe</code> on my entity and any time the data in the entity changes, I can update the form group.</p>\n<p>There is a small little trick you need to know about here. I already showed you how to update the form group using <code>patchValue()</code> <a href=\"/angular2-model-driven-forms-are-superior/\">here</a>. But because we were not dealing with a fully Functional Reactive programming model, I left out a part you’ll need here.</p>\n<p>When you update your code using <code>patchValue()</code>, the first parameter will still be the data you want to change. That is, the values from the store’s entity. But for the second parameter, you’ll need to pass in <code>&#123;emitEvent: false&#125;</code>, otherwise, you’ll end up with an infinite loop. Your form will cause your reducer to change and your store will cause your form to change. What that second parameter is saying is that we don’t want any of the change events to fire because we’ve updated the form.</p>\n<p>You may also want to consider writing code in your reducer that only returns a new state object if no data has changed.</p>\n<h3 id=\"RxJS\"><a href=\"#RxJS\" class=\"headerlink\" title=\"RxJS\"></a>RxJS</h3><p>Now, nothing about anything I’ve written in the “how to” is particularly Functional, but it is Reactive. By virtue of the subscribes, it is reacting to state change and reacting to changes in the form. What makes our code Functional, is that we make use of RxJS, a Reactive library, to process the data. If you’ve already been using the Http object in Angular, you’ve already been using RxJS.</p>\n<p>There is a great <a href=\"//reactivex.io/learnrx/\">tutorial for learning RxJS</a> that the guys at NetFlix have put together. I’m not even going to attempt to teach RxJS here. They’ve got the best material and it is what helped me wrap my head around the basic concepts.</p>\n<p>What I do want to point out here is what makes Functional programming Functional so that you end up using RxJS correctly.  While these are not hard and fast rules, I would encourage you to break these rules only after you can’t find any other way:</p>\n<ol>\n<li>The output of one function becomes the input for the next function.</li>\n<li>A function never causes a side effect (this is why NgRX has Effects)</li>\n<li>The same parameters in will always produce the same data out.</li>\n<li>Avoid conditionals and use .filter(), .case() etc instead.</li>\n<li>Ideally the cyclomatic complexity of a function should be 1</li>\n</ol>\n<p>By following these rules, you will find that most of the code you write doesn’t need to have any test.  Why would you ever test a function with a cyclomatic complexity of 1, or code that has no conditions?</p>\n<h2 id=\"The-Right-Tool-for-the-Job\"><a href=\"#The-Right-Tool-for-the-Job\" class=\"headerlink\" title=\"The Right Tool for the Job\"></a>The Right Tool for the Job</h2><p>While I would love to be able to use Functional programming everywhere, I recognize that it isn’t always the best tool for the job. For example, at least with Angular, there isn’t a good way of writing our components and pages in a strictly Functional way. However, if you use what I’ve illustrated here, you’ll find that even though the structure of your components are Object-Oriented, much of the code within the component is quite functional.</p>\n",
            "tags": [
                "angular",
                "RxJS",
                "NgRX"
            ]
        },
        {
            "id": "http://davembush.github.com/using-real-world-ngrx/",
            "url": "http://davembush.github.com/using-real-world-ngrx/",
            "title": "Using Real World NgRX",
            "date_published": "2017-05-09T10:30:00.000Z",
            "content_html": "<p>This week, I want to demonstrate some ways you might use NgRX in your own code.</p>\n<h2 id=\"Review\"><a href=\"#Review\" class=\"headerlink\" title=\"Review\"></a>Review</h2><p>Last week we went into a lot of detail about how the NgRX system should be wired together. Here is all of that in picture form.</p>\n<p><img src=\"/uploads/2017/05/image.png\" alt=\"image\" title=\"image\"></p>\n<p>A component fires an event to either an effect or a reducer using an action. If an effect was called, it fires another action which is normally picked up by a reducer. The Reducer mutates the state which then gets placed in the store. “Magic happens here.” You don’t write any code to get it to the store other than that you create a reducer. Anything that is observing the table in the store that got changed will get notified via RxJS observables and the cycle is complete.</p>\n<p>Note that the action you dispatch can be handled by either an Effect, a Reducer or both.</p>\n<h2 id=\"Basic-CRUD\"><a href=\"#Basic-CRUD\" class=\"headerlink\" title=\"Basic CRUD\"></a>Basic CRUD</h2><p>Most of the time, we think of NgRX as a way of handling CRUD operations. We need to see the current record so we fire off a LOAD action that uses an effect to retrieve the data from the database. Once the data comes back, we return an action that tells the reducer to put that new data into the store. Since our component is observing the store, it updates the screen with the new values.</p>\n<p>If we need to add a record, we fire an ADD action. If we need to delete we fire a DELETE action. If we need to update, we fire an UPDATE action. Each of these are picked up by the Effect, which then fires an action that places new state information in the store via the Reducer.</p>\n<h2 id=\"Wait-State\"><a href=\"#Wait-State\" class=\"headerlink\" title=\"Wait State\"></a>Wait State</h2><p>When most people think of how to use NgRX or any similar pattern, they immediately think of the CRUD pattern I mentioned above. But, we don’t have to start the Action chain from a component. For that matter, we don’t have to listen to our Store data from a component either.</p>\n<p>One way I’ve implemented NgRX that solves a lot of common issues is that I’ve created a wait state component that shows when a count variable has been incremented and doesn’t show when the count is zero. Since Store is <code>Injectable</code>, I can increment and decrement the count from just about anywhere. Most often I increment it from an effect just before I make an AJAX call and decrement it in a finally() block of the Http observable. I have a start() action that increments the count and an end() action that decrements the count and ensures that I never go below zero. I can start off multiple asynchronous processes which will all increment the counter and decrement the counter appropriately. The wait state GUI displays until everything has finished.</p>\n<p>This is OH! So much easier than how we’ve had to handle this problem with other design patterns. I’m not saying it couldn’t be done, or that it was even particularly hard. But this way is easier.</p>\n<h2 id=\"Error-Handling\"><a href=\"#Error-Handling\" class=\"headerlink\" title=\"Error Handling\"></a>Error Handling</h2><p>Another place where you might want to present information but trigger the display from just about anywhere is with error handling. In the code I work on, I have a modal popup component that displays whenever my error collection has something in it. Anytime I need to display an error, I add the error to the collection via an Action and it magically displays. The great thing about this mechanism is that regardless of how many errors I send to the collection, they all display until I close the window, which clears out the collection.</p>\n<h2 id=\"Page-State\"><a href=\"#Page-State\" class=\"headerlink\" title=\"Page State\"></a>Page State</h2><p>Most page state is handled by the fact that we’ve stored the data into a database. But there are times when we want to come back to a page we had been working on previously and we want it to display with the data that was on it at the time we left.</p>\n<p>Or maybe you want to work on a series of pages prior to saving so that everything gets saved as a set.</p>\n<p>No matter. You can use NgRX to store everything into the store and a separate action can trigger an effect that pushes that data to the database.</p>\n<p>Or, as is the case in an application I’m working on, I’m using a form to search a database. When I come back, I want the same search fields and I want the search to reinitialized. In my particular case, I don’t have a search field. You change a field, a new search is automatically initiated. This case is just a little bit more complicated than what we’ve looked at so far.</p>\n<p><img src=\"/uploads/2017/05/image-1.png\" alt=\"image\" title=\"image\"></p>\n<p>In order to keep the state information available so that it is there when I come back to it, I need to store that information in the search table via the Search Reducer. So, every time something changes in the Search Form, I send off an action to the Search Reducer so that the change can be recorded.</p>\n<p>Meanwhile, the Search Form also is listening to the Search Table so that when it comes back it can put the changes in the form, and it can send an action to the Search Results Reducer telling it to search for the information. When it gets the results, the Search Results Table picks them up and since the Search Results Component is listening to the Search Results Table, they display.</p>\n<p>If I leave the page, the Search Form grabs the current search parameters from the Search Table and Fills the Form and sends the action to the Search Results Reducer and the page is back where we left it.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>The point is, NgRX isn’t just about basic CRUD forms and because there are multiple ways you can mix and match the parts, even your basic CRUD implementation has a lot more flexibility than you might be used to.</p>\n",
            "tags": [
                "angular",
                "design patterns",
                "NgRX"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-2-model-driven-forms-are-superior/",
            "url": "http://davembush.github.com/angular-2-model-driven-forms-are-superior/",
            "title": "Angular(2+) Model Driven Forms Are Superior",
            "date_published": "2017-04-18T10:30:00.000Z",
            "content_html": "<p>If you are programming in Angular and haven’t tried Model Driven Forms yet, I’m assuming that is because you’ve not taken the time to try to learn it. In this article, I am going to try to convince you that the Model Driven Form based approach is superior to Template Driven Forms and that the only people that are still using Template Driven Forms are people who either have not been enlightened or lazy.</p>\n<figure>![](/uploads/2017/04/image-4.png \"Angular(2+) Model Driven Forms Are Superior\")<figcaption>Photo credit: [DarlingJack](//www.flickr.com/photos/aceofknaves/33346081006/) via [Visualhunt.com](//visualhunt.com/re/f8175d) / [ CC BY](//creativecommons.org/licenses/by/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"What-are-Template-Driven-Forms\"><a href=\"#What-are-Template-Driven-Forms\" class=\"headerlink\" title=\"What are Template Driven Forms\"></a>What are Template Driven Forms</h2><p>For those who aren’t already familiar with the terms, let’s define them first.  A template driven form is an Angular form that has most of the form logic in the template code.  The elements that give away the fact that we are working with a template driven form are that we are using ngModel in our form fields, all of our form fields have a name attribute, and our form has ngForm declared as assigned to the form variable.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> #<span class=\"attr\">form</span>=<span class=\"string\">&quot;ngForm&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;name&quot;</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;text&quot;</span> [(<span class=\"attr\">ngModel</span>)]=<span class=\"string\">&quot;nameField&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>In our code, each form field is handled individually.  While we might bind them all to a structure of some sort in our TypeScript code, the result is we continue to think of the data as parts rather than wholes.</p>\n<h2 id=\"What-are-Model-Driven-Forms\"><a href=\"#What-are-Model-Driven-Forms\" class=\"headerlink\" title=\"What are Model Driven Forms\"></a>What are Model Driven Forms</h2><p>Model Driven Forms, on the other hand, put a minimal amount of information in the template. It isn’t that we eliminate the template completely, we just put more of the responsibility into the TypeScript code.</p>\n<p>Typical template code for Model Driven Forms looks like this</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">form</span> [<span class=\"attr\">formGroup</span>]=<span class=\"string\">&quot;form&quot;</span> &gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">formControlName</span>=<span class=\"string\">&quot;name&quot;</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">form</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Notice how much less code is needed.</p>\n<p>But, you may ask, how do I get the code in and out of the field? How do I validate the field?</p>\n<p>Oh, but you see, that is exactly why I love Model Driven forms. That’s all in the TypeScript code.</p>\n<p>But other than the fact that there is less code in the template and we can handle everything about the form in our TypeScript, the main difference between Template Driven Forms and Model Driven Forms is that Model Driven Forms let us treat the form as a whole rather than individual parts. This solves problems that used to be rather tricky using Template Driven Forms.</p>\n<h2 id=\"Flexible-Validation\"><a href=\"#Flexible-Validation\" class=\"headerlink\" title=\"Flexible Validation\"></a>Flexible Validation</h2><p>Just so we have a reference, this is what our TypeScript code would look like to wire up our TypeScript code to our template.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">form</span> = formBuilder.<span class=\"title function_\">group</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: [<span class=\"string\">&#x27;&#x27;</span>,<span class=\"title class_\">Validators</span>.<span class=\"property\">required</span>],</span><br><span class=\"line\">  <span class=\"attr\">sex</span>: [<span class=\"string\">&#x27;&#x27;</span>,<span class=\"title class_\">Validators</span>.<span class=\"property\">required</span>],</span><br><span class=\"line\">  <span class=\"attr\">dob</span>: [<span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"title class_\">Validators</span>.<span class=\"title function_\">compose</span>([ <span class=\"title class_\">Validators</span>.<span class=\"property\">required</span>, <span class=\"title class_\">View</span>.<span class=\"property\">isDate</span>])]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p><code>this.form</code> references a public member in the form class. It is the same name that we named our form group in the template file.</p>\n<p>Within the form group, we have a property for each field in our form group. In the sample above, we only created one input field named ‘name’. This form group references two other fields, ‘sex’ and ‘dob’. I added these in so I could show you some other features.</p>\n<p>You’ll see that we’ve defined some validations. Simple required validations until we get to ‘dob’ where we want to make sure we give them a real date. For this, we use two new features. We use the <code>compose</code> feature to combine several validations into one. We also created a custom validation called <code>isDate.</code></p>\n<p>Custom validations are static methods that take the control they are associated with as a parameter. Each control has a value property that you can use to retrieve the current value of the control.</p>\n<p>The problem that this solves is that now we can write any validation we need without having to make it a directive. We could also cross validate between this control and another control on the form by climbing up to the parent Form Group and back down to a sibling Form Control. It really is quite flexible.</p>\n<h2 id=\"Easy-Change-Detection\"><a href=\"#Easy-Change-Detection\" class=\"headerlink\" title=\"Easy Change Detection\"></a>Easy Change Detection</h2><p>If you are working with Template Driven Forms, you know that the way you know a value in a control has changed is because the property it is associated with gets a new value. Setting up a simple setter lets you know the field has changed. Or if you prefer you can use the split syntax of</p>\n<p><code>[ngModel]=&#39;field&#39; (ngModelChange)=&#39;changeHander($event)&#39;</code></p>\n<p>In Model Driven forms we can tell when any field has changed by subscribing to the valueChanges property.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">form</span>.<span class=\"property\">valueChanges</span>.<span class=\"title function_\">subscribe</span>(<span class=\"function\">(<span class=\"params\">value</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">contact</span> = <span class=\"title function_\">deepAssign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>.<span class=\"property\">contact</span>, value);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>The value that gets passed in has information about the field or fields that changed. So, rather than getting every field every time, you are only getting the information that actually changed. So, in your subscription, you can detect what changed and deal with that field individually if you need to. In the code above, I’m just dispatching the new state to my reducer. By doing this, my store has the current state so that when I’m ready to put it in a database, I don’t have to go around my form and gather up all the information. I already have it all.</p>\n<h2 id=\"Centralized-Form-Handling\"><a href=\"#Centralized-Form-Handling\" class=\"headerlink\" title=\"Centralized Form Handling\"></a>Centralized Form Handling</h2><p>And that’s what I mean by “Centralized Form Handling.” All my form validation stuff is centralized. All the code I need to get the data out of my form is centralized. And, as you’ll see soon, all the code I need to get the data into my form is centralized.</p>\n<h2 id=\"Completing-the-Picture\"><a href=\"#Completing-the-Picture\" class=\"headerlink\" title=\"Completing the Picture\"></a>Completing the Picture</h2><p>The only bit we have left out is, how do we get the data into the form?</p>\n<p>That’s pretty easy.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">form</span>.<span class=\"title function_\">patchValue</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: contact.<span class=\"property\">name</span>,</span><br><span class=\"line\">  <span class=\"attr\">sex</span>:contact.<span class=\"property\">sex</span>,</span><br><span class=\"line\">  <span class=\"attr\">dob</span>:contact.<span class=\"property\">dob</span>.<span class=\"title function_\">toLocaleDateString</span>()</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Where contract is an object that has the new data I want to put into the corresponding fields.</p>\n<h2 id=\"Testing\"><a href=\"#Testing\" class=\"headerlink\" title=\"Testing\"></a>Testing</h2><p>One thing we haven’t talked about is my favorite subject of testing. Because all of our logic resides in our TypeScript file, testing our screen logic becomes almost trivial. In fact, if you’ve done this correctly, you shouldn’t need to write anything more than a set of Unit Tests to make sure your screen works as expected. If you marry this with NgRX&#x2F;Store, you will be even better off because you’ll never have to deal with a real database while testing your screen. And you won’t have to do a lot of mocking to achieve this.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>So, maybe this hasn’t convinced you. So, here is a challenge. Try it! While I have had people reject this model when I explain it to them, those who have actually tried it have seen that it really is a superior model. Which just goes to show that my dad was right, “It is amazing how much I don’t understand, when it doesn’t fit my plan.”  </p>\n<h2 id=\"Further-Your-Education\"><a href=\"#Further-Your-Education\" class=\"headerlink\" title=\"Further Your Education:\"></a>Further Your Education:</h2><p><a href=\"//blog.thoughtram.io/angular/2016/06/22/model-driven-forms-in-angular-2.html\">Reactive Forms in Angular</a> <a href=\"//scotch.io/tutorials/using-angular-2s-model-driven-forms-with-formgroup-and-formcontrol\">Using Angular’s Model Driven Forms</a> <a href=\"//toddmotto.com/angular-2-forms-reactive\">Angular Reactive Form Fundamentals</a> <a href=\"//angular.io/docs/ts/latest/guide/reactive-forms.html\">Reactive Forms</a> (From the Angular Site)</p>\n",
            "tags": [
                "angular",
                "model driven",
                "reactive forms"
            ]
        },
        {
            "id": "http://davembush.github.com/more-control-with-angular-flex-layout/",
            "url": "http://davembush.github.com/more-control-with-angular-flex-layout/",
            "title": "More Control with Angular Flex Layout",
            "date_published": "2017-04-11T10:30:00.000Z",
            "content_html": "<p>If you are using Angular(2+) and you are looking for an easy way to layout your components that gives you lots of flexibility and very few restrictions, you owe it to yourself to checkout <a href=\"//github.com/angular/flex-layout\">Angular Flex Layout</a>.  While it is still in Beta, the framework is quite usable.  I’ve been using it in one of my projects and I’ve been quite happy with the results.</p>\n<figure>![](/uploads/2017/04/image-2.png \"More Control with Angular Flex Layout\") Photo via [VisualHunt.com](//visualhunt.com/re/7d8037)</figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"The-Old-Days\"><a href=\"#The-Old-Days\" class=\"headerlink\" title=\"The Old Days\"></a>The Old Days</h2><h3 id=\"Straight-CSS\"><a href=\"#Straight-CSS\" class=\"headerlink\" title=\"Straight CSS\"></a>Straight CSS</h3><p>I tell people, “I’ve been programming websites since ‘Al Gore invented the Internet’” Which is to say, some time prior to 1998. So, I’ve had to deal with layout issues for a very long time. At least in terms of “Internet Time.” And during that time, being able to lay things out on the page in some sort of intelligent way has matured quite a bit. But still, coding it all by hand, unless you are a fulltime CSS person, is not the best use of my time.</p>\n<p>This is, in part, why Bootstrap was created.</p>\n<h3 id=\"Bootstrap\"><a href=\"#Bootstrap\" class=\"headerlink\" title=\"Bootstrap\"></a>Bootstrap</h3><p>I generally love Bootstrap. A great CSS framework that allows me to style my application easily, is easy to modify, and has a pretty respectable grid systems for placing my controls on the page. The problem with Bootstrap though is that the grid system is really all you have available for layout, and it is rather limited. At least that has been my experience. By default, you get a grid with 12 columns. And while you can next grids in other grids, you still end up with alignment issues. There must be an easier way.</p>\n<h3 id=\"AngularJS-Material-Design\"><a href=\"#AngularJS-Material-Design\" class=\"headerlink\" title=\"AngularJS Material Design\"></a>AngularJS Material Design</h3><p>The Angular Flex Layout used to be part of the AngularJS Material Design project. But instead of making it part of the Angular Material Design project, it has been broken out so that we can use it in combination with other systems. Grids where they make sense and Flex Layout where that will work better.</p>\n<h2 id=\"Flex-Layout-Benefits\"><a href=\"#Flex-Layout-Benefits\" class=\"headerlink\" title=\"Flex Layout Benefits\"></a>Flex Layout Benefits</h2><h3 id=\"No-Grids\"><a href=\"#No-Grids\" class=\"headerlink\" title=\"No Grids\"></a>No Grids</h3><p>Now, what makes Flex Layout so great? The first thing that I think of is that I can do everything I was able to do with the Bootstrap grid system, but I have a lot more control. In fact, this past week, I converted an existing layout that was using nested grids to achieve the layout I was looking for and flattened it significantly by switching it to use Flex. You see, in Flex, you can say you want a row and then for each cell in that row, you can specify the width of the cell in any unit you want, or you can tell it to take up the remaining space. And just like Bootstrap grids, the DIVs wrap if needed.</p>\n<h3 id=\"Directive-Based\"><a href=\"#Directive-Based\" class=\"headerlink\" title=\"Directive Based\"></a>Directive Based</h3><p>The other thing that is true of flex is that all of this control is specified at the template level. I’m not specifying layout in a file that is separate from the template I want to apply it to.</p>\n<p>Now, the CSS purist might object to this. “Style information should all go in a global CSS file so you aren’t repeating yourself.” They’ll say. </p>\n<p>Well, yes, that’s true, if you are creating multiple pages that you want to all look the same. But we are talking about Angular here. A Single Page Application. If you have multiple templates that all need the same layout information, you are probably not thinking about your components correctly. That is, your problem isn’t a CSS&#x2F;Style issue, it is a component issue.</p>\n<p>In a SPA, each page looks the same because each page uses the same parent component. Rarely, do you really have a need to share layout styles. Mostly we share component look and feel. That’s different.</p>\n<h3 id=\"Responsive\"><a href=\"#Responsive\" class=\"headerlink\" title=\"Responsive\"></a>Responsive</h3><p>And if I want a cell to be one size for desktop and another size for tablets or phones, I can easily specify what size each should be. Similar to how we would do it with Bootstrap, but in much finer detail.</p>\n<h2 id=\"It’s-Just-CSS\"><a href=\"#It’s-Just-CSS\" class=\"headerlink\" title=\"It’s Just CSS\"></a>It’s Just CSS</h2><p>Before we move on, I want to point out that Flex Layout doesn’t do anything that the current CSS spec doesn’t already allow us to do. However, the current Flexbox CSS implementations are so new that each browser implements the spec enough different that we can’t be sure the styles will work the same way as we move from browser to browser.</p>\n<p>What Flex Layout attempts to do is to normalize the differences in a way similar to how jQuery normalized the DOM for us. Someday, we may not need Flex Layout. But until then, this is going to save you a lot of time trying to figure things out.</p>\n<h2 id=\"What-You-Can-Do\"><a href=\"#What-You-Can-Do\" class=\"headerlink\" title=\"What You Can Do\"></a>What You Can Do</h2><h3 id=\"Maintain-Aspect-Ratios\"><a href=\"#Maintain-Aspect-Ratios\" class=\"headerlink\" title=\"Maintain Aspect Ratios\"></a>Maintain Aspect Ratios</h3><p>I first started playing with the Flexbox CSS spec when I needed to implement a layout that included a video player that was bounded by a splitter control. As the splitter resizes the panel, the video needs to shrink and grow maintaining the aspect ratio while at the same time allowing the cell under it to grow and shrink. This is something that Flex can handle easily.</p>\n<h3 id=\"Rows-with-Cells\"><a href=\"#Rows-with-Cells\" class=\"headerlink\" title=\"Rows with Cells\"></a>Rows with Cells</h3><p>As I’ve already mentioned, it is as easy to set up a new row and place wrapping DIVs in it as it is with Bootstrap.</p>\n<h3 id=\"Columns-with-Cells\"><a href=\"#Columns-with-Cells\" class=\"headerlink\" title=\"Columns with Cells\"></a>Columns with Cells</h3><p>But unlike Bootstrap, you can also create groups of Columns with Cells.</p>\n<h3 id=\"Responsive-Card-Layouts\"><a href=\"#Responsive-Card-Layouts\" class=\"headerlink\" title=\"Responsive Card Layouts\"></a>Responsive Card Layouts</h3><p>The last couple of weeks, I needed to implement a card layout that changed the number of columns displayed based on the width of the container. By using Flex Layout along with min-width and max-width on the cards, I was able to get this to layout correctly regardless of the container width.</p>\n<h2 id=\"Getting-Started\"><a href=\"#Getting-Started\" class=\"headerlink\" title=\"Getting Started\"></a>Getting Started</h2><p>I’m not going to spend a lot of time going over the ins and outs of using Flex Layout. They do a pretty respectable job on the website. But, the one thing I did have trouble getting started with was exactly what syntax to use. Some stuff I found used <code>fx-flex</code> syntax and other sites used <code>fxFlex</code>. The one you want is <code>fxFlex</code>. That and a bit of experimentation should get you well on your way.</p>\n",
            "tags": [
                "angular",
                "css",
                "flex"
            ]
        },
        {
            "id": "http://davembush.github.com/3-javascript-fallacies-you-might-believe/",
            "url": "http://davembush.github.com/3-javascript-fallacies-you-might-believe/",
            "title": "3 JavaScript Fallacies You Might Believe",
            "date_published": "2017-03-14T11:30:00.000Z",
            "content_html": "<p>You know, you think the whole world knows something is true until you hear someone people respect say something really dumb.  The three JavaScript fallacies I have here are actual statements I’ve heard over the last week during a discussion about Angular2 and Rect.  What makes these fallacies particularly interesting is that they sound plausible.  In fact, there are time when they are even true.  But in the larger context of a JavaScript application they are nearly always false.</p>\n<p>So, here are 3 JavaScript Fallacies you may still believe that you may want to reevaluate.</p>\n<figure>![](/uploads/2017/03/image-2.png \"3 JavaScript Fallacies You Might Believe\")<figcaption>Photo credit: [bark](//www.flickr.com/photos/barkbud/4341791754/) via [VisualHunt](//visualhunt.com/re/8dc251) / [ CC BY](//creativecommons.org/licenses/by/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Direct-Access-to-the-DOM-is-Faster-than-using-a-Virtual-DOM\"><a href=\"#Direct-Access-to-the-DOM-is-Faster-than-using-a-Virtual-DOM\" class=\"headerlink\" title=\"Direct Access to the DOM is Faster than using a Virtual DOM\"></a>Direct Access to the DOM is Faster than using a Virtual DOM</h2><p>OK. I will grant that if you only ever want to change one thing on the screen at a time, yes accessing the DOM directly from JavaScript is probably going to be faster than going through some kind of Virtual DOM layer as is common in React, Angular2 and several other libraries and frameworks that are available today.</p>\n<p>But, the fact is, that’s not how most code works. If you are writing this kind of application and you are using a library or framework that uses a virtual DOM layer, something is wrong. I would argue you’ve probably chosen the wrong library for what you are trying to do.</p>\n<p>But, let’s assume that you are writing a typical SPA application that doesn’t just update one area of the screen. In this case, the fastest way to make this update is all at once. One call to the DOM from JavaScript. I’ve written before about how <a href=\"/javascript-performance-tweaks/\">slow accessing the DOM is</a>. And for all the performance enhancements since I wrote that article, accessing the DOM is still one of the slowest things you can do. So, a framework that lets you write your code in a way similar to how you would write to the DOM directly, but lets you do this in a way that doesn’t actually write to the DOM until the last minute is FASTER than writing to the DOM directly.</p>\n<h2 id=\"Immutable-Objects-are-Necessarily-Slower-than-Mutable-Objects\"><a href=\"#Immutable-Objects-are-Necessarily-Slower-than-Mutable-Objects\" class=\"headerlink\" title=\"Immutable Objects are Necessarily Slower than Mutable Objects\"></a>Immutable Objects are Necessarily Slower than Mutable Objects</h2><p>Functional JavaScript programming has become the latest cool new buzzword in the JavaScript community, for a lot of good reasons, but one main concept that comes along for the ride is the idea of making all of our object immutable. This means, for example, that if I want to modify an array, instead of changing the current array, I would create a new array and copy the elements and the new element into it. No more push.</p>\n<p>Similarly, for a regular object that isn’t a list, we would create a new object and copy the existing elements into it and then overwrite the items that have changed.</p>\n<h3 id=\"Why\"><a href=\"#Why\" class=\"headerlink\" title=\"Why?\"></a>Why?</h3><p>Now, why would we want to go to all of this work? It does seem like it would be faster to just modify the existing object. Right?</p>\n<p>But you see, there is this little thing called “change detection” that more than makes up for all of this overhead I just described.</p>\n<p>In most of our applications, at some point we want to know if an object has changed, right? If we can’t rely on the fact that we have a new object, we have to do a deep comparison of the two objects until we’ve determined that there is a difference, or we’ve been through the whole list and verified that the nothing has changed.</p>\n<p>Once we can rely on objects being immutable, we can use the equals operator (&#x3D;&#x3D;, or &#x3D;&#x3D;&#x3D;) to see if the object has changed. I’m sure you can see that this takes much less time than evaluating an entire object tree, even if you object only has two properties in it that need to be compared.</p>\n<h3 id=\"Real-Problem\"><a href=\"#Real-Problem\" class=\"headerlink\" title=\"Real Problem?\"></a>Real Problem?</h3><p>But let’s step back and look at the bigger picture. In most of the code that I write, what we are really talking about is immutable arrays. Yes there are other non-array places where we would use immutable objects, but my guess is that immutable objects impacts 80% of my code. Get a list of records from the database for example.</p>\n<p>The fact of the matter is, every time I access the database, I get a new array back anyhow. Even in the case of retrieving a single record, I still get a new object back.</p>\n<p>If I need to delete an element from an array, here again, I’ll end up creating a new object.</p>\n<p>In fact, except modifying a row, or adding a record to the end of a list, just about everything I tend to do with an array ends up being an immutable operation anyhow. By making everything immutable, we are forcing the areas that we aren’t already implementing immutability to be immutable. The point is, in terms of performance the net is an obvious gain both in terms of performance and in terms of consistency.</p>\n<p>And, going back to the issue of rendering our data into the DOM, because the change detection is faster, we can determine that a particular component doesn’t need to have the DOM updated quicker rather than re-rendering the entire DOM.</p>\n<h2 id=\"Backwards-Compatibility-means-I-can’t-upgrade-my-Development-Environment\"><a href=\"#Backwards-Compatibility-means-I-can’t-upgrade-my-Development-Environment\" class=\"headerlink\" title=\"Backwards Compatibility means I can’t upgrade my Development Environment\"></a>Backwards Compatibility means I can’t upgrade my Development Environment</h2><p>Continuing on, remember the conversation I’m referencing was about React and Angular2. And the guy who was making these statements about performance was asserting that he couldn’t upgrade his React environment to use the latest and greatest tool chain because he had to support older browsers. He specifically stated IE6. Now, knowing the site he’s talking about, I doubt we make any money at all from people who run IE6. But, let’s just assume for a second that we do.</p>\n<h3 id=\"So-what-you’re-telling-me-is…\"><a href=\"#So-what-you’re-telling-me-is…\" class=\"headerlink\" title=\"So, what you’re telling me is…\"></a>So, what you’re telling me is…</h3><p>… that you are willing to let performance suffer for 99% of your very large customer based because you need to support the 1% (I’m being generous here) of the people who have refused to upgrade and probably aren’t producing any revenue for the company? Maybe I’m missing something, but this seems rather short-sighted. That, or maybe you just don’t know that the new features in the newer browsers allow you to not just write better JavaScript but also allow you to do things without JavaScript that perform better. If you are really interested in writing fast web sites, you should be moving to the latest and greatest tool chain as often as is humanly possible.</p>\n<h3 id=\"Bugs-and-Security-Risk\"><a href=\"#Bugs-and-Security-Risk\" class=\"headerlink\" title=\"Bugs and Security Risk\"></a>Bugs and Security Risk</h3><p>Just this last week I saw a study that said that over a third of the web sites on the Internet were running code that left them venerable to security risk. That is, the code they were running had known security risk. By not upgrading your tools for public facing sites, you are leaving your company at risk. When your site is compromised, do you want to be the one who has to explain to your boss that it is because you refused to upgrade your tools? I sure don’t.</p>\n<h3 id=\"But-what-about-the-old-browsers\"><a href=\"#But-what-about-the-old-browsers\" class=\"headerlink\" title=\"But what about the old browsers?\"></a>But what about the old browsers?</h3><p>Well, if you really need to support the old stuff, there are polyfills that you can apply that will let you run the newer stuff in the older browsers. Seems to me you get the best of both worlds. Your customers who are up to date benefit with a better performing, and less buggy website, and the customers using older browser still get to see something. Are there places where you might still have to make some compromises. Sure. There are a few places. But not enough that you shouldn’t upgrade.</p>\n<h2 id=\"What-is-the-Bigger-Problem\"><a href=\"#What-is-the-Bigger-Problem\" class=\"headerlink\" title=\"What is the Bigger Problem?\"></a>What is the Bigger Problem?</h2><p>So, how can this happen? How can really smart people make really bad choices like this?</p>\n<p>I don’t really know, but I have a few theories.</p>\n<p>One is just plain arrogance. Being so sure you are right that you never stop to think you might be wrong.</p>\n<p>I have to admit, when I first learned about immutability, I thought it sounded slow too. But, my thinking went along the lines of, “well, much smarter people than me are working on this, they must think it makes sense. I wonder why?” And then I started digging for answers.</p>\n<p>So, I would encourage those who are responsible for making decisions to make sure that the people they are listening to can actually back up what they are saying and not just assume they are right because they seem so confident.</p>\n",
            "tags": [
                "angular",
                "javascript",
                "performance",
                "react.js"
            ]
        },
        {
            "id": "http://davembush.github.com/secrets-to-styling-angular2/",
            "url": "http://davembush.github.com/secrets-to-styling-angular2/",
            "title": "Secrets to Styling Angular2",
            "date_published": "2017-01-31T12:30:00.000Z",
            "content_html": "<p>This past week, while working on a new project, I discovered some secrets to styling Angular2 that I don’t think are very well-known.</p>\n<p>There are two specific issues I needed to solve this week that took a bit of digging. The first was that I wanted my routes to fade in and out as I move between routes. The second was that I was using a grid control from a third party and I needed to style an inner component. We will cover both as well as some more basic operations.</p>\n<figure>![](/uploads/2017/01/image-2.png \"Secrets to Styling Angular2\") Photo via [Visual hunt](//visualhunt.com/)</figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Angular2-Version\"><a href=\"#Angular2-Version\" class=\"headerlink\" title=\"Angular2 Version\"></a>Angular2 Version</h2><p>Just so there isn’t any confusion, this article is accurate for Angular 2.x as of 2.5</p>\n<h2 id=\"The-Basics\"><a href=\"#The-Basics\" class=\"headerlink\" title=\"The Basics\"></a>The Basics</h2><p>Just to make sure we have the basics covered, we want to start with generic styling. The temptation might be to style each of your components independently. This would be a mistake. Angular2 doesn’t throw out all the existing CSS rules. Instead, it adds to them. Therefore, anything you can do with a generic style should be handled at that level.</p>\n<p>Since I generally use Bootstrap to theme my applications, this is what I’ll reference here. Using the angular-cli, the way you would add the CSS theme information is to include it in the angular-cli.json file of your application in the “styles” section.</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;styles&quot;: [</span><br><span class=\"line\">  <span class=\"string\">&quot;../node_modules/bootstrap/dist/css/bootstrap.css&quot;</span>,</span><br><span class=\"line\">  <span class=\"string\">&quot;styles.css&quot;</span></span><br><span class=\"line\">],</span><br></pre></td></tr></table></figure>\n\n<p>If you have a component that you need to style in a way that is outside the bounds of the general CSS you’ve included, you can add CSS to the components CSS file. This all works as expected with one small exception. The CSS you add to this file only applies to the component and will override any other CSS that might already be applied by the general CSS.</p>\n<p>This is Angular2 CSS 101 stuff. I’ve written pretty extensively about this in the article “<a href=\"https://medium.com/@davembush/adding-css-and-javascript-to-an-angular-cli-project-2b843a8283f3\">Adding CSS and JavaScript to an Angular-CLI Project</a>”</p>\n<h2 id=\"Host-access\"><a href=\"#Host-access\" class=\"headerlink\" title=\"Host access\"></a>Host access</h2><p>But there are times when the thing you want to style is the host container of the component. Not just the HTML inside it. There are two ways that you might do this.</p>\n<h3 id=\"host\"><a href=\"#host\" class=\"headerlink\" title=\":host\"></a>:host</h3><p>The first way is to use the <code>:host</code> directive in your CSS. But you’ll need to be careful with this, as I found out recently.</p>\n<p>You see, you might expect that</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-pseudo\">:host</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">background-color</span>: blue;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>would cause the background color of the element to turn blue. But if you try that with a simple component you’ll find out that nothing shows up with a background color of blue because by default an element that isn’t part of the HTML spec has no size and basically disappears from the display. We want it to display an essentially be a container for all our other HTML so what you really want to do is something like:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-pseudo\">:host</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">background-color</span>: blue;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: auto;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: auto;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>The only way it will show up, in my experience, is to make the position ‘absolute.’ Remember, we are doing this only because we want the :host to have some impact as a container for all the other elements that might be in it. Normally, you can get by styling the html inside it.</p>\n<h3 id=\"HostBinding\"><a href=\"#HostBinding\" class=\"headerlink\" title=\"@HostBinding()\"></a>@HostBinding()</h3><p>An alternate way of setting style on the component container is by using the @HostBinding() decorator. What this does is that it binds a variable to the containers attribute so that you can change the value from your TypeScript code.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">&#x27;app-view&#x27;</span>,</span><br><span class=\"line\">  templateUrl: <span class=\"string\">&#x27;./view.component.html&#x27;</span>,</span><br><span class=\"line\">  styleUrls: [<span class=\"string\">&#x27;./view.component.css&#x27;</span>]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">export <span class=\"keyword\">class</span> <span class=\"title\">ViewComponent</span> <span class=\"title\">implements</span> <span class=\"title\">OnInit</span> &#123;</span><br><span class=\"line\">  @HostBinding(<span class=\"string\">&#x27;style.backgroundColor&#x27;</span>)</span><br><span class=\"line\">    backgroundColr = <span class=\"string\">&#x27;blue&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  constructor() &#123; &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  ngOnInit() &#123;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Child-Elements\"><a href=\"#Child-Elements\" class=\"headerlink\" title=\"Child Elements\"></a>Child Elements</h2><p>Now, the other problem you might run into is that you’ll be using some third-party control and you’ll want to style some container element inside of it to fit your needs. Again, this isn’t a particularly common problem, but it might just take you a while to find the answer.</p>\n<p>The first thing you may try is to just style the markup.</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">component-parent component-child &#123;</span><br><span class=\"line\">    <span class=\"comment\">/* style stuff here */</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>But, try as you might, you’ll never get those styles to show up. You can style the <code>component-parent</code> all you want, but not the <code>component-child</code> no matter what you do.</p>\n<p>Here is the trick that allows you to style the <code>component-child</code>:</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">component-parent &gt;&gt;&gt; component-child &#123;</span><br><span class=\"line\">    /\\* style stuff here */</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>That <code>&gt;&gt;&gt;</code> thing is call the “piercing” operator. All you need to know is that it is how you get the child elements styled.</p>\n<h2 id=\"Animations\"><a href=\"#Animations\" class=\"headerlink\" title=\"Animations\"></a>Animations</h2><p>You might wonder, at first, why we would need an Animation API in Angular2. Aren’t CSS animations good enough? Well, actually… It isn’t that CSS animations aren’t good enough, but because Angular2 “hide” and “shows” elements by putting them into and out of the DOM and does other DOM manipulations that conflict with CSS animations, you will find there are time you are going to need to use the Angular2 Animation API.</p>\n<p>The Animation API works in a similar way to how the CSS Animations work so this isn’t going to be a big stretch for you if you are already familiar with CSS Animations.</p>\n<p>To animate a component, you are going to need to add an animations section to the @Component decorator of your component:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">  selector: <span class=\"string\">&#x27;app-view&#x27;</span>,</span><br><span class=\"line\">  templateUrl: <span class=\"string\">&#x27;./view.component.html&#x27;</span>,</span><br><span class=\"line\">  styleUrls: [<span class=\"string\">&#x27;./view.component.css&#x27;</span>],</span><br><span class=\"line\">  animations: [</span><br><span class=\"line\">      <span class=\"comment\">/* animation definitions here */</span></span><br><span class=\"line\">  ]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>The question then, is “how do we define an animation” Since animations is obviously an array, we want to know, what is it an array of? It is an array of triggers. A trigger has two parts. A name, an an array that specifies how the animation should work. This name gets used in our template using the [@name] syntax to bind to a component property.</p>\n<p>Next, we define each of the states we want to respond to and style we want to end up with when that state is triggered.</p>\n<p>Finally, we define each of the transitions.</p>\n<p>The combination gives us a lot of flexibility. While we can create the same kind of transitions that we might have using CSS, we can also create transitions the we never could have using CSS. All we need to do is have our component change the value of some member variable in some predictable way and the transitions will kick into work.</p>\n<p>You can read more about transitions on the <a href=\"//angular.io/docs/ts/latest/guide/animations.html\">Angular2 documentation page</a>.</p>\n<h2 id=\"Route-Animations\"><a href=\"#Route-Animations\" class=\"headerlink\" title=\"Route Animations\"></a>Route Animations</h2><p>Route animations are similar. However, this is where everything I’ve said above comes together.</p>\n<p>The first problem you are going to run into trying to animate a route is that the state you want to base your animations on is the route, which is the parent component of your component you are probably trying to animate. But the reality is, what you are really doing is animating something when it is first displayed and animating it again when it is going away. That is, when it is placed into the DOM and when it is being removed from the DOM. Angular2 has to predefined states for this, ‘:enter’ and ‘:leave’.</p>\n<p>So, we create a trigger named ‘routeAnimation’ and in our route components we bind to it using the @HostBinding() decorator.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@HostBinding(<span class=\"string\">&#x27;@routeAnimation&#x27;</span>) routeAnimation = <span class=\"literal\">true</span>;</span><br></pre></td></tr></table></figure>\n\n<p>Everything else you need to know I’ve already discussed above.</p>\n<p>For more information about routing animations, you can check the <a href=\"//angular.io/docs/ts/latest/guide/router.html\">router documentation on the Angular2 documentation page</a>.</p>\n<h2 id=\"Finally\"><a href=\"#Finally\" class=\"headerlink\" title=\"Finally\"></a>Finally</h2><p>It took me way too long to figure this out because a lot of the information has changed since RC0. Hopefully, it will point you in the right direction.</p>\n",
            "tags": [
                "angular",
                "animation",
                "css"
            ]
        },
        {
            "id": "http://davembush.github.com/amazing-angular2-dom-tips-tricks-and-warnings/",
            "url": "http://davembush.github.com/amazing-angular2-dom-tips-tricks-and-warnings/",
            "title": "Amazing Angular2 DOM Tips, Tricks, and Warnings",
            "date_published": "2017-01-17T12:30:00.000Z",
            "content_html": "<p>I’ve been working with Angular2 now since RC0 and I’ve learned quite a few things about Angular2 DOM tips, tricks, and warnings that you’ll want to pay attention to as you get started.</p>\n<figure>![](/uploads/2017/01/image.png \"Amazing Angular2 DOM Tips, Tricks and Warnings\")<figcaption>Photo credit: [Sister72](//www.flickr.com/photos/sis/196867770/) via [VisualHunt](//visualhunt.com) / [CC BY](//creativecommons.org/licenses/by/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Avoid-DOM-Manipulation\"><a href=\"#Avoid-DOM-Manipulation\" class=\"headerlink\" title=\"Avoid DOM Manipulation\"></a>Avoid DOM Manipulation</h2><p>One of the first things you need to understand about how Angular2 works compared to AngularJS is that any DOM manipulation you do using Angular2 isn’t really manipulating the DOM. At least not directly. Everything that happens at the DOM level is a result of a state change in the component. When Angular2 realizes that the state has changed, it changes the DOM to reflect the change.</p>\n<p>What this means, generally, is that if you need to know about some state change that happened at the DOM level, you’ll want to track that change in your component class. Can you access the DOM directly from your code? Yes. And sometimes you might just have to. But you’ll produce code that is much easier to test if you avoid having your code reach up into the DOM to get current state information.</p>\n<p>You may have already heard about the experimental Web Workers support in Angular2. To make sure you can use this, it would be best to avoid direct DOM manipulation until we are sure the Web Workers implementation will be able to deal with this properly. What this all means in practical terms is that you’ll want to avoid using libraries such as jQuery to manipulate your code and instead replicate that behavior using native Angular2 calls.</p>\n<h2 id=\"Only-Generate-the-HTML-You-Need\"><a href=\"#Only-Generate-the-HTML-You-Need\" class=\"headerlink\" title=\"Only Generate the HTML You Need\"></a>Only Generate the HTML You Need</h2><p>On a similar note, you only want to render the HTML you’re going to need at any one time. Not everything all at once. This will allow your code to render much more efficiently.</p>\n<p>For example, if you have a menu that has dropdown menus, the temptation is going to be to render all the HTML the menu may need all at once and use JavaScript to show or hide the dropdowns as you mouse over them or click them. But with Angular2, you could use the *ngIf directive to include and exclude the menu option as you need them to show. This reduces the initial page size and simplifies your code. Been there, done that.</p>\n<p>By the way, there are other directives you’ll want to get familiar with, but *ngIf is probably the most often ignored because you are likely to try to use display:none to hide an element instead of just eliminating it from the DOM completely.</p>\n<h2 id=\"Minimize-Change-Detection\"><a href=\"#Minimize-Change-Detection\" class=\"headerlink\" title=\"Minimize Change Detection\"></a>Minimize Change Detection</h2><p>I was recently working on a component that displayed a nested array as a set of tabs and dropdown menus. Everything was working great but I wanted to check the CSS on the dropdown so I could make some adjustments. This is when I discovered that the HTML was being rewritten about once a second even though nothing had changed. I couldn’t see this on the main screen, but it became super evident when I opened the developer tools.</p>\n<p>Fortunately, I had already learned about OnPush change detection. So I was able to set my component to use Push notification:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Component(&#123;</span><br><span class=\"line\">    templateUrl: <span class=\"string\">&#x27;template.html&#x27;</span>,</span><br><span class=\"line\">    changeDetection: ChangeDetectionStrategy.OnPush <span class=\"comment\">// &lt;===</span></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">export <span class=\"keyword\">class</span> <span class=\"title\">View</span> ...</span><br></pre></td></tr></table></figure>\n\n<p>And now the component only re-renders when the data it is looking at changes.</p>\n<p>For Push notification to work correctly, all the data that the component is looking at has to be <a href=\"/what-if-everything-was-immutable/\">immutable</a> or an <a href=\"/reasons-to-use-rxjs-today/\">Observable</a>. These are both patterns you should become familiar with because any well architected Angular2 application will make significant use of both of these.</p>\n<h2 id=\"Accessing-the-Component-Container\"><a href=\"#Accessing-the-Component-Container\" class=\"headerlink\" title=\"Accessing the Component Container\"></a>Accessing the Component Container</h2><p>Another problem I recently had was that I wanted to use the class attributes from the container on a child component. The question I had trouble getting the answer to was, “just how to I access the container element?” This was very easy. It is always easy once you know the secret handshake.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.elementRef</span><br></pre></td></tr></table></figure>\n\n<p>There are various properties and methods hanging off that which might be useful to you. In my case, I wanted to go after the classes that had been attached and reattach them to the INPUT element that was a child of the component. So, I needed to use:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.elementRef.nativeElement.classList</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Accessing-Child-Elements\"><a href=\"#Accessing-Child-Elements\" class=\"headerlink\" title=\"Accessing Child Elements\"></a>Accessing Child Elements</h2><p>Similarly, you might want to access child elements from your code. This is much easier to find when you search the Internet.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ViewChild(<span class=\"string\">&#x27;input&#x27;</span>) input: ElementRef;</span><br></pre></td></tr></table></figure>\n\n<p>@ViewChild is an attribute that tells the Angular2 compiler to look for an element in the template with the variable named input. I’ll explain template variables in a bit. In the code above, I’m going after the INPUT element with a template variable named “input” so I typed it as ElementRef since I don’t have a specific class name for it.</p>\n<p>If you only have one unique element, you can just use code that looks more like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@ViewChild(ElementClassName) variableName: ElementClassName;</span><br></pre></td></tr></table></figure>\n\n<p>Of course, you’ll want to make sure you imported <code>ElementClassName</code> for this to work. In this case, I’m going after a specific type of element so I type the variable as that type. Now my typescript code knows what properties, fields, and methods I have available.</p>\n<h2 id=\"Template-Variables\"><a href=\"#Template-Variables\" class=\"headerlink\" title=\"Template Variables\"></a>Template Variables</h2><p>As I mentioned above, you can create template variables to allow you to access your child elements from your typescript code. But you can use them for other purposes as well. To create a template variable, just put a hash in front of the variable name you want to use.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">input</span> #<span class=\"attr\">firstName</span> <span class=\"attr\">...</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>Now you can use this in your typescript using ViewChild() as explained above, or you can use it in your template as a regular variable.</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123; &#123;firstName.value&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Use-a-Model-Driven-Approach\"><a href=\"#Use-a-Model-Driven-Approach\" class=\"headerlink\" title=\"Use a Model Driven Approach\"></a>Use a Model Driven Approach</h2><p>If you are coming from AngularJS, you may be tempted to use what is commonly referred to as a Template Driven approach. This is approach that relies no “Two-Way” data-binding to update the data in the typescript code to the fields in your template. While this works for a lot of simple apps, you never know when a simple app will turn into a complex app and your Template based approach will quickly become insufficient.</p>\n<p>No, what you want to use is the Model Driven approach. This approach gives you A LOT more control over what we typically are attempting to do in our forms and scales well as the complexity of our forms increases.</p>\n<p>I’ve written a lot more about this in my post on <a href=\"/awesome-angular2-architecture-options-and-opinions/\">Angular2 Architecture</a>.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>Obviously, there is a lot to learn. If you keep using Angular2 like you’ve been using AngularJS, you are going to run into a lot of difficulties. It pays to learn how a system works prior to using it for a real application.</p>\n<p>What have you learned along the way? Leave a comment.</p>\n",
            "tags": [
                "angular",
                "typescript",
                "DOM"
            ]
        },
        {
            "id": "http://davembush.github.com/what-if-everything-was-immutable/",
            "url": "http://davembush.github.com/what-if-everything-was-immutable/",
            "title": "What if Everything Was Immutable?",
            "date_published": "2017-01-10T12:30:00.000Z",
            "content_html": "<p>The first time a programmer who was trained in the classical procedural&#x2F;object oriented history is confronted with the concept of making everything immutable, the first question that comes to mind is, “won’t that make my application slow?”  This is because of how most programmers have been trained.  Making everything immutable generally means that we must copy a lot of memory from one place to another.  Moving memory around is generally considered slow.</p>\n<p>And so, most programmers dismiss the whole idea as crazy talk.  But is it really all that crazy?</p>\n<figure>![](/uploads/2016/12/image-4.png \"What if Everything Was Immutable?\")<figcaption>Photo credit: [Paul Stevenson](//www.flickr.com/photos/pss/354177349/) via [Visualhunt](//visualhunt.com) / [CC BY](//creativecommons.org/licenses/by/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Two-Paths\"><a href=\"#Two-Paths\" class=\"headerlink\" title=\"Two Paths\"></a>Two Paths</h2><p>So, let’s look at some computer history.  If you’ve been in this industry any length of time, you’ve probably heard the name Turing and you know the Turing machine has something to do with programming.  But you may not know how it impacts your day to day programming life.</p>\n<p>In short, Turing is the guy we can point to as the father of modern computing, complete with the fact that we generally process everything sequentially.  It is this sequential processing that causes us to have instructions working on memory and it has served us well.</p>\n<p>But there is another branch of computer science that was made popular by Alonzo Church that is based on Lambda Calculus.  This branch of computer science is where the bulk of Functional Programming can be traced back to.  In this branch, everything is a function.  Any parameters you pass in cannot have their state changed and the value that is returned is a new value.</p>\n<p>The main benefits to this newer functional style are:</p>\n<ul>\n<li>If I pass in the same parameters, I’ll always get back the same value.</li>\n<li>State is never mutated accidentally because state is never mutated.</li>\n<li>Functions never have an unpredictable side effect.</li>\n</ul>\n<p>Just think of how many bugs you wouldn’t have introduced into your code had this been true when you wrote it.</p>\n<h2 id=\"Convergence\"><a href=\"#Convergence\" class=\"headerlink\" title=\"Convergence\"></a>Convergence</h2><p>Recently, functional programming has become more popular and the two branches of computer science have started to merge.  Taking the best of both worlds and using what makes sense from each.  But, we’ve already had at least one immutable object in most of our object-oriented languages.  The String object.  So, what does String give us that we use nearly every day?</p>\n<h2 id=\"Immutable-Strings\"><a href=\"#Immutable-Strings\" class=\"headerlink\" title=\"Immutable Strings\"></a>Immutable Strings</h2><h3 id=\"No-Side-Effects\"><a href=\"#No-Side-Effects\" class=\"headerlink\" title=\"No Side Effects\"></a>No Side Effects</h3><p>As we’ve already mentioned, that fact that something is immutable means it can’t be changed.  So, when you pass a string as a parameter, even though it is an object, the string won’t change if the function changes the string.  This is good news because the calling function doesn’t have to protect itself against unintended consequences.</p>\n<h3 id=\"Memory-Efficiency\"><a href=\"#Memory-Efficiency\" class=\"headerlink\" title=\"Memory Efficiency\"></a>Memory Efficiency</h3><p>The other thing that happens with immutable object is that every string representation only exist once.  So, we never duplicate memory.</p>\n<p>What do I mean by this? Well, take this example from C#</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> string1 = <span class=\"string\">&quot;abc&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> string2 = <span class=\"string\">&quot;abc&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (string1 == string2) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">writeLn</span>(<span class=\"string\">&#x27;is equal&#x27;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Testing-Equality\"><a href=\"#Testing-Equality\" class=\"headerlink\" title=\"Testing Equality\"></a>Testing Equality</h3><p><code>string1</code> and <code>string2</code> point to the same object “abc” not two different instances of “abc”.  This is why we can write <code>string1 == string2</code>.  Unfortunately, the &#x3D;&#x3D; operator is overloaded so we are still doing string comparison.  </p>\n<p>But if you want efficiency, you can use the <a href=\"/net-string-pool-not-just-for-the-compiler/\">Intern()</a> method and ReferenceEquals() to bypass this overload and use pointer comparison.  This is a good thing because we test for string equality and inequality so often the performance penalty we incur from making strings immutable is more than offset by the performance gains we get testing for equality.</p>\n<h2 id=\"Make-Everything-Immutable\"><a href=\"#Make-Everything-Immutable\" class=\"headerlink\" title=\"Make Everything Immutable\"></a>Make Everything Immutable</h2><p>If you think about the code you typically write, how much of the time would you benefit from every object in your code working in a similar way to strings? Wouldn’t it be a great thing if you knew that when you passed an object into a function, that function was not going to change the object at all?  Can you think of times that might have prevented a bug? Think of the memory optimizations you would benefit from.</p>\n<p>And how much easier would it be to test for equality if all you had to test was a memory pointer?  Not only would it be fast, but it would be reliable and a lot less work to code.</p>\n<h2 id=\"Immutability-is-Hard-–-or-is-it\"><a href=\"#Immutability-is-Hard-–-or-is-it\" class=\"headerlink\" title=\"Immutability is Hard – or is it?\"></a>Immutability is Hard – or is it?</h2><p>So now that you know what the benefits are, you are probably thinking, “Yes, but coding immutability into a language that doesn’t support it natively is a lot of work.  It is so much easier to write code the way I always have, even if it isn’t quite a safe.” Yes, I feel your pain.  But there are libraries for that.  Say you could get all the benefits of immutability with very little programming or performance cost?  Would you be interested? I know I was.  Just having the benefits of immutable data with the performance was benefit enough for me.  But then I was introduced to <a href=\"//facebook.github.io/immutable-js/\">immutable.j</a>s and I realized that I could have all of the benefits with a lot less performance cost than I was expecting because the library uses data structures that allow us to manipulate pointers rather than raw data.  The result is that only pointers to data that have actually changed change.  Nearly everything else stays as it was and adding items to List instead of arrays and Maps ends up being a lot more efficient.</p>\n<h2 id=\"Impact-on-Angular2\"><a href=\"#Impact-on-Angular2\" class=\"headerlink\" title=\"Impact on Angular2\"></a>Impact on Angular2</h2><p>By using immutable object in Angular2 along with libraries like <a href=\"//github.com/ngrx/store\">NgRX&#x2F;Store</a> you can see some major performance increases because the view will be able to determine when it needs to change based on simple object pointer comparison rather than checking entire objects.  For compute-intensive tasks, this is going to be a huge benefit.</p>\n<p>But it is also well worth learning how to use this before you ever need it simply because it will be a new way of thinking about your project that may take some time to get accustomed to.</p>\n",
            "tags": [
                "angular",
                "javascript",
                "immutable"
            ]
        },
        {
            "id": "http://davembush.github.com/awesome-angular2-architecture-options-and-opinions/",
            "url": "http://davembush.github.com/awesome-angular2-architecture-options-and-opinions/",
            "title": "Awesome Angular2 Architecture Options and Opinions",
            "date_published": "2016-12-27T12:30:00.000Z",
            "content_html": "<p>On the subject of Angular2 Architecture, the perception is that Angular 2 is a highly-opinionated architecture. But even though there is a <a href=\"/angular.io/styleguide\">style guide for Angular 2</a>, there are a lot of decisions that still need to be made when working on any but the most trivial of applications. And even then, since most applications take on a life of their own, one could make the case that you need to make these decisions for any application you are building regardless of the initial size. Applications grow up. But, that’s another blog post</p>\n<p>I’ve identified, and have formed opinions about 5 areas that Angular 2 leaves open for decisions. Areas that if you don’t spend time considering the choices and making decisions could cost you in the future</p>\n<p>The five areas I’ve identified are:</p>\n<ol>\n<li>Handling Forms</li>\n<li>Page State Management</li>\n<li>Component State Management</li>\n<li>Data Flow</li>\n<li>Client Side Data</li>\n</ol>\n<figure>![](/uploads/2016/12/image-2.png \"Awesome Angular2 Architecture Options and Opinions\") Photo via [africaniscool](//pixabay.com/en/users/africaniscool-216435/) via [Visualhunt.com](//visualhunt.com/photos/business/)</figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Handling-Forms\"><a href=\"#Handling-Forms\" class=\"headerlink\" title=\"Handling Forms\"></a>Handling Forms</h2><p>There are, at this point, two ways of dealing with forms in Angular 2. The first looks a lot like Angular 1 in that it is “Template Driven.” That is, everything you would describe about the form goes in the template. Using declarative syntax, the bulk of your form logic is declared in “HTML” like syntax and bound to your TypeScript code in a “code behind” kind of way. In a lot of ways, this will be very familiar to people who have coded ASP.NET or Angular 1</p>\n<p>But, the problem with using this method is that at some point, you won’t be able to do something you need to do using just a declarative syntax. The option is to use a “Model Driven” approach. These leaves the HTML parts in the template with a few tags to wire the template to the TypeScript code it is associated with, but the bulk of the processing is all in the TypeScript file. On the surface, you might think, “but Template Driven is much easier to think about.” But I assure you, using a predominately model driven approach has several advantages that the serious programmer will enjoy.</p>\n<h3 id=\"More-control-over-your-forms\"><a href=\"#More-control-over-your-forms\" class=\"headerlink\" title=\"More control over your forms.\"></a>More control over your forms.</h3><p>The first advantage you will notice is that you’ll have more control over your form. One place you will notice this is with form validation. But, you’ll also notice greater control because you will have direct control on how the data moves in and out of your form instead of the “magic happens here” of data binding that can, with complex forms, become entirely too complex to reason about.</p>\n<h3 id=\"Easier-to-test-the-forms\"><a href=\"#Easier-to-test-the-forms\" class=\"headerlink\" title=\"Easier to test the forms.\"></a>Easier to test the forms.</h3><p>Another huge advantage to using Model Driven forms is that you end up with forms that are MUCH easier to test. You can assume that the HTML is doing what it should and just test the TypeScript code. With a more template driven approach you’ll need to work out how to actually test your HTML. It can be done, and it isn’t really all that hard. But using a model driven approach is easier.</p>\n<h3 id=\"Easier-to-reason-about-how-the-code-is-being-processed\"><a href=\"#Easier-to-reason-about-how-the-code-is-being-processed\" class=\"headerlink\" title=\"Easier to reason about how the code is being processed.\"></a>Easier to reason about how the code is being processed.</h3><p>Related to the two previous points, using Model Driven forms makes your cod much easier to reason about. Once again, that whole “magic happens here” approach of data-binding can get in the way, while using the model driven approach will allow you to be very direct about what gets updated when more directly.</p>\n<h2 id=\"Page-and-Component-State-Management\"><a href=\"#Page-and-Component-State-Management\" class=\"headerlink\" title=\"Page and Component State Management\"></a>Page and Component State Management</h2><p>The temptation is to try to architect an Angular 2 project so that it looks something like how we used to write Angular 1 applications. That is, using an MV* architecture. Where this gets messed up is that the HTML template, the TypeScript and the CSS are really all part of the same class. Once you start thinking of them as one, MV* stops making as much sense</p>\n<p>The pattern I prefer here is one that uses the top-level View as a Controller View. That is, it is the one component that is responsible for being the traffic data cop. All the components under it are responsible for either rendering the state information they have been passed by the Controller View, updating that state information or firing event out when they’ve done something the outside world should know about</p>\n<p>The View Controller, on the other hand, is responsible for getting the data to and from where ever it needs to go</p>\n<p>By doing this, you end up with very testable, modular code and it becomes very clear that all your logic for a page, or sub-page, exist in one very well-defined section of your code. In fact, you can eliminate the need for most dependency injection by following this pattern. Any dependency injection you do need will probably end up in your Controller View.</p>\n<h2 id=\"Data-Flow\"><a href=\"#Data-Flow\" class=\"headerlink\" title=\"Data Flow\"></a>Data Flow</h2><p>So far, the three main methods of data management that have emerged for Angular 2 seem to be:</p>\n<ol>\n<li>Direct Access</li>\n<li>Flux&#x2F;Redux</li>\n<li>NgRX&#x2F;Store</li>\n</ol>\n<h3 id=\"Background\"><a href=\"#Background\" class=\"headerlink\" title=\"Background\"></a>Background</h3><h4 id=\"MVVM\"><a href=\"#MVVM\" class=\"headerlink\" title=\"MVVM\"></a>MVVM</h4><p>While MVVM was possible in Angular 1, and it works at the View level in Angular 2, the preferred model is what has come to be known as “One way data binding” which sounds odd, and really doesn’t describe what it does</p>\n<p>In short, while all the code you write may act like it is using two-way data-binding, the reality is that the code is only ever flowing in one direction</p>\n<p>The problem with true MVVM data binding is that when it is done correctly, data changes because other data changed</p>\n<p>This makes it very difficult to reason about the data in your application in all but the smallest of applications</p>\n<p>Further, to get this to work correctly, the resulting system is almost always slower than it needs to be. I’ve written before about <a href=\"/4-reasons-to-drop-mvvm/\">why I think MVVM is a poor choice for design patterns</a>.</p>\n<h4 id=\"Direct\"><a href=\"#Direct\" class=\"headerlink\" title=\"Direct\"></a>Direct</h4><p>It is possible to write an application that kind of looks like old style three layer architectures that some might try to call MVC, but it is a poor man’s implementation at best, and only because Angular 2 implements its own Dependency Injection Container mechanism does the result end up being anything close to loosely coupled</p>\n<p>This implementation generally has the top-level component managing the state of the application, or at least the state of that particular page, and calling out directly to services that retrieve data from the server and manipulate data</p>\n<p>While it works, in larger applications it can be difficult to manage and respond to state changes throughout your application. Imagine if that could happen for “free”.</p>\n<h4 id=\"Flux\"><a href=\"#Flux\" class=\"headerlink\" title=\"Flux\"></a>Flux</h4><p>The React community introduced a new pattern called Flux. There are multiple implementations of Flux, but the one that has become the defacto standard is called Redux. In general, Flux is made up of a series of publish subscribe mechanisms and ends up looking a lot like what the Gang of Four originally defined MVC to be while not actually being MVC.</p>\n<p>In very simple terms, the View fires an event to a “Dispatcher” which is a singleton. Each repository, or data store, or model (just depends on what you want to call it) registers a listener with the “Dispatcher” that lets the dispatcher know that it wants to know whenever something significant happens. These repositories are also singletons.</p>\n<p>When the Dispatcher receives a notification from a View, it notifies all the listeners in turn. The listeners look at the message they receive from the dispatcher to see if it is something they care about. If it is, they process the message accordingly.</p>\n<p>Once they are done, they fire an event to each Controller View that has registered a listener with them. The Controller View then updates the view based on the information it was passed in the event. I don’t want this to get too far down the road of “How” but to make the above paragraph just a bit clearer…</p>\n<p>There is a top-level View item that does no rendering. It is only responsible for responding to event notifications and passing the data down into the child views. You may hear this referred to as a View Controller, but it is more accurately a Controller View.</p>\n<p>Hopefully, you can see how this solves the problem up needing to force an update on a View because some other View changed the state of something. Because everyone who cares about the state is listening for a notification that something changes, the screen update “just works” and is much more reliable than a more MVVM style of updating the view and data.</p>\n<h4 id=\"NgRX-x2F-Store\"><a href=\"#NgRX-x2F-Store\" class=\"headerlink\" title=\"NgRX&#x2F;Store\"></a>NgRX&#x2F;Store</h4><p>Reactive Extensions are available for multiple platforms, including JavaScript. You can read more about them at <a href=\"//reactivex.io/\">http://reactivex.io/</a> and I’ve written about <a href=\"/reasons-to-use-rxjs-today/\">the reasons you want to use them</a> before. But for purposes of this article, one of the problems that Reactive programming solves is cleanly dealing with the asynchronous nature of JavaScript</p>\n<p>Nowhere is this more obvious than with Ajax request.</p>\n<p>If you’ve ever needed to deal with having to wait for multiple Ajax request to complete before you do something meaningful with the data, you are going to love Reactive programming.</p>\n<p>Another thing that Reactive programming gives you is it makes everything a “stream”.</p>\n<p>In simple terms imagine working with an array that never ends and being able to respond appropriately to each element that come through that stream of arrays and you’ll have a good conceptual idea of what it means that everything is a stream. This is how Reactive programming deals with asynchronous calls and events. Add to this the concept that streams can be combined and you’ll start to understand why this cleans up the asynchronous nature of JavaScript.</p>\n<p>The result is that we can write code that fills the stream and other code that says, “when a particular item comes in on the stream, let me know about it.” Basically, an embellished publish&#x2F;subscribe design pattern.</p>\n<p>From the description above, you should be able to see that Reactive programming can be used to implement Flux.</p>\n<p>This is exactly what NgRx&#x2F;Store does. It allows us to concentrate on writing Reducers while it focuses on managing the dispatcher, event handling, and the various repositories, or stores, our application might need.</p>\n<p>As I’ve used NgRX&#x2F;Store in my own applications, I’ve found that it further reduces the need for dependency injection and increases the testability of my code. The tradeoff is that there is a learning curve. But the time learning this new design pattern is well worth the effort.</p>\n<h2 id=\"Client-Side-Data\"><a href=\"#Client-Side-Data\" class=\"headerlink\" title=\"Client Side Data\"></a>Client Side Data</h2><p>At some point, you are going to need to manage the data on the client side. There are several issue you might want to consider. But at the most fundamental layer, you will end up with data on the client side that looks like a relational data in a database. The only difference is that your data will be primarily JSON data. Eventually, you’ll want to join that data or filter it. How will you do that? One product you might consider is <a href=\"//www.getbreezenow.com/\">Breeze</a>. It does a lot of stuff that makes your client side data look more like a database. It is worth a look</p>\n<p>If you end up using NgRX&#x2F;Store and RxJS, you may find that does everything you need. So that is another option. The advantage to using this method is you are no longer constrained by trying to make everything look like a relational database table even when it isn’t</p>\n<p>The other option, of course, is to use both for what they are good at.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>Angular 2 brings a lot of new concepts. While it might be tempting to use coding patterns that seem more comfortable, I believe that the path that Angular 2 has chosen is the future of JavaScript specifically and the programming world in general.</p>\n<p>Just about everything that is new falls into the general category of “Functional Programming” and much like the switch from procedural programming to object oriented programming, there are going to be people who are not able to wrap their heads around the concepts. How many guys ended up using C++ syntax to write C code? However, the productivity gains once we make the jump to this new way of thinking about our code will be well worth both the learning curve and the possible loss of some older programmers who can’t or won’t be retrained.</p>\n<p>There is also a danger of not being able to retain good programmers because we are still stuck using design patterns that were popular in the past but have been superseded by ways the developer community at large considers “better.”</p>\n",
            "tags": [
                "angular",
                "javascript",
                "archietcture"
            ]
        },
        {
            "id": "http://davembush.github.com/dissecting-angular-2-modules/",
            "url": "http://davembush.github.com/dissecting-angular-2-modules/",
            "title": "Dissecting Angular 2 Modules",
            "date_published": "2016-12-20T12:30:00.000Z",
            "content_html": "<p>In the new world of Angular 2, and even in the world of Angular.js, you might feel like the concept of a module is the most difficult to wrap your head around.</p>\n<p>This is especially if you’ve only ever written client side JavaScript code. Once you’ve learned why you need a module, the temptation is to use one module for all your code. I am guilty of doing that myself when I first started. But, many times using one module for your entire application is the wrong thing to do because it reduces the ability to reuse your code in other modules. Once you understand why modules exist, you’ll begin to reason about how to use modules appropriately.</p>\n<figure>![](/uploads/2016/12/image-1.png \"Dissecting Angular 2 Modules\")<figcaption>Photo credit: [Sappymoosetree](//www.flickr.com/photos/bahkubean/416801559/) via [Visual hunt](//visualhunt.com) / [CC BY-ND](//creativecommons.org/licenses/by-nd/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Why-Do-Modules-Exist\"><a href=\"#Why-Do-Modules-Exist\" class=\"headerlink\" title=\"Why Do Modules Exist?\"></a>Why Do Modules Exist?</h2><p>When the Angular 2 project started, modules did not exist, even though they had existed in Angular.js. But as the RC process continued, it became obvious that modules were going to be necessary. We could have written our code without modules, but the amount of code we would need to repeat to get the same functionality would be dramatically greater.</p>\n<p>It also often becomes more complex and harder to reason about.</p>\n<p>So, what exactly do modules get us? If you’ve worked in languages in the past that have the concept of a namespace, it might help you to think of a module as a substitute for namespaces. They allow us to group similar functionality together, and specify what functionality that belongs to the module can be accessed by the outside world. For example, I recently wrote a component that all the applications in our organization will be starting out with. It is composed of multiple components, but I only want the top most component exposed to the developers who will be using it.</p>\n<p>So, modules allow us to both group code together and encapsulate code so that code that might otherwise be publicly available becomes private to the outside world.</p>\n<h2 id=\"Dissecting-Modules\"><a href=\"#Dissecting-Modules\" class=\"headerlink\" title=\"Dissecting Modules\"></a>Dissecting Modules</h2><p>You may remember that in the <a href=\"//github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-4\">application we’ve been working on</a> we’ve already created a module. In fact, when you create any application using the CLI, there will always be this top-level module.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@NgModule(&#123;</span><br><span class=\"line\">  declarations: [</span><br><span class=\"line\">    AppComponent</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  imports: [</span><br><span class=\"line\">    BrowserModule,</span><br><span class=\"line\">    FormsModule,</span><br><span class=\"line\">    HttpModule,</span><br><span class=\"line\">    GettingStartedWithAngular2RoutingModule</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  providers: [],</span><br><span class=\"line\">  bootstrap: [AppComponent]</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">export <span class=\"keyword\">class</span> <span class=\"title\">AppModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>The declarations section simply specifies the components that this module owns. In the case of our app so far, the only component it owns is the top-level AppComponent.</p>\n<p>The imports section loads modules this module is going to need available in the components it owns. Many times, the components we need access to are only needed in our templates. Prior to using modules, we would need to include our components in our TS files just so the templates could access them. By loading them in the module, we can load modules once even though we may have multiple components that are part of the module that may need them.</p>\n<p>Since our module is not using any injectables, the providers section is empty. But that is what the providers section is for. Any class that we will need to inject in the constructor of other code would be listed in this providers section.</p>\n<p>Finally, the bootstrap section has the one component this module should load. This only shows up in the top-level module. While it is needed, I’ve yet to figure out why. We’ve already loaded the module, and therefore the component and the tag for the top-level component is in our index.html file, so I can’t see the point of specifying it here yet again.</p>\n<p>You may wonder, “How does this AppModules get loaded?” Go back to the root of your app directory and look for the main.ts file. You’ll see that we loaded it in there.</p>\n<p>platformBrowserDynamic().bootstrapModule(AppModule);</p>\n<p>You might wonder why this code is not included in the application module. This is because you might not always want to use platformBrowserDynamic(). If you are using Web Workers to run your code or using Ahead of Time compile, you would use two other methods of bootstrapping the module. I’ve only mentioned three here, but there are others.</p>\n<p>The next property you are likely to see in a module declaration is the exports section:</p>\n<p>exports:  [Edit]</p>\n<p>This tells the module that has imported this module that it can use the Edit component. We didn’t need this in the app module because the app module isn’t being used by another module. It is the top most module and really can’t be used by any other module by definition.</p>\n<h2 id=\"Routing-and-Modules\"><a href=\"#Routing-and-Modules\" class=\"headerlink\" title=\"Routing and Modules\"></a>Routing and Modules</h2><p>Several weeks ago we took a look at <a href=\"/angular-2-lazy-loading/\">implementing Lazy Loading by modifying our routing module</a>. What is unique about this situation is that every time you lazy load a module, it becomes the top most module, so once again, there is no real need to export it.</p>\n<h2 id=\"When-Should-Modules-Be-Used\"><a href=\"#When-Should-Modules-Be-Used\" class=\"headerlink\" title=\"When Should Modules Be Used?\"></a>When Should Modules Be Used?</h2><p>As I said when I started, the temptation is to just put all our import statements that our application is going to need in our app module. But that seems like an extremely lazy way of writing code. And when you go to write lazy loaded modules, that’s not going to work so well for you. So, there are two ways you can approach this.</p>\n<p>First, you can just create a module for every component you write. It is probably over kill, but it would be hard to go too far wrong here. Given the choice between too many modules and not enough, I’d error on the side of too many. At least it gives you the flexibility do make necessary changes in the future.</p>\n<p>But the more reasonable approach would be one module per feature and a module for common stuff. For example, if you are writing a component library, you would probably be safe writing a module for all the components in your library so you only have to import the library module and all your component would automatically become available to you. You’ll want to at least want to have one module per route so that you can lazy load the routes if you decide that is necessary.</p>\n",
            "tags": [
                "angular",
                "javascript",
                "modules"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-2-lazy-loading/",
            "url": "http://davembush.github.com/angular-2-lazy-loading/",
            "title": "Angular 2 Lazy Loading",
            "date_published": "2016-12-06T12:30:00.000Z",
            "content_html": "<p>Last week when we took a look at <a href=\"/adding-client-side-routing-to-angular-2/\">Client side Routing</a>, I mentioned that one of the reasons you’d want to implement a component in its own module is so that we could lazy load the component and its dependencies</p>\n<p>This week, we want to dig into how to implement lazy loading in your Angular 2 application</p>\n<figure>![](/uploads/2016/11/image-5.png \"Angular 2 Lazy Loading\") Photo via [jordan](//pixabay.com/en/users/jordan3600-400129/) via [Visualhunt](//visualhunt.com/)</figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"What-Is-Lazy-Loading\"><a href=\"#What-Is-Lazy-Loading\" class=\"headerlink\" title=\"What Is Lazy Loading?\"></a>What Is Lazy Loading?</h2><p>Imagine that you’ve written an application that is divided into four main sections. The people using the site may only use one or two sections of the site at a time, or at all. Is it fair to make them download the entire site? Or maybe you’ve written a monster site. Wouldn’t it make more sense to download only what you need as you need it? The perceived performance of a site written like this far exceeds the performance of a site that requires you to download everything at once</p>\n<p>And so, Lazy Loading was developed as a way of solving these issues and others. The idea is, rather than downloading everything, download only what is needed when it is needed.</p>\n<h2 id=\"The-Code\"><a href=\"#The-Code\" class=\"headerlink\" title=\"The Code\"></a>The Code</h2><p>Remember that last week we implemented a View module and an Edit module. We called them from our router by importing the modules and telling the router to load the components when a route was specified</p>\n<p>Because we are no longer loading the modules as part of our main application, we are going to go into the <code>app-routing.module.ts</code> file and remove all of the references to the components and the module. Instead, we are going to load the module using the <code>loadChildren</code> property in our route array.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import &#123; NgModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/core&#x27;</span>;</span><br><span class=\"line\">import &#123; Routes, RouterModule &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;@angular/router&#x27;</span>;</span><br><span class=\"line\"><span class=\"comment\">// import &#123; ViewComponent &#125; from &#x27;./view/view.component&#x27;;</span></span><br><span class=\"line\"><span class=\"comment\">// import &#123;ViewModule&#125; from &quot;./view/view.module&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">// import &#123;EditModule&#125; from &quot;./edit/edit.module&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">// import &#123;EditComponent&#125; from &quot;./edit/edit.component&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> routes: Routes = [</span><br><span class=\"line\">  &#123; path: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    loadChildren: <span class=\"string\">&#x27;./view/view.module#ViewModule&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//component: ViewComponent</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; path: <span class=\"string\">&#x27;Add&#x27;</span>,</span><br><span class=\"line\">    loadChildren: <span class=\"string\">&#x27;./edit/edit.module#EditModule&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//component: EditComponent</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; path: <span class=\"string\">&#x27;Edit/:id&#x27;</span>,</span><br><span class=\"line\">    loadChildren: <span class=\"string\">&#x27;./edit/edit.module#EditModule&#x27;</span></span><br><span class=\"line\">    <span class=\"comment\">//component: EditComponent</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\">@NgModule(&#123;</span><br><span class=\"line\">  imports: [</span><br><span class=\"line\">    RouterModule.forRoot(routes)</span><br><span class=\"line\">    <span class=\"comment\">//ViewModule,</span></span><br><span class=\"line\">    <span class=\"comment\">//EditModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  exports: [RouterModule],</span><br><span class=\"line\">  providers: []</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">export <span class=\"keyword\">class</span> <span class=\"title\">GettingStartedWithAngular2RoutingModule</span> &#123; &#125;</span><br></pre></td></tr></table></figure>\n\n<p>You’ll notice the format of the loadChildren string is:</p>\n<ol>\n<li>The path to the module (without the file extension)</li>\n<li>hash</li>\n<li>The class in the component that is exported</li>\n</ol>\n<p>But, there is nothing in the code that tells us what component is supposed to load. This is because the job of deciding what component to load has now been delegated to the module</p>\n<p>This is the part that remained a mystery to me for quite a while. I would look at the code demos but never saw the next part. Maybe this will save you some of that trouble</p>\n<p>In the view module, add this line to the imports array:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> RouterModule.forChild([</span><br><span class=\"line\">    &#123;path: <span class=\"string\">&#x27;&#x27;</span>, component: ViewComponent&#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n\n<p>Notice that we are using forChild here instead of forRoot but otherwise this looks the same as what we originally had for the View component prior to implementing lazy loading</p>\n<p>We can implement a similar line in the EditModule, except the component will be EditComponent.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RouterModule.forChild([</span><br><span class=\"line\">    &#123;path: <span class=\"string\">&#x27;&#x27;</span>, component: EditComponent&#125;</span><br><span class=\"line\">])</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Under-the-Hood\"><a href=\"#Under-the-Hood\" class=\"headerlink\" title=\"Under the Hood\"></a>Under the Hood</h2><p>Build the system using <code>ng build</code> because I want to show you what is happening under the hood</p>\n<p>Once you’ve built the system, look in the <code>dist</code> directory. You’ll see a <code>0.chunk.js</code> and a <code>1.chunk.js</code> file. These files hold the module and dependencies that we’ve lazy loaded</p>\n<p>If you load the application with the developer tools loaded and look at the network tab, you’ll see that one chunk is loaded immediately, for the view. The other is loaded when you navigate to the add or edit path</p>\n<p>The code so far can be found at <a href=\"//github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-4\" title=\"https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-4\">https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-4</a></p>\n",
            "tags": [
                "angular",
                "lazy loading"
            ]
        },
        {
            "id": "http://davembush.github.com/adding-client-side-routing-to-angular-2/",
            "url": "http://davembush.github.com/adding-client-side-routing-to-angular-2/",
            "title": "Adding Client Side Routing to Angular 2",
            "date_published": "2016-11-29T12:30:00.000Z",
            "content_html": "<p>Over the last several Angular 2 posts, we’ve been building up our application bit by bit and examining the various features of Angular 2 along the way using the Angular CLI where that makes sense and modifying it along the way. So far, routing is an area that the Angular CLI does not yet support and so, when you want to use routing in your Angular 2 application, you’ll need to wire most of it in by hand. Now, the routing engine has changed several times during the development of Angular 2. And I know you’re wondering which version of the router this article is going to be talking about. So, to be clear, this article was written using the Angular CLI version 1.0.0-beta.21 and Router version 3.2.1.</p>\n<figure>![](/uploads/2016/11/image-4.png \"Adding Client Side Routing to Angular 2\")<figcaption>Photo credit: [xomiele](//www.flickr.com/photos/xomiele/6759264721/) via [Visualhunt](//visualhunt.com/photos/snow/) / [CC BY](//creativecommons.org/licenses/by/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"What-is-Routing\"><a href=\"#What-is-Routing\" class=\"headerlink\" title=\"What is Routing?\"></a>What is Routing?</h2><p>If you are new to developing Single Page Application (SPAs) you might wonder what Routing is. You might be surprised to find out that you already know what routing is, but you’ve never actually called it by this name.</p>\n<p>For example, using MVC in the ASP.NET world, you used routing whenever you specified what controller you expected your code to hit when you specified a particular URL. You’ll remember that we set our code up so that when we specified that URL, code in a controller would get hit. We also had the option of specifying parameters that we wanted to have passed into our controller methods.</p>\n<p>In a SPA, routing does essentially the same thing. The only difference is that we never have to call the server. This makes all our “Pages” virtual. Instead of requiring that our visitors always start at our home page and navigate into the rest of our site; instead of creating a separate page on the server for each page in our site; we can load all the site up front and the user can navigate to exactly the page they want to be at. They can even link directly to that page and the client side will handle displaying the page appropriately.</p>\n<h2 id=\"There’s-a-Catch\"><a href=\"#There’s-a-Catch\" class=\"headerlink\" title=\"There’s a Catch\"></a>There’s a Catch</h2><p>One of the problems you’ll quickly discover is that for this to work, you’ll need to set your server up so that it doesn’t try to handle the routing as well.</p>\n<p>You see, if you navigate to the home page of your web site and then click around into the sub-pages, everything is going to appear to work correctly. But once you try to navigate directly to an inner page, you are going to become extremely frustrated. The problem lies in order your code gets executed.</p>\n<p>When you request a page directly, what happens is that the server will look for that page on the server. If it can’t find it, it will return, appropriately, a 404 error. The problem is that when we ask for a page that only exist because the client side has said it does, when the server goes to look for it, it will return the 404 error. It isn’t there.</p>\n<p>For the moment, I’m ignoring the fact that Angular 2 supplies a feature called Server Side Rendering, which can also take care of this problem. Given regular, out of the box, Angular 2 code, you’ll want to make sure you server knows what to do when the files don’t exist. What I normally do is that I create a rule on my server that says, “if I’m looking for a path that doesn’t have an extension, just return the index.html page you would have returned if I had asked for the home page.” In Express on Node.JS, the code for this looks like this:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// This comes last.  right before we start listening</span></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(<span class=\"keyword\">function</span>(<span class=\"params\">req,res</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">// this sends back the index.html file when</span></span><br><span class=\"line\">    <span class=\"comment\">// it looks like they are looking for</span></span><br><span class=\"line\">    <span class=\"comment\">// a client side route</span></span><br><span class=\"line\">    <span class=\"comment\">// assuming a real file will have an extension</span></span><br><span class=\"line\">    <span class=\"comment\">// and a route will not.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(req.<span class=\"property\">url</span>.<span class=\"title function_\">indexOf</span>(<span class=\"string\">&#x27;.&#x27;</span>) &gt; -<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">status</span>(<span class=\"number\">404</span>)        <span class=\"comment\">// HTTP status 404: Not Found</span></span><br><span class=\"line\">            .<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;Not found&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">sendFile</span>(__dirname + <span class=\"string\">&#x27;/www/index.html&#x27;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>If you are using IIS and ASP.NET, you might find this article I wrote about using <a href=\"/asp-net-angular-js-html5mode/\">Angular, Routing, and ASP.NET</a> useful.</p>\n<h2 id=\"Enabling-Routing\"><a href=\"#Enabling-Routing\" class=\"headerlink\" title=\"Enabling Routing\"></a>Enabling Routing</h2><p>Since the Angular CLI has included the packages you’ll need to enable routing, there is nothing to install. We just need to write some code.</p>\n<p>Typically routes get enabled at the top of your application after all the common code has been implemented. So, in the location where you want the routing to take effect, add the following tag:</p>\n<p><router-outlet></router-outlet></p>\n<p>I’ve added this to my <code>app.component.html</code> file in the sample app I’ve been working on. Replacing the <code>&lt;h1&gt;&#123; &#123;title&#125;&#125;&lt;/h1&gt;</code> code that we had from the previous weeks.</p>\n<p>If you were to run the code now all that you would see is that the title no longer shows up. We need to add the route code next. You will notice that an <code>app-routing.module.ts</code> file already exist. Open this file. You will see that the bulk of the code we are going to need is already there.</p>\n<p>You should see a line that looks like:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [];</span><br></pre></td></tr></table></figure>\n\n<p>We are going to add a route to this array:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">component</span>: <span class=\"title class_\">ViewComponent</span>,</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<p>What this is saying is that whenever we ask for the home page, load the “ViewComponent” component.</p>\n<p>But wait, we haven’t added any components yet.</p>\n<p>While we COULD just add a component, what I prefer to do is to add a new module. This is because I dislike the idea of making all the components in my code part of one huge modules. It makes it extremely difficult to refactor my code. I also want the ability to implement lazy loading in the future and I will need the component I am routing to, to be part of its own component in order for that to work.</p>\n<p>To add a View component to our code run the following line from the terminal&#x2F;command line <code>ng g module view</code> This will create a new ViewModule module with a new ViewComponent component located in the view directory.</p>\n<p>The rest of what we need to do is to just wire this all into the existing application.</p>\n<p>Go back to <code>app-routing.module.ts</code> and add an import statement to load in <code>ViewComponent</code> and the <code>ViewModule</code>:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; <span class=\"title class_\">ViewComponent</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./view/view.component&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123;<span class=\"title class_\">ViewModule</span>&#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;./view/view.module&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>We also need to add <code>ViewModule</code> to the imports array.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">RouterModule</span>.<span class=\"title function_\">forRoot</span>(routes),</span><br><span class=\"line\">    <span class=\"title class_\">ViewModule</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">exports</span>: [<span class=\"title class_\">RouterModule</span>],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: []</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Next, we need to register the routing module with the application. So, load up the app.module.ts file and add an import statement to import the app-routing module:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; _applicationName_RoutingModule&#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./app-routing.module&#x27;</span>;</span><br></pre></td></tr></table></figure>\n\n<p>And add <code>_applicationName_RoutingModule</code> to the imports array:</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@NgModule</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">declarations</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">AppComponent</span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">imports</span>: [</span><br><span class=\"line\">    <span class=\"title class_\">BrowserModule</span>,</span><br><span class=\"line\">    <span class=\"title class_\">FormsModule</span>,</span><br><span class=\"line\">    <span class=\"title class_\">HttpModule</span>,</span><br><span class=\"line\">    _applicationName_RoutingModule</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">providers</span>: [],</span><br><span class=\"line\">  <span class=\"attr\">bootstrap</span>: [<span class=\"title class_\">AppComponent</span>]</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>Adding additional routes is more of the same. Let’s add another module for editing.</p>\n<p><code>ng g module edit</code></p>\n<p>Add two new paths. One so we can add a new item and one so we can edit an existing item.</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"attr\">routes</span>: <span class=\"title class_\">Routes</span> = [</span><br><span class=\"line\">  &#123; <span class=\"attr\">path</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">ViewComponent</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">path</span>: <span class=\"string\">&#x27;Add&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">EditComponent</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  &#123; <span class=\"attr\">path</span>: <span class=\"string\">&#x27;Edit/:id&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">component</span>: <span class=\"title class_\">EditComponent</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br></pre></td></tr></table></figure>\n\n<p>Notice that for the Edit command I added :id at the end. The :id specifies that this location is where the parameter will be. In this case, the ID of the record that we want to edit.</p>\n<p>We will flesh these out later and I’ll leave adding import statements and adding modules to the import arrays to you. It is essentially copy&#x2F;paste&#x2F;modify from the previous code. When you have the code working, you should be able to navigate to &#x2F;Add or &#x2F;Edit&#x2F;id and see the new page.</p>\n<p>If you get stuck, the code so far can be found here: <a href=\"//github.com/DaveMBush/GettingStartedWithAngular2/tree/Step3\" title=\"https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step3\">https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step3</a></p>\n",
            "tags": [
                "angular",
                "routing"
            ]
        },
        {
            "id": "http://davembush.github.com/unit-testing-an-angular-2-cli-project/",
            "url": "http://davembush.github.com/unit-testing-an-angular-2-cli-project/",
            "title": "Unit Testing an Angular 2 CLI Project",
            "date_published": "2016-11-23T00:30:00.000Z",
            "content_html": "<p>This week we want to continue our series about Angular 2 by looking at the Unit Testing capabilities that Angular 2 provides for us. What we want to cover today is:</p>\n<ul>\n<li>Tweaking Karma to avoid using the Browser Window</li>\n<li>Code Coverage</li>\n<li>Tips to testing components</li>\n</ul>\n<p>This article was written using Angular CLI version 1.0.0-beta.20-4 (Tip, if you are upgrading on windows, <code>rm –rf node_modules dist temp</code> just means to delete the three directories. You can do that part manually, or install bash for Windows and run the command in bash.)</p>\n<figure>![](/uploads/2016/11/image-3.png \"Unit Testing an Angular 2 CLI Project\")<figcaption>Photo credit: [jimmiehomeschoolmom](//www.flickr.com/photos/jimmiehomeschoolmom/4427775569/) via [VisualHunt.com](//visualhunt.com) / [CC BY-NC-SA](//creativecommons.org/licenses/by-nc-sa/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>\n\n<h2 id=\"Tweaking-Karma\"><a href=\"#Tweaking-Karma\" class=\"headerlink\" title=\"Tweaking Karma\"></a>Tweaking Karma</h2><p>Open up the project we’ve been working on.</p>\n<ul>\n<li><a href=\"/getting-started-angular-2/\">Getting Started With Angular 2</a></li>\n<li><a href=\"https://medium.com/@davembush/adding-css-and-javascript-to-an-angular-cli-project-2b843a8283f3\">Adding CSS and JavaScript to an Angular CLI Project</a></li>\n</ul>\n<p>Drop into command line mode and run <code>ng test</code> The first thing you will notice is that this brings up the Chrome browser to run your test. I don’t know about you, but I really dislike having a browser window up. I have enough windows running on my screen as it is. This is the first thing we need to fix. To do this we are going to install PhantomJS.</p>\n<p><code>npm install --save-dev phantomjs-prebuilt</code></p>\n<p>Then, we need to tell karma to use PhantomJS. This is a two step process. First, we install the karma phantomjs runner <code>npm install --save-dev karma-phantomjs-launcher</code> Next, we modify the karma.conf.js file Change <code>require(&#39;karma-chrome-launcher&#39;),</code> and <code>browsers: [&#39;Chrome&#39;],</code> To <code>require(&#39;karma-phantomjs-launcher&#39;),</code> and <code>browsers: [&#39;PhantomJS&#39;],</code> Last, since we are not using the browser, we will need a better reporting mechanism.</p>\n<p>To do this we will install spec reporter.</p>\n<p><code>npm install --save-dev karma-spec-reporter</code></p>\n<p>and we replace this line in karma.conf.js</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reporters<span class=\"punctuation\">:</span> config.angularCli &amp;&amp; config.angularCli.codeCoverage</span><br><span class=\"line\">          ? <span class=\"punctuation\">[</span>&#x27;progress&#x27;<span class=\"punctuation\">,</span> &#x27;karma-remap-istanbul&#x27;<span class=\"punctuation\">]</span></span><br><span class=\"line\">          <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span>&#x27;progress&#x27;<span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br></pre></td></tr></table></figure>\n<p>with</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reporters<span class=\"punctuation\">:</span> config.angularCli &amp;&amp; config.angularCli.codeCoverage</span><br><span class=\"line\">          ? <span class=\"punctuation\">[</span>&#x27;spec&#x27;<span class=\"punctuation\">,</span> &#x27;karma-remap-istanbul&#x27;<span class=\"punctuation\">]</span></span><br><span class=\"line\">          <span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span>&#x27;spec&#x27;<span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br></pre></td></tr></table></figure>\n\n<p>And we add a require line at the top of the file with the other requires</p>\n<p><code>require(&#39;karma-spec-reporter&#39;),</code></p>\n<p>Now, when we run <code>ng test</code> We get a nice text report in our terminal windows instead of the browser popping up.</p>\n<h2 id=\"Code-Coverage\"><a href=\"#Code-Coverage\" class=\"headerlink\" title=\"Code Coverage\"></a>Code Coverage</h2><p>To get a code coverage report for our test use the command ng test –cc The code coverage files will end up in a directory named ‘coverage’ hanging off the root of your project. You can view the coverage&#x2F;index.html file to see how well your files are covered.</p>\n<h2 id=\"Testing-Components\"><a href=\"#Testing-Components\" class=\"headerlink\" title=\"Testing Components\"></a>Testing Components</h2><p>For the purposes of this article, I’m going to assume you have some familiarity with creating Jasmine tests. If you don’t the documentation for Jasmine is pretty easy to understand.</p>\n<p>But what I do want to cover here is how we test components.</p>\n<p>If you open up the <code>app.component.spec.ts</code> file, you’ll notice a <code>TestBed</code> class that gets used quite a bit. Since your test isn’t going to test modules because they only package our other code together, you need some way of faking that out so you can test the components. To do that, you use</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">TestBed</span>.<span class=\"title function_\">configureTestingModule</span>( &#123; <span class=\"attr\">declarations</span>: [ <span class=\"title class_\">AppComponent</span> ] &#125;);</span><br></pre></td></tr></table></figure>\n\n<p>Which just sets up the declarations you need to reference the component you need to test. You can put anything in this block that you would normally put in your module definition.</p>\n<p>Another <code>TestBed</code> method you’ll see is</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title class_\">TestBed</span>.<span class=\"title function_\">createComponent</span>()</span><br></pre></td></tr></table></figure>\n\n<p>which you probably have guessed, creates an instance of the module so you can test it. The object it creates has a <code>debugElement</code> property hanging off of it. There are two properties that hang off this object that you’ll make use of a lot. <code>componentInstance</code> is the actual instance of the component that you created. Any properties and methods that your component has will be available off of <code>componentInstance</code>.</p>\n<p>The other object that will be available is <code>nativeElement</code>. This is the DOM element that the component renders to and you can use <code>querySelector(cssSelectorGoesHere)</code> to select the first element matches the selector or <code>querySelectorAll(cssSelectorGoesHere)</code> to retrieve an array of elements that match.</p>\n<p>Of course, a test isn’t any good if you don’t make changes to the component and test for them. And for that we have <code>detectChanges()</code>. You’ll see that being used in the third test. You’ll want to use that before you <code>expect()</code> anything.</p>\n<h2 id=\"Ready-Set-…\"><a href=\"#Ready-Set-…\" class=\"headerlink\" title=\"Ready, Set, …\"></a>Ready, Set, …</h2><p>Now that we have some way of testing our code, we can actually begin to write so. Don’t forget to subscribe to the email I sent out so you don’t miss the next article in this series.</p>\n<p>Code so far is located at <a href=\"//github.com/DaveMBush/GettingStartedWithAngular2/tree/Step2\">https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step2</a></p>\n",
            "tags": [
                "unit test",
                "angular",
                "javascript",
                "typescript"
            ]
        },
        {
            "id": "http://davembush.github.com/getting-started-with-angular-2/",
            "url": "http://davembush.github.com/getting-started-with-angular-2/",
            "title": "Getting Started with Angular 2",
            "date_published": "2016-10-25T10:30:00.000Z",
            "content_html": "<p>Angular 2 is finally released. But the biggest problem with learning Angular 2 is that it is a “Choose your own adventure” kind of framework. And while React has a similar problem, I think Angular has out done them. This means that you can learn bits and pieces of Angular 2, but it will be a while before you get a cohesive understanding of what choices you need to make, which choices are the right choices, and why all of this matters.</p>\n<p>And all of this is even more difficult if you are a relatively new programmer. I’m talking those of you who have less than 5 years of experience and even some of you who have less than 10 years of experience.</p>\n<p>So, what I thought I’d do to address this very real problem is to assemble a very opinionated Angular 2 tutorial. Over the next several weeks I plan to show you how to create a simple CRUD application using Angular 2 in a way that will scale up to larger projects. While I may mention some of the other options along the way, what you’ll end up with is the “right way.” OK. To be fair, most of what I consider “right” is opinion. Some very smart people disagree with me. But, some other very smart people agree with me too.</p>\n<figure>![](/uploads/2016/10/image-2.png \"Getting Started with Angular 2\")<figcaption>Photo credit: [mikecogh](//www.flickr.com/photos/mikecogh/11300349426/) via [VisualHunt](//visualhunt.com) / [CC BY-SA](//creativecommons.org/licenses/by-sa/2.0/)</figcaption></figure>\n\n<span id=\"more\"></span>  Here’s where I think we are going with this.\n\n<ul>\n<li>Getting the project set up.</li>\n<li>Building, Running, Testing</li>\n<li>Adding in external packages</li>\n<li>Client Side Routing</li>\n<li>Building Components</li>\n<li>Using Reactive Programming</li>\n<li>Managing Application State</li>\n<li>Accessing the Server</li>\n<li>Using Web Workers for more Responsive Applications</li>\n<li>Ahead of Time (AoT) Compiling</li>\n<li>Server Side Rendering</li>\n</ul>\n<p>In this article, let’s focus on just getting a basic application up and running.</p>\n<h2 id=\"Prerequisites\"><a href=\"#Prerequisites\" class=\"headerlink\" title=\"Prerequisites\"></a>Prerequisites</h2><p>If you haven’t installed Node yet, I suggest you do that now. <a href=\"/you-can-start-using-node-today/\">Here’s an article on how to install Node if you are new to Node</a>. Even if you think you know how to install node (“How hard can that be?”) read the article. You might learn something. I would recommend installing Node 6.x as of this writing or whatever the latest version is when you are reading this.</p>\n<p>You’ll also want to get an editor that has good support for TypeScript, HTML, and CSS. I’ve heard a lot of good things about VS Code, but the editor I use is WebStorm. If you are a .NET programmer, Visual Studio will get you kind of close. If you can’t or won’t switch to WebStorm for your JavaScript development, at least get the ReSharper plugin for Visual Studio. You’ll also need plugins to enable Node and TypeScript development from within Visual Studio if you haven’t installed them already.</p>\n<p>For those of you in the Java world using Eclipse. Eclipse has the worse JavaScript support I’ve ever seen. I understand that it is familiar, but just about any other JavaScript editor will be better.</p>\n<p>Anyhow, I’m using WebStorm. If you are using another editor, you are on your own.</p>\n<h2 id=\"Angular-CLI\"><a href=\"#Angular-CLI\" class=\"headerlink\" title=\"Angular CLI\"></a>Angular CLI</h2><p>Now that you have Node installed and you have a reasonably good JavaScript&#x2F;TypeScript editor, the next thing you will want to install is the <a href=\"//github.com/angular/angular-cli\">Angular CLI</a>. As of this writing, the Angular CLI is at Beta .17 so I can understand that you might be hesitant to use it. But it is done enough that we can use it to get our project going with MUCH less effort than if we did it by hand. And hopefully, the parts we need will get completed by the time we need them.</p>\n<p>There are a few other practical reasons for using the CLI rather than coding it yourself. First, the CLI conforms to the Angular 2 style guide. This was developed by the team that wrote Angular 2. Who better to tell us what the code should look like? And while I may not always agree with some of the recommendations, I understand why they are there and I’m willing to live with them. Hopefully, organizations coding Angular 2 applications will conform to these conventions so that anyone who writes Angular 2 code will already know them as they move from one organization to another.</p>\n<p>The instructions are on the web site for installing. But here is what you need to do in a little more detail.</p>\n<p>First, install the angular cli globally.</p>\n<p><code>npm install -g angular-cli</code></p>\n<p>By the way, when you run <code>npm</code> commands, or <code>ng</code> commands later on, you’ll do that from the command line.</p>\n<p>The next thing you’ll want to do is create a new project using the Angular CLI. This is where things are not as clear as I would have liked. Probably because their development environment looks different than mine. The official documents say to run these commands</p>\n<p><code>ng new PROJECT_NAME cd PROJECT_NAME ng serve</code></p>\n<p>where PROJECT_NAME is the name you want to give your project. This project name will become a sub directory under the directory you executed the command from. But what if you want to create a new project first, using your editor, and then you want to run <code>ng new</code>? My first attempt was to run ng new using the directory where my project existed. But that just gave me an error message that said the directory already existed. Yeah, I know.</p>\n<p>Then I tried running <code>ng new</code> without the directory name inside the project directory. The result of that was being told that I forgot a parameter.</p>\n<p>Well, what about using <code>ng new</code> with “.” as a parameter, meaning “current directory”. Nope, “.” is not a valid name. It took me a while to figure this out.</p>\n<p>But you can execute <code>ng init</code> from within the directory your existing project is in and it will scaffold out your application in your current directory.</p>\n<h2 id=\"NG-SERVE\"><a href=\"#NG-SERVE\" class=\"headerlink\" title=\"NG SERVE\"></a>NG SERVE</h2><p>One of the commands you’ll see above is <code>ng serve</code>.</p>\n<p>You may wonder what this is and why you would want to run it. Don’t I just deploy my application on my own server? Well, yes, eventually you will. But while you are developing the application you will want or need to test it locally.</p>\n<p>Since Angular 2 requires a build and packaging step, you’ll want to automate this as much as possible. So, before you toss the idea of using <code>ng serve</code> out, let’s take a look at what this gives you.</p>\n<p>First, <code>ng serve</code> gives you a web server to run your application. By default, this runs on <a href=\"//localhost:4200\">http://localhost:4200</a>. You can try this now.</p>\n<p>Oh wait! What’s it doing? It looks like it is doing way more than starting a web server.</p>\n<p>Well, yes, it is. You see <code>ng serve</code> automatically compiles all of your typescript files and bundles all of your resulting files together every time a file changes. The first time you run <code>ng serve</code>, it will do this because everything has changed. But it gets better, it will also refresh whatever browser is looking at the application so that your browser will always reflect whatever changes you’ve made in your source code.</p>\n<p>There are a few specific cases where this won’t work, but generally this works out pretty well.</p>\n<p>If you make a change and it doesn’t get reflected as you would expect, try restarting the server. That will probably fix the issue.</p>\n<p>The other thing you can do is that you can configure the server to proxy request to another server. This would be useful if you want to pull data from your Java, ASP.NET, or other platform while still running ng serve for the client side development work.</p>\n<p>If everything is working so far, you should be able to pull up your browser and run the application on <a href=\"//localhost:4200\">http://localhost:4200</a> and see a message “app works!” It really is just the barest of all possible applications.</p>\n<h2 id=\"What-Else\"><a href=\"#What-Else\" class=\"headerlink\" title=\"What Else?\"></a>What Else?</h2><p>If you are curious like I am, you may have taken a look around the file structure to see what was installed. One directory you may have noticed is the “e2e” directory. This is where your end to end tests go. You can run these using the command</p>\n<p><code>ng e2e</code></p>\n<p>Just make sure you have already run ng serve in another window. You can also run the unit tests that are in *.spec.ts files by running the command</p>\n<p><code>ng test</code></p>\n<p>This will run the tests using Jasmine in a Chrome browser.</p>\n<p>The final thing to note about the CLI is that it uses Webpack instead of System.JS to manage bundling and minification. As of this writing, the tour of heroes demo still uses System.JS so this might be a point of confusion for you. The good news is that Webpack is a bit more straight forward than System.JS and I believe you’ll find it a lot easier to use.</p>\n<h2 id=\"Follow-Along\"><a href=\"#Follow-Along\" class=\"headerlink\" title=\"Follow Along\"></a>Follow Along</h2><p>The result of step one can be found on my GitHub account: <a href=\"//github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-1\" title=\"https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-1\">https://github.com/DaveMBush/GettingStartedWithAngular2/tree/Step-1</a></p>\n",
            "tags": [
                "angular",
                "javascript"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-2-thoughts/",
            "url": "http://davembush.github.com/angular-2-thoughts/",
            "title": "Angular 2 Thoughts",
            "date_published": "2016-10-04T10:30:00.000Z",
            "content_html": "<p>I was asked this past week what my thoughts were on Angular 2. I wrote early on about my impressions of Angular 2 when it was barely done enough to review. But now that I’ve been working with it for a while and know a bit more, what I want to discuss is more along the line of what it means to the average developer and, more importantly, organizations that are planning to use it.</p>\n<p><img src=\"/uploads/2016/09/image-3.png\" alt=\"image\" title=\"image\"></p>\n<h2 id=\"Options\"><a href=\"#Options\" class=\"headerlink\" title=\"Options\"></a>Options</h2><p>While like Angular 1, Angular 2 provides us with most of what we need to build an application. Angular 2 also provides us, out of the box, with very Angular 1 ish ways of putting together an application, complete with modules. What Angular 2 provides that isn’t quite so obvious going into your development is options.</p>\n<p>In angular 1, we had options at the GUI level. And while this is still true for Angular 2, this is not the only place where you will see options.</p>\n<p>In general, you can split your options into, 1) do you want to do things the Angular 1 way, or 2) would you like to use an approach that looks more like React.JS? No place is this more obvious than with how you deal with forms. You can create forms with a declarative syntax, like you’ve done with Angular 1, using <a href=\"//angular.io/docs/ts/latest/guide/template-syntax.html\">Template Syntax</a>. But, in my opinion, a much better way to create forms is with a more reactive approach using the FormControls and FormGroups classes. If all you are doing is just displaying data, you’ll probably find that using the template syntax is all you need. But once you start working with complex forms that accepts data input and implements validation, you’ll probably want to move toward a more reactive approach. The added benefit is that more of you code will be testable.</p>\n<p>The next option you are going to have is figuring out how to move data around your system. Most of the literature is going to suggest you use a data flow that looks a lot like what you were doing in Angular 1. But there is nothing stopping you from using Flux, Redux, or even RxJS instead. And here again, my recommendation would be that you learn these because I think you’ll find that your system will end up being much easier to reason about than the old MVVM stuff you may be used to.</p>\n<h2 id=\"Lazy-Loading\"><a href=\"#Lazy-Loading\" class=\"headerlink\" title=\"Lazy Loading\"></a>Lazy Loading</h2><p>There are several places where we had to make choices in Angular 2 where the feature has been built into the framework. One of these places is lazy loading. Why load all of your JavaScript up front? Load what you need when you need it. Angular 2 makes this easy with Lazy Loading and the choice between using WebPack (the default) or System.JS.</p>\n<p>I’ll warn you though, as of this writing, Lazy Loading only really works when using System.JS unless you want to spend a lot of time tweaking your webpack config file.</p>\n<h2 id=\"Angular-2-CLI\"><a href=\"#Angular-2-CLI\" class=\"headerlink\" title=\"Angular 2 CLI\"></a>Angular 2 CLI</h2><p>Command Line Interfaces seem to be the cool new kid on the block. You aren’t a real framework unless you have one. While the Angular CLI is not quite baked yet, I can see how this is going to make writing Angular 2 apps much easier. There are a lot of moving parts involved in getting even the most basic of applications up and running. The Angular CLI makes starting your first application REALLY easy. It even hides all of the WebPack internals while allowing you to add your own config file if you need to. Once they have the routing bit re-implemented, it should make using Lazy Loading with WebPack much easier.</p>\n<p>The other thing using the CLI will do for you is that you will automatically start following the <a href=\"//angular.io/styleguide\">coding standards</a> that the Angular team have developed.</p>\n<h2 id=\"Angular-2-Components\"><a href=\"#Angular-2-Components\" class=\"headerlink\" title=\"Angular 2 Components\"></a>Angular 2 Components</h2><p>Right now, there aren’t a lot of options available for Angular 2 for custom components. While Kendo UI has been the defacto standard for Angular components in the past, Telerik is in the middle of rewriting <a href=\"//www.telerik.com/blogs/kendo-ui-for-angular-2-r3-roadmap\">Kendo UI for Angular 2</a> (and React.JS). I haven’t seen any movement in the Angular UI camp to support Angular 2. Angular 2 Material has a few components that seem ready, but they are all relatively simple. The only vendors that seems to have a complete Angular 2 package is <a href=\"//wijmo.com/angular2/\">Wijmo</a> and <a href=\"//www.primefaces.org/primeng/\">Prime Faces</a>. I haven’t tried them and I’m not endorsing them. I’m just reporting what I’ve found. There are a few standalone components here and there, but if you are looking for a set of components you can just use from one source, I’m afraid you’ll have to wait. This isn’t necessarily a bad thing. It gives you time to properly learn Angular 2.</p>\n<p>But what about the Angular 1 to Angular 2 bridge? In my mind this is way more trouble than it is worth. We’ve waited two years for Angular 2, I think we can wait just a bit longer for a set of components that we can use with it.</p>\n<h2 id=\"What-Angular-2-Means-for-You\"><a href=\"#What-Angular-2-Means-for-You\" class=\"headerlink\" title=\"What Angular 2 Means for You\"></a>What Angular 2 Means for You</h2><p>The main difference between Angular 1 and Angular 2 is that just about any Script Kiddie could pick up Angular 1 and get something done. Angular 1 was developed during a period of JavaScript history when JavaScript had not quite reach the level of “serious programming language.” But now, JavaScript has not just reached that level, but several very serious frameworks have been developed.</p>\n<p>What I notice as I review the JavaScript landscape is that we’ve moved from just getting stuff done with little to no planning, to treating JavaScript as a first class programming language that requires, and even demands that we adhere to a set of programming best practices that we would use for any other language. These include things like naming conventions and design patterns. For you to write code well in this new universe, you will need to understand what these design patterns are, why they exist and how to implement them well. If you continue on your merry script kiddie way, you will soon find yourself out of work.</p>\n<p>Further, if you think you know Angular 2 just because you know Angular 1, or you think Angular 2 will be easy to pick up because you know Angular 1, you are in for a very big surprise. Many of the concepts are the same. But since Angular 2 has so many options, you should learn the options well so that you can make an educated decision about which option to use.</p>\n<h2 id=\"What-Angular-2-Means-for-Organizations\"><a href=\"#What-Angular-2-Means-for-Organizations\" class=\"headerlink\" title=\"What Angular 2 Means for Organizations\"></a>What Angular 2 Means for Organizations</h2><p>Similarly, if you are an organization that is planning to move to Angular 2, don’t expect your programmers to just pick up and move to Angular 2 overnight. Give them time to learn it. My recommendation is that you make learning it part of their job while they continue to use Angular 1 for the product you are trying to complete. We all have time pressure, so you need to factor learning into the schedule.</p>\n<p>But Angular 2 may also mean you need to find additional programmers who already have the skills and can transfer the knowledge to your team.</p>\n",
            "tags": [
                "angular",
                "javascript"
            ]
        },
        {
            "id": "http://davembush.github.com/angular-2-%E2%80%93-first-impressions-compared-to-angular-1/",
            "url": "http://davembush.github.com/angular-2-%E2%80%93-first-impressions-compared-to-angular-1/",
            "title": "Angular 2 – First Impressions [Compared to Angular 1]",
            "date_published": "2016-02-25T13:30:00.000Z",
            "content_html": "<p>I’ve spent the last week putting together <a href=\"//github.com/DaveMBush/MEA2N_CRUD_Reference_App\">a reference app for Angular 2</a>.  It is a great exercise to try to nail down the basics of how a new framework works.  Next week I plan on doing a similar exercise for <a href=\"//facebook.github.io/react/\">React</a>.</p>\n<p>Anyhow, I thought for this week’s post, I would try to relay some of my impressions, and some of the issues I see with this new framework.</p>\n<p><img src=\"/uploads/2016/02/image-3.png\" alt=\"Angular 2 - First Impressions\" title=\"Angular 2 - First Impressions\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"Why-call-it-Angular-2\"><a href=\"#Why-call-it-Angular-2\" class=\"headerlink\" title=\"Why call it Angular 2?\"></a>Why call it Angular 2?</h2><p>I realize naming things is always hard, but I think naming something similar to something that already exist is dangerous.</p>\n<p>When .NET first came out, many ASP programmers tried to use ASP.NET as though it were ASP.  That didn’t turn out so well for them and, I think, confused them.</p>\n<p>VB.NET had a similar problem.  During those early days of .NET I was working for a training company.  I had several ex VB6 developers show up to my C# class.  Do you know why?  Because they realized that VB.NET was such an entirely different language, they were better off just starting over with a new language than possibly treating VB.NET as though it were VB6.  Good call if you ask me.</p>\n<p>Most recently, Microsoft has learned from history and decided to rename the product they’ve been referring to as .NET 5 as .NET Core 1.0.  In this case it is enough like .NET that keeping .NET in the name is a good thing.  But starting the versioning at 1.0 again also shows that this is a brand new product with some differences from what we are all used to.</p>\n<p>Rob Eisenburg decided to call his new project Aurelia instead of Durandal 2 because they are enough different from each other.  While I’m not an expert on either product, I’m pretty sure that there are elements of Durandal in Aurelia simply because Rob was significantly involved in both projects.</p>\n<p>Which brings me to Angular 2.</p>\n<p>Why call it Angular anything?!  Angular 2 has very little in common with Angular 1.x other than basic concepts.  But, so much has changed it is like calling “ASP.NET 1.0” “ASP 5”.  It just doesn’t work, and it hides the fact that there is going to be a HUGE learning curve for those who are familiar with Angular 1.</p>\n<h2 id=\"So-What-Has-Changed\"><a href=\"#So-What-Has-Changed\" class=\"headerlink\" title=\"So What Has Changed?\"></a>So What Has Changed?</h2><h3 id=\"Case-sensitive-vs-Snake-Case\"><a href=\"#Case-sensitive-vs-Snake-Case\" class=\"headerlink\" title=\"Case sensitive vs Snake Case\"></a>Case sensitive vs Snake Case</h3><p>In Angular 1, all of the directives that we create are case sensitive in our code and snake-case-in-our-html.  In Angular2, the HTML markup is case sensitive.  Rob went on a rant about this <a href=\"//eisenbergeffect.bluespire.com/on-angular-2-and-html/\">here</a>.  His issue is that Angular 2 isn’t HTML spec compliant because it is case sensitive.  I’m really not sure how much this matters as long as the final result is compliant.  My issue is more along the lines of, “did this really need to change at all?”</p>\n<h3 id=\"Basic-Syntax-Changes\"><a href=\"#Basic-Syntax-Changes\" class=\"headerlink\" title=\"Basic Syntax Changes\"></a>Basic Syntax Changes</h3><p>Then there are the basic syntax changes.  If you want to bind to an html element property you use square brackets.  If you want to fire an event, you use parenthesis.  If you want two way databinding, you use both.</p>\n<p>What? We didn’t need this distinction with Angular 1.  Why the distinction in Angular 2?  I suppose it has something to do with making it easier for Angular 2 to parse the HTML.  But, from the outside looking in, the thing you are binding to should make it clear enough what it is you are trying to do.  It reminds me of Pascal (the language).  More syntax for the sake of making sure the programmer can’t shoot himself in the foot.</p>\n<h3 id=\"TypeScript\"><a href=\"#TypeScript\" class=\"headerlink\" title=\"TypeScript\"></a>TypeScript</h3><p>I fell in love with TypeScript back at version 0.9.  The advantage to an object oriented programmer is that you don’t have to think differently about your client side code using TypeScript than you would about your server side code if you are using a real object oriented language like C#, or Java on the server side.</p>\n<p>But TypeScript isn’t JavaScript.  And while you can write Angular 2 using JavaScript, the preferred language, and the language that the bulk of Angular 2 is written in, is TypeScript.</p>\n<p>To confuse matters, rather than tell the world, “Hey, just use TypeScript” they decided to give us options.  You can use Dart (what’s that?) JavaScript, or TypeScript.  We’ve already been through this with VB.NET and C#.  Doesn’t anyone learn from history?  Eventually C# won.  Oh, there are a few hold outs.  But even most of the VB lovers have given up and moved to C#.  It will be interesting to see how this TypeScript move plays out.</p>\n<p>On the one hand, I think TypeScript is a better version of JavaScript.  On the other hand, if all you know is TypeScript, it will make it harder to find a job as a JavaScript programmer.</p>\n<p>While TypeScript is definitely a better choice than having a new proprietary language just for Angular, which was the original plan, I still think we might have better off using pure JavaScript as the language of choice.</p>\n<p>Like I said, I’m a fan of TypeScript, I’m just not sure making this the default language is a good choice.</p>\n<h3 id=\"Everything-Visual-Is-a-Component\"><a href=\"#Everything-Visual-Is-a-Component\" class=\"headerlink\" title=\"Everything Visual Is a Component\"></a>Everything Visual Is a Component</h3><p>Unlike Angular 1 where you have pages and directives, everything in Angular 2 from a visual perspective maps to an element.  This is a good change.</p>\n<p>At first when I heard this, I had trouble having it make sense in my mind.  But having implemented it once, I see that it really does make a lot of sense.</p>\n<p>You can also create new attributes that you can attach to an element.  But attributes add behavior to an element rather that making an element do or be something entirely different like you could do with Angular 1.</p>\n<h3 id=\"Component-CSS\"><a href=\"#Component-CSS\" class=\"headerlink\" title=\"Component CSS\"></a>Component CSS</h3><p>I’m really not sure if I like this feature or not.  Done right, I think it is a very good thing.  Done poorly, this could be a disaster.</p>\n<p>Here’s the deal. In Angular 1, when you wrote a directive, any CSS you wrote to go with it needed to be included separately by the person using your component.  In Angular 2, you bind that CSS to your component and it gets included in the HEAD of your html.  It also gets mangled, similar to how ASP.NET would mangle IDs in WebForms, so that the CSS from the component won’t conflict with the other CSS that the page is using.</p>\n<p>This is all in preparation for the forthcoming HTML standard that will support Web Components. What is good about this is that the component is stand alone.  What is bad about this is that if I need to override the CSS, that might be a bit more difficult to do than what we are used to.</p>\n<h3 id=\"Routing\"><a href=\"#Routing\" class=\"headerlink\" title=\"Routing\"></a>Routing</h3><p>My biggest disappointment with Angular 2 is with the new router.  Is it better than the router that comes with Angular 1?  Yes.  Absolutely.</p>\n<p>Is it better than <a href=\"//angular-ui.github.io/ui-router/\">UI-Router</a>?  I’m not so sure.</p>\n<p>The new router will let you have nested routes.  While it doesn’t do it in exactly the same way as you can with UI-Router, it can be done.  And like UI-Router’s ng-sref, you can link to routes by name.</p>\n<p>But the part I never could find clear documentation on is how I would create two insertion points in my HTML for route specific content like I could do with UI-Router.  From what little I could find it looks like they had something working that looked a lot like UI-Router and then they ripped it out in favor of some other method that either is not there yet, or is not clearly documented.</p>\n<h3 id=\"Singletons\"><a href=\"#Singletons\" class=\"headerlink\" title=\"Singletons\"></a>Singletons</h3><p>If you’ve done any work with Angular 1, you’ll be familiar with the confusion between the different types of singletons.  The good news with Angular 2 is that everything is just considered a service.  If you decorate your class with “Injectable” the class can be injected into other classes. But, and I consider this a really big stumbling block moving to Angular 2, services are really singletons.  This is both good and bad.</p>\n<p>Typically we create a hierarch of components in our site with components housing other components.  To get singleton behavior, you would declare the need for your service as far up that hierarchy as is practical.  Just not at the app level.  You would hardly ever want to do that.  You only declare the dependency once in your app.  At the point you declare the dependency a new object is created that is injected anywhere else down the component hierarchy you specify that you need it in your constructor.</p>\n<p>But you need to pay attention to how I phrased that last paragraph because what creates the object is the fact that you declared the dependency.  If you declare it again, you get a new object.</p>\n<p>At first glance, this may appear to be a bad thing.  But I can think of situations where I may actually want to either have one object for an entire application or one object per instance of a component.  This new way of implementing injectable objects gives us that flexibility.</p>\n<h3 id=\"Promises-vs-Observables\"><a href=\"#Promises-vs-Observables\" class=\"headerlink\" title=\"Promises vs Observables\"></a>Promises vs Observables</h3><p>While it doesn’t make sense to get into the details here, it is worth mentioning that instead of using Promises to avoid callback hell, Angular 2 is using RXjs’ observables.  It might take a while to get your head around this new paradigm.  But as it turns out, it would appear that observables can be used in more places than promises can because they are stream based.</p>\n<h2 id=\"Better-x2F-New-x2F-Enhanced\"><a href=\"#Better-x2F-New-x2F-Enhanced\" class=\"headerlink\" title=\"Better&#x2F;New&#x2F;Enhanced\"></a>Better&#x2F;New&#x2F;Enhanced</h2><h3 id=\"Declarative-or-Explicitly-Coded-Forms\"><a href=\"#Declarative-or-Explicitly-Coded-Forms\" class=\"headerlink\" title=\"Declarative or Explicitly Coded Forms\"></a>Declarative or Explicitly Coded Forms</h3><p>In Angular 1, just about everything view related is declarative.  This works, but at times I found it awkward to use.  For example, I needed to add validation to an element and it just seemed there must be an easier more direct way to do this than what I was given in Angular 1.</p>\n<p>In Angular 2, you can just put enough code in the HTML to render the element and then attach the JavaScript to it using function calls.  This gives you A LOT more control over you view, even if it does take a bit more work to get it setup.</p>\n<p>I think there are times when it will still make sense to do everything declaratively.  But for anything more than a trivial form, I think you are going to love this new option.</p>\n<h3 id=\"Binding-Optimization\"><a href=\"#Binding-Optimization\" class=\"headerlink\" title=\"Binding Optimization\"></a>Binding Optimization</h3><p>The Angular 2 databinding seems to be optimized.  I don’t fully understand exactly what is different, but I’ll take their word for it that it is, or will be once we are no longer in beta.</p>\n<h2 id=\"Still-Needs-Work\"><a href=\"#Still-Needs-Work\" class=\"headerlink\" title=\"Still Needs Work\"></a>Still Needs Work</h2><h3 id=\"Rendering-Optimization\"><a href=\"#Rendering-Optimization\" class=\"headerlink\" title=\"Rendering Optimization\"></a>Rendering Optimization</h3><p>As I’ve started to look at React, and other systems that create “Virtual DOMs” I keep thinking, “Why can’t Angular do something like this?”  Being able to manipulate all of the DOM and then show the result when you are done is one of the easiest places to improve performance, and yet I don’t see any hooks in Angular that would make this possible.  This isn’t to say that I think React is better than Angular.  So far, I see some really big issues with React as well.  But I’d love to have some kind of Virtual DOM implementation in Angular without losing what is already built in.</p>\n<h3 id=\"Testability\"><a href=\"#Testability\" class=\"headerlink\" title=\"Testability\"></a>Testability</h3><p>I can’t comment fully on the ability to test Angular 2 simply because the documentation for this is not fully baked.  So, I’ll refrain from making any comments at all.</p>\n<h2 id=\"Conclusion\"><a href=\"#Conclusion\" class=\"headerlink\" title=\"Conclusion\"></a>Conclusion</h2><p>There are a lot of wins with Angular 2 and I think, in general, you are going to like this new framework.  It will be interesting to see how the UI component space will mature around this new framework.</p>\n<p>If you are interested in learning Angular 2, I would suggest that you work through the <a href=\"//angular.io/docs/ts/latest/tutorial/\">tutorial</a> and read through the <a href=\"//angular.io/docs/ts/latest/guide/\">development guide</a>.</p>\n",
            "tags": [
                "angular",
                "javascript"
            ]
        },
        {
            "id": "http://davembush.github.com/adventures-working-with-angular%E2%80%99s-scope/",
            "url": "http://davembush.github.com/adventures-working-with-angular%E2%80%99s-scope/",
            "title": "Adventures Working With Angular’s $scope",
            "date_published": "2015-11-26T13:30:00.000Z",
            "content_html": "<p>Every week when I write, I try to think back on the past week and think, “What have I learned that might be useful to others.”  Most weeks that is a pretty easy question to answer because I get most of my pleasure from learning new stuff.  But this week was different.</p>\n<p>When I sat down to write today, I couldn’t come up with a subject that couldn’t be covered with a sentence.  More of a tweet than a blog post.  It was so bad that I decided to go run the errands that are on my list and come back to it once I got home.</p>\n<p>Evidently, that was a good move because I think I have something that will be genuinely useful.  Although I will admit that if you’ve been working with AngularJS for very long at all, you may have already learned what I’m about to explain.</p>\n<p><img src=\"/uploads/2015/11/image2.png\" alt=\"image\" title=\"image\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"The-Basics\"><a href=\"#The-Basics\" class=\"headerlink\" title=\"The Basics\"></a>The Basics</h2><p>To make sure we are all on the same page, I want to cover the basics first.  Every controller has a $scope variable associated with it.  $scopes can be nested within each other, which allows us to either have child scopes add information to parent scopes using prototypical inheritance, or the child $scope can be isolated so that it can’t see the parent $scope up the nesting chain.  In either case, you can gain access to the parent $scope by using the $parent variable.</p>\n<p>What is important to realize about $scope is that it is attached to the element’s this pointer.  Every controller you create is its own object and $scope is just one of many properties that is part of that object.</p>\n<p>Now, in normal Angular programming, you may only ever create one controller per element.  But if you’ve ever created a directive that gets used on multiple places, or you’ve done anything with repeaters, you know that controllers can be created “under the hood.”  So that the $scope for the repeater item isn’t the same as the $scope for the element that holds the main collection.</p>\n<h2 id=\"scope-and-ControllerAs\"><a href=\"#scope-and-ControllerAs\" class=\"headerlink\" title=\"$scope and ControllerAs\"></a>$scope and ControllerAs</h2><p>In version 1.2 of Angular, the ControllerAs syntax was added, this can be added in a number of different ways that I won’t describe here.  That’s old news and there are plenty of places to find that information, including the Angular documentation.  But what isn’t clear at first, is what this feature does for us under the hood. Many people, who haven’t dug in deep under the hood assume that somehow this replaces $scope.  But in fact what it does is that it adds a variable onto $scope.  If you were to use ControllerAs redMonkey, what actually happens under the hood is that you end up with a variable named “redMonkey” that is hanging off of the controller’s $scope variable.</p>\n<p>In fact, what you end up with is this holding a property “$scope” and $scope holding a property “redMonkey” which is actually pointing to the controller’s this pointer.  Further, it is possible to have elements in your view bind to other variables hanging off of $scope while in the same view, other things are bound to variables hanging off of redMonkeys.</p>\n<h2 id=\"scope-and-Singletons\"><a href=\"#scope-and-Singletons\" class=\"headerlink\" title=\"$scope and Singletons\"></a>$scope and Singletons</h2><p>I hope at this point you have a relatively clear picture of how $scope works because this is where things start to get interesting.  You see, just about everything else that you create in Angular is a singleton.  That is, only one instance of it exist in the entire application.  So, what happens if you pass $scope into one of these singletons and you use that singleton multiple times on the same page? Well, there’s no telling for sure.  You might get lucky and everything will seem to work, until one day it doesn’t.  In fact, you may never notice that there is a problem if you only ever call it from one controller or directive at a time.</p>\n<p>But to use singletons effectively, what you need to do is that you will need to pass the scope to each of the functions you need to have use it, unless you can be sure it will only be able to use one scope at a time.  As a general rule, you should never store state in anything that is a singleton.</p>\n<p>How do I know? Well, this week, I was working on some code that I thought was overriding the control’s controller.  But, when I finally got it all working I found that it only worked some of the time because what I had really overridden was a method in a directive.  Another time this week, I was doing something similar thinking I was overriding a function in the main control’s $scope only to find out that the function I was overloading was in a nested repeater item.</p>\n<h2 id=\"Finding-scope-for-an-element\"><a href=\"#Finding-scope-for-an-element\" class=\"headerlink\" title=\"Finding $scope for an element\"></a>Finding $scope for an element</h2><p>If you need help figuring out what $scope is bound to what element in your code, you can use the <a href=\"//chrome.google.com/webstore/detail/angularjs-batarang/ighdmehidhipcmcojjgiloacoafjmpfk?hl=en\">Batarang plugin</a>.  You can also use the following JavaScript code using any developer tool you might want to use.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">angular.<span class=\"title function_\">element</span>(elementSelector).<span class=\"title function_\">scope</span>()</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"scope-and-Repeaters\"><a href=\"#scope-and-Repeaters\" class=\"headerlink\" title=\"$scope and Repeaters\"></a>$scope and Repeaters</h2><p>So, back to one of my issues this week.  What I was working with was a tree control.  The tree was a set of repeaters within repeaters.  The original function that was bound to the click event was bound to the item scope so that each item was bound to its own instance of the onClick method.</p>\n<p>What I was trying to do was to override the function with a function in a directive I had created that wrapped the tree control and added a search box.  Fortunately, the item template could be changed, but how to get it to call MY click handler instead of the one it called by default? To further complicate matters, the $scope in the directives were isolated so I couldn’t add a new function on the scope I had control over and have the child scope see it.</p>\n<p>Or could I? The directive I was creating does have access to the scope of the tree control.  So, all I really needed to do was to create a new variable hanging off the tree control’s scope that pointed to the scope I wanted it to see and then in my template I could point to that variable and the function hanging off of it as the thing that should get called on click.</p>\n<p>Sure enough, that worked.</p>\n",
            "tags": [
                "angular",
                "javascript",
                "scope"
            ]
        },
        {
            "id": "http://davembush.github.com/create-a-desktop-application-using-angular-bootstrap-and-c/",
            "url": "http://davembush.github.com/create-a-desktop-application-using-angular-bootstrap-and-c/",
            "title": "Create A Desktop Application using Angular, Bootstrap and C#",
            "date_published": "2015-10-15T11:30:00.000Z",
            "content_html": "<p>Last week I mentioned that it is possible to <a href=\"/7-reasons-every-programmer-needs-to-learn-javascript/\">create a desktop application using JavaScript</a> and that I had actually started working on an application that used Angular and Bootstrap for the presentation layer.  I actually have enough of that working that I can share the “how-to” with you.</p>\n<p><img src=\"/uploads/2015/10/image1.png\" alt=\"image\" title=\"image\"></p>\n<span id=\"more\"></span>\n\n<h2 id=\"Why-Would-You-Do-This\"><a href=\"#Why-Would-You-Do-This\" class=\"headerlink\" title=\"Why Would You Do This?\"></a>Why Would You Do This?</h2><p>Well, I don’t know why YOU would do this, but the reason I’m doing this is because the more I do on the web, the less able I am to work with Windows Form, and I haven’t even bothered learning WPF.  I decided several years ago that I would niche down over web technologies.  And yet, I want to write this desktop application.  I tried to use Windows Form, which I am most familiar with, and just got frustrated.  I want to use a grid control.  But what I want to do with the control is something more like what I would do with Angular’s ui-grid than what I can do with the grid control built into Windows Form. I’m sure someone who really knew the desktop side of the fence would be able to do what I want to do.  But I want to leverage what I know.  And eventually, I may move the whole thing to Node.js even though to get the thing up and running, I am going to use C# for the main processing.</p>\n<h2 id=\"Rendering-HTML\"><a href=\"#Rendering-HTML\" class=\"headerlink\" title=\"Rendering HTML\"></a>Rendering HTML</h2><p>The first step toward getting all of this working is to just get HTML to render inside of a Windows Form (or WPF) executable.  I decided to use Windows Forms because I don’t need any of the WPF goodness that WPF would give me.  But you could tweak most of the setup I’m going to give you so that it would work with WPF if that’s your preferred platform.</p>\n<p>So, let’s start out by creating a Windows Form based application.  Once you have the project loaded, you’ll want to grab the <a href=\"//www.nuget.org/packages/CefSharp.WinForms/\">CefSharp Windows Forms DLL’s and related files</a>.  You can use NuGet to get these installed.  Just search for, “CefSharp.WinForms”.</p>\n<p>Because chromium uses Win32 or Win64 based C++ DLLs, you’ll need to configure your project to run as one or the other project.  This part was a little tricky.  What I found was that just changing the project settings for the default configuration named “Any CPU” was not enough.  What you need to do is to create a new project named “x64” or “x32” and change the settings there.</p>\n<p>Try compiling now, before you add any code.  If you’ve configured the project correctly with the CefSharp DLLs it should compile.</p>\n<p>The next thing you want to do is to insert the Chromium Browser control into the form.  Yes, it is a control like any other control.  No, you won’t find it on your toolbar.  No, it isn’t worth adding to the toolbar.  It is the only control that is going to be on the form so all you need to do is add it to the form using a few lines of code.</p>\n<p>First, add a private variable to hold the browser control.  It doesn’t need to be a member variable to get the HTML to render, but you’ll want it to be private later on.  So, just make it private to start with.</p>\n<p>Then, in your Load() method, add the following code:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Form1_Load</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Initialize CefSharp</span></span><br><span class=\"line\">     Cef.Initialize();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Create a new browser window</span></span><br><span class=\"line\">    _browser =</span><br><span class=\"line\">        <span class=\"keyword\">new</span> ChromiumWebBrowser(<span class=\"string\">&quot;http://www.google.com/&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Add the new browser window to the form</span></span><br><span class=\"line\">    Controls.Add(_browser);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>You will also need code in your <code>FormClosing()</code> method.  You can create this in Visual Studio by selecting it from the dropdowns in the upper right corner of the code window.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title\">Form1_FormClosing</span>(<span class=\"params\"><span class=\"built_in\">object</span> sender, EventArgs e</span>)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Cef.Shutdown();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>OK.  Compile and run.  You should be able to load the Google web site and see it in your Windows Form.</p>\n<h2 id=\"Using-Our-Own-Files\"><a href=\"#Using-Our-Own-Files\" class=\"headerlink\" title=\"Using Our Own Files\"></a>Using Our Own Files</h2><p>OK, so we’ve proven that we can render HTML inside of a Windows Form application.  But that won’t do us much good if we want to run code on our own.  Most of the places on the web that talk about loading HTML inside of a desktop application using Chromium suggest that you copy the HTML files over as content and use the file:&#x2F;&#x2F; protocol to load them.  But there are two problems with doing that.  First, I don’t want the files generally accessible to whoever has this installed.  What if someone decides to change those files? The second problem I have is even worse.  Assuming I could live with the files being available on the file system, Angular doesn’t work from the file system.  It wants to run from <a href=\"http://somedomain/\">http://somedomain/</a>.  So at the very least, we need for our files to LOOK like they’ve been served from a web server.</p>\n<p>Fortunately, we can solve both of these problems.</p>\n<h3 id=\"Make-Our-Files-Resources\"><a href=\"#Make-Our-Files-Resources\" class=\"headerlink\" title=\"Make Our Files Resources\"></a>Make Our Files Resources</h3><p>To start with, we’ll just add one file.  Since it will be the beginning of our main application, name the file index.html and place it in a directory called “web” off the root of your project.  Put enough HTML in there that you’ll know the file actually got loaded.</p>\n<p>Then in the file properties, mark the file as an “Embedded Resource” instead of “Content” To load this file as a resource, you’ll use code that looks something like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> assembly = Assembly.GetExecutingAssembly();</span><br><span class=\"line\"><span class=\"keyword\">var</span> textStream = assembly.GetManifestResourceStream</span><br><span class=\"line\">                 (<span class=\"string\">&quot;TopLevelNamespace.web.index.html&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Make-it-LOOK-Like-it-Came-From-a-Server\"><a href=\"#Make-it-LOOK-Like-it-Came-From-a-Server\" class=\"headerlink\" title=\"Make it LOOK Like it Came From a Server\"></a>Make it LOOK Like it Came From a Server</h3><p>This is where some of the magic starts to happen.  The Chromium APIs have code that will let you register a pre-canned response object with a URL using a dictionary.  So, all we need to do is change the text string that we returned in the code above into a response object and register it with Chromium.</p>\n<p>The code to do that looks like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> factory = (DefaultResourceHandlerFactory)(browser.ResourceHandlerFactory);</span><br><span class=\"line\"><span class=\"keyword\">if</span> (factory == <span class=\"literal\">null</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> response = ResourceHandler.FromStream(textStream);</span><br><span class=\"line\">factory.RegisterHandler(<span class=\"string\">&quot;http://local/&quot;</span>, response);</span><br></pre></td></tr></table></figure>\n\n<p>And now, when we tell Chromium to load “<a href=\"http://local/%E2%80%9D\">http://local/”</a> it  will render the index.html file from our EXE.</p>\n<p>Cool! Now, loading each file like this is going to get rather tedious pretty fast.  So what we need is a mechanism for loading all of the files in our web directory automatically.  For this we need to be able to iterate over all of our resources in the web namespace and register them with an associated “http:&#x2F;&#x2F;” tag.</p>\n<p>Since the best that we can do is get a list of all of the resources in our assembly, we will have to do some filtering to only register stuff in the “web” namespace.  But, there is another issue.  All of the resources are going to be listed as “TopLevelNamespace.web.subnamespace.filename.extension” and we want to register them as “<a href=\"http://local/subnamespace/filename.extension%E2%80%9D\">http://local/subnamespace/filename.extension”</a>.  So there is a bit of string manipulation that we need to go through to register everything correctly.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Get the list of resources</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> resourceNames = Assembly.GetExecutingAssembly()</span><br><span class=\"line\">    .GetManifestResourceNames();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// For each resource</span></span><br><span class=\"line\"><span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> resource <span class=\"keyword\">in</span> resourceNames)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"comment\">// If it isn&#x27;t in the &quot;web&quot; namespace, skip it.</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!resource.StartsWith(<span class=\"string\">&quot;TopLevelNamespace.web&quot;</span>))</span><br><span class=\"line\">        <span class=\"keyword\">continue</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Strip out the namespace that we don&#x27;t need.</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> url = resource.Replace</span><br><span class=\"line\">        (<span class=\"string\">&quot;TopLevelNamespace.web.&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Function I made that turns the</span></span><br><span class=\"line\">    <span class=\"comment\">// resource into a textStream</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> r = LoadResource(url);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Make the namespace look like a path</span></span><br><span class=\"line\">    url = url.Replace(<span class=\"string\">&quot;.&quot;</span>, <span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> lastSlash = url.LastIndexOf(<span class=\"string\">&quot;/&quot;</span>,</span><br><span class=\"line\">        StringComparison.Ordinal);</span><br><span class=\"line\">    url = url.Substring(<span class=\"number\">0</span>, lastSlash) + <span class=\"string\">&quot;.&quot;</span> +</span><br><span class=\"line\">        url.Substring(lastSlash + <span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Register the response with the URL</span></span><br><span class=\"line\">    factory.RegisterHandler(<span class=\"string\">&quot;http://local/&quot;</span> + url,</span><br><span class=\"line\">        ResourceHandler.FromStream(r));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Now that I’ve explained all of the code.  The full class for loading the resources looks like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title\">RegisterWebsite</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">Load</span>(<span class=\"params\">ChromiumWebBrowser browser</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> factory = (DefaultResourceHandlerFactory)</span><br><span class=\"line\">            (browser.ResourceHandlerFactory);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (factory == <span class=\"literal\">null</span>) <span class=\"keyword\">return</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> response = ResourceHandler</span><br><span class=\"line\">            .FromStream(LoadResource(<span class=\"string\">&quot;index.html&quot;</span>));</span><br><span class=\"line\">        factory.RegisterHandler(<span class=\"string\">&quot;http://local/&quot;</span>, response);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">var</span> resourceNames = Assembly.GetExecutingAssembly()</span><br><span class=\"line\">            .GetManifestResourceNames();</span><br><span class=\"line\">        <span class=\"keyword\">foreach</span> (<span class=\"keyword\">var</span> resource <span class=\"keyword\">in</span> resourceNames)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!resource.StartsWith(<span class=\"string\">&quot;TopLevelNamespace.web&quot;</span>))</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> url = resource.Replace(<span class=\"string\">&quot;TopLevelNamespace.web.&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> r = LoadResource(url);</span><br><span class=\"line\">            url = url.Replace(<span class=\"string\">&quot;.&quot;</span>, <span class=\"string\">&quot;/&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">var</span> lastSlash = url.LastIndexOf(<span class=\"string\">&quot;/&quot;</span>,</span><br><span class=\"line\">                StringComparison.Ordinal);</span><br><span class=\"line\">            url = url.Substring(<span class=\"number\">0</span>, lastSlash) + <span class=\"string\">&quot;.&quot;</span> +</span><br><span class=\"line\">                url.Substring(lastSlash + <span class=\"number\">1</span>);</span><br><span class=\"line\">            factory.RegisterHandler(<span class=\"string\">&quot;http://local/&quot;</span> + url,</span><br><span class=\"line\">                 ResourceHandler.FromStream(r));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">static</span> Stream <span class=\"title\">LoadResource</span>(<span class=\"params\"><span class=\"built_in\">string</span> filename</span>)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> assembly = Assembly.GetExecutingAssembly();</span><br><span class=\"line\">        <span class=\"keyword\">var</span> textStream = assembly</span><br><span class=\"line\">            .GetManifestResourceStream(<span class=\"string\">&quot;TopLevelNamespace.&quot;</span></span><br><span class=\"line\">                + filename);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> textStream;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>There is some obvious room for improvement here.  But the basics are there, you can tweak as needed.</p>\n<p>The main entry point is the Load method where we pass in a pointer to the browser control we created when we started this project.</p>\n<h2 id=\"Getting-JavaScript-to-talk-to-C\"><a href=\"#Getting-JavaScript-to-talk-to-C\" class=\"headerlink\" title=\"Getting JavaScript to talk to C#\"></a>Getting JavaScript to talk to C#</h2><p>Now that we have the basics out of the way, we need to get the two halves of our project talking to each other.  The first half is that we need a way for our JavaScript client side code to retrieve data and send notifications to our server side code.  Fortunately, the mechanisms for doing this are already built into Chromium.</p>\n<p>Any C# object can be registered with Chromium as a JavaScript object so that any property will become a JavaScript field and any method will become a JavaScript method.</p>\n<p>The API to make this happen looks like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_browser</span><br><span class=\"line\">    .RegisterJsObject(<span class=\"string\">&quot;NameYouWantJavaScriptToSeeThisObjectAs&quot;</span>,</span><br><span class=\"line\">        cSharpObjectHere);</span><br></pre></td></tr></table></figure>\n\n<p>In our JavaScript code, we would find that the window object now has a field named “NameYouWantJavaScriptToSeeThisObjectAs”</p>\n<h2 id=\"Getting-C-to-talk-to-C\"><a href=\"#Getting-C-to-talk-to-C\" class=\"headerlink\" title=\"Getting C# to talk to C#\"></a>Getting C# to talk to C#</h2><p>The reverse is just as easy.</p>\n<p>_browser.ExecuteScriptAsync(string) takes a string that is the JavaScript that you want to execute.</p>\n<h2 id=\"Getting-the-Communication-To-Play-Nice-with-Angular\"><a href=\"#Getting-the-Communication-To-Play-Nice-with-Angular\" class=\"headerlink\" title=\"Getting the Communication To Play Nice with Angular\"></a>Getting the Communication To Play Nice with Angular</h2><p>But getting this all to play well with <a href=\"//angularjs.org/\">Angular</a> requires just a little bit more.</p>\n<p>You may find that code on your screen that depends on a field or method that was registered with RegisterJsObject does not update when it should.  In fact, I would guess that this would happen most of the time because our C# object knows nothing of Angular and Angular knows nothing of our C# object.  So to fix this, we will need to make sure we $watch our C# object in our angular code.</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$scope.$watch(<span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span><br><span class=\"line\">    &#123;<span class=\"keyword\">return</span> <span class=\"variable language_\">window</span>.<span class=\"property\">RegisteredObject</span>.<span class=\"property\">property</span>&#125;,</span><br><span class=\"line\">    <span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">    $scope.<span class=\"property\">someField</span> = <span class=\"variable language_\">window</span>.<span class=\"property\">RegisteredObject</span>.<span class=\"property\">property</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>What this code does is that it tells Angular to check this field when it goes through its $digest cycle.  If it has changed since the last time it looked, it should run the second function that was passed in to $watch().</p>\n<p>But this isn’t the only code you will need to add.  Whenever you make a change to something on the C# side that the Angular code needs to reflect, you’ll need to tell Angular to run the $digest() cycle manually.  To do that, you’ll use that ExecuteScriptAsync() method to run some JavaScript.</p>\n<p>The easiest way to do this is to just run it off the top level $scope object.  The way you find the top level $scope object is to use JavaScript to find the element that you marked as “ng-app” in your HTML.  Once you’ve done that, you will see that it has a scope() method hanging off of it.  So this code will force a $digest cycle on everything from the top level $scope all of the way down.</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_browser</span><br><span class=\"line\">    .ExecuteScriptAsync(<span class=\"string\">&quot;angular.element(&#x27;[ng-app]&#x27;).scope().$digest();&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>Alternatively, you could skip setting the watch and have your ExecuteScriptAsync call set the $scope variables directly using something like this:</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_browser.ExecuteScriptAsync(</span><br><span class=\"line\">  <span class=\"string\">&quot;angular.element(&#x27;#IdOfViewThatHasAControllerAttached&#x27;).&quot;</span>+</span><br><span class=\"line\">  <span class=\"string\">&quot;scope().status = &#x27;this is a new status&#x27;;angular.&quot;</span> +</span><br><span class=\"line\">  <span class=\"string\">&quot;element(&#x27;[ng-app]&#x27;).scope().$digest();&quot;</span>);</span><br></pre></td></tr></table></figure>\n\n<p>Where #IdOfViewThatHasAControllerAttached is an ID of a element in a view that you’ve associated with a controller.  You’ll still want your controller to pull from the C# JavaScript object for the initial load because the DIV may or may not be there when you do the push.  Personally, I prefer the $watch method.  There is less to think about on the C# side.</p>\n<p>And that’s how you create a desktop application using Angular, Bootstrap and C#.</p>\n",
            "tags": [
                "angular",
                "javascript",
                "angular.js",
                "bootstrap"
            ]
        }
    ]
}