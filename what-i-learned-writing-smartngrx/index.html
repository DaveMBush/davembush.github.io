<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>What I Learned Writing SmartNgRX | Dave&#39;s Notebook</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Last week, I announced a project I had been working on for over 10 months. I call it SmartNgRX and it solves many common issues most of us have using SmartNgRX, including the boilerplate issue, over-f">
<meta property="og:type" content="article">
<meta property="og:title" content="What I Learned Writing SmartNgRX">
<meta property="og:url" content="http://davembush.github.com/what-i-learned-writing-smartngrx/index.html">
<meta property="og:site_name" content="Dave&#39;s Notebook">
<meta property="og:description" content="Last week, I announced a project I had been working on for over 10 months. I call it SmartNgRX and it solves many common issues most of us have using SmartNgRX, including the boilerplate issue, over-f">
<meta property="og:locale">
<meta property="article:published_time" content="2024-10-14T11:12:03.000Z">
<meta property="article:modified_time" content="2024-12-19T15:23:12.843Z">
<meta property="article:author" content="Dave M Bush">
<meta property="article:tag" content="angular">
<meta property="article:tag" content="ngrx">
<meta property="article:tag" content="smart-ngrx">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Dave&#39;s Notebook" type="application/atom+xml">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" integrity="sha384-XdYbMnZ/QjLh6iI4ogqCTaIjrFk87ip+ekIjefZch0Y+PvJ8CDYtEs1ipDmPorQ+" crossorigin="anonymous">

  
<link rel="stylesheet" href="/css/styles.css">

  

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <nav class="navbar navbar-inverse">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="main-menu-navbar">
      <ul class="nav navbar-nav">
        
          <li><a class=""
                 href="/index.html">Home</a></li>
        
          <li><a class=""
                 href="/archives/">Archives</a></li>
        
      </ul>

      <!--
      <ul class="nav navbar-nav navbar-right">
        
          <li><a href="/atom.xml" title="RSS Feed"><i class="fa fa-rss"></i></a></li>
        
      </ul>
      -->
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

  <div class="container">
    <div class="blog-header">
  <h1 class="blog-title">Dave&#39;s Notebook</h1>
  
</div>

    <div class="row">
        <div class="col-sm-8 blog-main">
          <article id="post-what-I-learned-writing-smart-ngrx" class="article article-type-post" itemscope itemprop="blogPost">

  <header class="article-header">
    
  
    <h1 class="article-title" itemprop="name">
      What I Learned Writing SmartNgRX
    </h1>
  


  </header>

  <div class="article-meta">
    <div class="article-datetime">
  <a href="/what-i-learned-writing-smartngrx/" class="article-date"><time datetime="2024-10-14T11:12:03.000Z" itemprop="datePublished">2024-10-14</time></a>
</div>

    
    

  </div>
  <div class="article-inner">

    <div class="article-entry" itemprop="articleBody">
      
        <p>Last week, I announced a project I had been working on for over 10 months. I call it <a href="/smart-ngrx/">SmartNgRX</a> and it solves many common issues most of us have using SmartNgRX, including the boilerplate issue, over-fetching, and memory pressure caused by stale data.</p>
<p>Today I want to talk about a few things I learned while creating SmartNgRX that can be applied globally to any project.</p>
<span id="more"></span>

<h2 id="No-Boilerplate-Needed"><a href="#No-Boilerplate-Needed" class="headerlink" title="No Boilerplate Needed"></a>No Boilerplate Needed</h2><p>While SmartNgRX solves the boilerplate issue, you can apply this to your code simply by making all your NgRX slices behave the same. Once you’ve done that, you can create a single factory function for each of your Actions, Reducers, and Effects and use that to generate the Actions, Reducers, and Effects you need.</p>
<p>You can see how I’ve done this by looking at the source code for SmartNgRX.</p>
<h3 id="Generic-Actions"><a href="#Generic-Actions" class="headerlink" title="Generic Actions"></a>Generic Actions</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> actionGroupCache = <span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">unknown</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> actionFactory&lt;T <span class="keyword">extends</span> <span class="title class_">SmartNgRXRowBase</span>&gt;(</span><br><span class="line">  <span class="attr">feature</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">entity</span>: <span class="built_in">string</span>,</span><br><span class="line">): <span class="title class_">ActionGroup</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> source = <span class="string">`<span class="subst">$&#123;feature&#125;</span><span class="subst">$&#123;psi&#125;</span><span class="subst">$&#123;entity&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> cached = actionGroupCache.<span class="title function_">get</span>(source) <span class="keyword">as</span> <span class="title class_">ActionGroup</span>&lt;T&gt; | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">if</span> (cached) &#123;</span><br><span class="line">    <span class="keyword">return</span> cached;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> actionGroup = <span class="title function_">createActionGroup</span>(&#123;</span><br><span class="line">    <span class="attr">source</span>: source <span class="keyword">as</span> <span class="built_in">any</span>,</span><br><span class="line">    <span class="attr">events</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;Update Many&#x27;</span>: props&lt;<span class="title class_">UpdateChanges</span>&lt;T&gt;&gt;(),</span><br><span class="line">      <span class="title class_">Remove</span>: props&lt;<span class="title class_">IdsProp</span>&gt;(),</span><br><span class="line">      <span class="string">&#x27;Load By Ids&#x27;</span>: props&lt;<span class="title class_">IdsProp</span>&gt;(),</span><br><span class="line">      <span class="string">&#x27;Load By Ids Preload&#x27;</span>: props&lt;<span class="title class_">IdsProp</span>&gt;(),</span><br><span class="line">      <span class="string">&#x27;Store Rows&#x27;</span>: props&lt;<span class="title class_">RowsProp</span>&lt;T&gt;&gt;(),</span><br><span class="line">      <span class="title class_">Update</span>: props&lt;&#123; <span class="attr">old</span>: <span class="title class_">RowProp</span>&lt;T&gt;; <span class="attr">new</span>: <span class="title class_">RowProp</span>&lt;T&gt; &#125;&gt;(),</span><br><span class="line">      <span class="string">&#x27;Add To Store&#x27;</span>: props&lt;<span class="title class_">RowProp</span>&lt;T&gt;&gt;(),</span><br><span class="line">      <span class="title class_">Add</span>: props&lt;&#123;</span><br><span class="line">        <span class="attr">row</span>: T;</span><br><span class="line">        <span class="attr">parentId</span>: <span class="built_in">string</span>;</span><br><span class="line">        <span class="attr">parentFeature</span>: <span class="built_in">string</span>;</span><br><span class="line">        <span class="attr">parentEntityName</span>: <span class="built_in">string</span>;</span><br><span class="line">      &#125;&gt;(),</span><br><span class="line">      <span class="string">&#x27;Add Success&#x27;</span>: props&lt;&#123;</span><br><span class="line">        <span class="attr">newRow</span>: T;</span><br><span class="line">        <span class="attr">oldRow</span>: T;</span><br><span class="line">        <span class="attr">parentId</span>: <span class="built_in">string</span>;</span><br><span class="line">        <span class="attr">parentFeature</span>: <span class="built_in">string</span>;</span><br><span class="line">        <span class="attr">parentEntityName</span>: <span class="built_in">string</span>;</span><br><span class="line">      &#125;&gt;(),</span><br><span class="line">      <span class="title class_">Delete</span>: props&lt;&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="built_in">string</span>;</span><br><span class="line">        <span class="attr">parentInfo</span>: &#123; <span class="attr">feature</span>: <span class="built_in">string</span>; <span class="attr">entity</span>: <span class="built_in">string</span>; <span class="attr">ids</span>: <span class="built_in">string</span>[] &#125;[];</span><br><span class="line">      &#125;&gt;(),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  actionGroupCache.<span class="title function_">set</span>(source, actionGroup);</span><br><span class="line">  <span class="keyword">return</span> actionGroup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A casual glance will show you that all I’ve done is wrap the <code>createActionGroup</code> function from NgRX with a function that takes a feature and entity name and returns an ActionGroup. This is a simple example of reducing boilerplate in your code. We use the feature name and the entity name to generate the source name for the ActionGroup which makes it unique.</p>
<p>You’ll notice that I’ve also cached the <code>ActionGroup</code> so that if you call it again, you’ll get the same <code>ActionGroup</code> back. This simple optimization allows you to use the factory function to retrieve the action wherever you need it instead of passing it around. In my case, I needed this because the library doesn’t expose the actions used by NgRX and I wanted to let the developers using SmartNgRX use the actions in their code if they desired.</p>
<h3 id="Reducers"><a href="#Reducers" class="headerlink" title="Reducers"></a>Reducers</h3><p>Similarly, I’ve wrapped <code>createReducer</code> with a factory function that takes the feature and entity name and returns a reducer. Again, this is all you need to ensure the reducer is unique.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> reducerFactory&lt;T <span class="keyword">extends</span> <span class="title class_">SmartNgRXRowBase</span>&gt;(</span><br><span class="line">  <span class="attr">feature</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">entity</span>: <span class="built_in">string</span>,</span><br><span class="line">): <span class="title class_">ActionReducer</span>&lt;<span class="title class_">EntityState</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> adapter = entityDefinitionCache&lt;T&gt;(feature, entity).<span class="property">entityAdapter</span>;</span><br><span class="line">  <span class="keyword">const</span> initialState = adapter.<span class="title function_">getInitialState</span>();</span><br><span class="line">  <span class="keyword">const</span> actions = actionFactory&lt;T&gt;(feature, entity);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createReducer</span>(</span><br><span class="line">    initialState,</span><br><span class="line">    <span class="title function_">on</span>(actions.<span class="property">add</span>, <span class="function">(<span class="params">state, &#123; row &#125;</span>) =&gt;</span> adapter.<span class="title function_">upsertOne</span>(row, state)),</span><br><span class="line">    <span class="title function_">on</span>(actions.<span class="property">addSuccess</span>, <span class="function">(<span class="params">state, &#123; newRow &#125;</span>) =&gt;</span></span><br><span class="line">      adapter.<span class="title function_">upsertOne</span>(newRow, state),</span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">on</span>(actions.<span class="property">updateMany</span>, <span class="function">(<span class="params">state, &#123; changes &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> adapter.<span class="title function_">updateMany</span>(changes, state);</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="title function_">on</span>(actions.<span class="property">remove</span>, <span class="function">(<span class="params">state, &#123; ids &#125;</span>) =&gt;</span> adapter.<span class="title function_">removeMany</span>(ids, state)),</span><br><span class="line">    <span class="title function_">on</span>(actions.<span class="property">update</span>, <span class="function">(<span class="params">state, &#123; <span class="keyword">new</span>: &#123; row &#125; &#125;</span>) =&gt;</span></span><br><span class="line">      adapter.<span class="title function_">upsertOne</span>(row, state),</span><br><span class="line">    ),</span><br><span class="line"></span><br><span class="line">    <span class="title function_">on</span>(actions.<span class="property">storeRows</span>, <span class="function">(<span class="params">state, &#123; rows &#125;</span>) =&gt;</span> adapter.<span class="title function_">upsertMany</span>(rows, state)),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Effects"><a href="#Effects" class="headerlink" title="Effects"></a>Effects</h3><p>Finally, I’ve wrapped <code>createEffect</code> with a factory function that takes the feature and entity name and returns an effect. This is the same as the other two examples.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> effectsFactory&lt;T <span class="keyword">extends</span> <span class="title class_">SmartNgRXRowBase</span>&gt;(</span><br><span class="line">  <span class="attr">feature</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">entityName</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">effectsServiceToken</span>: <span class="title class_">InjectionToken</span>&lt;<span class="title class_">EffectService</span>&lt;T&gt;&gt;,</span><br><span class="line">): <span class="title class_">Record</span>&lt;<span class="title class_">EffectsFactoryKeys</span>, <span class="title class_">FunctionalEffect</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> actions = actionFactory&lt;T&gt;(feature, entityName);</span><br><span class="line">  <span class="keyword">const</span> entityDefinition = entityDefinitionCache&lt;T&gt;(feature, entityName);</span><br><span class="line">  <span class="keyword">const</span> adapter = entityDefinition.<span class="property">entityAdapter</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Ends up calling the `EffectService` to delete the row specified</span></span><br><span class="line"><span class="comment">     * by the ID in the action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">delete</span>: <span class="title function_">createEffect</span>(</span><br><span class="line">      <span class="title function_">deleteEffect</span>(effectsServiceToken, actions),</span><br><span class="line">      dispatchFalse,</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Ends up calling the `EffectService` to determine what rows</span></span><br><span class="line"><span class="comment">     * need to be loaded yet and returns dummy rows for those rows.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">loadByIdsPreload</span>: <span class="title function_">createEffect</span>(</span><br><span class="line">      <span class="title function_">loadByIdsPreloadEffect</span>(feature, entityName, actions),</span><br><span class="line">      dispatchFalse,</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Ends up calling the `EffectService` to load the rows specified</span></span><br><span class="line"><span class="comment">     * from the server.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">loadByIds</span>: <span class="title function_">createEffect</span>(</span><br><span class="line">      <span class="title function_">loadByIdsEffect</span>(effectsServiceToken, actions, feature, entityName),</span><br><span class="line">      dispatchFalse,</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Ends up calling the `EffectService` to update the row specified</span></span><br><span class="line"><span class="comment">     * by the row in the action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">update</span>: <span class="title function_">createEffect</span>(</span><br><span class="line">      updateEffect&lt;T&gt;(effectsServiceToken, actions, feature, entityName),</span><br><span class="line">      dispatchFalse,</span><br><span class="line">    ),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Ends up calling the `EffectService` to add the row specified</span></span><br><span class="line"><span class="comment">     * by the row in the action.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">add</span>: <span class="title function_">createEffect</span>(<span class="title function_">addEffect</span>(effectsServiceToken, actions), dispatchTrue),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handles adding the new row to the store and removing the dummy row</span></span><br><span class="line"><span class="comment">     * that was added so we could edit it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="attr">addSuccess</span>: <span class="title function_">createEffect</span>(</span><br><span class="line">      addSuccessEffect&lt;T&gt;(effectsServiceToken, actions, adapter),</span><br><span class="line">      dispatchFalse,</span><br><span class="line">    ),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>By now, you get the general idea. A couple of things to note about the <code>effectsFactory</code>.</p>
<p>First we pass in an <code>InjectionToken</code> that is used to get the <code>EffectService</code> that is used by the effects. By doing this, all we need to do is make sure your effects services conform to the <code>EffectService</code> abstract class and we can use them in the effects.</p>
<p>This is how SmartNgRX can hide NgRX from the developer and just let them implement the specifics for each entity.</p>
<p>You’ll also notice that to keep the code clean, I’ve implemented the details in other functions that I call. If you want to see the details, you can <a target="_blank" rel="noopener" href="https://github.com/DaveMBush/SmartNgRX/tree/cbec5143855b1916e0c67776b22a6134a18d5ee4/libs/smart-ngrx/src/effects">look at the source code for the effects in SmartNgRX</a>.</p>
<p>Second, we use the cached <code>ActionGroup</code> by calling the <code>actionFactory</code> function to get the actions we need for the effects instance. Now we don’t need to know about a specific instance and find some way to pass it into the effect.</p>
<p>Finally, we need access to the EntityAdapter for the entity we are working with. We create the entity adapter when we configure SmartNgRX. The two lines of code, above, that retrieve the adapter are retrieving it from a map where we set it during SmartNgRX setup</p>
<p>And that’s how you avoid NgRX boilerplate in your code.</p>
<h2 id="Too-Many-Actions-and-Reducers"><a href="#Too-Many-Actions-and-Reducers" class="headerlink" title="Too Many Actions and Reducers"></a>Too Many Actions and Reducers</h2><p>I’ve been saying this for several years and still managed to get this “wrong” while writing my code.</p>
<p>Here’s the basic issue. Reducers and Effects have specific purposes. Where I went wrong is with my reducers. But I’ll address both Reducers and Effects here.</p>
<p>But first, let’s take a detour and talk about an ideal NgRX setup.</p>
<h3 id="Ideal-NgRX-Setup"><a href="#Ideal-NgRX-Setup" class="headerlink" title="Ideal NgRX Setup"></a>Ideal NgRX Setup</h3><p>The Redux pattern, generally, and NgRX, specifically, were created to store states predictably. “State only” is my motto. This means that logic should be kept out of our NgRX code. This keeps our NgRX code simple and reduces bugs. You wouldn’t believe some of the code I’ve seen that violates this principle. Then again, maybe you could. You’ve probably written it.</p>
<p>So, if we want to keep logic out of NgRX, where should it go?</p>
<h3 id="Action-Services"><a href="#Action-Services" class="headerlink" title="Action Services"></a>Action Services</h3><p>It goes in a service. When you call an action, it should already have the data in the form that NgRX ultimately needs. The reducer can then take this data and store it in the store without doing anything to it.</p>
<p>Notice how small my reducer code is.</p>
<h3 id="Effects-Service"><a href="#Effects-Service" class="headerlink" title="Effects Service"></a>Effects Service</h3><p>Similarly, when you call an effect, it should already have the data to do whatever it needs. Again, in an ideal world, all the effect does is call what I’ve come to term the effect service. The effect service can do whatever work needs to be done.</p>
<p>For example, say you are calling the server, but the shape of the data you get back isn’t what your application will need. The place to do the transformation is in the effect service. Not in the effect.</p>
<p>By doing this, you’ll only need actions that perform basic CRUD operations. You shouldn’t see actions for every possible way you could change the state of your application. Most of that can, and should, be handled in an Action Service.</p>
<p>There has been a lot of noise in the community about using the “facade” pattern with NgRX but most implementations I’ve seen just put a class in front of the same actions we’ve always had. This is not a facade pattern. This is just a bulky, excessive layer in front of what we’ve always been doing.</p>
<p>What I’m doing is closer to a facade pattern because now all those action calls become calls to a service. The service does the transformations and dispatches whatever action is appropriate to update the store.</p>
<h3 id="Command-or-Event-Pattern"><a href="#Command-or-Event-Pattern" class="headerlink" title="Command or Event Pattern"></a>Command or Event Pattern</h3><p>By following these tip, the question of using the command or event patterns with NgRX becomes moot. The argument for using the event pattern is that your actions now give you some idea of what triggered them by using the action name as the where. In the pattern I’ve described, 100% of your actions (should) get triggered by the same code every time if you’ve structured things correctly.  That code gets triggered by multiple other places just like any other function in your code does. Now, you can evaluate the call stack. You can still use the event pattern. But, there isn’t a strong argument for it anymore.</p>
<p>The best part about using this pattern is that I’m in a great position to convert SmartNgRX to use Signals instead of Observables and most of my code won’t change.</p>
<p>As far as NgRX code is concerned, the only NgRX place you should have any logic at all is in Selectors, but that’s a topic for another day.</p>

      
    </div>

    
      

    

    <footer class="article-footer">
      <a data-url="http://davembush.github.com/what-i-learned-writing-smartngrx/" data-id="clyuc0yp20000nghi6sri3vv7" class="article-share-link">
        <i class="fa fa-share"></i> Share
      </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/angular/" rel="tag">angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ngrx/" rel="tag">ngrx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/smart-ngrx/" rel="tag">smart-ngrx</a></li></ul>


    </footer>
  </div>
  
    
<ul id="article-nav" class="nav nav-pills nav-justified">
  
  <li role="presentation">
    <a href="/navigating-work-relationships/" id="article-nav-older" class="article-nav-link-wrap">
      <i class="fa fa-chevron-left pull-left"></i>
      <span class="article-nav-link-title">Navigating Work Relationships</span>
    </a>
  </li>
  
  
  <li role="presentation">
    <a href="/smart-ngrx/" id="article-nav-newer" class="article-nav-link-wrap">
      <span class="article-nav-link-title">smart-ngrx</span>
      <i class="fa fa-chevron-right pull-right"></i>
    </a>
  </li>
  
</ul>


  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments</noscript>
    <script src="https://giscus.app/client.js"
        data-repo="DaveMBush/davembush.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzkwNzY1NTc="
        data-category="Announcements"
        data-category-id="DIC_kwDOCEojzc4CRNna"
        data-mapping="title"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
  </div>
</section>



        </div>
        <div class="col-sm-3 col-sm-offset-1 blog-sidebar">
          
  
  <div class="sidebar-module">
    <h4>Recents</h4>
    <ul class="sidebar-module-list">
      
        <li>
          <a href="/use-typescript-class-instead-of-interface-or-type/">Use TypeScript Class instead of Interface or Type</a>
        </li>
      
        <li>
          <a href="/optimizing-angular-for-speed/">Optimizing Angular For Speed</a>
        </li>
      
        <li>
          <a href="/ngrx-performance-improvement/">NgRX Performance Improvement</a>
        </li>
      
        <li>
          <a href="/smart-ngrx/">smart-ngrx</a>
        </li>
      
        <li>
          <a href="/what-i-learned-writing-smartngrx/">What I Learned Writing SmartNgRX</a>
        </li>
      
    </ul>
  </div>


  
  <div class="sidebar-module">
    <h4>Archives</h4>
    <ul class="sidebar-module-list"><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2025/04/">April 2025</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2025/01/">January 2025</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2024/12/">December 2024</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2024/10/">October 2024</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2023/08/">August 2023</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2023/07/">July 2023</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2023/03/">March 2023</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2022/12/">December 2022</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2022/11/">November 2022</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2022/07/">July 2022</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2022/05/">May 2022</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2021/09/">September 2021</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2021/05/">May 2021</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/11/">November 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/10/">October 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/06/">June 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2020/01/">January 2020</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/10/">October 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/09/">September 2018</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/08/">August 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/07/">July 2018</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/03/">March 2018</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/02/">February 2018</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2018/01/">January 2018</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/12/">December 2017</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/11/">November 2017</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/10/">October 2017</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/09/">September 2017</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/08/">August 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/07/">July 2017</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/06/">June 2017</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/05/">May 2017</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/04/">April 2017</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/03/">March 2017</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/02/">February 2017</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2017/01/">January 2017</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/12/">December 2016</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/11/">November 2016</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/10/">October 2016</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/09/">September 2016</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/08/">August 2016</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/07/">July 2016</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/06/">June 2016</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/05/">May 2016</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/04/">April 2016</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/03/">March 2016</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/02/">February 2016</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2016/01/">January 2016</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/12/">December 2015</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/11/">November 2015</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/10/">October 2015</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/09/">September 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/08/">August 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/07/">July 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/06/">June 2015</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/05/">May 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/04/">April 2015</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/03/">March 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/02/">February 2015</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2015/01/">January 2015</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/12/">December 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/11/">November 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/10/">October 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/09/">September 2014</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/08/">August 2014</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/07/">July 2014</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/06/">June 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/05/">May 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/04/">April 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/03/">March 2014</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/02/">February 2014</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2014/01/">January 2014</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/12/">December 2013</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/11/">November 2013</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/10/">October 2013</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/09/">September 2013</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/08/">August 2013</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/07/">July 2013</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/06/">June 2013</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/05/">May 2013</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2013/01/">January 2013</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2012/09/">September 2012</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2012/08/">August 2012</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2010/10/">October 2010</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2010/03/">March 2010</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/12/">December 2009</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/10/">October 2009</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/09/">September 2009</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/08/">August 2009</a><span class="sidebar-module-list-count">3</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/07/">July 2009</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/06/">June 2009</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/04/">April 2009</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/03/">March 2009</a><span class="sidebar-module-list-count">4</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/02/">February 2009</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2009/01/">January 2009</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/12/">December 2008</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/11/">November 2008</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/08/">August 2008</a><span class="sidebar-module-list-count">2</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/07/">July 2008</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/06/">June 2008</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/05/">May 2008</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2008/04/">April 2008</a><span class="sidebar-module-list-count">1</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2007/11/">November 2007</a><span class="sidebar-module-list-count">5</span></li><li class="sidebar-module-list-item"><a class="sidebar-module-list-link" href="/archives/2007/10/">October 2007</a><span class="sidebar-module-list-count">1</span></li></ul>
  </div>




        </div>
    </div>
  </div>
  <footer class="blog-footer">
  <div class="container">
    <div id="footer-info" class="inner">
      &copy; 2025 Dave M Bush<br>
      All opinions are my own and do not reflect any company I have or am currently working at.<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

  

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>




<script src="/js/script.js"></script>


</body>
</html>
